var Rw=Object.defineProperty;var Cw=(n,e,t)=>e in n?Rw(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var w=(n,e,t)=>Cw(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&r(l)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function Ad(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Pf={exports:{}},To={},kf={exports:{}},Le={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Z_;function Iw(){if(Z_)return Le;Z_=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),_=Symbol.iterator;function y(M){return M===null||typeof M!="object"?null:(M=_&&M[_]||M["@@iterator"],typeof M=="function"?M:null)}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,S={};function C(M,Q,re){this.props=M,this.context=Q,this.refs=S,this.updater=re||b}C.prototype.isReactComponent={},C.prototype.setState=function(M,Q){if(typeof M!="object"&&typeof M!="function"&&M!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,M,Q,"setState")},C.prototype.forceUpdate=function(M){this.updater.enqueueForceUpdate(this,M,"forceUpdate")};function P(){}P.prototype=C.prototype;function z(M,Q,re){this.props=M,this.context=Q,this.refs=S,this.updater=re||b}var k=z.prototype=new P;k.constructor=z,x(k,C.prototype),k.isPureReactComponent=!0;var V=Array.isArray,Z=Object.prototype.hasOwnProperty,Y={current:null},L={key:!0,ref:!0,__self:!0,__source:!0};function E(M,Q,re){var be,Te={},Ee=null,Ne=null;if(Q!=null)for(be in Q.ref!==void 0&&(Ne=Q.ref),Q.key!==void 0&&(Ee=""+Q.key),Q)Z.call(Q,be)&&!L.hasOwnProperty(be)&&(Te[be]=Q[be]);var _e=arguments.length-2;if(_e===1)Te.children=re;else if(1<_e){for(var we=Array(_e),Ve=0;Ve<_e;Ve++)we[Ve]=arguments[Ve+2];Te.children=we}if(M&&M.defaultProps)for(be in _e=M.defaultProps,_e)Te[be]===void 0&&(Te[be]=_e[be]);return{$$typeof:n,type:M,key:Ee,ref:Ne,props:Te,_owner:Y.current}}function R(M,Q){return{$$typeof:n,type:M.type,key:Q,ref:M.ref,props:M.props,_owner:M._owner}}function N(M){return typeof M=="object"&&M!==null&&M.$$typeof===n}function j(M){var Q={"=":"=0",":":"=2"};return"$"+M.replace(/[=:]/g,function(re){return Q[re]})}var K=/\/+/g;function G(M,Q){return typeof M=="object"&&M!==null&&M.key!=null?j(""+M.key):Q.toString(36)}function fe(M,Q,re,be,Te){var Ee=typeof M;(Ee==="undefined"||Ee==="boolean")&&(M=null);var Ne=!1;if(M===null)Ne=!0;else switch(Ee){case"string":case"number":Ne=!0;break;case"object":switch(M.$$typeof){case n:case e:Ne=!0}}if(Ne)return Ne=M,Te=Te(Ne),M=be===""?"."+G(Ne,0):be,V(Te)?(re="",M!=null&&(re=M.replace(K,"$&/")+"/"),fe(Te,Q,re,"",function(Ve){return Ve})):Te!=null&&(N(Te)&&(Te=R(Te,re+(!Te.key||Ne&&Ne.key===Te.key?"":(""+Te.key).replace(K,"$&/")+"/")+M)),Q.push(Te)),1;if(Ne=0,be=be===""?".":be+":",V(M))for(var _e=0;_e<M.length;_e++){Ee=M[_e];var we=be+G(Ee,_e);Ne+=fe(Ee,Q,re,we,Te)}else if(we=y(M),typeof we=="function")for(M=we.call(M),_e=0;!(Ee=M.next()).done;)Ee=Ee.value,we=be+G(Ee,_e++),Ne+=fe(Ee,Q,re,we,Te);else if(Ee==="object")throw Q=String(M),Error("Objects are not valid as a React child (found: "+(Q==="[object Object]"?"object with keys {"+Object.keys(M).join(", ")+"}":Q)+"). If you meant to render a collection of children, use an array instead.");return Ne}function Ce(M,Q,re){if(M==null)return M;var be=[],Te=0;return fe(M,be,"","",function(Ee){return Q.call(re,Ee,Te++)}),be}function De(M){if(M._status===-1){var Q=M._result;Q=Q(),Q.then(function(re){(M._status===0||M._status===-1)&&(M._status=1,M._result=re)},function(re){(M._status===0||M._status===-1)&&(M._status=2,M._result=re)}),M._status===-1&&(M._status=0,M._result=Q)}if(M._status===1)return M._result.default;throw M._result}var de={current:null},ne={transition:null},ie={ReactCurrentDispatcher:de,ReactCurrentBatchConfig:ne,ReactCurrentOwner:Y};function ce(){throw Error("act(...) is not supported in production builds of React.")}return Le.Children={map:Ce,forEach:function(M,Q,re){Ce(M,function(){Q.apply(this,arguments)},re)},count:function(M){var Q=0;return Ce(M,function(){Q++}),Q},toArray:function(M){return Ce(M,function(Q){return Q})||[]},only:function(M){if(!N(M))throw Error("React.Children.only expected to receive a single React element child.");return M}},Le.Component=C,Le.Fragment=t,Le.Profiler=i,Le.PureComponent=z,Le.StrictMode=r,Le.Suspense=f,Le.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ie,Le.act=ce,Le.cloneElement=function(M,Q,re){if(M==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+M+".");var be=x({},M.props),Te=M.key,Ee=M.ref,Ne=M._owner;if(Q!=null){if(Q.ref!==void 0&&(Ee=Q.ref,Ne=Y.current),Q.key!==void 0&&(Te=""+Q.key),M.type&&M.type.defaultProps)var _e=M.type.defaultProps;for(we in Q)Z.call(Q,we)&&!L.hasOwnProperty(we)&&(be[we]=Q[we]===void 0&&_e!==void 0?_e[we]:Q[we])}var we=arguments.length-2;if(we===1)be.children=re;else if(1<we){_e=Array(we);for(var Ve=0;Ve<we;Ve++)_e[Ve]=arguments[Ve+2];be.children=_e}return{$$typeof:n,type:M.type,key:Te,ref:Ee,props:be,_owner:Ne}},Le.createContext=function(M){return M={$$typeof:l,_currentValue:M,_currentValue2:M,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},M.Provider={$$typeof:s,_context:M},M.Consumer=M},Le.createElement=E,Le.createFactory=function(M){var Q=E.bind(null,M);return Q.type=M,Q},Le.createRef=function(){return{current:null}},Le.forwardRef=function(M){return{$$typeof:c,render:M}},Le.isValidElement=N,Le.lazy=function(M){return{$$typeof:p,_payload:{_status:-1,_result:M},_init:De}},Le.memo=function(M,Q){return{$$typeof:h,type:M,compare:Q===void 0?null:Q}},Le.startTransition=function(M){var Q=ne.transition;ne.transition={};try{M()}finally{ne.transition=Q}},Le.unstable_act=ce,Le.useCallback=function(M,Q){return de.current.useCallback(M,Q)},Le.useContext=function(M){return de.current.useContext(M)},Le.useDebugValue=function(){},Le.useDeferredValue=function(M){return de.current.useDeferredValue(M)},Le.useEffect=function(M,Q){return de.current.useEffect(M,Q)},Le.useId=function(){return de.current.useId()},Le.useImperativeHandle=function(M,Q,re){return de.current.useImperativeHandle(M,Q,re)},Le.useInsertionEffect=function(M,Q){return de.current.useInsertionEffect(M,Q)},Le.useLayoutEffect=function(M,Q){return de.current.useLayoutEffect(M,Q)},Le.useMemo=function(M,Q){return de.current.useMemo(M,Q)},Le.useReducer=function(M,Q,re){return de.current.useReducer(M,Q,re)},Le.useRef=function(M){return de.current.useRef(M)},Le.useState=function(M){return de.current.useState(M)},Le.useSyncExternalStore=function(M,Q,re){return de.current.useSyncExternalStore(M,Q,re)},Le.useTransition=function(){return de.current.useTransition()},Le.version="18.3.1",Le}var Q_;function Rd(){return Q_||(Q_=1,kf.exports=Iw()),kf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var J_;function Pw(){if(J_)return To;J_=1;var n=Rd(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(c,f,h){var p,_={},y=null,b=null;h!==void 0&&(y=""+h),f.key!==void 0&&(y=""+f.key),f.ref!==void 0&&(b=f.ref);for(p in f)r.call(f,p)&&!s.hasOwnProperty(p)&&(_[p]=f[p]);if(c&&c.defaultProps)for(p in f=c.defaultProps,f)_[p]===void 0&&(_[p]=f[p]);return{$$typeof:e,type:c,key:y,ref:b,props:_,_owner:i.current}}return To.Fragment=t,To.jsx=l,To.jsxs=l,To}var G_;function kw(){return G_||(G_=1,Pf.exports=Pw()),Pf.exports}var $t=kw(),al={},Mf={exports:{}},sn={},Of={exports:{}},Nf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var em;function Mw(){return em||(em=1,function(n){function e(ne,ie){var ce=ne.length;ne.push(ie);e:for(;0<ce;){var M=ce-1>>>1,Q=ne[M];if(0<i(Q,ie))ne[M]=ie,ne[ce]=Q,ce=M;else break e}}function t(ne){return ne.length===0?null:ne[0]}function r(ne){if(ne.length===0)return null;var ie=ne[0],ce=ne.pop();if(ce!==ie){ne[0]=ce;e:for(var M=0,Q=ne.length,re=Q>>>1;M<re;){var be=2*(M+1)-1,Te=ne[be],Ee=be+1,Ne=ne[Ee];if(0>i(Te,ce))Ee<Q&&0>i(Ne,Te)?(ne[M]=Ne,ne[Ee]=ce,M=Ee):(ne[M]=Te,ne[be]=ce,M=be);else if(Ee<Q&&0>i(Ne,ce))ne[M]=Ne,ne[Ee]=ce,M=Ee;else break e}}return ie}function i(ne,ie){var ce=ne.sortIndex-ie.sortIndex;return ce!==0?ce:ne.id-ie.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();n.unstable_now=function(){return l.now()-c}}var f=[],h=[],p=1,_=null,y=3,b=!1,x=!1,S=!1,C=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(ne){for(var ie=t(h);ie!==null;){if(ie.callback===null)r(h);else if(ie.startTime<=ne)r(h),ie.sortIndex=ie.expirationTime,e(f,ie);else break;ie=t(h)}}function V(ne){if(S=!1,k(ne),!x)if(t(f)!==null)x=!0,De(Z);else{var ie=t(h);ie!==null&&de(V,ie.startTime-ne)}}function Z(ne,ie){x=!1,S&&(S=!1,P(E),E=-1),b=!0;var ce=y;try{for(k(ie),_=t(f);_!==null&&(!(_.expirationTime>ie)||ne&&!j());){var M=_.callback;if(typeof M=="function"){_.callback=null,y=_.priorityLevel;var Q=M(_.expirationTime<=ie);ie=n.unstable_now(),typeof Q=="function"?_.callback=Q:_===t(f)&&r(f),k(ie)}else r(f);_=t(f)}if(_!==null)var re=!0;else{var be=t(h);be!==null&&de(V,be.startTime-ie),re=!1}return re}finally{_=null,y=ce,b=!1}}var Y=!1,L=null,E=-1,R=5,N=-1;function j(){return!(n.unstable_now()-N<R)}function K(){if(L!==null){var ne=n.unstable_now();N=ne;var ie=!0;try{ie=L(!0,ne)}finally{ie?G():(Y=!1,L=null)}}else Y=!1}var G;if(typeof z=="function")G=function(){z(K)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,Ce=fe.port2;fe.port1.onmessage=K,G=function(){Ce.postMessage(null)}}else G=function(){C(K,0)};function De(ne){L=ne,Y||(Y=!0,G())}function de(ne,ie){E=C(function(){ne(n.unstable_now())},ie)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ne){ne.callback=null},n.unstable_continueExecution=function(){x||b||(x=!0,De(Z))},n.unstable_forceFrameRate=function(ne){0>ne||125<ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<ne?Math.floor(1e3/ne):5},n.unstable_getCurrentPriorityLevel=function(){return y},n.unstable_getFirstCallbackNode=function(){return t(f)},n.unstable_next=function(ne){switch(y){case 1:case 2:case 3:var ie=3;break;default:ie=y}var ce=y;y=ie;try{return ne()}finally{y=ce}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ne,ie){switch(ne){case 1:case 2:case 3:case 4:case 5:break;default:ne=3}var ce=y;y=ne;try{return ie()}finally{y=ce}},n.unstable_scheduleCallback=function(ne,ie,ce){var M=n.unstable_now();switch(typeof ce=="object"&&ce!==null?(ce=ce.delay,ce=typeof ce=="number"&&0<ce?M+ce:M):ce=M,ne){case 1:var Q=-1;break;case 2:Q=250;break;case 5:Q=1073741823;break;case 4:Q=1e4;break;default:Q=5e3}return Q=ce+Q,ne={id:p++,callback:ie,priorityLevel:ne,startTime:ce,expirationTime:Q,sortIndex:-1},ce>M?(ne.sortIndex=ce,e(h,ne),t(f)===null&&ne===t(h)&&(S?(P(E),E=-1):S=!0,de(V,ce-M))):(ne.sortIndex=Q,e(f,ne),x||b||(x=!0,De(Z))),ne},n.unstable_shouldYield=j,n.unstable_wrapCallback=function(ne){var ie=y;return function(){var ce=y;y=ie;try{return ne.apply(this,arguments)}finally{y=ce}}}}(Nf)),Nf}var tm;function Ow(){return tm||(tm=1,Of.exports=Mw()),Of.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nm;function Nw(){if(nm)return sn;nm=1;var n=Rd(),e=Ow();function t(o){for(var a="https://reactjs.org/docs/error-decoder.html?invariant="+o,u=1;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u]);return"Minified React error #"+o+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function s(o,a){l(o,a),l(o+"Capture",a)}function l(o,a){for(i[o]=a,o=0;o<a.length;o++)r.add(a[o])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},_={};function y(o){return f.call(_,o)?!0:f.call(p,o)?!1:h.test(o)?_[o]=!0:(p[o]=!0,!1)}function b(o,a,u,d){if(u!==null&&u.type===0)return!1;switch(typeof a){case"function":case"symbol":return!0;case"boolean":return d?!1:u!==null?!u.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function x(o,a,u,d){if(a===null||typeof a>"u"||b(o,a,u,d))return!0;if(d)return!1;if(u!==null)switch(u.type){case 3:return!a;case 4:return a===!1;case 5:return isNaN(a);case 6:return isNaN(a)||1>a}return!1}function S(o,a,u,d,g,m,v){this.acceptsBooleans=a===2||a===3||a===4,this.attributeName=d,this.attributeNamespace=g,this.mustUseProperty=u,this.propertyName=o,this.type=a,this.sanitizeURL=m,this.removeEmptyString=v}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){C[o]=new S(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var a=o[0];C[a]=new S(a,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){C[o]=new S(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){C[o]=new S(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){C[o]=new S(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){C[o]=new S(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){C[o]=new S(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){C[o]=new S(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){C[o]=new S(o,5,!1,o.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function z(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var a=o.replace(P,z);C[a]=new S(a,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var a=o.replace(P,z);C[a]=new S(a,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var a=o.replace(P,z);C[a]=new S(a,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){C[o]=new S(o,1,!1,o.toLowerCase(),null,!1,!1)}),C.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){C[o]=new S(o,1,!1,o.toLowerCase(),null,!0,!0)});function k(o,a,u,d){var g=C.hasOwnProperty(a)?C[a]:null;(g!==null?g.type!==0:d||!(2<a.length)||a[0]!=="o"&&a[0]!=="O"||a[1]!=="n"&&a[1]!=="N")&&(x(a,u,g,d)&&(u=null),d||g===null?y(a)&&(u===null?o.removeAttribute(a):o.setAttribute(a,""+u)):g.mustUseProperty?o[g.propertyName]=u===null?g.type===3?!1:"":u:(a=g.attributeName,d=g.attributeNamespace,u===null?o.removeAttribute(a):(g=g.type,u=g===3||g===4&&u===!0?"":""+u,d?o.setAttributeNS(d,a,u):o.setAttribute(a,u))))}var V=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Z=Symbol.for("react.element"),Y=Symbol.for("react.portal"),L=Symbol.for("react.fragment"),E=Symbol.for("react.strict_mode"),R=Symbol.for("react.profiler"),N=Symbol.for("react.provider"),j=Symbol.for("react.context"),K=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),fe=Symbol.for("react.suspense_list"),Ce=Symbol.for("react.memo"),De=Symbol.for("react.lazy"),de=Symbol.for("react.offscreen"),ne=Symbol.iterator;function ie(o){return o===null||typeof o!="object"?null:(o=ne&&o[ne]||o["@@iterator"],typeof o=="function"?o:null)}var ce=Object.assign,M;function Q(o){if(M===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);M=a&&a[1]||""}return`
`+M+o}var re=!1;function be(o,a){if(!o||re)return"";re=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(a)if(a=function(){throw Error()},Object.defineProperty(a.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(a,[])}catch(q){var d=q}Reflect.construct(o,[],a)}else{try{a.call()}catch(q){d=q}o.call(a.prototype)}else{try{throw Error()}catch(q){d=q}o()}}catch(q){if(q&&d&&typeof q.stack=="string"){for(var g=q.stack.split(`
`),m=d.stack.split(`
`),v=g.length-1,I=m.length-1;1<=v&&0<=I&&g[v]!==m[I];)I--;for(;1<=v&&0<=I;v--,I--)if(g[v]!==m[I]){if(v!==1||I!==1)do if(v--,I--,0>I||g[v]!==m[I]){var O=`
`+g[v].replace(" at new "," at ");return o.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",o.displayName)),O}while(1<=v&&0<=I);break}}}finally{re=!1,Error.prepareStackTrace=u}return(o=o?o.displayName||o.name:"")?Q(o):""}function Te(o){switch(o.tag){case 5:return Q(o.type);case 16:return Q("Lazy");case 13:return Q("Suspense");case 19:return Q("SuspenseList");case 0:case 2:case 15:return o=be(o.type,!1),o;case 11:return o=be(o.type.render,!1),o;case 1:return o=be(o.type,!0),o;default:return""}}function Ee(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case L:return"Fragment";case Y:return"Portal";case R:return"Profiler";case E:return"StrictMode";case G:return"Suspense";case fe:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case j:return(o.displayName||"Context")+".Consumer";case N:return(o._context.displayName||"Context")+".Provider";case K:var a=o.render;return o=o.displayName,o||(o=a.displayName||a.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Ce:return a=o.displayName||null,a!==null?a:Ee(o.type)||"Memo";case De:a=o._payload,o=o._init;try{return Ee(o(a))}catch{}}return null}function Ne(o){var a=o.type;switch(o.tag){case 24:return"Cache";case 9:return(a.displayName||"Context")+".Consumer";case 10:return(a._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=a.render,o=o.displayName||o.name||"",a.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return a;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ee(a);case 8:return a===E?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof a=="function")return a.displayName||a.name||null;if(typeof a=="string")return a}return null}function _e(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function we(o){var a=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function Ve(o){var a=we(o)?"checked":"value",u=Object.getOwnPropertyDescriptor(o.constructor.prototype,a),d=""+o[a];if(!o.hasOwnProperty(a)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var g=u.get,m=u.set;return Object.defineProperty(o,a,{configurable:!0,get:function(){return g.call(this)},set:function(v){d=""+v,m.call(this,v)}}),Object.defineProperty(o,a,{enumerable:u.enumerable}),{getValue:function(){return d},setValue:function(v){d=""+v},stopTracking:function(){o._valueTracker=null,delete o[a]}}}}function Re(o){o._valueTracker||(o._valueTracker=Ve(o))}function et(o){if(!o)return!1;var a=o._valueTracker;if(!a)return!0;var u=a.getValue(),d="";return o&&(d=we(o)?o.checked?"true":"false":o.value),o=d,o!==u?(a.setValue(o),!0):!1}function rt(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function We(o,a){var u=a.checked;return ce({},a,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:u??o._wrapperState.initialChecked})}function Ye(o,a){var u=a.defaultValue==null?"":a.defaultValue,d=a.checked!=null?a.checked:a.defaultChecked;u=_e(a.value!=null?a.value:u),o._wrapperState={initialChecked:d,initialValue:u,controlled:a.type==="checkbox"||a.type==="radio"?a.checked!=null:a.value!=null}}function Fe(o,a){a=a.checked,a!=null&&k(o,"checked",a,!1)}function Ht(o,a){Fe(o,a);var u=_e(a.value),d=a.type;if(u!=null)d==="number"?(u===0&&o.value===""||o.value!=u)&&(o.value=""+u):o.value!==""+u&&(o.value=""+u);else if(d==="submit"||d==="reset"){o.removeAttribute("value");return}a.hasOwnProperty("value")?Qe(o,a.type,u):a.hasOwnProperty("defaultValue")&&Qe(o,a.type,_e(a.defaultValue)),a.checked==null&&a.defaultChecked!=null&&(o.defaultChecked=!!a.defaultChecked)}function Pe(o,a,u){if(a.hasOwnProperty("value")||a.hasOwnProperty("defaultValue")){var d=a.type;if(!(d!=="submit"&&d!=="reset"||a.value!==void 0&&a.value!==null))return;a=""+o._wrapperState.initialValue,u||a===o.value||(o.value=a),o.defaultValue=a}u=o.name,u!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,u!==""&&(o.name=u)}function Qe(o,a,u){(a!=="number"||rt(o.ownerDocument)!==o)&&(u==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+u&&(o.defaultValue=""+u))}var Zt=Array.isArray;function an(o,a,u,d){if(o=o.options,a){a={};for(var g=0;g<u.length;g++)a["$"+u[g]]=!0;for(u=0;u<o.length;u++)g=a.hasOwnProperty("$"+o[u].value),o[u].selected!==g&&(o[u].selected=g),g&&d&&(o[u].defaultSelected=!0)}else{for(u=""+_e(u),a=null,g=0;g<o.length;g++){if(o[g].value===u){o[g].selected=!0,d&&(o[g].defaultSelected=!0);return}a!==null||o[g].disabled||(a=o[g])}a!==null&&(a.selected=!0)}}function Qt(o,a){if(a.dangerouslySetInnerHTML!=null)throw Error(t(91));return ce({},a,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function vr(o,a){var u=a.value;if(u==null){if(u=a.children,a=a.defaultValue,u!=null){if(a!=null)throw Error(t(92));if(Zt(u)){if(1<u.length)throw Error(t(93));u=u[0]}a=u}a==null&&(a=""),u=a}o._wrapperState={initialValue:_e(u)}}function wt(o,a){var u=_e(a.value),d=_e(a.defaultValue);u!=null&&(u=""+u,u!==o.value&&(o.value=u),a.defaultValue==null&&o.defaultValue!==u&&(o.defaultValue=u)),d!=null&&(o.defaultValue=""+d)}function ln(o){var a=o.textContent;a===o._wrapperState.initialValue&&a!==""&&a!==null&&(o.value=a)}function dt(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function At(o,a){return o==null||o==="http://www.w3.org/1999/xhtml"?dt(a):o==="http://www.w3.org/2000/svg"&&a==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var Jt,Di=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(a,u,d,g){MSApp.execUnsafeLocalFunction(function(){return o(a,u,d,g)})}:o}(function(o,a){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=a;else{for(Jt=Jt||document.createElement("div"),Jt.innerHTML="<svg>"+a.valueOf().toString()+"</svg>",a=Jt.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;a.firstChild;)o.appendChild(a.firstChild)}});function br(o,a){if(a){var u=o.firstChild;if(u&&u===o.lastChild&&u.nodeType===3){u.nodeValue=a;return}}o.textContent=a}var mn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yn=["Webkit","ms","Moz","O"];Object.keys(mn).forEach(function(o){yn.forEach(function(a){a=a+o.charAt(0).toUpperCase()+o.substring(1),mn[a]=mn[o]})});function wr(o,a,u){return a==null||typeof a=="boolean"||a===""?"":u||typeof a!="number"||a===0||mn.hasOwnProperty(o)&&mn[o]?(""+a).trim():a+"px"}function Bs(o,a){o=o.style;for(var u in a)if(a.hasOwnProperty(u)){var d=u.indexOf("--")===0,g=wr(u,a[u],d);u==="float"&&(u="cssFloat"),d?o.setProperty(u,g):o[u]=g}}var M3=ce({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zc(o,a){if(a){if(M3[o]&&(a.children!=null||a.dangerouslySetInnerHTML!=null))throw Error(t(137,o));if(a.dangerouslySetInnerHTML!=null){if(a.children!=null)throw Error(t(60));if(typeof a.dangerouslySetInnerHTML!="object"||!("__html"in a.dangerouslySetInnerHTML))throw Error(t(61))}if(a.style!=null&&typeof a.style!="object")throw Error(t(62))}}function $c(o,a){if(o.indexOf("-")===-1)return typeof a.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jc=null;function Wc(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Hc=null,Fi=null,Li=null;function dp(o){if(o=oo(o)){if(typeof Hc!="function")throw Error(t(280));var a=o.stateNode;a&&(a=Ta(a),Hc(o.stateNode,o.type,a))}}function pp(o){Fi?Li?Li.push(o):Li=[o]:Fi=o}function gp(){if(Fi){var o=Fi,a=Li;if(Li=Fi=null,dp(o),a)for(o=0;o<a.length;o++)dp(a[o])}}function _p(o,a){return o(a)}function mp(){}var Xc=!1;function yp(o,a,u){if(Xc)return o(a,u);Xc=!0;try{return _p(o,a,u)}finally{Xc=!1,(Fi!==null||Li!==null)&&(mp(),gp())}}function Us(o,a){var u=o.stateNode;if(u===null)return null;var d=Ta(u);if(d===null)return null;u=d[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(o=o.type,d=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!d;break e;default:o=!1}if(o)return null;if(u&&typeof u!="function")throw Error(t(231,a,typeof u));return u}var Yc=!1;if(c)try{var Vs={};Object.defineProperty(Vs,"passive",{get:function(){Yc=!0}}),window.addEventListener("test",Vs,Vs),window.removeEventListener("test",Vs,Vs)}catch{Yc=!1}function O3(o,a,u,d,g,m,v,I,O){var q=Array.prototype.slice.call(arguments,3);try{a.apply(u,q)}catch(te){this.onError(te)}}var zs=!1,ea=null,ta=!1,Kc=null,N3={onError:function(o){zs=!0,ea=o}};function D3(o,a,u,d,g,m,v,I,O){zs=!1,ea=null,O3.apply(N3,arguments)}function F3(o,a,u,d,g,m,v,I,O){if(D3.apply(this,arguments),zs){if(zs){var q=ea;zs=!1,ea=null}else throw Error(t(198));ta||(ta=!0,Kc=q)}}function ni(o){var a=o,u=o;if(o.alternate)for(;a.return;)a=a.return;else{o=a;do a=o,(a.flags&4098)!==0&&(u=a.return),o=a.return;while(o)}return a.tag===3?u:null}function vp(o){if(o.tag===13){var a=o.memoizedState;if(a===null&&(o=o.alternate,o!==null&&(a=o.memoizedState)),a!==null)return a.dehydrated}return null}function bp(o){if(ni(o)!==o)throw Error(t(188))}function L3(o){var a=o.alternate;if(!a){if(a=ni(o),a===null)throw Error(t(188));return a!==o?null:o}for(var u=o,d=a;;){var g=u.return;if(g===null)break;var m=g.alternate;if(m===null){if(d=g.return,d!==null){u=d;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===u)return bp(g),o;if(m===d)return bp(g),a;m=m.sibling}throw Error(t(188))}if(u.return!==d.return)u=g,d=m;else{for(var v=!1,I=g.child;I;){if(I===u){v=!0,u=g,d=m;break}if(I===d){v=!0,d=g,u=m;break}I=I.sibling}if(!v){for(I=m.child;I;){if(I===u){v=!0,u=m,d=g;break}if(I===d){v=!0,d=m,u=g;break}I=I.sibling}if(!v)throw Error(t(189))}}if(u.alternate!==d)throw Error(t(190))}if(u.tag!==3)throw Error(t(188));return u.stateNode.current===u?o:a}function wp(o){return o=L3(o),o!==null?Tp(o):null}function Tp(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var a=Tp(o);if(a!==null)return a;o=o.sibling}return null}var xp=e.unstable_scheduleCallback,Sp=e.unstable_cancelCallback,B3=e.unstable_shouldYield,U3=e.unstable_requestPaint,pt=e.unstable_now,V3=e.unstable_getCurrentPriorityLevel,qc=e.unstable_ImmediatePriority,Ep=e.unstable_UserBlockingPriority,na=e.unstable_NormalPriority,z3=e.unstable_LowPriority,Ap=e.unstable_IdlePriority,ra=null,Hn=null;function $3(o){if(Hn&&typeof Hn.onCommitFiberRoot=="function")try{Hn.onCommitFiberRoot(ra,o,void 0,(o.current.flags&128)===128)}catch{}}var kn=Math.clz32?Math.clz32:H3,j3=Math.log,W3=Math.LN2;function H3(o){return o>>>=0,o===0?32:31-(j3(o)/W3|0)|0}var ia=64,sa=4194304;function $s(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function oa(o,a){var u=o.pendingLanes;if(u===0)return 0;var d=0,g=o.suspendedLanes,m=o.pingedLanes,v=u&268435455;if(v!==0){var I=v&~g;I!==0?d=$s(I):(m&=v,m!==0&&(d=$s(m)))}else v=u&~g,v!==0?d=$s(v):m!==0&&(d=$s(m));if(d===0)return 0;if(a!==0&&a!==d&&(a&g)===0&&(g=d&-d,m=a&-a,g>=m||g===16&&(m&4194240)!==0))return a;if((d&4)!==0&&(d|=u&16),a=o.entangledLanes,a!==0)for(o=o.entanglements,a&=d;0<a;)u=31-kn(a),g=1<<u,d|=o[u],a&=~g;return d}function X3(o,a){switch(o){case 1:case 2:case 4:return a+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Y3(o,a){for(var u=o.suspendedLanes,d=o.pingedLanes,g=o.expirationTimes,m=o.pendingLanes;0<m;){var v=31-kn(m),I=1<<v,O=g[v];O===-1?((I&u)===0||(I&d)!==0)&&(g[v]=X3(I,a)):O<=a&&(o.expiredLanes|=I),m&=~I}}function Zc(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Rp(){var o=ia;return ia<<=1,(ia&4194240)===0&&(ia=64),o}function Qc(o){for(var a=[],u=0;31>u;u++)a.push(o);return a}function js(o,a,u){o.pendingLanes|=a,a!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,a=31-kn(a),o[a]=u}function K3(o,a){var u=o.pendingLanes&~a;o.pendingLanes=a,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=a,o.mutableReadLanes&=a,o.entangledLanes&=a,a=o.entanglements;var d=o.eventTimes;for(o=o.expirationTimes;0<u;){var g=31-kn(u),m=1<<g;a[g]=0,d[g]=-1,o[g]=-1,u&=~m}}function Jc(o,a){var u=o.entangledLanes|=a;for(o=o.entanglements;u;){var d=31-kn(u),g=1<<d;g&a|o[d]&a&&(o[d]|=a),u&=~g}}var Ke=0;function Cp(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var Ip,Gc,Pp,kp,Mp,eu=!1,aa=[],Tr=null,xr=null,Sr=null,Ws=new Map,Hs=new Map,Er=[],q3="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Op(o,a){switch(o){case"focusin":case"focusout":Tr=null;break;case"dragenter":case"dragleave":xr=null;break;case"mouseover":case"mouseout":Sr=null;break;case"pointerover":case"pointerout":Ws.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Hs.delete(a.pointerId)}}function Xs(o,a,u,d,g,m){return o===null||o.nativeEvent!==m?(o={blockedOn:a,domEventName:u,eventSystemFlags:d,nativeEvent:m,targetContainers:[g]},a!==null&&(a=oo(a),a!==null&&Gc(a)),o):(o.eventSystemFlags|=d,a=o.targetContainers,g!==null&&a.indexOf(g)===-1&&a.push(g),o)}function Z3(o,a,u,d,g){switch(a){case"focusin":return Tr=Xs(Tr,o,a,u,d,g),!0;case"dragenter":return xr=Xs(xr,o,a,u,d,g),!0;case"mouseover":return Sr=Xs(Sr,o,a,u,d,g),!0;case"pointerover":var m=g.pointerId;return Ws.set(m,Xs(Ws.get(m)||null,o,a,u,d,g)),!0;case"gotpointercapture":return m=g.pointerId,Hs.set(m,Xs(Hs.get(m)||null,o,a,u,d,g)),!0}return!1}function Np(o){var a=ri(o.target);if(a!==null){var u=ni(a);if(u!==null){if(a=u.tag,a===13){if(a=vp(u),a!==null){o.blockedOn=a,Mp(o.priority,function(){Pp(u)});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){o.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}o.blockedOn=null}function la(o){if(o.blockedOn!==null)return!1;for(var a=o.targetContainers;0<a.length;){var u=nu(o.domEventName,o.eventSystemFlags,a[0],o.nativeEvent);if(u===null){u=o.nativeEvent;var d=new u.constructor(u.type,u);jc=d,u.target.dispatchEvent(d),jc=null}else return a=oo(u),a!==null&&Gc(a),o.blockedOn=u,!1;a.shift()}return!0}function Dp(o,a,u){la(o)&&u.delete(a)}function Q3(){eu=!1,Tr!==null&&la(Tr)&&(Tr=null),xr!==null&&la(xr)&&(xr=null),Sr!==null&&la(Sr)&&(Sr=null),Ws.forEach(Dp),Hs.forEach(Dp)}function Ys(o,a){o.blockedOn===a&&(o.blockedOn=null,eu||(eu=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Q3)))}function Ks(o){function a(g){return Ys(g,o)}if(0<aa.length){Ys(aa[0],o);for(var u=1;u<aa.length;u++){var d=aa[u];d.blockedOn===o&&(d.blockedOn=null)}}for(Tr!==null&&Ys(Tr,o),xr!==null&&Ys(xr,o),Sr!==null&&Ys(Sr,o),Ws.forEach(a),Hs.forEach(a),u=0;u<Er.length;u++)d=Er[u],d.blockedOn===o&&(d.blockedOn=null);for(;0<Er.length&&(u=Er[0],u.blockedOn===null);)Np(u),u.blockedOn===null&&Er.shift()}var Bi=V.ReactCurrentBatchConfig,ca=!0;function J3(o,a,u,d){var g=Ke,m=Bi.transition;Bi.transition=null;try{Ke=1,tu(o,a,u,d)}finally{Ke=g,Bi.transition=m}}function G3(o,a,u,d){var g=Ke,m=Bi.transition;Bi.transition=null;try{Ke=4,tu(o,a,u,d)}finally{Ke=g,Bi.transition=m}}function tu(o,a,u,d){if(ca){var g=nu(o,a,u,d);if(g===null)vu(o,a,d,ua,u),Op(o,d);else if(Z3(g,o,a,u,d))d.stopPropagation();else if(Op(o,d),a&4&&-1<q3.indexOf(o)){for(;g!==null;){var m=oo(g);if(m!==null&&Ip(m),m=nu(o,a,u,d),m===null&&vu(o,a,d,ua,u),m===g)break;g=m}g!==null&&d.stopPropagation()}else vu(o,a,d,null,u)}}var ua=null;function nu(o,a,u,d){if(ua=null,o=Wc(d),o=ri(o),o!==null)if(a=ni(o),a===null)o=null;else if(u=a.tag,u===13){if(o=vp(a),o!==null)return o;o=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;o=null}else a!==o&&(o=null);return ua=o,null}function Fp(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(V3()){case qc:return 1;case Ep:return 4;case na:case z3:return 16;case Ap:return 536870912;default:return 16}default:return 16}}var Ar=null,ru=null,fa=null;function Lp(){if(fa)return fa;var o,a=ru,u=a.length,d,g="value"in Ar?Ar.value:Ar.textContent,m=g.length;for(o=0;o<u&&a[o]===g[o];o++);var v=u-o;for(d=1;d<=v&&a[u-d]===g[m-d];d++);return fa=g.slice(o,1<d?1-d:void 0)}function ha(o){var a=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&a===13&&(o=13)):o=a,o===10&&(o=13),32<=o||o===13?o:0}function da(){return!0}function Bp(){return!1}function cn(o){function a(u,d,g,m,v){this._reactName=u,this._targetInst=g,this.type=d,this.nativeEvent=m,this.target=v,this.currentTarget=null;for(var I in o)o.hasOwnProperty(I)&&(u=o[I],this[I]=u?u(m):m[I]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?da:Bp,this.isPropagationStopped=Bp,this}return ce(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=da)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=da)},persist:function(){},isPersistent:da}),a}var Ui={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},iu=cn(Ui),qs=ce({},Ui,{view:0,detail:0}),e1=cn(qs),su,ou,Zs,pa=ce({},qs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:lu,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Zs&&(Zs&&o.type==="mousemove"?(su=o.screenX-Zs.screenX,ou=o.screenY-Zs.screenY):ou=su=0,Zs=o),su)},movementY:function(o){return"movementY"in o?o.movementY:ou}}),Up=cn(pa),t1=ce({},pa,{dataTransfer:0}),n1=cn(t1),r1=ce({},qs,{relatedTarget:0}),au=cn(r1),i1=ce({},Ui,{animationName:0,elapsedTime:0,pseudoElement:0}),s1=cn(i1),o1=ce({},Ui,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),a1=cn(o1),l1=ce({},Ui,{data:0}),Vp=cn(l1),c1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},u1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},f1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function h1(o){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(o):(o=f1[o])?!!a[o]:!1}function lu(){return h1}var d1=ce({},qs,{key:function(o){if(o.key){var a=c1[o.key]||o.key;if(a!=="Unidentified")return a}return o.type==="keypress"?(o=ha(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?u1[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:lu,charCode:function(o){return o.type==="keypress"?ha(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?ha(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),p1=cn(d1),g1=ce({},pa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zp=cn(g1),_1=ce({},qs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:lu}),m1=cn(_1),y1=ce({},Ui,{propertyName:0,elapsedTime:0,pseudoElement:0}),v1=cn(y1),b1=ce({},pa,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),w1=cn(b1),T1=[9,13,27,32],cu=c&&"CompositionEvent"in window,Qs=null;c&&"documentMode"in document&&(Qs=document.documentMode);var x1=c&&"TextEvent"in window&&!Qs,$p=c&&(!cu||Qs&&8<Qs&&11>=Qs),jp=" ",Wp=!1;function Hp(o,a){switch(o){case"keyup":return T1.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Xp(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Vi=!1;function S1(o,a){switch(o){case"compositionend":return Xp(a);case"keypress":return a.which!==32?null:(Wp=!0,jp);case"textInput":return o=a.data,o===jp&&Wp?null:o;default:return null}}function E1(o,a){if(Vi)return o==="compositionend"||!cu&&Hp(o,a)?(o=Lp(),fa=ru=Ar=null,Vi=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return $p&&a.locale!=="ko"?null:a.data;default:return null}}var A1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yp(o){var a=o&&o.nodeName&&o.nodeName.toLowerCase();return a==="input"?!!A1[o.type]:a==="textarea"}function Kp(o,a,u,d){pp(d),a=va(a,"onChange"),0<a.length&&(u=new iu("onChange","change",null,u,d),o.push({event:u,listeners:a}))}var Js=null,Gs=null;function R1(o){hg(o,0)}function ga(o){var a=Hi(o);if(et(a))return o}function C1(o,a){if(o==="change")return a}var qp=!1;if(c){var uu;if(c){var fu="oninput"in document;if(!fu){var Zp=document.createElement("div");Zp.setAttribute("oninput","return;"),fu=typeof Zp.oninput=="function"}uu=fu}else uu=!1;qp=uu&&(!document.documentMode||9<document.documentMode)}function Qp(){Js&&(Js.detachEvent("onpropertychange",Jp),Gs=Js=null)}function Jp(o){if(o.propertyName==="value"&&ga(Gs)){var a=[];Kp(a,Gs,o,Wc(o)),yp(R1,a)}}function I1(o,a,u){o==="focusin"?(Qp(),Js=a,Gs=u,Js.attachEvent("onpropertychange",Jp)):o==="focusout"&&Qp()}function P1(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return ga(Gs)}function k1(o,a){if(o==="click")return ga(a)}function M1(o,a){if(o==="input"||o==="change")return ga(a)}function O1(o,a){return o===a&&(o!==0||1/o===1/a)||o!==o&&a!==a}var Mn=typeof Object.is=="function"?Object.is:O1;function eo(o,a){if(Mn(o,a))return!0;if(typeof o!="object"||o===null||typeof a!="object"||a===null)return!1;var u=Object.keys(o),d=Object.keys(a);if(u.length!==d.length)return!1;for(d=0;d<u.length;d++){var g=u[d];if(!f.call(a,g)||!Mn(o[g],a[g]))return!1}return!0}function Gp(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function eg(o,a){var u=Gp(o);o=0;for(var d;u;){if(u.nodeType===3){if(d=o+u.textContent.length,o<=a&&d>=a)return{node:u,offset:a-o};o=d}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=Gp(u)}}function tg(o,a){return o&&a?o===a?!0:o&&o.nodeType===3?!1:a&&a.nodeType===3?tg(o,a.parentNode):"contains"in o?o.contains(a):o.compareDocumentPosition?!!(o.compareDocumentPosition(a)&16):!1:!1}function ng(){for(var o=window,a=rt();a instanceof o.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)o=a.contentWindow;else break;a=rt(o.document)}return a}function hu(o){var a=o&&o.nodeName&&o.nodeName.toLowerCase();return a&&(a==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||a==="textarea"||o.contentEditable==="true")}function N1(o){var a=ng(),u=o.focusedElem,d=o.selectionRange;if(a!==u&&u&&u.ownerDocument&&tg(u.ownerDocument.documentElement,u)){if(d!==null&&hu(u)){if(a=d.start,o=d.end,o===void 0&&(o=a),"selectionStart"in u)u.selectionStart=a,u.selectionEnd=Math.min(o,u.value.length);else if(o=(a=u.ownerDocument||document)&&a.defaultView||window,o.getSelection){o=o.getSelection();var g=u.textContent.length,m=Math.min(d.start,g);d=d.end===void 0?m:Math.min(d.end,g),!o.extend&&m>d&&(g=d,d=m,m=g),g=eg(u,m);var v=eg(u,d);g&&v&&(o.rangeCount!==1||o.anchorNode!==g.node||o.anchorOffset!==g.offset||o.focusNode!==v.node||o.focusOffset!==v.offset)&&(a=a.createRange(),a.setStart(g.node,g.offset),o.removeAllRanges(),m>d?(o.addRange(a),o.extend(v.node,v.offset)):(a.setEnd(v.node,v.offset),o.addRange(a)))}}for(a=[],o=u;o=o.parentNode;)o.nodeType===1&&a.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof u.focus=="function"&&u.focus(),u=0;u<a.length;u++)o=a[u],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var D1=c&&"documentMode"in document&&11>=document.documentMode,zi=null,du=null,to=null,pu=!1;function rg(o,a,u){var d=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;pu||zi==null||zi!==rt(d)||(d=zi,"selectionStart"in d&&hu(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),to&&eo(to,d)||(to=d,d=va(du,"onSelect"),0<d.length&&(a=new iu("onSelect","select",null,a,u),o.push({event:a,listeners:d}),a.target=zi)))}function _a(o,a){var u={};return u[o.toLowerCase()]=a.toLowerCase(),u["Webkit"+o]="webkit"+a,u["Moz"+o]="moz"+a,u}var $i={animationend:_a("Animation","AnimationEnd"),animationiteration:_a("Animation","AnimationIteration"),animationstart:_a("Animation","AnimationStart"),transitionend:_a("Transition","TransitionEnd")},gu={},ig={};c&&(ig=document.createElement("div").style,"AnimationEvent"in window||(delete $i.animationend.animation,delete $i.animationiteration.animation,delete $i.animationstart.animation),"TransitionEvent"in window||delete $i.transitionend.transition);function ma(o){if(gu[o])return gu[o];if(!$i[o])return o;var a=$i[o],u;for(u in a)if(a.hasOwnProperty(u)&&u in ig)return gu[o]=a[u];return o}var sg=ma("animationend"),og=ma("animationiteration"),ag=ma("animationstart"),lg=ma("transitionend"),cg=new Map,ug="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(o,a){cg.set(o,a),s(a,[o])}for(var _u=0;_u<ug.length;_u++){var mu=ug[_u],F1=mu.toLowerCase(),L1=mu[0].toUpperCase()+mu.slice(1);Rr(F1,"on"+L1)}Rr(sg,"onAnimationEnd"),Rr(og,"onAnimationIteration"),Rr(ag,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(lg,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var no="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),B1=new Set("cancel close invalid load scroll toggle".split(" ").concat(no));function fg(o,a,u){var d=o.type||"unknown-event";o.currentTarget=u,F3(d,a,void 0,o),o.currentTarget=null}function hg(o,a){a=(a&4)!==0;for(var u=0;u<o.length;u++){var d=o[u],g=d.event;d=d.listeners;e:{var m=void 0;if(a)for(var v=d.length-1;0<=v;v--){var I=d[v],O=I.instance,q=I.currentTarget;if(I=I.listener,O!==m&&g.isPropagationStopped())break e;fg(g,I,q),m=O}else for(v=0;v<d.length;v++){if(I=d[v],O=I.instance,q=I.currentTarget,I=I.listener,O!==m&&g.isPropagationStopped())break e;fg(g,I,q),m=O}}}if(ta)throw o=Kc,ta=!1,Kc=null,o}function tt(o,a){var u=a[Eu];u===void 0&&(u=a[Eu]=new Set);var d=o+"__bubble";u.has(d)||(dg(a,o,2,!1),u.add(d))}function yu(o,a,u){var d=0;a&&(d|=4),dg(u,o,d,a)}var ya="_reactListening"+Math.random().toString(36).slice(2);function ro(o){if(!o[ya]){o[ya]=!0,r.forEach(function(u){u!=="selectionchange"&&(B1.has(u)||yu(u,!1,o),yu(u,!0,o))});var a=o.nodeType===9?o:o.ownerDocument;a===null||a[ya]||(a[ya]=!0,yu("selectionchange",!1,a))}}function dg(o,a,u,d){switch(Fp(a)){case 1:var g=J3;break;case 4:g=G3;break;default:g=tu}u=g.bind(null,a,u,o),g=void 0,!Yc||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(g=!0),d?g!==void 0?o.addEventListener(a,u,{capture:!0,passive:g}):o.addEventListener(a,u,!0):g!==void 0?o.addEventListener(a,u,{passive:g}):o.addEventListener(a,u,!1)}function vu(o,a,u,d,g){var m=d;if((a&1)===0&&(a&2)===0&&d!==null)e:for(;;){if(d===null)return;var v=d.tag;if(v===3||v===4){var I=d.stateNode.containerInfo;if(I===g||I.nodeType===8&&I.parentNode===g)break;if(v===4)for(v=d.return;v!==null;){var O=v.tag;if((O===3||O===4)&&(O=v.stateNode.containerInfo,O===g||O.nodeType===8&&O.parentNode===g))return;v=v.return}for(;I!==null;){if(v=ri(I),v===null)return;if(O=v.tag,O===5||O===6){d=m=v;continue e}I=I.parentNode}}d=d.return}yp(function(){var q=m,te=Wc(u),se=[];e:{var ee=cg.get(o);if(ee!==void 0){var pe=iu,me=o;switch(o){case"keypress":if(ha(u)===0)break e;case"keydown":case"keyup":pe=p1;break;case"focusin":me="focus",pe=au;break;case"focusout":me="blur",pe=au;break;case"beforeblur":case"afterblur":pe=au;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=Up;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=n1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=m1;break;case sg:case og:case ag:pe=s1;break;case lg:pe=v1;break;case"scroll":pe=e1;break;case"wheel":pe=w1;break;case"copy":case"cut":case"paste":pe=a1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=zp}var ye=(a&4)!==0,gt=!ye&&o==="scroll",H=ye?ee!==null?ee+"Capture":null:ee;ye=[];for(var D=q,X;D!==null;){X=D;var le=X.stateNode;if(X.tag===5&&le!==null&&(X=le,H!==null&&(le=Us(D,H),le!=null&&ye.push(io(D,le,X)))),gt)break;D=D.return}0<ye.length&&(ee=new pe(ee,me,null,u,te),se.push({event:ee,listeners:ye}))}}if((a&7)===0){e:{if(ee=o==="mouseover"||o==="pointerover",pe=o==="mouseout"||o==="pointerout",ee&&u!==jc&&(me=u.relatedTarget||u.fromElement)&&(ri(me)||me[ir]))break e;if((pe||ee)&&(ee=te.window===te?te:(ee=te.ownerDocument)?ee.defaultView||ee.parentWindow:window,pe?(me=u.relatedTarget||u.toElement,pe=q,me=me?ri(me):null,me!==null&&(gt=ni(me),me!==gt||me.tag!==5&&me.tag!==6)&&(me=null)):(pe=null,me=q),pe!==me)){if(ye=Up,le="onMouseLeave",H="onMouseEnter",D="mouse",(o==="pointerout"||o==="pointerover")&&(ye=zp,le="onPointerLeave",H="onPointerEnter",D="pointer"),gt=pe==null?ee:Hi(pe),X=me==null?ee:Hi(me),ee=new ye(le,D+"leave",pe,u,te),ee.target=gt,ee.relatedTarget=X,le=null,ri(te)===q&&(ye=new ye(H,D+"enter",me,u,te),ye.target=X,ye.relatedTarget=gt,le=ye),gt=le,pe&&me)t:{for(ye=pe,H=me,D=0,X=ye;X;X=ji(X))D++;for(X=0,le=H;le;le=ji(le))X++;for(;0<D-X;)ye=ji(ye),D--;for(;0<X-D;)H=ji(H),X--;for(;D--;){if(ye===H||H!==null&&ye===H.alternate)break t;ye=ji(ye),H=ji(H)}ye=null}else ye=null;pe!==null&&pg(se,ee,pe,ye,!1),me!==null&&gt!==null&&pg(se,gt,me,ye,!0)}}e:{if(ee=q?Hi(q):window,pe=ee.nodeName&&ee.nodeName.toLowerCase(),pe==="select"||pe==="input"&&ee.type==="file")var ve=C1;else if(Yp(ee))if(qp)ve=M1;else{ve=P1;var xe=I1}else(pe=ee.nodeName)&&pe.toLowerCase()==="input"&&(ee.type==="checkbox"||ee.type==="radio")&&(ve=k1);if(ve&&(ve=ve(o,q))){Kp(se,ve,u,te);break e}xe&&xe(o,ee,q),o==="focusout"&&(xe=ee._wrapperState)&&xe.controlled&&ee.type==="number"&&Qe(ee,"number",ee.value)}switch(xe=q?Hi(q):window,o){case"focusin":(Yp(xe)||xe.contentEditable==="true")&&(zi=xe,du=q,to=null);break;case"focusout":to=du=zi=null;break;case"mousedown":pu=!0;break;case"contextmenu":case"mouseup":case"dragend":pu=!1,rg(se,u,te);break;case"selectionchange":if(D1)break;case"keydown":case"keyup":rg(se,u,te)}var Se;if(cu)e:{switch(o){case"compositionstart":var Ie="onCompositionStart";break e;case"compositionend":Ie="onCompositionEnd";break e;case"compositionupdate":Ie="onCompositionUpdate";break e}Ie=void 0}else Vi?Hp(o,u)&&(Ie="onCompositionEnd"):o==="keydown"&&u.keyCode===229&&(Ie="onCompositionStart");Ie&&($p&&u.locale!=="ko"&&(Vi||Ie!=="onCompositionStart"?Ie==="onCompositionEnd"&&Vi&&(Se=Lp()):(Ar=te,ru="value"in Ar?Ar.value:Ar.textContent,Vi=!0)),xe=va(q,Ie),0<xe.length&&(Ie=new Vp(Ie,o,null,u,te),se.push({event:Ie,listeners:xe}),Se?Ie.data=Se:(Se=Xp(u),Se!==null&&(Ie.data=Se)))),(Se=x1?S1(o,u):E1(o,u))&&(q=va(q,"onBeforeInput"),0<q.length&&(te=new Vp("onBeforeInput","beforeinput",null,u,te),se.push({event:te,listeners:q}),te.data=Se))}hg(se,a)})}function io(o,a,u){return{instance:o,listener:a,currentTarget:u}}function va(o,a){for(var u=a+"Capture",d=[];o!==null;){var g=o,m=g.stateNode;g.tag===5&&m!==null&&(g=m,m=Us(o,u),m!=null&&d.unshift(io(o,m,g)),m=Us(o,a),m!=null&&d.push(io(o,m,g))),o=o.return}return d}function ji(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function pg(o,a,u,d,g){for(var m=a._reactName,v=[];u!==null&&u!==d;){var I=u,O=I.alternate,q=I.stateNode;if(O!==null&&O===d)break;I.tag===5&&q!==null&&(I=q,g?(O=Us(u,m),O!=null&&v.unshift(io(u,O,I))):g||(O=Us(u,m),O!=null&&v.push(io(u,O,I)))),u=u.return}v.length!==0&&o.push({event:a,listeners:v})}var U1=/\r\n?/g,V1=/\u0000|\uFFFD/g;function gg(o){return(typeof o=="string"?o:""+o).replace(U1,`
`).replace(V1,"")}function ba(o,a,u){if(a=gg(a),gg(o)!==a&&u)throw Error(t(425))}function wa(){}var bu=null,wu=null;function Tu(o,a){return o==="textarea"||o==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var xu=typeof setTimeout=="function"?setTimeout:void 0,z1=typeof clearTimeout=="function"?clearTimeout:void 0,_g=typeof Promise=="function"?Promise:void 0,$1=typeof queueMicrotask=="function"?queueMicrotask:typeof _g<"u"?function(o){return _g.resolve(null).then(o).catch(j1)}:xu;function j1(o){setTimeout(function(){throw o})}function Su(o,a){var u=a,d=0;do{var g=u.nextSibling;if(o.removeChild(u),g&&g.nodeType===8)if(u=g.data,u==="/$"){if(d===0){o.removeChild(g),Ks(a);return}d--}else u!=="$"&&u!=="$?"&&u!=="$!"||d++;u=g}while(u);Ks(a)}function Cr(o){for(;o!=null;o=o.nextSibling){var a=o.nodeType;if(a===1||a===3)break;if(a===8){if(a=o.data,a==="$"||a==="$!"||a==="$?")break;if(a==="/$")return null}}return o}function mg(o){o=o.previousSibling;for(var a=0;o;){if(o.nodeType===8){var u=o.data;if(u==="$"||u==="$!"||u==="$?"){if(a===0)return o;a--}else u==="/$"&&a++}o=o.previousSibling}return null}var Wi=Math.random().toString(36).slice(2),Xn="__reactFiber$"+Wi,so="__reactProps$"+Wi,ir="__reactContainer$"+Wi,Eu="__reactEvents$"+Wi,W1="__reactListeners$"+Wi,H1="__reactHandles$"+Wi;function ri(o){var a=o[Xn];if(a)return a;for(var u=o.parentNode;u;){if(a=u[ir]||u[Xn]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(o=mg(o);o!==null;){if(u=o[Xn])return u;o=mg(o)}return a}o=u,u=o.parentNode}return null}function oo(o){return o=o[Xn]||o[ir],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function Hi(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(t(33))}function Ta(o){return o[so]||null}var Au=[],Xi=-1;function Ir(o){return{current:o}}function nt(o){0>Xi||(o.current=Au[Xi],Au[Xi]=null,Xi--)}function Ge(o,a){Xi++,Au[Xi]=o.current,o.current=a}var Pr={},Dt=Ir(Pr),Gt=Ir(!1),ii=Pr;function Yi(o,a){var u=o.type.contextTypes;if(!u)return Pr;var d=o.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===a)return d.__reactInternalMemoizedMaskedChildContext;var g={},m;for(m in u)g[m]=a[m];return d&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=a,o.__reactInternalMemoizedMaskedChildContext=g),g}function en(o){return o=o.childContextTypes,o!=null}function xa(){nt(Gt),nt(Dt)}function yg(o,a,u){if(Dt.current!==Pr)throw Error(t(168));Ge(Dt,a),Ge(Gt,u)}function vg(o,a,u){var d=o.stateNode;if(a=a.childContextTypes,typeof d.getChildContext!="function")return u;d=d.getChildContext();for(var g in d)if(!(g in a))throw Error(t(108,Ne(o)||"Unknown",g));return ce({},u,d)}function Sa(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Pr,ii=Dt.current,Ge(Dt,o),Ge(Gt,Gt.current),!0}function bg(o,a,u){var d=o.stateNode;if(!d)throw Error(t(169));u?(o=vg(o,a,ii),d.__reactInternalMemoizedMergedChildContext=o,nt(Gt),nt(Dt),Ge(Dt,o)):nt(Gt),Ge(Gt,u)}var sr=null,Ea=!1,Ru=!1;function wg(o){sr===null?sr=[o]:sr.push(o)}function X1(o){Ea=!0,wg(o)}function kr(){if(!Ru&&sr!==null){Ru=!0;var o=0,a=Ke;try{var u=sr;for(Ke=1;o<u.length;o++){var d=u[o];do d=d(!0);while(d!==null)}sr=null,Ea=!1}catch(g){throw sr!==null&&(sr=sr.slice(o+1)),xp(qc,kr),g}finally{Ke=a,Ru=!1}}return null}var Ki=[],qi=0,Aa=null,Ra=0,vn=[],bn=0,si=null,or=1,ar="";function oi(o,a){Ki[qi++]=Ra,Ki[qi++]=Aa,Aa=o,Ra=a}function Tg(o,a,u){vn[bn++]=or,vn[bn++]=ar,vn[bn++]=si,si=o;var d=or;o=ar;var g=32-kn(d)-1;d&=~(1<<g),u+=1;var m=32-kn(a)+g;if(30<m){var v=g-g%5;m=(d&(1<<v)-1).toString(32),d>>=v,g-=v,or=1<<32-kn(a)+g|u<<g|d,ar=m+o}else or=1<<m|u<<g|d,ar=o}function Cu(o){o.return!==null&&(oi(o,1),Tg(o,1,0))}function Iu(o){for(;o===Aa;)Aa=Ki[--qi],Ki[qi]=null,Ra=Ki[--qi],Ki[qi]=null;for(;o===si;)si=vn[--bn],vn[bn]=null,ar=vn[--bn],vn[bn]=null,or=vn[--bn],vn[bn]=null}var un=null,fn=null,it=!1,On=null;function xg(o,a){var u=Sn(5,null,null,0);u.elementType="DELETED",u.stateNode=a,u.return=o,a=o.deletions,a===null?(o.deletions=[u],o.flags|=16):a.push(u)}function Sg(o,a){switch(o.tag){case 5:var u=o.type;return a=a.nodeType!==1||u.toLowerCase()!==a.nodeName.toLowerCase()?null:a,a!==null?(o.stateNode=a,un=o,fn=Cr(a.firstChild),!0):!1;case 6:return a=o.pendingProps===""||a.nodeType!==3?null:a,a!==null?(o.stateNode=a,un=o,fn=null,!0):!1;case 13:return a=a.nodeType!==8?null:a,a!==null?(u=si!==null?{id:or,overflow:ar}:null,o.memoizedState={dehydrated:a,treeContext:u,retryLane:1073741824},u=Sn(18,null,null,0),u.stateNode=a,u.return=o,o.child=u,un=o,fn=null,!0):!1;default:return!1}}function Pu(o){return(o.mode&1)!==0&&(o.flags&128)===0}function ku(o){if(it){var a=fn;if(a){var u=a;if(!Sg(o,a)){if(Pu(o))throw Error(t(418));a=Cr(u.nextSibling);var d=un;a&&Sg(o,a)?xg(d,u):(o.flags=o.flags&-4097|2,it=!1,un=o)}}else{if(Pu(o))throw Error(t(418));o.flags=o.flags&-4097|2,it=!1,un=o}}}function Eg(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;un=o}function Ca(o){if(o!==un)return!1;if(!it)return Eg(o),it=!0,!1;var a;if((a=o.tag!==3)&&!(a=o.tag!==5)&&(a=o.type,a=a!=="head"&&a!=="body"&&!Tu(o.type,o.memoizedProps)),a&&(a=fn)){if(Pu(o))throw Ag(),Error(t(418));for(;a;)xg(o,a),a=Cr(a.nextSibling)}if(Eg(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(t(317));e:{for(o=o.nextSibling,a=0;o;){if(o.nodeType===8){var u=o.data;if(u==="/$"){if(a===0){fn=Cr(o.nextSibling);break e}a--}else u!=="$"&&u!=="$!"&&u!=="$?"||a++}o=o.nextSibling}fn=null}}else fn=un?Cr(o.stateNode.nextSibling):null;return!0}function Ag(){for(var o=fn;o;)o=Cr(o.nextSibling)}function Zi(){fn=un=null,it=!1}function Mu(o){On===null?On=[o]:On.push(o)}var Y1=V.ReactCurrentBatchConfig;function ao(o,a,u){if(o=u.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(u._owner){if(u=u._owner,u){if(u.tag!==1)throw Error(t(309));var d=u.stateNode}if(!d)throw Error(t(147,o));var g=d,m=""+o;return a!==null&&a.ref!==null&&typeof a.ref=="function"&&a.ref._stringRef===m?a.ref:(a=function(v){var I=g.refs;v===null?delete I[m]:I[m]=v},a._stringRef=m,a)}if(typeof o!="string")throw Error(t(284));if(!u._owner)throw Error(t(290,o))}return o}function Ia(o,a){throw o=Object.prototype.toString.call(a),Error(t(31,o==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":o))}function Rg(o){var a=o._init;return a(o._payload)}function Cg(o){function a(H,D){if(o){var X=H.deletions;X===null?(H.deletions=[D],H.flags|=16):X.push(D)}}function u(H,D){if(!o)return null;for(;D!==null;)a(H,D),D=D.sibling;return null}function d(H,D){for(H=new Map;D!==null;)D.key!==null?H.set(D.key,D):H.set(D.index,D),D=D.sibling;return H}function g(H,D){return H=Ur(H,D),H.index=0,H.sibling=null,H}function m(H,D,X){return H.index=X,o?(X=H.alternate,X!==null?(X=X.index,X<D?(H.flags|=2,D):X):(H.flags|=2,D)):(H.flags|=1048576,D)}function v(H){return o&&H.alternate===null&&(H.flags|=2),H}function I(H,D,X,le){return D===null||D.tag!==6?(D=Sf(X,H.mode,le),D.return=H,D):(D=g(D,X),D.return=H,D)}function O(H,D,X,le){var ve=X.type;return ve===L?te(H,D,X.props.children,le,X.key):D!==null&&(D.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===De&&Rg(ve)===D.type)?(le=g(D,X.props),le.ref=ao(H,D,X),le.return=H,le):(le=Ga(X.type,X.key,X.props,null,H.mode,le),le.ref=ao(H,D,X),le.return=H,le)}function q(H,D,X,le){return D===null||D.tag!==4||D.stateNode.containerInfo!==X.containerInfo||D.stateNode.implementation!==X.implementation?(D=Ef(X,H.mode,le),D.return=H,D):(D=g(D,X.children||[]),D.return=H,D)}function te(H,D,X,le,ve){return D===null||D.tag!==7?(D=pi(X,H.mode,le,ve),D.return=H,D):(D=g(D,X),D.return=H,D)}function se(H,D,X){if(typeof D=="string"&&D!==""||typeof D=="number")return D=Sf(""+D,H.mode,X),D.return=H,D;if(typeof D=="object"&&D!==null){switch(D.$$typeof){case Z:return X=Ga(D.type,D.key,D.props,null,H.mode,X),X.ref=ao(H,null,D),X.return=H,X;case Y:return D=Ef(D,H.mode,X),D.return=H,D;case De:var le=D._init;return se(H,le(D._payload),X)}if(Zt(D)||ie(D))return D=pi(D,H.mode,X,null),D.return=H,D;Ia(H,D)}return null}function ee(H,D,X,le){var ve=D!==null?D.key:null;if(typeof X=="string"&&X!==""||typeof X=="number")return ve!==null?null:I(H,D,""+X,le);if(typeof X=="object"&&X!==null){switch(X.$$typeof){case Z:return X.key===ve?O(H,D,X,le):null;case Y:return X.key===ve?q(H,D,X,le):null;case De:return ve=X._init,ee(H,D,ve(X._payload),le)}if(Zt(X)||ie(X))return ve!==null?null:te(H,D,X,le,null);Ia(H,X)}return null}function pe(H,D,X,le,ve){if(typeof le=="string"&&le!==""||typeof le=="number")return H=H.get(X)||null,I(D,H,""+le,ve);if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Z:return H=H.get(le.key===null?X:le.key)||null,O(D,H,le,ve);case Y:return H=H.get(le.key===null?X:le.key)||null,q(D,H,le,ve);case De:var xe=le._init;return pe(H,D,X,xe(le._payload),ve)}if(Zt(le)||ie(le))return H=H.get(X)||null,te(D,H,le,ve,null);Ia(D,le)}return null}function me(H,D,X,le){for(var ve=null,xe=null,Se=D,Ie=D=0,It=null;Se!==null&&Ie<X.length;Ie++){Se.index>Ie?(It=Se,Se=null):It=Se.sibling;var je=ee(H,Se,X[Ie],le);if(je===null){Se===null&&(Se=It);break}o&&Se&&je.alternate===null&&a(H,Se),D=m(je,D,Ie),xe===null?ve=je:xe.sibling=je,xe=je,Se=It}if(Ie===X.length)return u(H,Se),it&&oi(H,Ie),ve;if(Se===null){for(;Ie<X.length;Ie++)Se=se(H,X[Ie],le),Se!==null&&(D=m(Se,D,Ie),xe===null?ve=Se:xe.sibling=Se,xe=Se);return it&&oi(H,Ie),ve}for(Se=d(H,Se);Ie<X.length;Ie++)It=pe(Se,H,Ie,X[Ie],le),It!==null&&(o&&It.alternate!==null&&Se.delete(It.key===null?Ie:It.key),D=m(It,D,Ie),xe===null?ve=It:xe.sibling=It,xe=It);return o&&Se.forEach(function(Vr){return a(H,Vr)}),it&&oi(H,Ie),ve}function ye(H,D,X,le){var ve=ie(X);if(typeof ve!="function")throw Error(t(150));if(X=ve.call(X),X==null)throw Error(t(151));for(var xe=ve=null,Se=D,Ie=D=0,It=null,je=X.next();Se!==null&&!je.done;Ie++,je=X.next()){Se.index>Ie?(It=Se,Se=null):It=Se.sibling;var Vr=ee(H,Se,je.value,le);if(Vr===null){Se===null&&(Se=It);break}o&&Se&&Vr.alternate===null&&a(H,Se),D=m(Vr,D,Ie),xe===null?ve=Vr:xe.sibling=Vr,xe=Vr,Se=It}if(je.done)return u(H,Se),it&&oi(H,Ie),ve;if(Se===null){for(;!je.done;Ie++,je=X.next())je=se(H,je.value,le),je!==null&&(D=m(je,D,Ie),xe===null?ve=je:xe.sibling=je,xe=je);return it&&oi(H,Ie),ve}for(Se=d(H,Se);!je.done;Ie++,je=X.next())je=pe(Se,H,Ie,je.value,le),je!==null&&(o&&je.alternate!==null&&Se.delete(je.key===null?Ie:je.key),D=m(je,D,Ie),xe===null?ve=je:xe.sibling=je,xe=je);return o&&Se.forEach(function(Aw){return a(H,Aw)}),it&&oi(H,Ie),ve}function gt(H,D,X,le){if(typeof X=="object"&&X!==null&&X.type===L&&X.key===null&&(X=X.props.children),typeof X=="object"&&X!==null){switch(X.$$typeof){case Z:e:{for(var ve=X.key,xe=D;xe!==null;){if(xe.key===ve){if(ve=X.type,ve===L){if(xe.tag===7){u(H,xe.sibling),D=g(xe,X.props.children),D.return=H,H=D;break e}}else if(xe.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===De&&Rg(ve)===xe.type){u(H,xe.sibling),D=g(xe,X.props),D.ref=ao(H,xe,X),D.return=H,H=D;break e}u(H,xe);break}else a(H,xe);xe=xe.sibling}X.type===L?(D=pi(X.props.children,H.mode,le,X.key),D.return=H,H=D):(le=Ga(X.type,X.key,X.props,null,H.mode,le),le.ref=ao(H,D,X),le.return=H,H=le)}return v(H);case Y:e:{for(xe=X.key;D!==null;){if(D.key===xe)if(D.tag===4&&D.stateNode.containerInfo===X.containerInfo&&D.stateNode.implementation===X.implementation){u(H,D.sibling),D=g(D,X.children||[]),D.return=H,H=D;break e}else{u(H,D);break}else a(H,D);D=D.sibling}D=Ef(X,H.mode,le),D.return=H,H=D}return v(H);case De:return xe=X._init,gt(H,D,xe(X._payload),le)}if(Zt(X))return me(H,D,X,le);if(ie(X))return ye(H,D,X,le);Ia(H,X)}return typeof X=="string"&&X!==""||typeof X=="number"?(X=""+X,D!==null&&D.tag===6?(u(H,D.sibling),D=g(D,X),D.return=H,H=D):(u(H,D),D=Sf(X,H.mode,le),D.return=H,H=D),v(H)):u(H,D)}return gt}var Qi=Cg(!0),Ig=Cg(!1),Pa=Ir(null),ka=null,Ji=null,Ou=null;function Nu(){Ou=Ji=ka=null}function Du(o){var a=Pa.current;nt(Pa),o._currentValue=a}function Fu(o,a,u){for(;o!==null;){var d=o.alternate;if((o.childLanes&a)!==a?(o.childLanes|=a,d!==null&&(d.childLanes|=a)):d!==null&&(d.childLanes&a)!==a&&(d.childLanes|=a),o===u)break;o=o.return}}function Gi(o,a){ka=o,Ou=Ji=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&a)!==0&&(tn=!0),o.firstContext=null)}function wn(o){var a=o._currentValue;if(Ou!==o)if(o={context:o,memoizedValue:a,next:null},Ji===null){if(ka===null)throw Error(t(308));Ji=o,ka.dependencies={lanes:0,firstContext:o}}else Ji=Ji.next=o;return a}var ai=null;function Lu(o){ai===null?ai=[o]:ai.push(o)}function Pg(o,a,u,d){var g=a.interleaved;return g===null?(u.next=u,Lu(a)):(u.next=g.next,g.next=u),a.interleaved=u,lr(o,d)}function lr(o,a){o.lanes|=a;var u=o.alternate;for(u!==null&&(u.lanes|=a),u=o,o=o.return;o!==null;)o.childLanes|=a,u=o.alternate,u!==null&&(u.childLanes|=a),u=o,o=o.return;return u.tag===3?u.stateNode:null}var Mr=!1;function Bu(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kg(o,a){o=o.updateQueue,a.updateQueue===o&&(a.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function cr(o,a){return{eventTime:o,lane:a,tag:0,payload:null,callback:null,next:null}}function Or(o,a,u){var d=o.updateQueue;if(d===null)return null;if(d=d.shared,($e&2)!==0){var g=d.pending;return g===null?a.next=a:(a.next=g.next,g.next=a),d.pending=a,lr(o,u)}return g=d.interleaved,g===null?(a.next=a,Lu(d)):(a.next=g.next,g.next=a),d.interleaved=a,lr(o,u)}function Ma(o,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194240)!==0)){var d=a.lanes;d&=o.pendingLanes,u|=d,a.lanes=u,Jc(o,u)}}function Mg(o,a){var u=o.updateQueue,d=o.alternate;if(d!==null&&(d=d.updateQueue,u===d)){var g=null,m=null;if(u=u.firstBaseUpdate,u!==null){do{var v={eventTime:u.eventTime,lane:u.lane,tag:u.tag,payload:u.payload,callback:u.callback,next:null};m===null?g=m=v:m=m.next=v,u=u.next}while(u!==null);m===null?g=m=a:m=m.next=a}else g=m=a;u={baseState:d.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:d.shared,effects:d.effects},o.updateQueue=u;return}o=u.lastBaseUpdate,o===null?u.firstBaseUpdate=a:o.next=a,u.lastBaseUpdate=a}function Oa(o,a,u,d){var g=o.updateQueue;Mr=!1;var m=g.firstBaseUpdate,v=g.lastBaseUpdate,I=g.shared.pending;if(I!==null){g.shared.pending=null;var O=I,q=O.next;O.next=null,v===null?m=q:v.next=q,v=O;var te=o.alternate;te!==null&&(te=te.updateQueue,I=te.lastBaseUpdate,I!==v&&(I===null?te.firstBaseUpdate=q:I.next=q,te.lastBaseUpdate=O))}if(m!==null){var se=g.baseState;v=0,te=q=O=null,I=m;do{var ee=I.lane,pe=I.eventTime;if((d&ee)===ee){te!==null&&(te=te.next={eventTime:pe,lane:0,tag:I.tag,payload:I.payload,callback:I.callback,next:null});e:{var me=o,ye=I;switch(ee=a,pe=u,ye.tag){case 1:if(me=ye.payload,typeof me=="function"){se=me.call(pe,se,ee);break e}se=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=ye.payload,ee=typeof me=="function"?me.call(pe,se,ee):me,ee==null)break e;se=ce({},se,ee);break e;case 2:Mr=!0}}I.callback!==null&&I.lane!==0&&(o.flags|=64,ee=g.effects,ee===null?g.effects=[I]:ee.push(I))}else pe={eventTime:pe,lane:ee,tag:I.tag,payload:I.payload,callback:I.callback,next:null},te===null?(q=te=pe,O=se):te=te.next=pe,v|=ee;if(I=I.next,I===null){if(I=g.shared.pending,I===null)break;ee=I,I=ee.next,ee.next=null,g.lastBaseUpdate=ee,g.shared.pending=null}}while(!0);if(te===null&&(O=se),g.baseState=O,g.firstBaseUpdate=q,g.lastBaseUpdate=te,a=g.shared.interleaved,a!==null){g=a;do v|=g.lane,g=g.next;while(g!==a)}else m===null&&(g.shared.lanes=0);ui|=v,o.lanes=v,o.memoizedState=se}}function Og(o,a,u){if(o=a.effects,a.effects=null,o!==null)for(a=0;a<o.length;a++){var d=o[a],g=d.callback;if(g!==null){if(d.callback=null,d=u,typeof g!="function")throw Error(t(191,g));g.call(d)}}}var lo={},Yn=Ir(lo),co=Ir(lo),uo=Ir(lo);function li(o){if(o===lo)throw Error(t(174));return o}function Uu(o,a){switch(Ge(uo,a),Ge(co,o),Ge(Yn,lo),o=a.nodeType,o){case 9:case 11:a=(a=a.documentElement)?a.namespaceURI:At(null,"");break;default:o=o===8?a.parentNode:a,a=o.namespaceURI||null,o=o.tagName,a=At(a,o)}nt(Yn),Ge(Yn,a)}function es(){nt(Yn),nt(co),nt(uo)}function Ng(o){li(uo.current);var a=li(Yn.current),u=At(a,o.type);a!==u&&(Ge(co,o),Ge(Yn,u))}function Vu(o){co.current===o&&(nt(Yn),nt(co))}var at=Ir(0);function Na(o){for(var a=o;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||u.data==="$?"||u.data==="$!"))return a}else if(a.tag===19&&a.memoizedProps.revealOrder!==void 0){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var zu=[];function $u(){for(var o=0;o<zu.length;o++)zu[o]._workInProgressVersionPrimary=null;zu.length=0}var Da=V.ReactCurrentDispatcher,ju=V.ReactCurrentBatchConfig,ci=0,lt=null,Tt=null,Rt=null,Fa=!1,fo=!1,ho=0,K1=0;function Ft(){throw Error(t(321))}function Wu(o,a){if(a===null)return!1;for(var u=0;u<a.length&&u<o.length;u++)if(!Mn(o[u],a[u]))return!1;return!0}function Hu(o,a,u,d,g,m){if(ci=m,lt=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,Da.current=o===null||o.memoizedState===null?J1:G1,o=u(d,g),fo){m=0;do{if(fo=!1,ho=0,25<=m)throw Error(t(301));m+=1,Rt=Tt=null,a.updateQueue=null,Da.current=ew,o=u(d,g)}while(fo)}if(Da.current=Ua,a=Tt!==null&&Tt.next!==null,ci=0,Rt=Tt=lt=null,Fa=!1,a)throw Error(t(300));return o}function Xu(){var o=ho!==0;return ho=0,o}function Kn(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Rt===null?lt.memoizedState=Rt=o:Rt=Rt.next=o,Rt}function Tn(){if(Tt===null){var o=lt.alternate;o=o!==null?o.memoizedState:null}else o=Tt.next;var a=Rt===null?lt.memoizedState:Rt.next;if(a!==null)Rt=a,Tt=o;else{if(o===null)throw Error(t(310));Tt=o,o={memoizedState:Tt.memoizedState,baseState:Tt.baseState,baseQueue:Tt.baseQueue,queue:Tt.queue,next:null},Rt===null?lt.memoizedState=Rt=o:Rt=Rt.next=o}return Rt}function po(o,a){return typeof a=="function"?a(o):a}function Yu(o){var a=Tn(),u=a.queue;if(u===null)throw Error(t(311));u.lastRenderedReducer=o;var d=Tt,g=d.baseQueue,m=u.pending;if(m!==null){if(g!==null){var v=g.next;g.next=m.next,m.next=v}d.baseQueue=g=m,u.pending=null}if(g!==null){m=g.next,d=d.baseState;var I=v=null,O=null,q=m;do{var te=q.lane;if((ci&te)===te)O!==null&&(O=O.next={lane:0,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null}),d=q.hasEagerState?q.eagerState:o(d,q.action);else{var se={lane:te,action:q.action,hasEagerState:q.hasEagerState,eagerState:q.eagerState,next:null};O===null?(I=O=se,v=d):O=O.next=se,lt.lanes|=te,ui|=te}q=q.next}while(q!==null&&q!==m);O===null?v=d:O.next=I,Mn(d,a.memoizedState)||(tn=!0),a.memoizedState=d,a.baseState=v,a.baseQueue=O,u.lastRenderedState=d}if(o=u.interleaved,o!==null){g=o;do m=g.lane,lt.lanes|=m,ui|=m,g=g.next;while(g!==o)}else g===null&&(u.lanes=0);return[a.memoizedState,u.dispatch]}function Ku(o){var a=Tn(),u=a.queue;if(u===null)throw Error(t(311));u.lastRenderedReducer=o;var d=u.dispatch,g=u.pending,m=a.memoizedState;if(g!==null){u.pending=null;var v=g=g.next;do m=o(m,v.action),v=v.next;while(v!==g);Mn(m,a.memoizedState)||(tn=!0),a.memoizedState=m,a.baseQueue===null&&(a.baseState=m),u.lastRenderedState=m}return[m,d]}function Dg(){}function Fg(o,a){var u=lt,d=Tn(),g=a(),m=!Mn(d.memoizedState,g);if(m&&(d.memoizedState=g,tn=!0),d=d.queue,qu(Ug.bind(null,u,d,o),[o]),d.getSnapshot!==a||m||Rt!==null&&Rt.memoizedState.tag&1){if(u.flags|=2048,go(9,Bg.bind(null,u,d,g,a),void 0,null),Ct===null)throw Error(t(349));(ci&30)!==0||Lg(u,a,g)}return g}function Lg(o,a,u){o.flags|=16384,o={getSnapshot:a,value:u},a=lt.updateQueue,a===null?(a={lastEffect:null,stores:null},lt.updateQueue=a,a.stores=[o]):(u=a.stores,u===null?a.stores=[o]:u.push(o))}function Bg(o,a,u,d){a.value=u,a.getSnapshot=d,Vg(a)&&zg(o)}function Ug(o,a,u){return u(function(){Vg(a)&&zg(o)})}function Vg(o){var a=o.getSnapshot;o=o.value;try{var u=a();return!Mn(o,u)}catch{return!0}}function zg(o){var a=lr(o,1);a!==null&&Ln(a,o,1,-1)}function $g(o){var a=Kn();return typeof o=="function"&&(o=o()),a.memoizedState=a.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:o},a.queue=o,o=o.dispatch=Q1.bind(null,lt,o),[a.memoizedState,o]}function go(o,a,u,d){return o={tag:o,create:a,destroy:u,deps:d,next:null},a=lt.updateQueue,a===null?(a={lastEffect:null,stores:null},lt.updateQueue=a,a.lastEffect=o.next=o):(u=a.lastEffect,u===null?a.lastEffect=o.next=o:(d=u.next,u.next=o,o.next=d,a.lastEffect=o)),o}function jg(){return Tn().memoizedState}function La(o,a,u,d){var g=Kn();lt.flags|=o,g.memoizedState=go(1|a,u,void 0,d===void 0?null:d)}function Ba(o,a,u,d){var g=Tn();d=d===void 0?null:d;var m=void 0;if(Tt!==null){var v=Tt.memoizedState;if(m=v.destroy,d!==null&&Wu(d,v.deps)){g.memoizedState=go(a,u,m,d);return}}lt.flags|=o,g.memoizedState=go(1|a,u,m,d)}function Wg(o,a){return La(8390656,8,o,a)}function qu(o,a){return Ba(2048,8,o,a)}function Hg(o,a){return Ba(4,2,o,a)}function Xg(o,a){return Ba(4,4,o,a)}function Yg(o,a){if(typeof a=="function")return o=o(),a(o),function(){a(null)};if(a!=null)return o=o(),a.current=o,function(){a.current=null}}function Kg(o,a,u){return u=u!=null?u.concat([o]):null,Ba(4,4,Yg.bind(null,a,o),u)}function Zu(){}function qg(o,a){var u=Tn();a=a===void 0?null:a;var d=u.memoizedState;return d!==null&&a!==null&&Wu(a,d[1])?d[0]:(u.memoizedState=[o,a],o)}function Zg(o,a){var u=Tn();a=a===void 0?null:a;var d=u.memoizedState;return d!==null&&a!==null&&Wu(a,d[1])?d[0]:(o=o(),u.memoizedState=[o,a],o)}function Qg(o,a,u){return(ci&21)===0?(o.baseState&&(o.baseState=!1,tn=!0),o.memoizedState=u):(Mn(u,a)||(u=Rp(),lt.lanes|=u,ui|=u,o.baseState=!0),a)}function q1(o,a){var u=Ke;Ke=u!==0&&4>u?u:4,o(!0);var d=ju.transition;ju.transition={};try{o(!1),a()}finally{Ke=u,ju.transition=d}}function Jg(){return Tn().memoizedState}function Z1(o,a,u){var d=Lr(o);if(u={lane:d,action:u,hasEagerState:!1,eagerState:null,next:null},Gg(o))e_(a,u);else if(u=Pg(o,a,u,d),u!==null){var g=Yt();Ln(u,o,d,g),t_(u,a,d)}}function Q1(o,a,u){var d=Lr(o),g={lane:d,action:u,hasEagerState:!1,eagerState:null,next:null};if(Gg(o))e_(a,g);else{var m=o.alternate;if(o.lanes===0&&(m===null||m.lanes===0)&&(m=a.lastRenderedReducer,m!==null))try{var v=a.lastRenderedState,I=m(v,u);if(g.hasEagerState=!0,g.eagerState=I,Mn(I,v)){var O=a.interleaved;O===null?(g.next=g,Lu(a)):(g.next=O.next,O.next=g),a.interleaved=g;return}}catch{}finally{}u=Pg(o,a,g,d),u!==null&&(g=Yt(),Ln(u,o,d,g),t_(u,a,d))}}function Gg(o){var a=o.alternate;return o===lt||a!==null&&a===lt}function e_(o,a){fo=Fa=!0;var u=o.pending;u===null?a.next=a:(a.next=u.next,u.next=a),o.pending=a}function t_(o,a,u){if((u&4194240)!==0){var d=a.lanes;d&=o.pendingLanes,u|=d,a.lanes=u,Jc(o,u)}}var Ua={readContext:wn,useCallback:Ft,useContext:Ft,useEffect:Ft,useImperativeHandle:Ft,useInsertionEffect:Ft,useLayoutEffect:Ft,useMemo:Ft,useReducer:Ft,useRef:Ft,useState:Ft,useDebugValue:Ft,useDeferredValue:Ft,useTransition:Ft,useMutableSource:Ft,useSyncExternalStore:Ft,useId:Ft,unstable_isNewReconciler:!1},J1={readContext:wn,useCallback:function(o,a){return Kn().memoizedState=[o,a===void 0?null:a],o},useContext:wn,useEffect:Wg,useImperativeHandle:function(o,a,u){return u=u!=null?u.concat([o]):null,La(4194308,4,Yg.bind(null,a,o),u)},useLayoutEffect:function(o,a){return La(4194308,4,o,a)},useInsertionEffect:function(o,a){return La(4,2,o,a)},useMemo:function(o,a){var u=Kn();return a=a===void 0?null:a,o=o(),u.memoizedState=[o,a],o},useReducer:function(o,a,u){var d=Kn();return a=u!==void 0?u(a):a,d.memoizedState=d.baseState=a,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:a},d.queue=o,o=o.dispatch=Z1.bind(null,lt,o),[d.memoizedState,o]},useRef:function(o){var a=Kn();return o={current:o},a.memoizedState=o},useState:$g,useDebugValue:Zu,useDeferredValue:function(o){return Kn().memoizedState=o},useTransition:function(){var o=$g(!1),a=o[0];return o=q1.bind(null,o[1]),Kn().memoizedState=o,[a,o]},useMutableSource:function(){},useSyncExternalStore:function(o,a,u){var d=lt,g=Kn();if(it){if(u===void 0)throw Error(t(407));u=u()}else{if(u=a(),Ct===null)throw Error(t(349));(ci&30)!==0||Lg(d,a,u)}g.memoizedState=u;var m={value:u,getSnapshot:a};return g.queue=m,Wg(Ug.bind(null,d,m,o),[o]),d.flags|=2048,go(9,Bg.bind(null,d,m,u,a),void 0,null),u},useId:function(){var o=Kn(),a=Ct.identifierPrefix;if(it){var u=ar,d=or;u=(d&~(1<<32-kn(d)-1)).toString(32)+u,a=":"+a+"R"+u,u=ho++,0<u&&(a+="H"+u.toString(32)),a+=":"}else u=K1++,a=":"+a+"r"+u.toString(32)+":";return o.memoizedState=a},unstable_isNewReconciler:!1},G1={readContext:wn,useCallback:qg,useContext:wn,useEffect:qu,useImperativeHandle:Kg,useInsertionEffect:Hg,useLayoutEffect:Xg,useMemo:Zg,useReducer:Yu,useRef:jg,useState:function(){return Yu(po)},useDebugValue:Zu,useDeferredValue:function(o){var a=Tn();return Qg(a,Tt.memoizedState,o)},useTransition:function(){var o=Yu(po)[0],a=Tn().memoizedState;return[o,a]},useMutableSource:Dg,useSyncExternalStore:Fg,useId:Jg,unstable_isNewReconciler:!1},ew={readContext:wn,useCallback:qg,useContext:wn,useEffect:qu,useImperativeHandle:Kg,useInsertionEffect:Hg,useLayoutEffect:Xg,useMemo:Zg,useReducer:Ku,useRef:jg,useState:function(){return Ku(po)},useDebugValue:Zu,useDeferredValue:function(o){var a=Tn();return Tt===null?a.memoizedState=o:Qg(a,Tt.memoizedState,o)},useTransition:function(){var o=Ku(po)[0],a=Tn().memoizedState;return[o,a]},useMutableSource:Dg,useSyncExternalStore:Fg,useId:Jg,unstable_isNewReconciler:!1};function Nn(o,a){if(o&&o.defaultProps){a=ce({},a),o=o.defaultProps;for(var u in o)a[u]===void 0&&(a[u]=o[u]);return a}return a}function Qu(o,a,u,d){a=o.memoizedState,u=u(d,a),u=u==null?a:ce({},a,u),o.memoizedState=u,o.lanes===0&&(o.updateQueue.baseState=u)}var Va={isMounted:function(o){return(o=o._reactInternals)?ni(o)===o:!1},enqueueSetState:function(o,a,u){o=o._reactInternals;var d=Yt(),g=Lr(o),m=cr(d,g);m.payload=a,u!=null&&(m.callback=u),a=Or(o,m,g),a!==null&&(Ln(a,o,g,d),Ma(a,o,g))},enqueueReplaceState:function(o,a,u){o=o._reactInternals;var d=Yt(),g=Lr(o),m=cr(d,g);m.tag=1,m.payload=a,u!=null&&(m.callback=u),a=Or(o,m,g),a!==null&&(Ln(a,o,g,d),Ma(a,o,g))},enqueueForceUpdate:function(o,a){o=o._reactInternals;var u=Yt(),d=Lr(o),g=cr(u,d);g.tag=2,a!=null&&(g.callback=a),a=Or(o,g,d),a!==null&&(Ln(a,o,d,u),Ma(a,o,d))}};function n_(o,a,u,d,g,m,v){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(d,m,v):a.prototype&&a.prototype.isPureReactComponent?!eo(u,d)||!eo(g,m):!0}function r_(o,a,u){var d=!1,g=Pr,m=a.contextType;return typeof m=="object"&&m!==null?m=wn(m):(g=en(a)?ii:Dt.current,d=a.contextTypes,m=(d=d!=null)?Yi(o,g):Pr),a=new a(u,m),o.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,a.updater=Va,o.stateNode=a,a._reactInternals=o,d&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=g,o.__reactInternalMemoizedMaskedChildContext=m),a}function i_(o,a,u,d){o=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,d),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,d),a.state!==o&&Va.enqueueReplaceState(a,a.state,null)}function Ju(o,a,u,d){var g=o.stateNode;g.props=u,g.state=o.memoizedState,g.refs={},Bu(o);var m=a.contextType;typeof m=="object"&&m!==null?g.context=wn(m):(m=en(a)?ii:Dt.current,g.context=Yi(o,m)),g.state=o.memoizedState,m=a.getDerivedStateFromProps,typeof m=="function"&&(Qu(o,a,m,u),g.state=o.memoizedState),typeof a.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(a=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),a!==g.state&&Va.enqueueReplaceState(g,g.state,null),Oa(o,u,g,d),g.state=o.memoizedState),typeof g.componentDidMount=="function"&&(o.flags|=4194308)}function ts(o,a){try{var u="",d=a;do u+=Te(d),d=d.return;while(d);var g=u}catch(m){g=`
Error generating stack: `+m.message+`
`+m.stack}return{value:o,source:a,stack:g,digest:null}}function Gu(o,a,u){return{value:o,source:null,stack:u??null,digest:a??null}}function ef(o,a){try{console.error(a.value)}catch(u){setTimeout(function(){throw u})}}var tw=typeof WeakMap=="function"?WeakMap:Map;function s_(o,a,u){u=cr(-1,u),u.tag=3,u.payload={element:null};var d=a.value;return u.callback=function(){Ya||(Ya=!0,_f=d),ef(o,a)},u}function o_(o,a,u){u=cr(-1,u),u.tag=3;var d=o.type.getDerivedStateFromError;if(typeof d=="function"){var g=a.value;u.payload=function(){return d(g)},u.callback=function(){ef(o,a)}}var m=o.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(u.callback=function(){ef(o,a),typeof d!="function"&&(Dr===null?Dr=new Set([this]):Dr.add(this));var v=a.stack;this.componentDidCatch(a.value,{componentStack:v!==null?v:""})}),u}function a_(o,a,u){var d=o.pingCache;if(d===null){d=o.pingCache=new tw;var g=new Set;d.set(a,g)}else g=d.get(a),g===void 0&&(g=new Set,d.set(a,g));g.has(u)||(g.add(u),o=gw.bind(null,o,a,u),a.then(o,o))}function l_(o){do{var a;if((a=o.tag===13)&&(a=o.memoizedState,a=a!==null?a.dehydrated!==null:!0),a)return o;o=o.return}while(o!==null);return null}function c_(o,a,u,d,g){return(o.mode&1)===0?(o===a?o.flags|=65536:(o.flags|=128,u.flags|=131072,u.flags&=-52805,u.tag===1&&(u.alternate===null?u.tag=17:(a=cr(-1,1),a.tag=2,Or(u,a,1))),u.lanes|=1),o):(o.flags|=65536,o.lanes=g,o)}var nw=V.ReactCurrentOwner,tn=!1;function Xt(o,a,u,d){a.child=o===null?Ig(a,null,u,d):Qi(a,o.child,u,d)}function u_(o,a,u,d,g){u=u.render;var m=a.ref;return Gi(a,g),d=Hu(o,a,u,d,m,g),u=Xu(),o!==null&&!tn?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~g,ur(o,a,g)):(it&&u&&Cu(a),a.flags|=1,Xt(o,a,d,g),a.child)}function f_(o,a,u,d,g){if(o===null){var m=u.type;return typeof m=="function"&&!xf(m)&&m.defaultProps===void 0&&u.compare===null&&u.defaultProps===void 0?(a.tag=15,a.type=m,h_(o,a,m,d,g)):(o=Ga(u.type,null,d,a,a.mode,g),o.ref=a.ref,o.return=a,a.child=o)}if(m=o.child,(o.lanes&g)===0){var v=m.memoizedProps;if(u=u.compare,u=u!==null?u:eo,u(v,d)&&o.ref===a.ref)return ur(o,a,g)}return a.flags|=1,o=Ur(m,d),o.ref=a.ref,o.return=a,a.child=o}function h_(o,a,u,d,g){if(o!==null){var m=o.memoizedProps;if(eo(m,d)&&o.ref===a.ref)if(tn=!1,a.pendingProps=d=m,(o.lanes&g)!==0)(o.flags&131072)!==0&&(tn=!0);else return a.lanes=o.lanes,ur(o,a,g)}return tf(o,a,u,d,g)}function d_(o,a,u){var d=a.pendingProps,g=d.children,m=o!==null?o.memoizedState:null;if(d.mode==="hidden")if((a.mode&1)===0)a.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ge(rs,hn),hn|=u;else{if((u&1073741824)===0)return o=m!==null?m.baseLanes|u:u,a.lanes=a.childLanes=1073741824,a.memoizedState={baseLanes:o,cachePool:null,transitions:null},a.updateQueue=null,Ge(rs,hn),hn|=o,null;a.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=m!==null?m.baseLanes:u,Ge(rs,hn),hn|=d}else m!==null?(d=m.baseLanes|u,a.memoizedState=null):d=u,Ge(rs,hn),hn|=d;return Xt(o,a,g,u),a.child}function p_(o,a){var u=a.ref;(o===null&&u!==null||o!==null&&o.ref!==u)&&(a.flags|=512,a.flags|=2097152)}function tf(o,a,u,d,g){var m=en(u)?ii:Dt.current;return m=Yi(a,m),Gi(a,g),u=Hu(o,a,u,d,m,g),d=Xu(),o!==null&&!tn?(a.updateQueue=o.updateQueue,a.flags&=-2053,o.lanes&=~g,ur(o,a,g)):(it&&d&&Cu(a),a.flags|=1,Xt(o,a,u,g),a.child)}function g_(o,a,u,d,g){if(en(u)){var m=!0;Sa(a)}else m=!1;if(Gi(a,g),a.stateNode===null)$a(o,a),r_(a,u,d),Ju(a,u,d,g),d=!0;else if(o===null){var v=a.stateNode,I=a.memoizedProps;v.props=I;var O=v.context,q=u.contextType;typeof q=="object"&&q!==null?q=wn(q):(q=en(u)?ii:Dt.current,q=Yi(a,q));var te=u.getDerivedStateFromProps,se=typeof te=="function"||typeof v.getSnapshotBeforeUpdate=="function";se||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(I!==d||O!==q)&&i_(a,v,d,q),Mr=!1;var ee=a.memoizedState;v.state=ee,Oa(a,d,v,g),O=a.memoizedState,I!==d||ee!==O||Gt.current||Mr?(typeof te=="function"&&(Qu(a,u,te,d),O=a.memoizedState),(I=Mr||n_(a,u,I,d,ee,O,q))?(se||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount()),typeof v.componentDidMount=="function"&&(a.flags|=4194308)):(typeof v.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=d,a.memoizedState=O),v.props=d,v.state=O,v.context=q,d=I):(typeof v.componentDidMount=="function"&&(a.flags|=4194308),d=!1)}else{v=a.stateNode,kg(o,a),I=a.memoizedProps,q=a.type===a.elementType?I:Nn(a.type,I),v.props=q,se=a.pendingProps,ee=v.context,O=u.contextType,typeof O=="object"&&O!==null?O=wn(O):(O=en(u)?ii:Dt.current,O=Yi(a,O));var pe=u.getDerivedStateFromProps;(te=typeof pe=="function"||typeof v.getSnapshotBeforeUpdate=="function")||typeof v.UNSAFE_componentWillReceiveProps!="function"&&typeof v.componentWillReceiveProps!="function"||(I!==se||ee!==O)&&i_(a,v,d,O),Mr=!1,ee=a.memoizedState,v.state=ee,Oa(a,d,v,g);var me=a.memoizedState;I!==se||ee!==me||Gt.current||Mr?(typeof pe=="function"&&(Qu(a,u,pe,d),me=a.memoizedState),(q=Mr||n_(a,u,q,d,ee,me,O)||!1)?(te||typeof v.UNSAFE_componentWillUpdate!="function"&&typeof v.componentWillUpdate!="function"||(typeof v.componentWillUpdate=="function"&&v.componentWillUpdate(d,me,O),typeof v.UNSAFE_componentWillUpdate=="function"&&v.UNSAFE_componentWillUpdate(d,me,O)),typeof v.componentDidUpdate=="function"&&(a.flags|=4),typeof v.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof v.componentDidUpdate!="function"||I===o.memoizedProps&&ee===o.memoizedState||(a.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||I===o.memoizedProps&&ee===o.memoizedState||(a.flags|=1024),a.memoizedProps=d,a.memoizedState=me),v.props=d,v.state=me,v.context=O,d=q):(typeof v.componentDidUpdate!="function"||I===o.memoizedProps&&ee===o.memoizedState||(a.flags|=4),typeof v.getSnapshotBeforeUpdate!="function"||I===o.memoizedProps&&ee===o.memoizedState||(a.flags|=1024),d=!1)}return nf(o,a,u,d,m,g)}function nf(o,a,u,d,g,m){p_(o,a);var v=(a.flags&128)!==0;if(!d&&!v)return g&&bg(a,u,!1),ur(o,a,m);d=a.stateNode,nw.current=a;var I=v&&typeof u.getDerivedStateFromError!="function"?null:d.render();return a.flags|=1,o!==null&&v?(a.child=Qi(a,o.child,null,m),a.child=Qi(a,null,I,m)):Xt(o,a,I,m),a.memoizedState=d.state,g&&bg(a,u,!0),a.child}function __(o){var a=o.stateNode;a.pendingContext?yg(o,a.pendingContext,a.pendingContext!==a.context):a.context&&yg(o,a.context,!1),Uu(o,a.containerInfo)}function m_(o,a,u,d,g){return Zi(),Mu(g),a.flags|=256,Xt(o,a,u,d),a.child}var rf={dehydrated:null,treeContext:null,retryLane:0};function sf(o){return{baseLanes:o,cachePool:null,transitions:null}}function y_(o,a,u){var d=a.pendingProps,g=at.current,m=!1,v=(a.flags&128)!==0,I;if((I=v)||(I=o!==null&&o.memoizedState===null?!1:(g&2)!==0),I?(m=!0,a.flags&=-129):(o===null||o.memoizedState!==null)&&(g|=1),Ge(at,g&1),o===null)return ku(a),o=a.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((a.mode&1)===0?a.lanes=1:o.data==="$!"?a.lanes=8:a.lanes=1073741824,null):(v=d.children,o=d.fallback,m?(d=a.mode,m=a.child,v={mode:"hidden",children:v},(d&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=v):m=el(v,d,0,null),o=pi(o,d,u,null),m.return=a,o.return=a,m.sibling=o,a.child=m,a.child.memoizedState=sf(u),a.memoizedState=rf,o):of(a,v));if(g=o.memoizedState,g!==null&&(I=g.dehydrated,I!==null))return rw(o,a,v,d,I,g,u);if(m){m=d.fallback,v=a.mode,g=o.child,I=g.sibling;var O={mode:"hidden",children:d.children};return(v&1)===0&&a.child!==g?(d=a.child,d.childLanes=0,d.pendingProps=O,a.deletions=null):(d=Ur(g,O),d.subtreeFlags=g.subtreeFlags&14680064),I!==null?m=Ur(I,m):(m=pi(m,v,u,null),m.flags|=2),m.return=a,d.return=a,d.sibling=m,a.child=d,d=m,m=a.child,v=o.child.memoizedState,v=v===null?sf(u):{baseLanes:v.baseLanes|u,cachePool:null,transitions:v.transitions},m.memoizedState=v,m.childLanes=o.childLanes&~u,a.memoizedState=rf,d}return m=o.child,o=m.sibling,d=Ur(m,{mode:"visible",children:d.children}),(a.mode&1)===0&&(d.lanes=u),d.return=a,d.sibling=null,o!==null&&(u=a.deletions,u===null?(a.deletions=[o],a.flags|=16):u.push(o)),a.child=d,a.memoizedState=null,d}function of(o,a){return a=el({mode:"visible",children:a},o.mode,0,null),a.return=o,o.child=a}function za(o,a,u,d){return d!==null&&Mu(d),Qi(a,o.child,null,u),o=of(a,a.pendingProps.children),o.flags|=2,a.memoizedState=null,o}function rw(o,a,u,d,g,m,v){if(u)return a.flags&256?(a.flags&=-257,d=Gu(Error(t(422))),za(o,a,v,d)):a.memoizedState!==null?(a.child=o.child,a.flags|=128,null):(m=d.fallback,g=a.mode,d=el({mode:"visible",children:d.children},g,0,null),m=pi(m,g,v,null),m.flags|=2,d.return=a,m.return=a,d.sibling=m,a.child=d,(a.mode&1)!==0&&Qi(a,o.child,null,v),a.child.memoizedState=sf(v),a.memoizedState=rf,m);if((a.mode&1)===0)return za(o,a,v,null);if(g.data==="$!"){if(d=g.nextSibling&&g.nextSibling.dataset,d)var I=d.dgst;return d=I,m=Error(t(419)),d=Gu(m,d,void 0),za(o,a,v,d)}if(I=(v&o.childLanes)!==0,tn||I){if(d=Ct,d!==null){switch(v&-v){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(d.suspendedLanes|v))!==0?0:g,g!==0&&g!==m.retryLane&&(m.retryLane=g,lr(o,g),Ln(d,o,g,-1))}return Tf(),d=Gu(Error(t(421))),za(o,a,v,d)}return g.data==="$?"?(a.flags|=128,a.child=o.child,a=_w.bind(null,o),g._reactRetry=a,null):(o=m.treeContext,fn=Cr(g.nextSibling),un=a,it=!0,On=null,o!==null&&(vn[bn++]=or,vn[bn++]=ar,vn[bn++]=si,or=o.id,ar=o.overflow,si=a),a=of(a,d.children),a.flags|=4096,a)}function v_(o,a,u){o.lanes|=a;var d=o.alternate;d!==null&&(d.lanes|=a),Fu(o.return,a,u)}function af(o,a,u,d,g){var m=o.memoizedState;m===null?o.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:d,tail:u,tailMode:g}:(m.isBackwards=a,m.rendering=null,m.renderingStartTime=0,m.last=d,m.tail=u,m.tailMode=g)}function b_(o,a,u){var d=a.pendingProps,g=d.revealOrder,m=d.tail;if(Xt(o,a,d.children,u),d=at.current,(d&2)!==0)d=d&1|2,a.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=a.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&v_(o,u,a);else if(o.tag===19)v_(o,u,a);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===a)break e;for(;o.sibling===null;){if(o.return===null||o.return===a)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}d&=1}if(Ge(at,d),(a.mode&1)===0)a.memoizedState=null;else switch(g){case"forwards":for(u=a.child,g=null;u!==null;)o=u.alternate,o!==null&&Na(o)===null&&(g=u),u=u.sibling;u=g,u===null?(g=a.child,a.child=null):(g=u.sibling,u.sibling=null),af(a,!1,g,u,m);break;case"backwards":for(u=null,g=a.child,a.child=null;g!==null;){if(o=g.alternate,o!==null&&Na(o)===null){a.child=g;break}o=g.sibling,g.sibling=u,u=g,g=o}af(a,!0,u,null,m);break;case"together":af(a,!1,null,null,void 0);break;default:a.memoizedState=null}return a.child}function $a(o,a){(a.mode&1)===0&&o!==null&&(o.alternate=null,a.alternate=null,a.flags|=2)}function ur(o,a,u){if(o!==null&&(a.dependencies=o.dependencies),ui|=a.lanes,(u&a.childLanes)===0)return null;if(o!==null&&a.child!==o.child)throw Error(t(153));if(a.child!==null){for(o=a.child,u=Ur(o,o.pendingProps),a.child=u,u.return=a;o.sibling!==null;)o=o.sibling,u=u.sibling=Ur(o,o.pendingProps),u.return=a;u.sibling=null}return a.child}function iw(o,a,u){switch(a.tag){case 3:__(a),Zi();break;case 5:Ng(a);break;case 1:en(a.type)&&Sa(a);break;case 4:Uu(a,a.stateNode.containerInfo);break;case 10:var d=a.type._context,g=a.memoizedProps.value;Ge(Pa,d._currentValue),d._currentValue=g;break;case 13:if(d=a.memoizedState,d!==null)return d.dehydrated!==null?(Ge(at,at.current&1),a.flags|=128,null):(u&a.child.childLanes)!==0?y_(o,a,u):(Ge(at,at.current&1),o=ur(o,a,u),o!==null?o.sibling:null);Ge(at,at.current&1);break;case 19:if(d=(u&a.childLanes)!==0,(o.flags&128)!==0){if(d)return b_(o,a,u);a.flags|=128}if(g=a.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),Ge(at,at.current),d)break;return null;case 22:case 23:return a.lanes=0,d_(o,a,u)}return ur(o,a,u)}var w_,lf,T_,x_;w_=function(o,a){for(var u=a.child;u!==null;){if(u.tag===5||u.tag===6)o.appendChild(u.stateNode);else if(u.tag!==4&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===a)break;for(;u.sibling===null;){if(u.return===null||u.return===a)return;u=u.return}u.sibling.return=u.return,u=u.sibling}},lf=function(){},T_=function(o,a,u,d){var g=o.memoizedProps;if(g!==d){o=a.stateNode,li(Yn.current);var m=null;switch(u){case"input":g=We(o,g),d=We(o,d),m=[];break;case"select":g=ce({},g,{value:void 0}),d=ce({},d,{value:void 0}),m=[];break;case"textarea":g=Qt(o,g),d=Qt(o,d),m=[];break;default:typeof g.onClick!="function"&&typeof d.onClick=="function"&&(o.onclick=wa)}zc(u,d);var v;u=null;for(q in g)if(!d.hasOwnProperty(q)&&g.hasOwnProperty(q)&&g[q]!=null)if(q==="style"){var I=g[q];for(v in I)I.hasOwnProperty(v)&&(u||(u={}),u[v]="")}else q!=="dangerouslySetInnerHTML"&&q!=="children"&&q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&q!=="autoFocus"&&(i.hasOwnProperty(q)?m||(m=[]):(m=m||[]).push(q,null));for(q in d){var O=d[q];if(I=g?.[q],d.hasOwnProperty(q)&&O!==I&&(O!=null||I!=null))if(q==="style")if(I){for(v in I)!I.hasOwnProperty(v)||O&&O.hasOwnProperty(v)||(u||(u={}),u[v]="");for(v in O)O.hasOwnProperty(v)&&I[v]!==O[v]&&(u||(u={}),u[v]=O[v])}else u||(m||(m=[]),m.push(q,u)),u=O;else q==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,I=I?I.__html:void 0,O!=null&&I!==O&&(m=m||[]).push(q,O)):q==="children"?typeof O!="string"&&typeof O!="number"||(m=m||[]).push(q,""+O):q!=="suppressContentEditableWarning"&&q!=="suppressHydrationWarning"&&(i.hasOwnProperty(q)?(O!=null&&q==="onScroll"&&tt("scroll",o),m||I===O||(m=[])):(m=m||[]).push(q,O))}u&&(m=m||[]).push("style",u);var q=m;(a.updateQueue=q)&&(a.flags|=4)}},x_=function(o,a,u,d){u!==d&&(a.flags|=4)};function _o(o,a){if(!it)switch(o.tailMode){case"hidden":a=o.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?o.tail=null:u.sibling=null;break;case"collapsed":u=o.tail;for(var d=null;u!==null;)u.alternate!==null&&(d=u),u=u.sibling;d===null?a||o.tail===null?o.tail=null:o.tail.sibling=null:d.sibling=null}}function Lt(o){var a=o.alternate!==null&&o.alternate.child===o.child,u=0,d=0;if(a)for(var g=o.child;g!==null;)u|=g.lanes|g.childLanes,d|=g.subtreeFlags&14680064,d|=g.flags&14680064,g.return=o,g=g.sibling;else for(g=o.child;g!==null;)u|=g.lanes|g.childLanes,d|=g.subtreeFlags,d|=g.flags,g.return=o,g=g.sibling;return o.subtreeFlags|=d,o.childLanes=u,a}function sw(o,a,u){var d=a.pendingProps;switch(Iu(a),a.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Lt(a),null;case 1:return en(a.type)&&xa(),Lt(a),null;case 3:return d=a.stateNode,es(),nt(Gt),nt(Dt),$u(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(o===null||o.child===null)&&(Ca(a)?a.flags|=4:o===null||o.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,On!==null&&(vf(On),On=null))),lf(o,a),Lt(a),null;case 5:Vu(a);var g=li(uo.current);if(u=a.type,o!==null&&a.stateNode!=null)T_(o,a,u,d,g),o.ref!==a.ref&&(a.flags|=512,a.flags|=2097152);else{if(!d){if(a.stateNode===null)throw Error(t(166));return Lt(a),null}if(o=li(Yn.current),Ca(a)){d=a.stateNode,u=a.type;var m=a.memoizedProps;switch(d[Xn]=a,d[so]=m,o=(a.mode&1)!==0,u){case"dialog":tt("cancel",d),tt("close",d);break;case"iframe":case"object":case"embed":tt("load",d);break;case"video":case"audio":for(g=0;g<no.length;g++)tt(no[g],d);break;case"source":tt("error",d);break;case"img":case"image":case"link":tt("error",d),tt("load",d);break;case"details":tt("toggle",d);break;case"input":Ye(d,m),tt("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!m.multiple},tt("invalid",d);break;case"textarea":vr(d,m),tt("invalid",d)}zc(u,m),g=null;for(var v in m)if(m.hasOwnProperty(v)){var I=m[v];v==="children"?typeof I=="string"?d.textContent!==I&&(m.suppressHydrationWarning!==!0&&ba(d.textContent,I,o),g=["children",I]):typeof I=="number"&&d.textContent!==""+I&&(m.suppressHydrationWarning!==!0&&ba(d.textContent,I,o),g=["children",""+I]):i.hasOwnProperty(v)&&I!=null&&v==="onScroll"&&tt("scroll",d)}switch(u){case"input":Re(d),Pe(d,m,!0);break;case"textarea":Re(d),ln(d);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(d.onclick=wa)}d=g,a.updateQueue=d,d!==null&&(a.flags|=4)}else{v=g.nodeType===9?g:g.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=dt(u)),o==="http://www.w3.org/1999/xhtml"?u==="script"?(o=v.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof d.is=="string"?o=v.createElement(u,{is:d.is}):(o=v.createElement(u),u==="select"&&(v=o,d.multiple?v.multiple=!0:d.size&&(v.size=d.size))):o=v.createElementNS(o,u),o[Xn]=a,o[so]=d,w_(o,a,!1,!1),a.stateNode=o;e:{switch(v=$c(u,d),u){case"dialog":tt("cancel",o),tt("close",o),g=d;break;case"iframe":case"object":case"embed":tt("load",o),g=d;break;case"video":case"audio":for(g=0;g<no.length;g++)tt(no[g],o);g=d;break;case"source":tt("error",o),g=d;break;case"img":case"image":case"link":tt("error",o),tt("load",o),g=d;break;case"details":tt("toggle",o),g=d;break;case"input":Ye(o,d),g=We(o,d),tt("invalid",o);break;case"option":g=d;break;case"select":o._wrapperState={wasMultiple:!!d.multiple},g=ce({},d,{value:void 0}),tt("invalid",o);break;case"textarea":vr(o,d),g=Qt(o,d),tt("invalid",o);break;default:g=d}zc(u,g),I=g;for(m in I)if(I.hasOwnProperty(m)){var O=I[m];m==="style"?Bs(o,O):m==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&Di(o,O)):m==="children"?typeof O=="string"?(u!=="textarea"||O!=="")&&br(o,O):typeof O=="number"&&br(o,""+O):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(i.hasOwnProperty(m)?O!=null&&m==="onScroll"&&tt("scroll",o):O!=null&&k(o,m,O,v))}switch(u){case"input":Re(o),Pe(o,d,!1);break;case"textarea":Re(o),ln(o);break;case"option":d.value!=null&&o.setAttribute("value",""+_e(d.value));break;case"select":o.multiple=!!d.multiple,m=d.value,m!=null?an(o,!!d.multiple,m,!1):d.defaultValue!=null&&an(o,!!d.multiple,d.defaultValue,!0);break;default:typeof g.onClick=="function"&&(o.onclick=wa)}switch(u){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(a.flags|=4)}a.ref!==null&&(a.flags|=512,a.flags|=2097152)}return Lt(a),null;case 6:if(o&&a.stateNode!=null)x_(o,a,o.memoizedProps,d);else{if(typeof d!="string"&&a.stateNode===null)throw Error(t(166));if(u=li(uo.current),li(Yn.current),Ca(a)){if(d=a.stateNode,u=a.memoizedProps,d[Xn]=a,(m=d.nodeValue!==u)&&(o=un,o!==null))switch(o.tag){case 3:ba(d.nodeValue,u,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&ba(d.nodeValue,u,(o.mode&1)!==0)}m&&(a.flags|=4)}else d=(u.nodeType===9?u:u.ownerDocument).createTextNode(d),d[Xn]=a,a.stateNode=d}return Lt(a),null;case 13:if(nt(at),d=a.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(it&&fn!==null&&(a.mode&1)!==0&&(a.flags&128)===0)Ag(),Zi(),a.flags|=98560,m=!1;else if(m=Ca(a),d!==null&&d.dehydrated!==null){if(o===null){if(!m)throw Error(t(318));if(m=a.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(t(317));m[Xn]=a}else Zi(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;Lt(a),m=!1}else On!==null&&(vf(On),On=null),m=!0;if(!m)return a.flags&65536?a:null}return(a.flags&128)!==0?(a.lanes=u,a):(d=d!==null,d!==(o!==null&&o.memoizedState!==null)&&d&&(a.child.flags|=8192,(a.mode&1)!==0&&(o===null||(at.current&1)!==0?xt===0&&(xt=3):Tf())),a.updateQueue!==null&&(a.flags|=4),Lt(a),null);case 4:return es(),lf(o,a),o===null&&ro(a.stateNode.containerInfo),Lt(a),null;case 10:return Du(a.type._context),Lt(a),null;case 17:return en(a.type)&&xa(),Lt(a),null;case 19:if(nt(at),m=a.memoizedState,m===null)return Lt(a),null;if(d=(a.flags&128)!==0,v=m.rendering,v===null)if(d)_o(m,!1);else{if(xt!==0||o!==null&&(o.flags&128)!==0)for(o=a.child;o!==null;){if(v=Na(o),v!==null){for(a.flags|=128,_o(m,!1),d=v.updateQueue,d!==null&&(a.updateQueue=d,a.flags|=4),a.subtreeFlags=0,d=u,u=a.child;u!==null;)m=u,o=d,m.flags&=14680066,v=m.alternate,v===null?(m.childLanes=0,m.lanes=o,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=v.childLanes,m.lanes=v.lanes,m.child=v.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=v.memoizedProps,m.memoizedState=v.memoizedState,m.updateQueue=v.updateQueue,m.type=v.type,o=v.dependencies,m.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),u=u.sibling;return Ge(at,at.current&1|2),a.child}o=o.sibling}m.tail!==null&&pt()>is&&(a.flags|=128,d=!0,_o(m,!1),a.lanes=4194304)}else{if(!d)if(o=Na(v),o!==null){if(a.flags|=128,d=!0,u=o.updateQueue,u!==null&&(a.updateQueue=u,a.flags|=4),_o(m,!0),m.tail===null&&m.tailMode==="hidden"&&!v.alternate&&!it)return Lt(a),null}else 2*pt()-m.renderingStartTime>is&&u!==1073741824&&(a.flags|=128,d=!0,_o(m,!1),a.lanes=4194304);m.isBackwards?(v.sibling=a.child,a.child=v):(u=m.last,u!==null?u.sibling=v:a.child=v,m.last=v)}return m.tail!==null?(a=m.tail,m.rendering=a,m.tail=a.sibling,m.renderingStartTime=pt(),a.sibling=null,u=at.current,Ge(at,d?u&1|2:u&1),a):(Lt(a),null);case 22:case 23:return wf(),d=a.memoizedState!==null,o!==null&&o.memoizedState!==null!==d&&(a.flags|=8192),d&&(a.mode&1)!==0?(hn&1073741824)!==0&&(Lt(a),a.subtreeFlags&6&&(a.flags|=8192)):Lt(a),null;case 24:return null;case 25:return null}throw Error(t(156,a.tag))}function ow(o,a){switch(Iu(a),a.tag){case 1:return en(a.type)&&xa(),o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 3:return es(),nt(Gt),nt(Dt),$u(),o=a.flags,(o&65536)!==0&&(o&128)===0?(a.flags=o&-65537|128,a):null;case 5:return Vu(a),null;case 13:if(nt(at),o=a.memoizedState,o!==null&&o.dehydrated!==null){if(a.alternate===null)throw Error(t(340));Zi()}return o=a.flags,o&65536?(a.flags=o&-65537|128,a):null;case 19:return nt(at),null;case 4:return es(),null;case 10:return Du(a.type._context),null;case 22:case 23:return wf(),null;case 24:return null;default:return null}}var ja=!1,Bt=!1,aw=typeof WeakSet=="function"?WeakSet:Set,ge=null;function ns(o,a){var u=o.ref;if(u!==null)if(typeof u=="function")try{u(null)}catch(d){ut(o,a,d)}else u.current=null}function cf(o,a,u){try{u()}catch(d){ut(o,a,d)}}var S_=!1;function lw(o,a){if(bu=ca,o=ng(),hu(o)){if("selectionStart"in o)var u={start:o.selectionStart,end:o.selectionEnd};else e:{u=(u=o.ownerDocument)&&u.defaultView||window;var d=u.getSelection&&u.getSelection();if(d&&d.rangeCount!==0){u=d.anchorNode;var g=d.anchorOffset,m=d.focusNode;d=d.focusOffset;try{u.nodeType,m.nodeType}catch{u=null;break e}var v=0,I=-1,O=-1,q=0,te=0,se=o,ee=null;t:for(;;){for(var pe;se!==u||g!==0&&se.nodeType!==3||(I=v+g),se!==m||d!==0&&se.nodeType!==3||(O=v+d),se.nodeType===3&&(v+=se.nodeValue.length),(pe=se.firstChild)!==null;)ee=se,se=pe;for(;;){if(se===o)break t;if(ee===u&&++q===g&&(I=v),ee===m&&++te===d&&(O=v),(pe=se.nextSibling)!==null)break;se=ee,ee=se.parentNode}se=pe}u=I===-1||O===-1?null:{start:I,end:O}}else u=null}u=u||{start:0,end:0}}else u=null;for(wu={focusedElem:o,selectionRange:u},ca=!1,ge=a;ge!==null;)if(a=ge,o=a.child,(a.subtreeFlags&1028)!==0&&o!==null)o.return=a,ge=o;else for(;ge!==null;){a=ge;try{var me=a.alternate;if((a.flags&1024)!==0)switch(a.tag){case 0:case 11:case 15:break;case 1:if(me!==null){var ye=me.memoizedProps,gt=me.memoizedState,H=a.stateNode,D=H.getSnapshotBeforeUpdate(a.elementType===a.type?ye:Nn(a.type,ye),gt);H.__reactInternalSnapshotBeforeUpdate=D}break;case 3:var X=a.stateNode.containerInfo;X.nodeType===1?X.textContent="":X.nodeType===9&&X.documentElement&&X.removeChild(X.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(le){ut(a,a.return,le)}if(o=a.sibling,o!==null){o.return=a.return,ge=o;break}ge=a.return}return me=S_,S_=!1,me}function mo(o,a,u){var d=a.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var g=d=d.next;do{if((g.tag&o)===o){var m=g.destroy;g.destroy=void 0,m!==void 0&&cf(a,u,m)}g=g.next}while(g!==d)}}function Wa(o,a){if(a=a.updateQueue,a=a!==null?a.lastEffect:null,a!==null){var u=a=a.next;do{if((u.tag&o)===o){var d=u.create;u.destroy=d()}u=u.next}while(u!==a)}}function uf(o){var a=o.ref;if(a!==null){var u=o.stateNode;switch(o.tag){case 5:o=u;break;default:o=u}typeof a=="function"?a(o):a.current=o}}function E_(o){var a=o.alternate;a!==null&&(o.alternate=null,E_(a)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(a=o.stateNode,a!==null&&(delete a[Xn],delete a[so],delete a[Eu],delete a[W1],delete a[H1])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function A_(o){return o.tag===5||o.tag===3||o.tag===4}function R_(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||A_(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function ff(o,a,u){var d=o.tag;if(d===5||d===6)o=o.stateNode,a?u.nodeType===8?u.parentNode.insertBefore(o,a):u.insertBefore(o,a):(u.nodeType===8?(a=u.parentNode,a.insertBefore(o,u)):(a=u,a.appendChild(o)),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=wa));else if(d!==4&&(o=o.child,o!==null))for(ff(o,a,u),o=o.sibling;o!==null;)ff(o,a,u),o=o.sibling}function hf(o,a,u){var d=o.tag;if(d===5||d===6)o=o.stateNode,a?u.insertBefore(o,a):u.appendChild(o);else if(d!==4&&(o=o.child,o!==null))for(hf(o,a,u),o=o.sibling;o!==null;)hf(o,a,u),o=o.sibling}var kt=null,Dn=!1;function Nr(o,a,u){for(u=u.child;u!==null;)C_(o,a,u),u=u.sibling}function C_(o,a,u){if(Hn&&typeof Hn.onCommitFiberUnmount=="function")try{Hn.onCommitFiberUnmount(ra,u)}catch{}switch(u.tag){case 5:Bt||ns(u,a);case 6:var d=kt,g=Dn;kt=null,Nr(o,a,u),kt=d,Dn=g,kt!==null&&(Dn?(o=kt,u=u.stateNode,o.nodeType===8?o.parentNode.removeChild(u):o.removeChild(u)):kt.removeChild(u.stateNode));break;case 18:kt!==null&&(Dn?(o=kt,u=u.stateNode,o.nodeType===8?Su(o.parentNode,u):o.nodeType===1&&Su(o,u),Ks(o)):Su(kt,u.stateNode));break;case 4:d=kt,g=Dn,kt=u.stateNode.containerInfo,Dn=!0,Nr(o,a,u),kt=d,Dn=g;break;case 0:case 11:case 14:case 15:if(!Bt&&(d=u.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){g=d=d.next;do{var m=g,v=m.destroy;m=m.tag,v!==void 0&&((m&2)!==0||(m&4)!==0)&&cf(u,a,v),g=g.next}while(g!==d)}Nr(o,a,u);break;case 1:if(!Bt&&(ns(u,a),d=u.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=u.memoizedProps,d.state=u.memoizedState,d.componentWillUnmount()}catch(I){ut(u,a,I)}Nr(o,a,u);break;case 21:Nr(o,a,u);break;case 22:u.mode&1?(Bt=(d=Bt)||u.memoizedState!==null,Nr(o,a,u),Bt=d):Nr(o,a,u);break;default:Nr(o,a,u)}}function I_(o){var a=o.updateQueue;if(a!==null){o.updateQueue=null;var u=o.stateNode;u===null&&(u=o.stateNode=new aw),a.forEach(function(d){var g=mw.bind(null,o,d);u.has(d)||(u.add(d),d.then(g,g))})}}function Fn(o,a){var u=a.deletions;if(u!==null)for(var d=0;d<u.length;d++){var g=u[d];try{var m=o,v=a,I=v;e:for(;I!==null;){switch(I.tag){case 5:kt=I.stateNode,Dn=!1;break e;case 3:kt=I.stateNode.containerInfo,Dn=!0;break e;case 4:kt=I.stateNode.containerInfo,Dn=!0;break e}I=I.return}if(kt===null)throw Error(t(160));C_(m,v,g),kt=null,Dn=!1;var O=g.alternate;O!==null&&(O.return=null),g.return=null}catch(q){ut(g,a,q)}}if(a.subtreeFlags&12854)for(a=a.child;a!==null;)P_(a,o),a=a.sibling}function P_(o,a){var u=o.alternate,d=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(Fn(a,o),qn(o),d&4){try{mo(3,o,o.return),Wa(3,o)}catch(ye){ut(o,o.return,ye)}try{mo(5,o,o.return)}catch(ye){ut(o,o.return,ye)}}break;case 1:Fn(a,o),qn(o),d&512&&u!==null&&ns(u,u.return);break;case 5:if(Fn(a,o),qn(o),d&512&&u!==null&&ns(u,u.return),o.flags&32){var g=o.stateNode;try{br(g,"")}catch(ye){ut(o,o.return,ye)}}if(d&4&&(g=o.stateNode,g!=null)){var m=o.memoizedProps,v=u!==null?u.memoizedProps:m,I=o.type,O=o.updateQueue;if(o.updateQueue=null,O!==null)try{I==="input"&&m.type==="radio"&&m.name!=null&&Fe(g,m),$c(I,v);var q=$c(I,m);for(v=0;v<O.length;v+=2){var te=O[v],se=O[v+1];te==="style"?Bs(g,se):te==="dangerouslySetInnerHTML"?Di(g,se):te==="children"?br(g,se):k(g,te,se,q)}switch(I){case"input":Ht(g,m);break;case"textarea":wt(g,m);break;case"select":var ee=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!m.multiple;var pe=m.value;pe!=null?an(g,!!m.multiple,pe,!1):ee!==!!m.multiple&&(m.defaultValue!=null?an(g,!!m.multiple,m.defaultValue,!0):an(g,!!m.multiple,m.multiple?[]:"",!1))}g[so]=m}catch(ye){ut(o,o.return,ye)}}break;case 6:if(Fn(a,o),qn(o),d&4){if(o.stateNode===null)throw Error(t(162));g=o.stateNode,m=o.memoizedProps;try{g.nodeValue=m}catch(ye){ut(o,o.return,ye)}}break;case 3:if(Fn(a,o),qn(o),d&4&&u!==null&&u.memoizedState.isDehydrated)try{Ks(a.containerInfo)}catch(ye){ut(o,o.return,ye)}break;case 4:Fn(a,o),qn(o);break;case 13:Fn(a,o),qn(o),g=o.child,g.flags&8192&&(m=g.memoizedState!==null,g.stateNode.isHidden=m,!m||g.alternate!==null&&g.alternate.memoizedState!==null||(gf=pt())),d&4&&I_(o);break;case 22:if(te=u!==null&&u.memoizedState!==null,o.mode&1?(Bt=(q=Bt)||te,Fn(a,o),Bt=q):Fn(a,o),qn(o),d&8192){if(q=o.memoizedState!==null,(o.stateNode.isHidden=q)&&!te&&(o.mode&1)!==0)for(ge=o,te=o.child;te!==null;){for(se=ge=te;ge!==null;){switch(ee=ge,pe=ee.child,ee.tag){case 0:case 11:case 14:case 15:mo(4,ee,ee.return);break;case 1:ns(ee,ee.return);var me=ee.stateNode;if(typeof me.componentWillUnmount=="function"){d=ee,u=ee.return;try{a=d,me.props=a.memoizedProps,me.state=a.memoizedState,me.componentWillUnmount()}catch(ye){ut(d,u,ye)}}break;case 5:ns(ee,ee.return);break;case 22:if(ee.memoizedState!==null){O_(se);continue}}pe!==null?(pe.return=ee,ge=pe):O_(se)}te=te.sibling}e:for(te=null,se=o;;){if(se.tag===5){if(te===null){te=se;try{g=se.stateNode,q?(m=g.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(I=se.stateNode,O=se.memoizedProps.style,v=O!=null&&O.hasOwnProperty("display")?O.display:null,I.style.display=wr("display",v))}catch(ye){ut(o,o.return,ye)}}}else if(se.tag===6){if(te===null)try{se.stateNode.nodeValue=q?"":se.memoizedProps}catch(ye){ut(o,o.return,ye)}}else if((se.tag!==22&&se.tag!==23||se.memoizedState===null||se===o)&&se.child!==null){se.child.return=se,se=se.child;continue}if(se===o)break e;for(;se.sibling===null;){if(se.return===null||se.return===o)break e;te===se&&(te=null),se=se.return}te===se&&(te=null),se.sibling.return=se.return,se=se.sibling}}break;case 19:Fn(a,o),qn(o),d&4&&I_(o);break;case 21:break;default:Fn(a,o),qn(o)}}function qn(o){var a=o.flags;if(a&2){try{e:{for(var u=o.return;u!==null;){if(A_(u)){var d=u;break e}u=u.return}throw Error(t(160))}switch(d.tag){case 5:var g=d.stateNode;d.flags&32&&(br(g,""),d.flags&=-33);var m=R_(o);hf(o,m,g);break;case 3:case 4:var v=d.stateNode.containerInfo,I=R_(o);ff(o,I,v);break;default:throw Error(t(161))}}catch(O){ut(o,o.return,O)}o.flags&=-3}a&4096&&(o.flags&=-4097)}function cw(o,a,u){ge=o,k_(o)}function k_(o,a,u){for(var d=(o.mode&1)!==0;ge!==null;){var g=ge,m=g.child;if(g.tag===22&&d){var v=g.memoizedState!==null||ja;if(!v){var I=g.alternate,O=I!==null&&I.memoizedState!==null||Bt;I=ja;var q=Bt;if(ja=v,(Bt=O)&&!q)for(ge=g;ge!==null;)v=ge,O=v.child,v.tag===22&&v.memoizedState!==null?N_(g):O!==null?(O.return=v,ge=O):N_(g);for(;m!==null;)ge=m,k_(m),m=m.sibling;ge=g,ja=I,Bt=q}M_(o)}else(g.subtreeFlags&8772)!==0&&m!==null?(m.return=g,ge=m):M_(o)}}function M_(o){for(;ge!==null;){var a=ge;if((a.flags&8772)!==0){var u=a.alternate;try{if((a.flags&8772)!==0)switch(a.tag){case 0:case 11:case 15:Bt||Wa(5,a);break;case 1:var d=a.stateNode;if(a.flags&4&&!Bt)if(u===null)d.componentDidMount();else{var g=a.elementType===a.type?u.memoizedProps:Nn(a.type,u.memoizedProps);d.componentDidUpdate(g,u.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var m=a.updateQueue;m!==null&&Og(a,m,d);break;case 3:var v=a.updateQueue;if(v!==null){if(u=null,a.child!==null)switch(a.child.tag){case 5:u=a.child.stateNode;break;case 1:u=a.child.stateNode}Og(a,v,u)}break;case 5:var I=a.stateNode;if(u===null&&a.flags&4){u=I;var O=a.memoizedProps;switch(a.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&u.focus();break;case"img":O.src&&(u.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(a.memoizedState===null){var q=a.alternate;if(q!==null){var te=q.memoizedState;if(te!==null){var se=te.dehydrated;se!==null&&Ks(se)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Bt||a.flags&512&&uf(a)}catch(ee){ut(a,a.return,ee)}}if(a===o){ge=null;break}if(u=a.sibling,u!==null){u.return=a.return,ge=u;break}ge=a.return}}function O_(o){for(;ge!==null;){var a=ge;if(a===o){ge=null;break}var u=a.sibling;if(u!==null){u.return=a.return,ge=u;break}ge=a.return}}function N_(o){for(;ge!==null;){var a=ge;try{switch(a.tag){case 0:case 11:case 15:var u=a.return;try{Wa(4,a)}catch(O){ut(a,u,O)}break;case 1:var d=a.stateNode;if(typeof d.componentDidMount=="function"){var g=a.return;try{d.componentDidMount()}catch(O){ut(a,g,O)}}var m=a.return;try{uf(a)}catch(O){ut(a,m,O)}break;case 5:var v=a.return;try{uf(a)}catch(O){ut(a,v,O)}}}catch(O){ut(a,a.return,O)}if(a===o){ge=null;break}var I=a.sibling;if(I!==null){I.return=a.return,ge=I;break}ge=a.return}}var uw=Math.ceil,Ha=V.ReactCurrentDispatcher,df=V.ReactCurrentOwner,xn=V.ReactCurrentBatchConfig,$e=0,Ct=null,_t=null,Mt=0,hn=0,rs=Ir(0),xt=0,yo=null,ui=0,Xa=0,pf=0,vo=null,nn=null,gf=0,is=1/0,fr=null,Ya=!1,_f=null,Dr=null,Ka=!1,Fr=null,qa=0,bo=0,mf=null,Za=-1,Qa=0;function Yt(){return($e&6)!==0?pt():Za!==-1?Za:Za=pt()}function Lr(o){return(o.mode&1)===0?1:($e&2)!==0&&Mt!==0?Mt&-Mt:Y1.transition!==null?(Qa===0&&(Qa=Rp()),Qa):(o=Ke,o!==0||(o=window.event,o=o===void 0?16:Fp(o.type)),o)}function Ln(o,a,u,d){if(50<bo)throw bo=0,mf=null,Error(t(185));js(o,u,d),(($e&2)===0||o!==Ct)&&(o===Ct&&(($e&2)===0&&(Xa|=u),xt===4&&Br(o,Mt)),rn(o,d),u===1&&$e===0&&(a.mode&1)===0&&(is=pt()+500,Ea&&kr()))}function rn(o,a){var u=o.callbackNode;Y3(o,a);var d=oa(o,o===Ct?Mt:0);if(d===0)u!==null&&Sp(u),o.callbackNode=null,o.callbackPriority=0;else if(a=d&-d,o.callbackPriority!==a){if(u!=null&&Sp(u),a===1)o.tag===0?X1(F_.bind(null,o)):wg(F_.bind(null,o)),$1(function(){($e&6)===0&&kr()}),u=null;else{switch(Cp(d)){case 1:u=qc;break;case 4:u=Ep;break;case 16:u=na;break;case 536870912:u=Ap;break;default:u=na}u=W_(u,D_.bind(null,o))}o.callbackPriority=a,o.callbackNode=u}}function D_(o,a){if(Za=-1,Qa=0,($e&6)!==0)throw Error(t(327));var u=o.callbackNode;if(ss()&&o.callbackNode!==u)return null;var d=oa(o,o===Ct?Mt:0);if(d===0)return null;if((d&30)!==0||(d&o.expiredLanes)!==0||a)a=Ja(o,d);else{a=d;var g=$e;$e|=2;var m=B_();(Ct!==o||Mt!==a)&&(fr=null,is=pt()+500,hi(o,a));do try{dw();break}catch(I){L_(o,I)}while(!0);Nu(),Ha.current=m,$e=g,_t!==null?a=0:(Ct=null,Mt=0,a=xt)}if(a!==0){if(a===2&&(g=Zc(o),g!==0&&(d=g,a=yf(o,g))),a===1)throw u=yo,hi(o,0),Br(o,d),rn(o,pt()),u;if(a===6)Br(o,d);else{if(g=o.current.alternate,(d&30)===0&&!fw(g)&&(a=Ja(o,d),a===2&&(m=Zc(o),m!==0&&(d=m,a=yf(o,m))),a===1))throw u=yo,hi(o,0),Br(o,d),rn(o,pt()),u;switch(o.finishedWork=g,o.finishedLanes=d,a){case 0:case 1:throw Error(t(345));case 2:di(o,nn,fr);break;case 3:if(Br(o,d),(d&130023424)===d&&(a=gf+500-pt(),10<a)){if(oa(o,0)!==0)break;if(g=o.suspendedLanes,(g&d)!==d){Yt(),o.pingedLanes|=o.suspendedLanes&g;break}o.timeoutHandle=xu(di.bind(null,o,nn,fr),a);break}di(o,nn,fr);break;case 4:if(Br(o,d),(d&4194240)===d)break;for(a=o.eventTimes,g=-1;0<d;){var v=31-kn(d);m=1<<v,v=a[v],v>g&&(g=v),d&=~m}if(d=g,d=pt()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*uw(d/1960))-d,10<d){o.timeoutHandle=xu(di.bind(null,o,nn,fr),d);break}di(o,nn,fr);break;case 5:di(o,nn,fr);break;default:throw Error(t(329))}}}return rn(o,pt()),o.callbackNode===u?D_.bind(null,o):null}function yf(o,a){var u=vo;return o.current.memoizedState.isDehydrated&&(hi(o,a).flags|=256),o=Ja(o,a),o!==2&&(a=nn,nn=u,a!==null&&vf(a)),o}function vf(o){nn===null?nn=o:nn.push.apply(nn,o)}function fw(o){for(var a=o;;){if(a.flags&16384){var u=a.updateQueue;if(u!==null&&(u=u.stores,u!==null))for(var d=0;d<u.length;d++){var g=u[d],m=g.getSnapshot;g=g.value;try{if(!Mn(m(),g))return!1}catch{return!1}}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===o)break;for(;a.sibling===null;){if(a.return===null||a.return===o)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Br(o,a){for(a&=~pf,a&=~Xa,o.suspendedLanes|=a,o.pingedLanes&=~a,o=o.expirationTimes;0<a;){var u=31-kn(a),d=1<<u;o[u]=-1,a&=~d}}function F_(o){if(($e&6)!==0)throw Error(t(327));ss();var a=oa(o,0);if((a&1)===0)return rn(o,pt()),null;var u=Ja(o,a);if(o.tag!==0&&u===2){var d=Zc(o);d!==0&&(a=d,u=yf(o,d))}if(u===1)throw u=yo,hi(o,0),Br(o,a),rn(o,pt()),u;if(u===6)throw Error(t(345));return o.finishedWork=o.current.alternate,o.finishedLanes=a,di(o,nn,fr),rn(o,pt()),null}function bf(o,a){var u=$e;$e|=1;try{return o(a)}finally{$e=u,$e===0&&(is=pt()+500,Ea&&kr())}}function fi(o){Fr!==null&&Fr.tag===0&&($e&6)===0&&ss();var a=$e;$e|=1;var u=xn.transition,d=Ke;try{if(xn.transition=null,Ke=1,o)return o()}finally{Ke=d,xn.transition=u,$e=a,($e&6)===0&&kr()}}function wf(){hn=rs.current,nt(rs)}function hi(o,a){o.finishedWork=null,o.finishedLanes=0;var u=o.timeoutHandle;if(u!==-1&&(o.timeoutHandle=-1,z1(u)),_t!==null)for(u=_t.return;u!==null;){var d=u;switch(Iu(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&xa();break;case 3:es(),nt(Gt),nt(Dt),$u();break;case 5:Vu(d);break;case 4:es();break;case 13:nt(at);break;case 19:nt(at);break;case 10:Du(d.type._context);break;case 22:case 23:wf()}u=u.return}if(Ct=o,_t=o=Ur(o.current,null),Mt=hn=a,xt=0,yo=null,pf=Xa=ui=0,nn=vo=null,ai!==null){for(a=0;a<ai.length;a++)if(u=ai[a],d=u.interleaved,d!==null){u.interleaved=null;var g=d.next,m=u.pending;if(m!==null){var v=m.next;m.next=g,d.next=v}u.pending=d}ai=null}return o}function L_(o,a){do{var u=_t;try{if(Nu(),Da.current=Ua,Fa){for(var d=lt.memoizedState;d!==null;){var g=d.queue;g!==null&&(g.pending=null),d=d.next}Fa=!1}if(ci=0,Rt=Tt=lt=null,fo=!1,ho=0,df.current=null,u===null||u.return===null){xt=1,yo=a,_t=null;break}e:{var m=o,v=u.return,I=u,O=a;if(a=Mt,I.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var q=O,te=I,se=te.tag;if((te.mode&1)===0&&(se===0||se===11||se===15)){var ee=te.alternate;ee?(te.updateQueue=ee.updateQueue,te.memoizedState=ee.memoizedState,te.lanes=ee.lanes):(te.updateQueue=null,te.memoizedState=null)}var pe=l_(v);if(pe!==null){pe.flags&=-257,c_(pe,v,I,m,a),pe.mode&1&&a_(m,q,a),a=pe,O=q;var me=a.updateQueue;if(me===null){var ye=new Set;ye.add(O),a.updateQueue=ye}else me.add(O);break e}else{if((a&1)===0){a_(m,q,a),Tf();break e}O=Error(t(426))}}else if(it&&I.mode&1){var gt=l_(v);if(gt!==null){(gt.flags&65536)===0&&(gt.flags|=256),c_(gt,v,I,m,a),Mu(ts(O,I));break e}}m=O=ts(O,I),xt!==4&&(xt=2),vo===null?vo=[m]:vo.push(m),m=v;do{switch(m.tag){case 3:m.flags|=65536,a&=-a,m.lanes|=a;var H=s_(m,O,a);Mg(m,H);break e;case 1:I=O;var D=m.type,X=m.stateNode;if((m.flags&128)===0&&(typeof D.getDerivedStateFromError=="function"||X!==null&&typeof X.componentDidCatch=="function"&&(Dr===null||!Dr.has(X)))){m.flags|=65536,a&=-a,m.lanes|=a;var le=o_(m,I,a);Mg(m,le);break e}}m=m.return}while(m!==null)}V_(u)}catch(ve){a=ve,_t===u&&u!==null&&(_t=u=u.return);continue}break}while(!0)}function B_(){var o=Ha.current;return Ha.current=Ua,o===null?Ua:o}function Tf(){(xt===0||xt===3||xt===2)&&(xt=4),Ct===null||(ui&268435455)===0&&(Xa&268435455)===0||Br(Ct,Mt)}function Ja(o,a){var u=$e;$e|=2;var d=B_();(Ct!==o||Mt!==a)&&(fr=null,hi(o,a));do try{hw();break}catch(g){L_(o,g)}while(!0);if(Nu(),$e=u,Ha.current=d,_t!==null)throw Error(t(261));return Ct=null,Mt=0,xt}function hw(){for(;_t!==null;)U_(_t)}function dw(){for(;_t!==null&&!B3();)U_(_t)}function U_(o){var a=j_(o.alternate,o,hn);o.memoizedProps=o.pendingProps,a===null?V_(o):_t=a,df.current=null}function V_(o){var a=o;do{var u=a.alternate;if(o=a.return,(a.flags&32768)===0){if(u=sw(u,a,hn),u!==null){_t=u;return}}else{if(u=ow(u,a),u!==null){u.flags&=32767,_t=u;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{xt=6,_t=null;return}}if(a=a.sibling,a!==null){_t=a;return}_t=a=o}while(a!==null);xt===0&&(xt=5)}function di(o,a,u){var d=Ke,g=xn.transition;try{xn.transition=null,Ke=1,pw(o,a,u,d)}finally{xn.transition=g,Ke=d}return null}function pw(o,a,u,d){do ss();while(Fr!==null);if(($e&6)!==0)throw Error(t(327));u=o.finishedWork;var g=o.finishedLanes;if(u===null)return null;if(o.finishedWork=null,o.finishedLanes=0,u===o.current)throw Error(t(177));o.callbackNode=null,o.callbackPriority=0;var m=u.lanes|u.childLanes;if(K3(o,m),o===Ct&&(_t=Ct=null,Mt=0),(u.subtreeFlags&2064)===0&&(u.flags&2064)===0||Ka||(Ka=!0,W_(na,function(){return ss(),null})),m=(u.flags&15990)!==0,(u.subtreeFlags&15990)!==0||m){m=xn.transition,xn.transition=null;var v=Ke;Ke=1;var I=$e;$e|=4,df.current=null,lw(o,u),P_(u,o),N1(wu),ca=!!bu,wu=bu=null,o.current=u,cw(u),U3(),$e=I,Ke=v,xn.transition=m}else o.current=u;if(Ka&&(Ka=!1,Fr=o,qa=g),m=o.pendingLanes,m===0&&(Dr=null),$3(u.stateNode),rn(o,pt()),a!==null)for(d=o.onRecoverableError,u=0;u<a.length;u++)g=a[u],d(g.value,{componentStack:g.stack,digest:g.digest});if(Ya)throw Ya=!1,o=_f,_f=null,o;return(qa&1)!==0&&o.tag!==0&&ss(),m=o.pendingLanes,(m&1)!==0?o===mf?bo++:(bo=0,mf=o):bo=0,kr(),null}function ss(){if(Fr!==null){var o=Cp(qa),a=xn.transition,u=Ke;try{if(xn.transition=null,Ke=16>o?16:o,Fr===null)var d=!1;else{if(o=Fr,Fr=null,qa=0,($e&6)!==0)throw Error(t(331));var g=$e;for($e|=4,ge=o.current;ge!==null;){var m=ge,v=m.child;if((ge.flags&16)!==0){var I=m.deletions;if(I!==null){for(var O=0;O<I.length;O++){var q=I[O];for(ge=q;ge!==null;){var te=ge;switch(te.tag){case 0:case 11:case 15:mo(8,te,m)}var se=te.child;if(se!==null)se.return=te,ge=se;else for(;ge!==null;){te=ge;var ee=te.sibling,pe=te.return;if(E_(te),te===q){ge=null;break}if(ee!==null){ee.return=pe,ge=ee;break}ge=pe}}}var me=m.alternate;if(me!==null){var ye=me.child;if(ye!==null){me.child=null;do{var gt=ye.sibling;ye.sibling=null,ye=gt}while(ye!==null)}}ge=m}}if((m.subtreeFlags&2064)!==0&&v!==null)v.return=m,ge=v;else e:for(;ge!==null;){if(m=ge,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:mo(9,m,m.return)}var H=m.sibling;if(H!==null){H.return=m.return,ge=H;break e}ge=m.return}}var D=o.current;for(ge=D;ge!==null;){v=ge;var X=v.child;if((v.subtreeFlags&2064)!==0&&X!==null)X.return=v,ge=X;else e:for(v=D;ge!==null;){if(I=ge,(I.flags&2048)!==0)try{switch(I.tag){case 0:case 11:case 15:Wa(9,I)}}catch(ve){ut(I,I.return,ve)}if(I===v){ge=null;break e}var le=I.sibling;if(le!==null){le.return=I.return,ge=le;break e}ge=I.return}}if($e=g,kr(),Hn&&typeof Hn.onPostCommitFiberRoot=="function")try{Hn.onPostCommitFiberRoot(ra,o)}catch{}d=!0}return d}finally{Ke=u,xn.transition=a}}return!1}function z_(o,a,u){a=ts(u,a),a=s_(o,a,1),o=Or(o,a,1),a=Yt(),o!==null&&(js(o,1,a),rn(o,a))}function ut(o,a,u){if(o.tag===3)z_(o,o,u);else for(;a!==null;){if(a.tag===3){z_(a,o,u);break}else if(a.tag===1){var d=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Dr===null||!Dr.has(d))){o=ts(u,o),o=o_(a,o,1),a=Or(a,o,1),o=Yt(),a!==null&&(js(a,1,o),rn(a,o));break}}a=a.return}}function gw(o,a,u){var d=o.pingCache;d!==null&&d.delete(a),a=Yt(),o.pingedLanes|=o.suspendedLanes&u,Ct===o&&(Mt&u)===u&&(xt===4||xt===3&&(Mt&130023424)===Mt&&500>pt()-gf?hi(o,0):pf|=u),rn(o,a)}function $_(o,a){a===0&&((o.mode&1)===0?a=1:(a=sa,sa<<=1,(sa&130023424)===0&&(sa=4194304)));var u=Yt();o=lr(o,a),o!==null&&(js(o,a,u),rn(o,u))}function _w(o){var a=o.memoizedState,u=0;a!==null&&(u=a.retryLane),$_(o,u)}function mw(o,a){var u=0;switch(o.tag){case 13:var d=o.stateNode,g=o.memoizedState;g!==null&&(u=g.retryLane);break;case 19:d=o.stateNode;break;default:throw Error(t(314))}d!==null&&d.delete(a),$_(o,u)}var j_;j_=function(o,a,u){if(o!==null)if(o.memoizedProps!==a.pendingProps||Gt.current)tn=!0;else{if((o.lanes&u)===0&&(a.flags&128)===0)return tn=!1,iw(o,a,u);tn=(o.flags&131072)!==0}else tn=!1,it&&(a.flags&1048576)!==0&&Tg(a,Ra,a.index);switch(a.lanes=0,a.tag){case 2:var d=a.type;$a(o,a),o=a.pendingProps;var g=Yi(a,Dt.current);Gi(a,u),g=Hu(null,a,d,o,g,u);var m=Xu();return a.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(a.tag=1,a.memoizedState=null,a.updateQueue=null,en(d)?(m=!0,Sa(a)):m=!1,a.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,Bu(a),g.updater=Va,a.stateNode=g,g._reactInternals=a,Ju(a,d,o,u),a=nf(null,a,d,!0,m,u)):(a.tag=0,it&&m&&Cu(a),Xt(null,a,g,u),a=a.child),a;case 16:d=a.elementType;e:{switch($a(o,a),o=a.pendingProps,g=d._init,d=g(d._payload),a.type=d,g=a.tag=vw(d),o=Nn(d,o),g){case 0:a=tf(null,a,d,o,u);break e;case 1:a=g_(null,a,d,o,u);break e;case 11:a=u_(null,a,d,o,u);break e;case 14:a=f_(null,a,d,Nn(d.type,o),u);break e}throw Error(t(306,d,""))}return a;case 0:return d=a.type,g=a.pendingProps,g=a.elementType===d?g:Nn(d,g),tf(o,a,d,g,u);case 1:return d=a.type,g=a.pendingProps,g=a.elementType===d?g:Nn(d,g),g_(o,a,d,g,u);case 3:e:{if(__(a),o===null)throw Error(t(387));d=a.pendingProps,m=a.memoizedState,g=m.element,kg(o,a),Oa(a,d,null,u);var v=a.memoizedState;if(d=v.element,m.isDehydrated)if(m={element:d,isDehydrated:!1,cache:v.cache,pendingSuspenseBoundaries:v.pendingSuspenseBoundaries,transitions:v.transitions},a.updateQueue.baseState=m,a.memoizedState=m,a.flags&256){g=ts(Error(t(423)),a),a=m_(o,a,d,u,g);break e}else if(d!==g){g=ts(Error(t(424)),a),a=m_(o,a,d,u,g);break e}else for(fn=Cr(a.stateNode.containerInfo.firstChild),un=a,it=!0,On=null,u=Ig(a,null,d,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling;else{if(Zi(),d===g){a=ur(o,a,u);break e}Xt(o,a,d,u)}a=a.child}return a;case 5:return Ng(a),o===null&&ku(a),d=a.type,g=a.pendingProps,m=o!==null?o.memoizedProps:null,v=g.children,Tu(d,g)?v=null:m!==null&&Tu(d,m)&&(a.flags|=32),p_(o,a),Xt(o,a,v,u),a.child;case 6:return o===null&&ku(a),null;case 13:return y_(o,a,u);case 4:return Uu(a,a.stateNode.containerInfo),d=a.pendingProps,o===null?a.child=Qi(a,null,d,u):Xt(o,a,d,u),a.child;case 11:return d=a.type,g=a.pendingProps,g=a.elementType===d?g:Nn(d,g),u_(o,a,d,g,u);case 7:return Xt(o,a,a.pendingProps,u),a.child;case 8:return Xt(o,a,a.pendingProps.children,u),a.child;case 12:return Xt(o,a,a.pendingProps.children,u),a.child;case 10:e:{if(d=a.type._context,g=a.pendingProps,m=a.memoizedProps,v=g.value,Ge(Pa,d._currentValue),d._currentValue=v,m!==null)if(Mn(m.value,v)){if(m.children===g.children&&!Gt.current){a=ur(o,a,u);break e}}else for(m=a.child,m!==null&&(m.return=a);m!==null;){var I=m.dependencies;if(I!==null){v=m.child;for(var O=I.firstContext;O!==null;){if(O.context===d){if(m.tag===1){O=cr(-1,u&-u),O.tag=2;var q=m.updateQueue;if(q!==null){q=q.shared;var te=q.pending;te===null?O.next=O:(O.next=te.next,te.next=O),q.pending=O}}m.lanes|=u,O=m.alternate,O!==null&&(O.lanes|=u),Fu(m.return,u,a),I.lanes|=u;break}O=O.next}}else if(m.tag===10)v=m.type===a.type?null:m.child;else if(m.tag===18){if(v=m.return,v===null)throw Error(t(341));v.lanes|=u,I=v.alternate,I!==null&&(I.lanes|=u),Fu(v,u,a),v=m.sibling}else v=m.child;if(v!==null)v.return=m;else for(v=m;v!==null;){if(v===a){v=null;break}if(m=v.sibling,m!==null){m.return=v.return,v=m;break}v=v.return}m=v}Xt(o,a,g.children,u),a=a.child}return a;case 9:return g=a.type,d=a.pendingProps.children,Gi(a,u),g=wn(g),d=d(g),a.flags|=1,Xt(o,a,d,u),a.child;case 14:return d=a.type,g=Nn(d,a.pendingProps),g=Nn(d.type,g),f_(o,a,d,g,u);case 15:return h_(o,a,a.type,a.pendingProps,u);case 17:return d=a.type,g=a.pendingProps,g=a.elementType===d?g:Nn(d,g),$a(o,a),a.tag=1,en(d)?(o=!0,Sa(a)):o=!1,Gi(a,u),r_(a,d,g),Ju(a,d,g,u),nf(null,a,d,!0,o,u);case 19:return b_(o,a,u);case 22:return d_(o,a,u)}throw Error(t(156,a.tag))};function W_(o,a){return xp(o,a)}function yw(o,a,u,d){this.tag=o,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Sn(o,a,u,d){return new yw(o,a,u,d)}function xf(o){return o=o.prototype,!(!o||!o.isReactComponent)}function vw(o){if(typeof o=="function")return xf(o)?1:0;if(o!=null){if(o=o.$$typeof,o===K)return 11;if(o===Ce)return 14}return 2}function Ur(o,a){var u=o.alternate;return u===null?(u=Sn(o.tag,a,o.key,o.mode),u.elementType=o.elementType,u.type=o.type,u.stateNode=o.stateNode,u.alternate=o,o.alternate=u):(u.pendingProps=a,u.type=o.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=o.flags&14680064,u.childLanes=o.childLanes,u.lanes=o.lanes,u.child=o.child,u.memoizedProps=o.memoizedProps,u.memoizedState=o.memoizedState,u.updateQueue=o.updateQueue,a=o.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=o.sibling,u.index=o.index,u.ref=o.ref,u}function Ga(o,a,u,d,g,m){var v=2;if(d=o,typeof o=="function")xf(o)&&(v=1);else if(typeof o=="string")v=5;else e:switch(o){case L:return pi(u.children,g,m,a);case E:v=8,g|=8;break;case R:return o=Sn(12,u,a,g|2),o.elementType=R,o.lanes=m,o;case G:return o=Sn(13,u,a,g),o.elementType=G,o.lanes=m,o;case fe:return o=Sn(19,u,a,g),o.elementType=fe,o.lanes=m,o;case de:return el(u,g,m,a);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case N:v=10;break e;case j:v=9;break e;case K:v=11;break e;case Ce:v=14;break e;case De:v=16,d=null;break e}throw Error(t(130,o==null?o:typeof o,""))}return a=Sn(v,u,a,g),a.elementType=o,a.type=d,a.lanes=m,a}function pi(o,a,u,d){return o=Sn(7,o,d,a),o.lanes=u,o}function el(o,a,u,d){return o=Sn(22,o,d,a),o.elementType=de,o.lanes=u,o.stateNode={isHidden:!1},o}function Sf(o,a,u){return o=Sn(6,o,null,a),o.lanes=u,o}function Ef(o,a,u){return a=Sn(4,o.children!==null?o.children:[],o.key,a),a.lanes=u,a.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},a}function bw(o,a,u,d,g){this.tag=a,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Qc(0),this.expirationTimes=Qc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Qc(0),this.identifierPrefix=d,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function Af(o,a,u,d,g,m,v,I,O){return o=new bw(o,a,u,I,O),a===1?(a=1,m===!0&&(a|=8)):a=0,m=Sn(3,null,null,a),o.current=m,m.stateNode=o,m.memoizedState={element:d,isDehydrated:u,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bu(m),o}function ww(o,a,u){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Y,key:d==null?null:""+d,children:o,containerInfo:a,implementation:u}}function H_(o){if(!o)return Pr;o=o._reactInternals;e:{if(ni(o)!==o||o.tag!==1)throw Error(t(170));var a=o;do{switch(a.tag){case 3:a=a.stateNode.context;break e;case 1:if(en(a.type)){a=a.stateNode.__reactInternalMemoizedMergedChildContext;break e}}a=a.return}while(a!==null);throw Error(t(171))}if(o.tag===1){var u=o.type;if(en(u))return vg(o,u,a)}return a}function X_(o,a,u,d,g,m,v,I,O){return o=Af(u,d,!0,o,g,m,v,I,O),o.context=H_(null),u=o.current,d=Yt(),g=Lr(u),m=cr(d,g),m.callback=a??null,Or(u,m,g),o.current.lanes=g,js(o,g,d),rn(o,d),o}function tl(o,a,u,d){var g=a.current,m=Yt(),v=Lr(g);return u=H_(u),a.context===null?a.context=u:a.pendingContext=u,a=cr(m,v),a.payload={element:o},d=d===void 0?null:d,d!==null&&(a.callback=d),o=Or(g,a,v),o!==null&&(Ln(o,g,v,m),Ma(o,g,v)),v}function nl(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Y_(o,a){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var u=o.retryLane;o.retryLane=u!==0&&u<a?u:a}}function Rf(o,a){Y_(o,a),(o=o.alternate)&&Y_(o,a)}function Tw(){return null}var K_=typeof reportError=="function"?reportError:function(o){console.error(o)};function Cf(o){this._internalRoot=o}rl.prototype.render=Cf.prototype.render=function(o){var a=this._internalRoot;if(a===null)throw Error(t(409));tl(o,a,null,null)},rl.prototype.unmount=Cf.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var a=o.containerInfo;fi(function(){tl(null,o,null,null)}),a[ir]=null}};function rl(o){this._internalRoot=o}rl.prototype.unstable_scheduleHydration=function(o){if(o){var a=kp();o={blockedOn:null,target:o,priority:a};for(var u=0;u<Er.length&&a!==0&&a<Er[u].priority;u++);Er.splice(u,0,o),u===0&&Np(o)}};function If(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function il(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function q_(){}function xw(o,a,u,d,g){if(g){if(typeof d=="function"){var m=d;d=function(){var q=nl(v);m.call(q)}}var v=X_(a,d,o,0,null,!1,!1,"",q_);return o._reactRootContainer=v,o[ir]=v.current,ro(o.nodeType===8?o.parentNode:o),fi(),v}for(;g=o.lastChild;)o.removeChild(g);if(typeof d=="function"){var I=d;d=function(){var q=nl(O);I.call(q)}}var O=Af(o,0,!1,null,null,!1,!1,"",q_);return o._reactRootContainer=O,o[ir]=O.current,ro(o.nodeType===8?o.parentNode:o),fi(function(){tl(a,O,u,d)}),O}function sl(o,a,u,d,g){var m=u._reactRootContainer;if(m){var v=m;if(typeof g=="function"){var I=g;g=function(){var O=nl(v);I.call(O)}}tl(a,v,o,g)}else v=xw(u,a,o,g,d);return nl(v)}Ip=function(o){switch(o.tag){case 3:var a=o.stateNode;if(a.current.memoizedState.isDehydrated){var u=$s(a.pendingLanes);u!==0&&(Jc(a,u|1),rn(a,pt()),($e&6)===0&&(is=pt()+500,kr()))}break;case 13:fi(function(){var d=lr(o,1);if(d!==null){var g=Yt();Ln(d,o,1,g)}}),Rf(o,1)}},Gc=function(o){if(o.tag===13){var a=lr(o,134217728);if(a!==null){var u=Yt();Ln(a,o,134217728,u)}Rf(o,134217728)}},Pp=function(o){if(o.tag===13){var a=Lr(o),u=lr(o,a);if(u!==null){var d=Yt();Ln(u,o,a,d)}Rf(o,a)}},kp=function(){return Ke},Mp=function(o,a){var u=Ke;try{return Ke=o,a()}finally{Ke=u}},Hc=function(o,a,u){switch(a){case"input":if(Ht(o,u),a=u.name,u.type==="radio"&&a!=null){for(u=o;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),a=0;a<u.length;a++){var d=u[a];if(d!==o&&d.form===o.form){var g=Ta(d);if(!g)throw Error(t(90));et(d),Ht(d,g)}}}break;case"textarea":wt(o,u);break;case"select":a=u.value,a!=null&&an(o,!!u.multiple,a,!1)}},_p=bf,mp=fi;var Sw={usingClientEntryPoint:!1,Events:[oo,Hi,Ta,pp,gp,bf]},wo={findFiberByHostInstance:ri,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ew={bundleType:wo.bundleType,version:wo.version,rendererPackageName:wo.rendererPackageName,rendererConfig:wo.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:V.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=wp(o),o===null?null:o.stateNode},findFiberByHostInstance:wo.findFiberByHostInstance||Tw,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ol=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ol.isDisabled&&ol.supportsFiber)try{ra=ol.inject(Ew),Hn=ol}catch{}}return sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sw,sn.createPortal=function(o,a){var u=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!If(a))throw Error(t(200));return ww(o,a,null,u)},sn.createRoot=function(o,a){if(!If(o))throw Error(t(299));var u=!1,d="",g=K_;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(d=a.identifierPrefix),a.onRecoverableError!==void 0&&(g=a.onRecoverableError)),a=Af(o,1,!1,null,null,u,!1,d,g),o[ir]=a.current,ro(o.nodeType===8?o.parentNode:o),new Cf(a)},sn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var a=o._reactInternals;if(a===void 0)throw typeof o.render=="function"?Error(t(188)):(o=Object.keys(o).join(","),Error(t(268,o)));return o=wp(a),o=o===null?null:o.stateNode,o},sn.flushSync=function(o){return fi(o)},sn.hydrate=function(o,a,u){if(!il(a))throw Error(t(200));return sl(null,o,a,!0,u)},sn.hydrateRoot=function(o,a,u){if(!If(o))throw Error(t(405));var d=u!=null&&u.hydratedSources||null,g=!1,m="",v=K_;if(u!=null&&(u.unstable_strictMode===!0&&(g=!0),u.identifierPrefix!==void 0&&(m=u.identifierPrefix),u.onRecoverableError!==void 0&&(v=u.onRecoverableError)),a=X_(a,null,o,1,u??null,g,!1,m,v),o[ir]=a.current,ro(o),d)for(o=0;o<d.length;o++)u=d[o],g=u._getVersion,g=g(u._source),a.mutableSourceEagerHydrationData==null?a.mutableSourceEagerHydrationData=[u,g]:a.mutableSourceEagerHydrationData.push(u,g);return new rl(a)},sn.render=function(o,a,u){if(!il(a))throw Error(t(200));return sl(null,o,a,!1,u)},sn.unmountComponentAtNode=function(o){if(!il(o))throw Error(t(40));return o._reactRootContainer?(fi(function(){sl(null,null,o,!1,function(){o._reactRootContainer=null,o[ir]=null})}),!0):!1},sn.unstable_batchedUpdates=bf,sn.unstable_renderSubtreeIntoContainer=function(o,a,u,d){if(!il(u))throw Error(t(200));if(o==null||o._reactInternals===void 0)throw Error(t(38));return sl(o,a,u,!1,d)},sn.version="18.3.1-next-f1338f8080-20240426",sn}var rm;function F0(){if(rm)return Mf.exports;rm=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Mf.exports=Nw(),Mf.exports}var im;function Dw(){if(im)return al;im=1;var n=F0();return al.createRoot=n.createRoot,al.hydrateRoot=n.hydrateRoot,al}var Fw=Dw();const Lw=Ad(Fw),ws=(n,e=0,t=1)=>Id(Pd(e,n),t),Cd=n=>{n._clipped=!1,n._unclipped=n.slice(0);for(let e=0;e<=3;e++)e<3?((n[e]<0||n[e]>255)&&(n._clipped=!0),n[e]=ws(n[e],0,255)):e===3&&(n[e]=ws(n[e],0,1));return n},L0={};for(let n of["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"])L0[`[object ${n}]`]=n.toLowerCase();function Be(n){return L0[Object.prototype.toString.call(n)]||"object"}const Ue=(n,e=null)=>n.length>=3?Array.prototype.slice.call(n):Be(n[0])=="object"&&e?e.split("").filter(t=>n[0][t]!==void 0).map(t=>n[0][t]):n[0],kc=n=>{if(n.length<2)return null;const e=n.length-1;return Be(n[e])=="string"?n[e].toLowerCase():null},{PI:Mc,min:Id,max:Pd}=Math,dr=Mc*2,Df=Mc/3,Bw=Mc/180,Uw=180/Mc,Me={format:{},autodetect:[]};class ae{constructor(...e){const t=this;if(Be(e[0])==="object"&&e[0].constructor&&e[0].constructor===this.constructor)return e[0];let r=kc(e),i=!1;if(!r){i=!0,Me.sorted||(Me.autodetect=Me.autodetect.sort((s,l)=>l.p-s.p),Me.sorted=!0);for(let s of Me.autodetect)if(r=s.test(...e),r)break}if(Me.format[r]){const s=Me.format[r].apply(null,i?e:e.slice(0,-1));t._rgb=Cd(s)}else throw new Error("unknown format: "+e);t._rgb.length===3&&t._rgb.push(1)}toString(){return Be(this.hex)=="function"?this.hex():`[${this._rgb.join(",")}]`}}const Vw="2.6.0",Oe=(...n)=>new Oe.Color(...n);Oe.Color=ae;Oe.version=Vw;const zw=(...n)=>{n=Ue(n,"cmyk");const[e,t,r,i]=n,s=n.length>4?n[4]:1;return i===1?[0,0,0,s]:[e>=1?0:255*(1-e)*(1-i),t>=1?0:255*(1-t)*(1-i),r>=1?0:255*(1-r)*(1-i),s]},{max:sm}=Math,$w=(...n)=>{let[e,t,r]=Ue(n,"rgb");e=e/255,t=t/255,r=r/255;const i=1-sm(e,sm(t,r)),s=i<1?1/(1-i):0,l=(1-e-i)*s,c=(1-t-i)*s,f=(1-r-i)*s;return[l,c,f,i]};ae.prototype.cmyk=function(){return $w(this._rgb)};Oe.cmyk=(...n)=>new ae(...n,"cmyk");Me.format.cmyk=zw;Me.autodetect.push({p:2,test:(...n)=>{if(n=Ue(n,"cmyk"),Be(n)==="array"&&n.length===4)return"cmyk"}});const Ff=n=>Math.round(n*100)/100,jw=(...n)=>{const e=Ue(n,"hsla");let t=kc(n)||"lsa";return e[0]=Ff(e[0]||0),e[1]=Ff(e[1]*100)+"%",e[2]=Ff(e[2]*100)+"%",t==="hsla"||e.length>3&&e[3]<1?(e[3]=e.length>3?e[3]:1,t="hsla"):e.length=3,`${t}(${e.join(",")})`},B0=(...n)=>{n=Ue(n,"rgba");let[e,t,r]=n;e/=255,t/=255,r/=255;const i=Id(e,t,r),s=Pd(e,t,r),l=(s+i)/2;let c,f;return s===i?(c=0,f=Number.NaN):c=l<.5?(s-i)/(s+i):(s-i)/(2-s-i),e==s?f=(t-r)/(s-i):t==s?f=2+(r-e)/(s-i):r==s&&(f=4+(e-t)/(s-i)),f*=60,f<0&&(f+=360),n.length>3&&n[3]!==void 0?[f,c,l,n[3]]:[f,c,l]},{round:Lf}=Math,Ww=(...n)=>{const e=Ue(n,"rgba");let t=kc(n)||"rgb";return t.substr(0,3)=="hsl"?jw(B0(e),t):(e[0]=Lf(e[0]),e[1]=Lf(e[1]),e[2]=Lf(e[2]),(t==="rgba"||e.length>3&&e[3]<1)&&(e[3]=e.length>3?e[3]:1,t="rgba"),`${t}(${e.slice(0,t==="rgb"?3:4).join(",")})`)},{round:Bf}=Math,Dh=(...n)=>{n=Ue(n,"hsl");const[e,t,r]=n;let i,s,l;if(t===0)i=s=l=r*255;else{const c=[0,0,0],f=[0,0,0],h=r<.5?r*(1+t):r+t-r*t,p=2*r-h,_=e/360;c[0]=_+1/3,c[1]=_,c[2]=_-1/3;for(let y=0;y<3;y++)c[y]<0&&(c[y]+=1),c[y]>1&&(c[y]-=1),6*c[y]<1?f[y]=p+(h-p)*6*c[y]:2*c[y]<1?f[y]=h:3*c[y]<2?f[y]=p+(h-p)*(2/3-c[y])*6:f[y]=p;[i,s,l]=[Bf(f[0]*255),Bf(f[1]*255),Bf(f[2]*255)]}return n.length>3?[i,s,l,n[3]]:[i,s,l,1]},U0=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,V0=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,z0=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,$0=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,j0=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,W0=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,{round:om}=Math,kd=n=>{n=n.toLowerCase().trim();let e;if(Me.format.named)try{return Me.format.named(n)}catch{}if(e=n.match(U0)){const t=e.slice(1,4);for(let r=0;r<3;r++)t[r]=+t[r];return t[3]=1,t}if(e=n.match(V0)){const t=e.slice(1,5);for(let r=0;r<4;r++)t[r]=+t[r];return t}if(e=n.match(z0)){const t=e.slice(1,4);for(let r=0;r<3;r++)t[r]=om(t[r]*2.55);return t[3]=1,t}if(e=n.match($0)){const t=e.slice(1,5);for(let r=0;r<3;r++)t[r]=om(t[r]*2.55);return t[3]=+t[3],t}if(e=n.match(j0)){const t=e.slice(1,4);t[1]*=.01,t[2]*=.01;const r=Dh(t);return r[3]=1,r}if(e=n.match(W0)){const t=e.slice(1,4);t[1]*=.01,t[2]*=.01;const r=Dh(t);return r[3]=+e[4],r}};kd.test=n=>U0.test(n)||V0.test(n)||z0.test(n)||$0.test(n)||j0.test(n)||W0.test(n);ae.prototype.css=function(n){return Ww(this._rgb,n)};Oe.css=(...n)=>new ae(...n,"css");Me.format.css=kd;Me.autodetect.push({p:5,test:(n,...e)=>{if(!e.length&&Be(n)==="string"&&kd.test(n))return"css"}});Me.format.gl=(...n)=>{const e=Ue(n,"rgba");return e[0]*=255,e[1]*=255,e[2]*=255,e};Oe.gl=(...n)=>new ae(...n,"gl");ae.prototype.gl=function(){const n=this._rgb;return[n[0]/255,n[1]/255,n[2]/255,n[3]]};const{floor:Hw}=Math,Xw=(...n)=>{n=Ue(n,"hcg");let[e,t,r]=n,i,s,l;r=r*255;const c=t*255;if(t===0)i=s=l=r;else{e===360&&(e=0),e>360&&(e-=360),e<0&&(e+=360),e/=60;const f=Hw(e),h=e-f,p=r*(1-t),_=p+c*(1-h),y=p+c*h,b=p+c;switch(f){case 0:[i,s,l]=[b,y,p];break;case 1:[i,s,l]=[_,b,p];break;case 2:[i,s,l]=[p,b,y];break;case 3:[i,s,l]=[p,_,b];break;case 4:[i,s,l]=[y,p,b];break;case 5:[i,s,l]=[b,p,_];break}}return[i,s,l,n.length>3?n[3]:1]},Yw=(...n)=>{const[e,t,r]=Ue(n,"rgb"),i=Id(e,t,r),s=Pd(e,t,r),l=s-i,c=l*100/255,f=i/(255-l)*100;let h;return l===0?h=Number.NaN:(e===s&&(h=(t-r)/l),t===s&&(h=2+(r-e)/l),r===s&&(h=4+(e-t)/l),h*=60,h<0&&(h+=360)),[h,c,f]};ae.prototype.hcg=function(){return Yw(this._rgb)};Oe.hcg=(...n)=>new ae(...n,"hcg");Me.format.hcg=Xw;Me.autodetect.push({p:1,test:(...n)=>{if(n=Ue(n,"hcg"),Be(n)==="array"&&n.length===3)return"hcg"}});const Kw=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,qw=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,H0=n=>{if(n.match(Kw)){(n.length===4||n.length===7)&&(n=n.substr(1)),n.length===3&&(n=n.split(""),n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]);const e=parseInt(n,16),t=e>>16,r=e>>8&255,i=e&255;return[t,r,i,1]}if(n.match(qw)){(n.length===5||n.length===9)&&(n=n.substr(1)),n.length===4&&(n=n.split(""),n=n[0]+n[0]+n[1]+n[1]+n[2]+n[2]+n[3]+n[3]);const e=parseInt(n,16),t=e>>24&255,r=e>>16&255,i=e>>8&255,s=Math.round((e&255)/255*100)/100;return[t,r,i,s]}throw new Error(`unknown hex color: ${n}`)},{round:ll}=Math,X0=(...n)=>{let[e,t,r,i]=Ue(n,"rgba"),s=kc(n)||"auto";i===void 0&&(i=1),s==="auto"&&(s=i<1?"rgba":"rgb"),e=ll(e),t=ll(t),r=ll(r);let c="000000"+(e<<16|t<<8|r).toString(16);c=c.substr(c.length-6);let f="0"+ll(i*255).toString(16);switch(f=f.substr(f.length-2),s.toLowerCase()){case"rgba":return`#${c}${f}`;case"argb":return`#${f}${c}`;default:return`#${c}`}};ae.prototype.hex=function(n){return X0(this._rgb,n)};Oe.hex=(...n)=>new ae(...n,"hex");Me.format.hex=H0;Me.autodetect.push({p:4,test:(n,...e)=>{if(!e.length&&Be(n)==="string"&&[3,4,5,6,7,8,9].indexOf(n.length)>=0)return"hex"}});const{cos:os}=Math,Zw=(...n)=>{n=Ue(n,"hsi");let[e,t,r]=n,i,s,l;return isNaN(e)&&(e=0),isNaN(t)&&(t=0),e>360&&(e-=360),e<0&&(e+=360),e/=360,e<1/3?(l=(1-t)/3,i=(1+t*os(dr*e)/os(Df-dr*e))/3,s=1-(l+i)):e<2/3?(e-=1/3,i=(1-t)/3,s=(1+t*os(dr*e)/os(Df-dr*e))/3,l=1-(i+s)):(e-=2/3,s=(1-t)/3,l=(1+t*os(dr*e)/os(Df-dr*e))/3,i=1-(s+l)),i=ws(r*i*3),s=ws(r*s*3),l=ws(r*l*3),[i*255,s*255,l*255,n.length>3?n[3]:1]},{min:Qw,sqrt:Jw,acos:Gw}=Math,e2=(...n)=>{let[e,t,r]=Ue(n,"rgb");e/=255,t/=255,r/=255;let i;const s=Qw(e,t,r),l=(e+t+r)/3,c=l>0?1-s/l:0;return c===0?i=NaN:(i=(e-t+(e-r))/2,i/=Jw((e-t)*(e-t)+(e-r)*(t-r)),i=Gw(i),r>t&&(i=dr-i),i/=dr),[i*360,c,l]};ae.prototype.hsi=function(){return e2(this._rgb)};Oe.hsi=(...n)=>new ae(...n,"hsi");Me.format.hsi=Zw;Me.autodetect.push({p:2,test:(...n)=>{if(n=Ue(n,"hsi"),Be(n)==="array"&&n.length===3)return"hsi"}});ae.prototype.hsl=function(){return B0(this._rgb)};Oe.hsl=(...n)=>new ae(...n,"hsl");Me.format.hsl=Dh;Me.autodetect.push({p:2,test:(...n)=>{if(n=Ue(n,"hsl"),Be(n)==="array"&&n.length===3)return"hsl"}});const{floor:t2}=Math,n2=(...n)=>{n=Ue(n,"hsv");let[e,t,r]=n,i,s,l;if(r*=255,t===0)i=s=l=r;else{e===360&&(e=0),e>360&&(e-=360),e<0&&(e+=360),e/=60;const c=t2(e),f=e-c,h=r*(1-t),p=r*(1-t*f),_=r*(1-t*(1-f));switch(c){case 0:[i,s,l]=[r,_,h];break;case 1:[i,s,l]=[p,r,h];break;case 2:[i,s,l]=[h,r,_];break;case 3:[i,s,l]=[h,p,r];break;case 4:[i,s,l]=[_,h,r];break;case 5:[i,s,l]=[r,h,p];break}}return[i,s,l,n.length>3?n[3]:1]},{min:r2,max:i2}=Math,s2=(...n)=>{n=Ue(n,"rgb");let[e,t,r]=n;const i=r2(e,t,r),s=i2(e,t,r),l=s-i;let c,f,h;return h=s/255,s===0?(c=Number.NaN,f=0):(f=l/s,e===s&&(c=(t-r)/l),t===s&&(c=2+(r-e)/l),r===s&&(c=4+(e-t)/l),c*=60,c<0&&(c+=360)),[c,f,h]};ae.prototype.hsv=function(){return s2(this._rgb)};Oe.hsv=(...n)=>new ae(...n,"hsv");Me.format.hsv=n2;Me.autodetect.push({p:2,test:(...n)=>{if(n=Ue(n,"hsv"),Be(n)==="array"&&n.length===3)return"hsv"}});const on={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},{pow:o2}=Math,Y0=(...n)=>{n=Ue(n,"lab");const[e,t,r]=n;let i,s,l,c,f,h;return s=(e+16)/116,i=isNaN(t)?s:s+t/500,l=isNaN(r)?s:s-r/200,s=on.Yn*Vf(s),i=on.Xn*Vf(i),l=on.Zn*Vf(l),c=Uf(3.2404542*i-1.5371385*s-.4985314*l),f=Uf(-.969266*i+1.8760108*s+.041556*l),h=Uf(.0556434*i-.2040259*s+1.0572252*l),[c,f,h,n.length>3?n[3]:1]},Uf=n=>255*(n<=.00304?12.92*n:1.055*o2(n,1/2.4)-.055),Vf=n=>n>on.t1?n*n*n:on.t2*(n-on.t0),{pow:K0}=Math,q0=(...n)=>{const[e,t,r]=Ue(n,"rgb"),[i,s,l]=a2(e,t,r),c=116*s-16;return[c<0?0:c,500*(i-s),200*(s-l)]},zf=n=>(n/=255)<=.04045?n/12.92:K0((n+.055)/1.055,2.4),$f=n=>n>on.t3?K0(n,1/3):n/on.t2+on.t0,a2=(n,e,t)=>{n=zf(n),e=zf(e),t=zf(t);const r=$f((.4124564*n+.3575761*e+.1804375*t)/on.Xn),i=$f((.2126729*n+.7151522*e+.072175*t)/on.Yn),s=$f((.0193339*n+.119192*e+.9503041*t)/on.Zn);return[r,i,s]};ae.prototype.lab=function(){return q0(this._rgb)};Oe.lab=(...n)=>new ae(...n,"lab");Me.format.lab=Y0;Me.autodetect.push({p:2,test:(...n)=>{if(n=Ue(n,"lab"),Be(n)==="array"&&n.length===3)return"lab"}});const{sin:l2,cos:c2}=Math,Z0=(...n)=>{let[e,t,r]=Ue(n,"lch");return isNaN(r)&&(r=0),r=r*Bw,[e,c2(r)*t,l2(r)*t]},Q0=(...n)=>{n=Ue(n,"lch");const[e,t,r]=n,[i,s,l]=Z0(e,t,r),[c,f,h]=Y0(i,s,l);return[c,f,h,n.length>3?n[3]:1]},u2=(...n)=>{const e=Ue(n,"hcl").reverse();return Q0(...e)},{sqrt:f2,atan2:h2,round:d2}=Math,J0=(...n)=>{const[e,t,r]=Ue(n,"lab"),i=f2(t*t+r*r);let s=(h2(r,t)*Uw+360)%360;return d2(i*1e4)===0&&(s=Number.NaN),[e,i,s]},G0=(...n)=>{const[e,t,r]=Ue(n,"rgb"),[i,s,l]=q0(e,t,r);return J0(i,s,l)};ae.prototype.lch=function(){return G0(this._rgb)};ae.prototype.hcl=function(){return G0(this._rgb).reverse()};Oe.lch=(...n)=>new ae(...n,"lch");Oe.hcl=(...n)=>new ae(...n,"hcl");Me.format.lch=Q0;Me.format.hcl=u2;["lch","hcl"].forEach(n=>Me.autodetect.push({p:2,test:(...e)=>{if(e=Ue(e,n),Be(e)==="array"&&e.length===3)return n}}));const Ss={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};ae.prototype.name=function(){const n=X0(this._rgb,"rgb");for(let e of Object.keys(Ss))if(Ss[e]===n)return e.toLowerCase();return n};Me.format.named=n=>{if(n=n.toLowerCase(),Ss[n])return H0(Ss[n]);throw new Error("unknown color name: "+n)};Me.autodetect.push({p:5,test:(n,...e)=>{if(!e.length&&Be(n)==="string"&&Ss[n.toLowerCase()])return"named"}});const p2=n=>{if(Be(n)=="number"&&n>=0&&n<=16777215){const e=n>>16,t=n>>8&255,r=n&255;return[e,t,r,1]}throw new Error("unknown num color: "+n)},g2=(...n)=>{const[e,t,r]=Ue(n,"rgb");return(e<<16)+(t<<8)+r};ae.prototype.num=function(){return g2(this._rgb)};Oe.num=(...n)=>new ae(...n,"num");Me.format.num=p2;Me.autodetect.push({p:5,test:(...n)=>{if(n.length===1&&Be(n[0])==="number"&&n[0]>=0&&n[0]<=16777215)return"num"}});const{round:ev}=Math;ae.prototype.rgb=function(n=!0){return n===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(ev)};ae.prototype.rgba=function(n=!0){return this._rgb.slice(0,4).map((e,t)=>t<3?n===!1?e:ev(e):e)};Oe.rgb=(...n)=>new ae(...n,"rgb");Me.format.rgb=(...n)=>{const e=Ue(n,"rgba");return e[3]===void 0&&(e[3]=1),e};Me.autodetect.push({p:3,test:(...n)=>{if(n=Ue(n,"rgba"),Be(n)==="array"&&(n.length===3||n.length===4&&Be(n[3])=="number"&&n[3]>=0&&n[3]<=1))return"rgb"}});const{log:cl}=Math,tv=n=>{const e=n/100;let t,r,i;return e<66?(t=255,r=e<6?0:-155.25485562709179-.44596950469579133*(r=e-2)+104.49216199393888*cl(r),i=e<20?0:-254.76935184120902+.8274096064007395*(i=e-10)+115.67994401066147*cl(i)):(t=351.97690566805693+.114206453784165*(t=e-55)-40.25366309332127*cl(t),r=325.4494125711974+.07943456536662342*(r=e-50)-28.0852963507957*cl(r),i=255),[t,r,i,1]},{round:_2}=Math,m2=(...n)=>{const e=Ue(n,"rgb"),t=e[0],r=e[2];let i=1e3,s=4e4;const l=.4;let c;for(;s-i>l;){c=(s+i)*.5;const f=tv(c);f[2]/f[0]>=r/t?s=c:i=c}return _2(c)};ae.prototype.temp=ae.prototype.kelvin=ae.prototype.temperature=function(){return m2(this._rgb)};Oe.temp=Oe.kelvin=Oe.temperature=(...n)=>new ae(...n,"temp");Me.format.temp=Me.format.kelvin=Me.format.temperature=tv;const{pow:Cl,sign:y2}=Math,nv=(...n)=>{n=Ue(n,"lab");const[e,t,r]=n,i=Cl(e+.3963377774*t+.2158037573*r,3),s=Cl(e-.1055613458*t-.0638541728*r,3),l=Cl(e-.0894841775*t-1.291485548*r,3);return[255*jf(4.0767416621*i-3.3077115913*s+.2309699292*l),255*jf(-1.2684380046*i+2.6097574011*s-.3413193965*l),255*jf(-.0041960863*i-.7034186147*s+1.707614701*l),n.length>3?n[3]:1]};function jf(n){const e=Math.abs(n);return e>.0031308?(y2(n)||1)*(1.055*Cl(e,1/2.4)-.055):n*12.92}const{cbrt:Wf,pow:v2,sign:b2}=Math,rv=(...n)=>{const[e,t,r]=Ue(n,"rgb"),[i,s,l]=[Hf(e/255),Hf(t/255),Hf(r/255)],c=Wf(.4122214708*i+.5363325363*s+.0514459929*l),f=Wf(.2119034982*i+.6806995451*s+.1073969566*l),h=Wf(.0883024619*i+.2817188376*s+.6299787005*l);return[.2104542553*c+.793617785*f-.0040720468*h,1.9779984951*c-2.428592205*f+.4505937099*h,.0259040371*c+.7827717662*f-.808675766*h]};function Hf(n){const e=Math.abs(n);return e<.04045?n/12.92:(b2(n)||1)*v2((e+.055)/1.055,2.4)}ae.prototype.oklab=function(){return rv(this._rgb)};Oe.oklab=(...n)=>new ae(...n,"oklab");Me.format.oklab=nv;Me.autodetect.push({p:3,test:(...n)=>{if(n=Ue(n,"oklab"),Be(n)==="array"&&n.length===3)return"oklab"}});const w2=(...n)=>{n=Ue(n,"lch");const[e,t,r]=n,[i,s,l]=Z0(e,t,r),[c,f,h]=nv(i,s,l);return[c,f,h,n.length>3?n[3]:1]},T2=(...n)=>{const[e,t,r]=Ue(n,"rgb"),[i,s,l]=rv(e,t,r);return J0(i,s,l)};ae.prototype.oklch=function(){return T2(this._rgb)};Oe.oklch=(...n)=>new ae(...n,"oklch");Me.format.oklch=w2;Me.autodetect.push({p:3,test:(...n)=>{if(n=Ue(n,"oklch"),Be(n)==="array"&&n.length===3)return"oklch"}});ae.prototype.alpha=function(n,e=!1){return n!==void 0&&Be(n)==="number"?e?(this._rgb[3]=n,this):new ae([this._rgb[0],this._rgb[1],this._rgb[2],n],"rgb"):this._rgb[3]};ae.prototype.clipped=function(){return this._rgb._clipped||!1};ae.prototype.darken=function(n=1){const e=this,t=e.lab();return t[0]-=on.Kn*n,new ae(t,"lab").alpha(e.alpha(),!0)};ae.prototype.brighten=function(n=1){return this.darken(-n)};ae.prototype.darker=ae.prototype.darken;ae.prototype.brighter=ae.prototype.brighten;ae.prototype.get=function(n){const[e,t]=n.split("."),r=this[e]();if(t){const i=e.indexOf(t)-(e.substr(0,2)==="ok"?2:0);if(i>-1)return r[i];throw new Error(`unknown channel ${t} in mode ${e}`)}else return r};const{pow:x2}=Math,S2=1e-7,E2=20;ae.prototype.luminance=function(n,e="rgb"){if(n!==void 0&&Be(n)==="number"){if(n===0)return new ae([0,0,0,this._rgb[3]],"rgb");if(n===1)return new ae([255,255,255,this._rgb[3]],"rgb");let t=this.luminance(),r=E2;const i=(l,c)=>{const f=l.interpolate(c,.5,e),h=f.luminance();return Math.abs(n-h)<S2||!r--?f:h>n?i(l,f):i(f,c)},s=(t>n?i(new ae([0,0,0]),this):i(this,new ae([255,255,255]))).rgb();return new ae([...s,this._rgb[3]])}return A2(...this._rgb.slice(0,3))};const A2=(n,e,t)=>(n=Xf(n),e=Xf(e),t=Xf(t),.2126*n+.7152*e+.0722*t),Xf=n=>(n/=255,n<=.03928?n/12.92:x2((n+.055)/1.055,2.4)),Wt={},zo=(n,e,t=.5,...r)=>{let i=r[0]||"lrgb";if(!Wt[i]&&!r.length&&(i=Object.keys(Wt)[0]),!Wt[i])throw new Error(`interpolation mode ${i} is not defined`);return Be(n)!=="object"&&(n=new ae(n)),Be(e)!=="object"&&(e=new ae(e)),Wt[i](n,e,t).alpha(n.alpha()+t*(e.alpha()-n.alpha()))};ae.prototype.mix=ae.prototype.interpolate=function(n,e=.5,...t){return zo(this,n,e,...t)};ae.prototype.premultiply=function(n=!1){const e=this._rgb,t=e[3];return n?(this._rgb=[e[0]*t,e[1]*t,e[2]*t,t],this):new ae([e[0]*t,e[1]*t,e[2]*t,t],"rgb")};ae.prototype.saturate=function(n=1){const e=this,t=e.lch();return t[1]+=on.Kn*n,t[1]<0&&(t[1]=0),new ae(t,"lch").alpha(e.alpha(),!0)};ae.prototype.desaturate=function(n=1){return this.saturate(-n)};ae.prototype.set=function(n,e,t=!1){const[r,i]=n.split("."),s=this[r]();if(i){const l=r.indexOf(i)-(r.substr(0,2)==="ok"?2:0);if(l>-1){if(Be(e)=="string")switch(e.charAt(0)){case"+":s[l]+=+e;break;case"-":s[l]+=+e;break;case"*":s[l]*=+e.substr(1);break;case"/":s[l]/=+e.substr(1);break;default:s[l]=+e}else if(Be(e)==="number")s[l]=e;else throw new Error("unsupported value for Color.set");const c=new ae(s,r);return t?(this._rgb=c._rgb,this):c}throw new Error(`unknown channel ${i} in mode ${r}`)}else return s};ae.prototype.tint=function(n=.5,...e){return zo(this,"white",n,...e)};ae.prototype.shade=function(n=.5,...e){return zo(this,"black",n,...e)};const R2=(n,e,t)=>{const r=n._rgb,i=e._rgb;return new ae(r[0]+t*(i[0]-r[0]),r[1]+t*(i[1]-r[1]),r[2]+t*(i[2]-r[2]),"rgb")};Wt.rgb=R2;const{sqrt:Yf,pow:as}=Math,C2=(n,e,t)=>{const[r,i,s]=n._rgb,[l,c,f]=e._rgb;return new ae(Yf(as(r,2)*(1-t)+as(l,2)*t),Yf(as(i,2)*(1-t)+as(c,2)*t),Yf(as(s,2)*(1-t)+as(f,2)*t),"rgb")};Wt.lrgb=C2;const I2=(n,e,t)=>{const r=n.lab(),i=e.lab();return new ae(r[0]+t*(i[0]-r[0]),r[1]+t*(i[1]-r[1]),r[2]+t*(i[2]-r[2]),"lab")};Wt.lab=I2;const Ds=(n,e,t,r)=>{let i,s;r==="hsl"?(i=n.hsl(),s=e.hsl()):r==="hsv"?(i=n.hsv(),s=e.hsv()):r==="hcg"?(i=n.hcg(),s=e.hcg()):r==="hsi"?(i=n.hsi(),s=e.hsi()):r==="lch"||r==="hcl"?(r="hcl",i=n.hcl(),s=e.hcl()):r==="oklch"&&(i=n.oklch().reverse(),s=e.oklch().reverse());let l,c,f,h,p,_;(r.substr(0,1)==="h"||r==="oklch")&&([l,f,p]=i,[c,h,_]=s);let y,b,x,S;return!isNaN(l)&&!isNaN(c)?(c>l&&c-l>180?S=c-(l+360):c<l&&l-c>180?S=c+360-l:S=c-l,b=l+t*S):isNaN(l)?isNaN(c)?b=Number.NaN:(b=c,(p==1||p==0)&&r!="hsv"&&(y=h)):(b=l,(_==1||_==0)&&r!="hsv"&&(y=f)),y===void 0&&(y=f+t*(h-f)),x=p+t*(_-p),r==="oklch"?new ae([x,y,b],r):new ae([b,y,x],r)},iv=(n,e,t)=>Ds(n,e,t,"lch");Wt.lch=iv;Wt.hcl=iv;const P2=(n,e,t)=>{const r=n.num(),i=e.num();return new ae(r+t*(i-r),"num")};Wt.num=P2;const k2=(n,e,t)=>Ds(n,e,t,"hcg");Wt.hcg=k2;const M2=(n,e,t)=>Ds(n,e,t,"hsi");Wt.hsi=M2;const O2=(n,e,t)=>Ds(n,e,t,"hsl");Wt.hsl=O2;const N2=(n,e,t)=>Ds(n,e,t,"hsv");Wt.hsv=N2;const D2=(n,e,t)=>{const r=n.oklab(),i=e.oklab();return new ae(r[0]+t*(i[0]-r[0]),r[1]+t*(i[1]-r[1]),r[2]+t*(i[2]-r[2]),"oklab")};Wt.oklab=D2;const F2=(n,e,t)=>Ds(n,e,t,"oklch");Wt.oklch=F2;const{pow:Kf,sqrt:qf,PI:Zf,cos:am,sin:lm,atan2:L2}=Math,B2=(n,e="lrgb",t=null)=>{const r=n.length;t||(t=Array.from(new Array(r)).map(()=>1));const i=r/t.reduce(function(_,y){return _+y});if(t.forEach((_,y)=>{t[y]*=i}),n=n.map(_=>new ae(_)),e==="lrgb")return U2(n,t);const s=n.shift(),l=s.get(e),c=[];let f=0,h=0;for(let _=0;_<l.length;_++)if(l[_]=(l[_]||0)*t[0],c.push(isNaN(l[_])?0:t[0]),e.charAt(_)==="h"&&!isNaN(l[_])){const y=l[_]/180*Zf;f+=am(y)*t[0],h+=lm(y)*t[0]}let p=s.alpha()*t[0];n.forEach((_,y)=>{const b=_.get(e);p+=_.alpha()*t[y+1];for(let x=0;x<l.length;x++)if(!isNaN(b[x]))if(c[x]+=t[y+1],e.charAt(x)==="h"){const S=b[x]/180*Zf;f+=am(S)*t[y+1],h+=lm(S)*t[y+1]}else l[x]+=b[x]*t[y+1]});for(let _=0;_<l.length;_++)if(e.charAt(_)==="h"){let y=L2(h/c[_],f/c[_])/Zf*180;for(;y<0;)y+=360;for(;y>=360;)y-=360;l[_]=y}else l[_]=l[_]/c[_];return p/=r,new ae(l,e).alpha(p>.99999?1:p,!0)},U2=(n,e)=>{const t=n.length,r=[0,0,0,0];for(let i=0;i<n.length;i++){const s=n[i],l=e[i]/t,c=s._rgb;r[0]+=Kf(c[0],2)*l,r[1]+=Kf(c[1],2)*l,r[2]+=Kf(c[2],2)*l,r[3]+=c[3]*l}return r[0]=qf(r[0]),r[1]=qf(r[1]),r[2]=qf(r[2]),r[3]>.9999999&&(r[3]=1),new ae(Cd(r))},{pow:V2}=Math;function Ul(n){let e="rgb",t=Oe("#ccc"),r=0,i=[0,1],s=[],l=[0,0],c=!1,f=[],h=!1,p=0,_=1,y=!1,b={},x=!0,S=1;const C=function(L){if(L=L||["#fff","#000"],L&&Be(L)==="string"&&Oe.brewer&&Oe.brewer[L.toLowerCase()]&&(L=Oe.brewer[L.toLowerCase()]),Be(L)==="array"){L.length===1&&(L=[L[0],L[0]]),L=L.slice(0);for(let E=0;E<L.length;E++)L[E]=Oe(L[E]);s.length=0;for(let E=0;E<L.length;E++)s.push(E/(L.length-1))}return Z(),f=L},P=function(L){if(c!=null){const E=c.length-1;let R=0;for(;R<E&&L>=c[R];)R++;return R-1}return 0};let z=L=>L,k=L=>L;const V=function(L,E){let R,N;if(E==null&&(E=!1),isNaN(L)||L===null)return t;E?N=L:c&&c.length>2?N=P(L)/(c.length-2):_!==p?N=(L-p)/(_-p):N=1,N=k(N),E||(N=z(N)),S!==1&&(N=V2(N,S)),N=l[0]+N*(1-l[0]-l[1]),N=ws(N,0,1);const j=Math.floor(N*1e4);if(x&&b[j])R=b[j];else{if(Be(f)==="array")for(let K=0;K<s.length;K++){const G=s[K];if(N<=G){R=f[K];break}if(N>=G&&K===s.length-1){R=f[K];break}if(N>G&&N<s[K+1]){N=(N-G)/(s[K+1]-G),R=Oe.interpolate(f[K],f[K+1],N,e);break}}else Be(f)==="function"&&(R=f(N));x&&(b[j]=R)}return R};var Z=()=>b={};C(n);const Y=function(L){const E=Oe(V(L));return h&&E[h]?E[h]():E};return Y.classes=function(L){if(L!=null){if(Be(L)==="array")c=L,i=[L[0],L[L.length-1]];else{const E=Oe.analyze(i);L===0?c=[E.min,E.max]:c=Oe.limits(E,"e",L)}return Y}return c},Y.domain=function(L){if(!arguments.length)return i;p=L[0],_=L[L.length-1],s=[];const E=f.length;if(L.length===E&&p!==_)for(let R of Array.from(L))s.push((R-p)/(_-p));else{for(let R=0;R<E;R++)s.push(R/(E-1));if(L.length>2){const R=L.map((j,K)=>K/(L.length-1)),N=L.map(j=>(j-p)/(_-p));N.every((j,K)=>R[K]===j)||(k=j=>{if(j<=0||j>=1)return j;let K=0;for(;j>=N[K+1];)K++;const G=(j-N[K])/(N[K+1]-N[K]);return R[K]+G*(R[K+1]-R[K])})}}return i=[p,_],Y},Y.mode=function(L){return arguments.length?(e=L,Z(),Y):e},Y.range=function(L,E){return C(L),Y},Y.out=function(L){return h=L,Y},Y.spread=function(L){return arguments.length?(r=L,Y):r},Y.correctLightness=function(L){return L==null&&(L=!0),y=L,Z(),y?z=function(E){const R=V(0,!0).lab()[0],N=V(1,!0).lab()[0],j=R>N;let K=V(E,!0).lab()[0];const G=R+(N-R)*E;let fe=K-G,Ce=0,De=1,de=20;for(;Math.abs(fe)>.01&&de-- >0;)(function(){return j&&(fe*=-1),fe<0?(Ce=E,E+=(De-E)*.5):(De=E,E+=(Ce-E)*.5),K=V(E,!0).lab()[0],fe=K-G})();return E}:z=E=>E,Y},Y.padding=function(L){return L!=null?(Be(L)==="number"&&(L=[L,L]),l=L,Y):l},Y.colors=function(L,E){arguments.length<2&&(E="hex");let R=[];if(arguments.length===0)R=f.slice(0);else if(L===1)R=[Y(.5)];else if(L>1){const N=i[0],j=i[1]-N;R=z2(0,L).map(K=>Y(N+K/(L-1)*j))}else{n=[];let N=[];if(c&&c.length>2)for(let j=1,K=c.length,G=1<=K;G?j<K:j>K;G?j++:j--)N.push((c[j-1]+c[j])*.5);else N=i;R=N.map(j=>Y(j))}return Oe[E]&&(R=R.map(N=>N[E]())),R},Y.cache=function(L){return L!=null?(x=L,Y):x},Y.gamma=function(L){return L!=null?(S=L,Y):S},Y.nodata=function(L){return L!=null?(t=Oe(L),Y):t},Y}function z2(n,e,t){let r=[],i=n<e,s=e;for(let l=n;i?l<s:l>s;i?l++:l--)r.push(l);return r}const $2=function(n){let e=[1,1];for(let t=1;t<n;t++){let r=[1];for(let i=1;i<=e.length;i++)r[i]=(e[i]||0)+e[i-1];e=r}return e},j2=function(n){let e,t,r,i;if(n=n.map(s=>new ae(s)),n.length===2)[t,r]=n.map(s=>s.lab()),e=function(s){const l=[0,1,2].map(c=>t[c]+s*(r[c]-t[c]));return new ae(l,"lab")};else if(n.length===3)[t,r,i]=n.map(s=>s.lab()),e=function(s){const l=[0,1,2].map(c=>(1-s)*(1-s)*t[c]+2*(1-s)*s*r[c]+s*s*i[c]);return new ae(l,"lab")};else if(n.length===4){let s;[t,r,i,s]=n.map(l=>l.lab()),e=function(l){const c=[0,1,2].map(f=>(1-l)*(1-l)*(1-l)*t[f]+3*(1-l)*(1-l)*l*r[f]+3*(1-l)*l*l*i[f]+l*l*l*s[f]);return new ae(c,"lab")}}else if(n.length>=5){let s,l,c;s=n.map(f=>f.lab()),c=n.length-1,l=$2(c),e=function(f){const h=1-f,p=[0,1,2].map(_=>s.reduce((y,b,x)=>y+l[x]*h**(c-x)*f**x*b[_],0));return new ae(p,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return e},W2=n=>{const e=j2(n);return e.scale=()=>Ul(e),e},jn=(n,e,t)=>{if(!jn[t])throw new Error("unknown blend mode "+t);return jn[t](n,e)},ei=n=>(e,t)=>{const r=Oe(t).rgb(),i=Oe(e).rgb();return Oe.rgb(n(r,i))},ti=n=>(e,t)=>{const r=[];return r[0]=n(e[0],t[0]),r[1]=n(e[1],t[1]),r[2]=n(e[2],t[2]),r},H2=n=>n,X2=(n,e)=>n*e/255,Y2=(n,e)=>n>e?e:n,K2=(n,e)=>n>e?n:e,q2=(n,e)=>255*(1-(1-n/255)*(1-e/255)),Z2=(n,e)=>e<128?2*n*e/255:255*(1-2*(1-n/255)*(1-e/255)),Q2=(n,e)=>255*(1-(1-e/255)/(n/255)),J2=(n,e)=>n===255?255:(n=255*(e/255)/(1-n/255),n>255?255:n);jn.normal=ei(ti(H2));jn.multiply=ei(ti(X2));jn.screen=ei(ti(q2));jn.overlay=ei(ti(Z2));jn.darken=ei(ti(Y2));jn.lighten=ei(ti(K2));jn.dodge=ei(ti(J2));jn.burn=ei(ti(Q2));const{pow:G2,sin:eT,cos:tT}=Math;function nT(n=300,e=-1.5,t=1,r=1,i=[0,1]){let s=0,l;Be(i)==="array"?l=i[1]-i[0]:(l=0,i=[i,i]);const c=function(f){const h=dr*((n+120)/360+e*f),p=G2(i[0]+l*f,r),y=(s!==0?t[0]+f*s:t)*p*(1-p)/2,b=tT(h),x=eT(h),S=p+y*(-.14861*b+1.78277*x),C=p+y*(-.29227*b-.90649*x),P=p+y*(1.97294*b);return Oe(Cd([S*255,C*255,P*255,1]))};return c.start=function(f){return f==null?n:(n=f,c)},c.rotations=function(f){return f==null?e:(e=f,c)},c.gamma=function(f){return f==null?r:(r=f,c)},c.hue=function(f){return f==null?t:(t=f,Be(t)==="array"?(s=t[1]-t[0],s===0&&(t=t[1])):s=0,c)},c.lightness=function(f){return f==null?i:(Be(f)==="array"?(i=f,l=f[1]-f[0]):(i=[f,f],l=0),c)},c.scale=()=>Oe.scale(c),c.hue(t),c}const rT="0123456789abcdef",{floor:iT,random:sT}=Math,oT=()=>{let n="#";for(let e=0;e<6;e++)n+=rT.charAt(iT(sT()*16));return new ae(n,"hex")},{log:cm,pow:aT,floor:lT,abs:cT}=Math;function sv(n,e=null){const t={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return Be(n)==="object"&&(n=Object.values(n)),n.forEach(r=>{e&&Be(r)==="object"&&(r=r[e]),r!=null&&!isNaN(r)&&(t.values.push(r),t.sum+=r,r<t.min&&(t.min=r),r>t.max&&(t.max=r),t.count+=1)}),t.domain=[t.min,t.max],t.limits=(r,i)=>ov(t,r,i),t}function ov(n,e="equal",t=7){Be(n)=="array"&&(n=sv(n));const{min:r,max:i}=n,s=n.values.sort((c,f)=>c-f);if(t===1)return[r,i];const l=[];if(e.substr(0,1)==="c"&&(l.push(r),l.push(i)),e.substr(0,1)==="e"){l.push(r);for(let c=1;c<t;c++)l.push(r+c/t*(i-r));l.push(i)}else if(e.substr(0,1)==="l"){if(r<=0)throw new Error("Logarithmic scales are only possible for values > 0");const c=Math.LOG10E*cm(r),f=Math.LOG10E*cm(i);l.push(r);for(let h=1;h<t;h++)l.push(aT(10,c+h/t*(f-c)));l.push(i)}else if(e.substr(0,1)==="q"){l.push(r);for(let c=1;c<t;c++){const f=(s.length-1)*c/t,h=lT(f);if(h===f)l.push(s[h]);else{const p=f-h;l.push(s[h]*(1-p)+s[h+1]*p)}}l.push(i)}else if(e.substr(0,1)==="k"){let c;const f=s.length,h=new Array(f),p=new Array(t);let _=!0,y=0,b=null;b=[],b.push(r);for(let C=1;C<t;C++)b.push(r+C/t*(i-r));for(b.push(i);_;){for(let P=0;P<t;P++)p[P]=0;for(let P=0;P<f;P++){const z=s[P];let k=Number.MAX_VALUE,V;for(let Z=0;Z<t;Z++){const Y=cT(b[Z]-z);Y<k&&(k=Y,V=Z),p[V]++,h[P]=V}}const C=new Array(t);for(let P=0;P<t;P++)C[P]=null;for(let P=0;P<f;P++)c=h[P],C[c]===null?C[c]=s[P]:C[c]+=s[P];for(let P=0;P<t;P++)C[P]*=1/p[P];_=!1;for(let P=0;P<t;P++)if(C[P]!==b[P]){_=!0;break}b=C,y++,y>200&&(_=!1)}const x={};for(let C=0;C<t;C++)x[C]=[];for(let C=0;C<f;C++)c=h[C],x[c].push(s[C]);let S=[];for(let C=0;C<t;C++)S.push(x[C][0]),S.push(x[C][x[C].length-1]);S=S.sort((C,P)=>C-P),l.push(S[0]);for(let C=1;C<S.length;C+=2){const P=S[C];!isNaN(P)&&l.indexOf(P)===-1&&l.push(P)}}return l}const uT=(n,e)=>{n=new ae(n),e=new ae(e);const t=n.luminance(),r=e.luminance();return t>r?(t+.05)/(r+.05):(r+.05)/(t+.05)},{sqrt:hr,pow:mt,min:fT,max:hT,atan2:um,abs:fm,cos:ul,sin:hm,exp:dT,PI:dm}=Math;function pT(n,e,t=1,r=1,i=1){var s=function(re){return 360*re/(2*dm)},l=function(re){return 2*dm*re/360};n=new ae(n),e=new ae(e);const[c,f,h]=Array.from(n.lab()),[p,_,y]=Array.from(e.lab()),b=(c+p)/2,x=hr(mt(f,2)+mt(h,2)),S=hr(mt(_,2)+mt(y,2)),C=(x+S)/2,P=.5*(1-hr(mt(C,7)/(mt(C,7)+mt(25,7)))),z=f*(1+P),k=_*(1+P),V=hr(mt(z,2)+mt(h,2)),Z=hr(mt(k,2)+mt(y,2)),Y=(V+Z)/2,L=s(um(h,z)),E=s(um(y,k)),R=L>=0?L:L+360,N=E>=0?E:E+360,j=fm(R-N)>180?(R+N+360)/2:(R+N)/2,K=1-.17*ul(l(j-30))+.24*ul(l(2*j))+.32*ul(l(3*j+6))-.2*ul(l(4*j-63));let G=N-R;G=fm(G)<=180?G:N<=R?G+360:G-360,G=2*hr(V*Z)*hm(l(G)/2);const fe=p-c,Ce=Z-V,De=1+.015*mt(b-50,2)/hr(20+mt(b-50,2)),de=1+.045*Y,ne=1+.015*Y*K,ie=30*dT(-mt((j-275)/25,2)),M=-(2*hr(mt(Y,7)/(mt(Y,7)+mt(25,7))))*hm(2*l(ie)),Q=hr(mt(fe/(t*De),2)+mt(Ce/(r*de),2)+mt(G/(i*ne),2)+M*(Ce/(r*de))*(G/(i*ne)));return hT(0,fT(100,Q))}function gT(n,e,t="lab"){n=new ae(n),e=new ae(e);const r=n.get(t),i=e.get(t);let s=0;for(let l in r){const c=(r[l]||0)-(i[l]||0);s+=c*c}return Math.sqrt(s)}const _T=(...n)=>{try{return new ae(...n),!0}catch{return!1}},mT={cool(){return Ul([Oe.hsl(180,1,.9),Oe.hsl(250,.7,.4)])},hot(){return Ul(["#000","#f00","#ff0","#fff"]).mode("rgb")}},Il={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]};for(let n of Object.keys(Il))Il[n.toLowerCase()]=Il[n];Object.assign(Oe,{average:B2,bezier:W2,blend:jn,cubehelix:nT,mix:zo,interpolate:zo,random:oT,scale:Ul,analyze:sv,contrast:uT,deltaE:pT,distance:gT,limits:ov,valid:_T,scales:mT,input:Me,colors:Ss,brewer:Il});const yT=()=>{const n=[50,150,300,450,600,750],e=Oe.scale("viridis").domain([50,750]);return $t.jsxs("div",{style:{position:"absolute",bottom:20,left:20,background:"rgba(255,255,255,0.9)",padding:8,borderRadius:4},children:[$t.jsx("b",{children:"Voltage (kV)"}),$t.jsx("div",{style:{display:"flex"},children:n.map(t=>$t.jsxs("div",{style:{margin:"0 4px",textAlign:"center"},children:[$t.jsx("div",{style:{width:20,height:8,background:e(t).hex()}}),$t.jsx("span",{style:{fontSize:10},children:t})]},t))})]})};var ue=Rd();const pm=Ad(ue);function Vl(n,e){if(!n)throw new Error(e||"loader assertion failed.")}const Md=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),gm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);gm&&parseFloat(gm[1]);const _m=globalThis,mm=globalThis.process||{},vT=globalThis.navigator||{};function av(n){if(typeof window<"u"&&window.process?.type==="renderer"||typeof process<"u"&&process.versions?.electron)return!0;const t=typeof navigator<"u"&&navigator.userAgent;return!!(t&&t.indexOf("Electron")>=0)}function Pi(){return!(typeof process=="object"&&String(process)==="[object process]"&&!process?.browser)||av()}function bT(n){return Pi()?av()?"Electron":(vT.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node"}const lv="4.1.0";function wT(n){try{const e=window[n],t="__storage_test__";return e.setItem(t,t),e.removeItem(t),e}catch{return null}}class TT{constructor(e,t,r="sessionStorage"){this.storage=wT(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function xT(n){let e;return n<10?e=`${n.toFixed(2)}ms`:n<100?e=`${n.toFixed(1)}ms`:n<1e3?e=`${n.toFixed(0)}ms`:e=`${(n/1e3).toFixed(2)}s`,e}function ST(n,e=8){const t=Math.max(e-n.length,0);return`${" ".repeat(t)}${n}`}var zl;(function(n){n[n.BLACK=30]="BLACK",n[n.RED=31]="RED",n[n.GREEN=32]="GREEN",n[n.YELLOW=33]="YELLOW",n[n.BLUE=34]="BLUE",n[n.MAGENTA=35]="MAGENTA",n[n.CYAN=36]="CYAN",n[n.WHITE=37]="WHITE",n[n.BRIGHT_BLACK=90]="BRIGHT_BLACK",n[n.BRIGHT_RED=91]="BRIGHT_RED",n[n.BRIGHT_GREEN=92]="BRIGHT_GREEN",n[n.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",n[n.BRIGHT_BLUE=94]="BRIGHT_BLUE",n[n.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",n[n.BRIGHT_CYAN=96]="BRIGHT_CYAN",n[n.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(zl||(zl={}));const ET=10;function ym(n){return typeof n!="string"?n:(n=n.toUpperCase(),zl[n]||zl.WHITE)}function AT(n,e,t){return!Pi&&typeof n=="string"&&(e&&(n=`\x1B[${ym(e)}m${n}\x1B[39m`),t&&(n=`\x1B[${ym(t)+ET}m${n}\x1B[49m`)),n}function RT(n,e=["constructor"]){const t=Object.getPrototypeOf(n),r=Object.getOwnPropertyNames(t),i=n;for(const s of r){const l=i[s];typeof l=="function"&&(e.find(c=>s===c)||(i[s]=l.bind(n)))}}function Od(n,e){if(!n)throw new Error("Assertion failed")}function ls(){let n;if(Pi()&&_m.performance)n=_m?.performance?.now?.();else if("hrtime"in mm){const e=mm?.hrtime?.();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}const cs={debug:Pi()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},CT={enabled:!0,level:0};function us(){}const vm={},bm={once:!0};class Ko{constructor({id:e}={id:""}){this.VERSION=lv,this._startTs=ls(),this._deltaTs=ls(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new TT(`__probe-${this.id}__`,CT),this.timeStamp(`${this.id} started`),RT(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((ls()-this._startTs).toPrecision(10))}getDelta(){return Number((ls()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,cs.warn,arguments,bm)}error(e){return this._getLogFunction(0,e,cs.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,cs.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,cs.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,cs.debug||cs.info,arguments,bm)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||us,r&&[r],{tag:PT(t)}):us}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||us)}group(e,t,r={collapsed:!1}){const i=wm({logLevel:e,message:t,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||us)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=cv(e)}_getLogFunction(e,t,r,i,s){if(this._shouldLog(e)){s=wm({logLevel:e,message:t,args:i,opts:s}),r=r||s.method,Od(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=ls();const l=s.tag||s.message;if(s.once&&l)if(!vm[l])vm[l]=ls();else return us;return t=IT(this.id,s.message,s),r.bind(console,t,...s.args)}return us}}Ko.VERSION=lv;function cv(n){if(!n)return 0;let e;switch(typeof n){case"number":e=n;break;case"object":e=n.logLevel||n.priority||0;break;default:return 0}return Od(Number.isFinite(e)&&e>=0),e}function wm(n){const{logLevel:e,message:t}=n;n.logLevel=cv(e);const r=n.args?Array.from(n.args):[];for(;r.length&&r.shift()!==t;);switch(typeof e){case"string":case"function":t!==void 0&&r.unshift(t),n.message=e;break;case"object":Object.assign(n,e);break}typeof n.message=="function"&&(n.message=n.message());const i=typeof n.message;return Od(i==="string"||i==="object"),Object.assign(n,{args:r},n.opts)}function IT(n,e,t){if(typeof e=="string"){const r=t.time?ST(xT(t.total)):"";e=t.time?`${n}: ${r}  ${e}`:`${n}: ${e}`,e=AT(e,t.color,t.background)}return e}function PT(n){for(const e in n)for(const t in n[e])return t||"untitled";return"empty"}const Qf="4.3.3",kT=Qf[0]>="0"&&Qf[0]<="9"?`v${Qf}`:"";function MT(){const n=new Ko({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=n,globalThis.loaders.version=kT,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=n,n}const OT=MT();function NT(n,e){return uv(n||{},e)}function uv(n,e,t=0){if(t>3)return e;const r={...n};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=uv(r[i]||{},e[i],t+1):r[i]=e[i];return r}const DT="latest";function FT(){return globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const LT=FT();function Gr(n,e){if(!n)throw new Error(e||"loaders.gl assertion failed.")}const vi=typeof process!="object"||String(process)!=="[object process]"||process.browser,BT=typeof window<"u"&&typeof window.orientation<"u",Tm=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);Tm&&parseFloat(Tm[1]);class UT{constructor(e,t){w(this,"name");w(this,"workerThread");w(this,"isRunning",!0);w(this,"result");w(this,"_resolve",()=>{});w(this,"_reject",()=>{});this.name=e,this.workerThread=t,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Gr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Gr(this.isRunning),this.isRunning=!1,this._reject(e)}}class Jf{terminate(){}}const Gf=new Map;function VT(n){Gr(n.source&&!n.url||!n.source&&n.url);let e=Gf.get(n.source||n.url);return e||(n.url&&(e=zT(n.url),Gf.set(n.url,e)),n.source&&(e=fv(n.source),Gf.set(n.source,e))),Gr(e),e}function zT(n){if(!n.startsWith("http"))return n;const e=$T(n);return fv(e)}function fv(n){const e=new Blob([n],{type:"application/javascript"});return URL.createObjectURL(e)}function $T(n){return`try {
  importScripts('${n}');
} catch (error) {
  console.error(error);
  throw error;
}`}function hv(n,e=!0,t){const r=t||new Set;if(n){if(xm(n))r.add(n);else if(xm(n.buffer))r.add(n.buffer);else if(!ArrayBuffer.isView(n)){if(e&&typeof n=="object")for(const i in n)hv(n[i],e,r)}}return t===void 0?Array.from(r):[]}function xm(n){return n?n instanceof ArrayBuffer||typeof MessagePort<"u"&&n instanceof MessagePort||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas:!1}const eh=()=>{};class Fh{constructor(e){w(this,"name");w(this,"source");w(this,"url");w(this,"terminated",!1);w(this,"worker");w(this,"onMessage");w(this,"onError");w(this,"_loadableURL","");const{name:t,source:r,url:i}=e;Gr(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=eh,this.onError=s=>console.log(s),this.worker=vi?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&vi||typeof Jf<"u"&&!vi}destroy(){this.onMessage=eh,this.onError=eh,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||hv(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=VT({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=t=>{t.data?this.onMessage(t.data):this.onError(new Error("No data received"))},e.onerror=t=>{this.onError(this._getErrorFromErrorEvent(t)),this.terminated=!0},e.onmessageerror=t=>console.error(t),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Jf(r,{eval:!1})}else if(this.source)e=new Jf(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",t=>{this.onMessage(t)}),e.on("error",t=>{this.onError(t)}),e.on("exit",t=>{}),e}}class jT{constructor(e){w(this,"name","unnamed");w(this,"source");w(this,"url");w(this,"maxConcurrency",1);w(this,"maxMobileConcurrency",1);w(this,"onDebug",()=>{});w(this,"reuseWorkers",!0);w(this,"props",{});w(this,"jobQueue",[]);w(this,"idleQueue",[]);w(this,"count",0);w(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return Fh.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,t=(i,s,l)=>i.done(l),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const r=new UT(t.name,e);e.onMessage=i=>t.onMessage(r,i.type,i.payload),e.onError=i=>t.onError(r,i),t.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!vi||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Fh({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return BT?this.maxMobileConcurrency:this.maxConcurrency}}const WT={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Xr=class Xr{constructor(e){w(this,"props");w(this,"workerPools",new Map);this.props={...WT},this.setProps(e),this.workerPools=new Map}static isSupported(){return Fh.isSupported()}static getWorkerFarm(e={}){return Xr._workerFarm=Xr._workerFarm||new Xr({}),Xr._workerFarm.setProps(e),Xr._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const t of this.workerPools.values())t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:r,url:i}=e;let s=this.workerPools.get(t);return s||(s=new jT({name:t,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};w(Xr,"_workerFarm");let $l=Xr;function HT(n,e={}){const t=e[n.id]||{},r=vi?`${n.id}-worker.js`:`${n.id}-worker-node.js`;let i=t.workerUrl;if(!i&&n.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(vi?i=`modules/${n.module}/dist/${r}`:i=`modules/${n.module}/src/workers/${n.id}-worker-node.ts`),!i){let s=n.version;s==="latest"&&(s=DT);const l=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${n.module}${l}/dist/${r}`}return Gr(i),i}function XT(n,e=LT){Gr(n,"no worker provided");const t=n.version;return!(!e||!t)}function YT(n,e){return!$l.isSupported()||!vi&&!e?._nodeWorkers?!1:n.worker&&e?.worker}async function KT(n,e,t,r,i){const s=n.id,l=HT(n,t),f=$l.getWorkerFarm(t).getWorkerPool({name:s,url:l});t=JSON.parse(JSON.stringify(t)),r=JSON.parse(JSON.stringify(r||{}));const h=await f.startJob("process-on-worker",qT.bind(null,i));return h.postMessage("process",{input:e,options:t,context:r}),await(await h.result).result}async function qT(n,e,t,r){switch(t){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:l}=r;try{const c=await n(s,l);e.postMessage("done",{id:i,result:c})}catch(c){const f=c instanceof Error?c.message:"unknown error";e.postMessage("error",{id:i,error:f})}break;default:console.warn(`parse-with-worker unknown message ${t}`)}}function ZT(n,e,t){if(t=t||n.byteLength,n.byteLength<t||e.byteLength<t)return!1;const r=new Uint8Array(n),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function QT(...n){return JT(n)}function JT(n){const e=n.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),t=e.reduce((s,l)=>s+l.byteLength,0),r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function GT(n){const e=[];for await(const t of n)e.push(t);return QT(...e)}function Sm(){let n;if(typeof window<"u"&&window.performance)n=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();n=e[0]*1e3+e[1]/1e6}else n=Date.now();return n}class Em{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=Sm(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(Sm()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Oc{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const t of Object.values(this.stats))e(t)}getTable(){const e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(t=>this._getOrCreate(t))}_getOrCreate(e){const{name:t,type:r}=e;let i=this.stats[t];return i||(e instanceof Em?i=e:i=new Em(t,r),this.stats[t]=i),i}}let ex="";const Am={};function tx(n){for(const e in Am)if(n.startsWith(e)){const t=Am[e];n=n.replace(e,t)}return!n.startsWith("http://")&&!n.startsWith("https://")&&(n=`${ex}${n}`),n}function nx(n){return n&&typeof n=="object"&&n.isBuffer}function dv(n){if(nx(n))return n;if(n instanceof ArrayBuffer)return n;if(ArrayBuffer.isView(n))return n.byteOffset===0&&n.byteLength===n.buffer.byteLength?n.buffer:n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength);if(typeof n=="string"){const e=n;return new TextEncoder().encode(e).buffer}if(n&&typeof n=="object"&&n._toArrayBuffer)return n._toArrayBuffer();throw new Error("toArrayBuffer")}function pv(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(e+1):""}function rx(n){const e=n?n.lastIndexOf("/"):-1;return e>=0?n.substr(0,e):""}const ix=n=>typeof n=="boolean",Mo=n=>typeof n=="function",qo=n=>n!==null&&typeof n=="object",Rm=n=>qo(n)&&n.constructor==={}.constructor,sx=n=>!!n&&typeof n[Symbol.iterator]=="function",ox=n=>n&&typeof n[Symbol.asyncIterator]=="function",ki=n=>typeof Response<"u"&&n instanceof Response||n&&n.arrayBuffer&&n.text&&n.json,Mi=n=>typeof Blob<"u"&&n instanceof Blob,ax=n=>n&&typeof n=="object"&&n.isBuffer,lx=n=>typeof ReadableStream<"u"&&n instanceof ReadableStream||qo(n)&&Mo(n.tee)&&Mo(n.cancel)&&Mo(n.getReader),cx=n=>qo(n)&&Mo(n.read)&&Mo(n.pipe)&&ix(n.readable),gv=n=>lx(n)||cx(n);class ux extends Error{constructor(t,r){super(t);w(this,"reason");w(this,"url");w(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const fx=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,hx=/^([-\w.]+\/[-\w.+]+)/;function Cm(n,e){return n.toLowerCase()===e.toLowerCase()}function dx(n){const e=hx.exec(n);return e?e[1]:n}function Im(n){const e=fx.exec(n);return e?e[1]:""}const _v=/\?.*/;function px(n){const e=n.match(_v);return e&&e[0]}function Nd(n){return n.replace(_v,"")}function gx(n){if(n.length<50)return n;const e=n.slice(n.length-15);return`${n.substr(0,32)}...${e}`}function Nc(n){return ki(n)?n.url:Mi(n)?n.name||"":typeof n=="string"?n:""}function Dd(n){if(ki(n)){const e=n,t=e.headers.get("content-type")||"",r=Nd(e.url);return dx(t)||Im(r)}return Mi(n)?n.type||"":typeof n=="string"?Im(n):""}function _x(n){return ki(n)?n.headers["content-length"]||-1:Mi(n)?n.size:typeof n=="string"?n.length:n instanceof ArrayBuffer||ArrayBuffer.isView(n)?n.byteLength:-1}async function mv(n){if(ki(n))return n;const e={},t=_x(n);t>=0&&(e["content-length"]=String(t));const r=Nc(n),i=Dd(n);i&&(e["content-type"]=i);const s=await vx(n);s&&(e["x-first-bytes"]=s),typeof n=="string"&&(n=new TextEncoder().encode(n));const l=new Response(n,{headers:e});return Object.defineProperty(l,"url",{value:r}),l}async function mx(n){if(!n.ok)throw await yx(n)}async function yx(n){const e=gx(n.url);let t=`Failed to fetch resource (${n.status}) ${n.statusText}: ${e}`;t=t.length>100?`${t.slice(0,100)}...`:t;const r={reason:n.statusText,url:n.url,response:n};try{const i=n.headers.get("Content-Type");r.reason=!n.bodyUsed&&i?.includes("application/json")?await n.json():await n.text()}catch{}return new ux(t,r)}async function vx(n){if(typeof n=="string")return`data:,${n.slice(0,5)}`;if(n instanceof Blob){const t=n.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>r(s?.target?.result),i.readAsDataURL(t)})}if(n instanceof ArrayBuffer){const t=n.slice(0,5);return`data:base64,${bx(t)}`}return null}function bx(n){let e="";const t=new Uint8Array(n);for(let r=0;r<t.byteLength;r++)e+=String.fromCharCode(t[r]);return btoa(e)}function wx(n){return!Tx(n)&&!xx(n)}function Tx(n){return n.startsWith("http:")||n.startsWith("https:")}function xx(n){return n.startsWith("data:")}async function Pm(n,e){if(typeof n=="string"){const t=tx(n);return wx(t)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(t,e):await fetch(t,e)}return await mv(n)}const km=new Ko({id:"loaders.gl"});class Sx{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Ex{constructor(){w(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const yv={fetch:null,mimeType:void 0,nothrow:!1,log:new Ex,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Md,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Ax={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function vv(){globalThis.loaders=globalThis.loaders||{};const{loaders:n}=globalThis;return n._state||(n._state={}),n._state}function bv(){const n=vv();return n.globalOptions=n.globalOptions||{...yv},n.globalOptions}function Rx(n,e,t,r){return t=t||[],t=Array.isArray(t)?t:[t],Cx(n,t),Px(e,n,r)}function Cx(n,e){Mm(n,null,yv,Ax,e);for(const t of e){const r=n&&n[t.id]||{},i=t.options&&t.options[t.id]||{},s=t.deprecatedOptions&&t.deprecatedOptions[t.id]||{};Mm(r,t.id,i,s,e)}}function Mm(n,e,t,r,i){const s=e||"Top level",l=e?`${e}.`:"";for(const c in n){const f=!e&&qo(n[c]),h=c==="baseUri"&&!e,p=c==="workerUrl"&&e;if(!(c in t)&&!h&&!p){if(c in r)km.warn(`${s} loader option '${l}${c}' no longer supported, use '${r[c]}'`)();else if(!f){const _=Ix(c,i);km.warn(`${s} loader option '${l}${c}' not recognized. ${_}`)()}}}}function Ix(n,e){const t=n.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(n===s)return`Did you mean '${i.id}.${s}'?`;const l=s.toLowerCase();(t.startsWith(l)||l.startsWith(t))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function Px(n,e,t){const i={...n.options||{}};return kx(i,t),i.log===null&&(i.log=new Sx),Om(i,bv()),Om(i,e),i}function Om(n,e){for(const t in e)if(t in e){const r=e[t];Rm(r)&&Rm(n[t])?n[t]={...n[t],...e[t]}:n[t]=e[t]}}function kx(n,e){e&&!("baseUri"in n)&&(n.baseUri=e)}function Fd(n){return n?(Array.isArray(n)&&(n=n[0]),Array.isArray(n?.extensions)):!1}function Ld(n){Vl(n,"null loader"),Vl(Fd(n),"invalid loader");let e;return Array.isArray(n)&&(e=n[1],n=n[0],n={...n,options:{...n.options,...e}}),(n?.parseTextSync||n?.parseText)&&(n.text=!0),n.text||(n.binary=!0),n}const wv=()=>{const n=vv();return n.loaderRegistry=n.loaderRegistry||[],n.loaderRegistry};function Mx(n){const e=wv();n=Array.isArray(n)?n:[n];for(const t of n){const r=Ld(t);e.find(i=>r===i)||e.unshift(r)}}function Ox(){return wv()}const Nx=/\.([^.]+)$/;async function Dx(n,e=[],t,r){if(!Tv(n))return null;let i=Nm(n,e,{...t,nothrow:!0},r);if(i)return i;if(Mi(n)&&(n=await n.slice(0,10).arrayBuffer(),i=Nm(n,e,t,r)),!i&&!t?.nothrow)throw new Error(xv(n));return i}function Nm(n,e=[],t,r){if(!Tv(n))return null;if(e&&!Array.isArray(e))return Ld(e);let i=[];e&&(i=i.concat(e)),t?.ignoreRegisteredLoaders||i.push(...Ox()),Lx(i);const s=Fx(n,i,t,r);if(!s&&!t?.nothrow)throw new Error(xv(n));return s}function Fx(n,e,t,r){const i=Nc(n),s=Dd(n),l=Nd(i)||r?.url;let c=null,f="";return t?.mimeType&&(c=th(e,t?.mimeType),f=`match forced by supplied MIME type ${t?.mimeType}`),c=c||Bx(e,l),f=f||(c?`matched url ${l}`:""),c=c||th(e,s),f=f||(c?`matched MIME type ${s}`:""),c=c||Vx(e,n),f=f||(c?`matched initial data ${Sv(n)}`:""),t?.fallbackMimeType&&(c=c||th(e,t?.fallbackMimeType),f=f||(c?`matched fallback MIME type ${s}`:"")),f&&OT.log(1,`selectLoader selected ${c?.name}: ${f}.`),c}function Tv(n){return!(n instanceof Response&&n.status===204)}function xv(n){const e=Nc(n),t=Dd(n);let r="No valid loader found (";r+=e?`${pv(e)}, `:"no url provided, ",r+=`MIME type: ${t?`"${t}"`:"not provided"}, `;const i=n?Sv(n):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function Lx(n){for(const e of n)Ld(e)}function Bx(n,e){const t=e&&Nx.exec(e),r=t&&t[1];return r?Ux(n,r):null}function Ux(n,e){e=e.toLowerCase();for(const t of n)for(const r of t.extensions)if(r.toLowerCase()===e)return t;return null}function th(n,e){for(const t of n)if(t.mimeTypes?.some(r=>Cm(e,r))||Cm(e,`application/x.${t.id}`))return t;return null}function Vx(n,e){if(!e)return null;for(const t of n)if(typeof e=="string"){if(zx(e,t))return t}else if(ArrayBuffer.isView(e)){if(Dm(e.buffer,e.byteOffset,t))return t}else if(e instanceof ArrayBuffer&&Dm(e,0,t))return t;return null}function zx(n,e){return e.testText?e.testText(n):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>n.startsWith(r))}function Dm(n,e,t){return(Array.isArray(t.tests)?t.tests:[t.tests]).some(i=>$x(n,e,t,i))}function $x(n,e,t,r){if(r instanceof ArrayBuffer)return ZT(r,n,r.byteLength);switch(typeof r){case"function":return r(n);case"string":const i=Lh(n,e,r.length);return r===i;default:return!1}}function Sv(n,e=5){return typeof n=="string"?n.slice(0,e):ArrayBuffer.isView(n)?Lh(n.buffer,n.byteOffset,e):n instanceof ArrayBuffer?Lh(n,0,e):""}function Lh(n,e,t){if(n.byteLength<e+t)return"";const r=new DataView(n);let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const jx=256*1024;function*Wx(n,e){const t=e?.chunkSize||jx;let r=0;const i=new TextEncoder;for(;r<n.length;){const s=Math.min(n.length-r,t),l=n.slice(r,r+s);r+=s,yield i.encode(l)}}const Hx=256*1024;function*Xx(n,e={}){const{chunkSize:t=Hx}=e;let r=0;for(;r<n.byteLength;){const i=Math.min(n.byteLength-r,t),s=new ArrayBuffer(i),l=new Uint8Array(n,r,i);new Uint8Array(s).set(l),r+=i,yield s}}const Yx=1024*1024;async function*Kx(n,e){const t=e?.chunkSize||Yx;let r=0;for(;r<n.size;){const i=r+t,s=await n.slice(r,i).arrayBuffer();r=i,yield s}}function Fm(n,e){return Md?qx(n,e):Zx(n)}async function*qx(n,e){const t=n.getReader();let r;try{for(;;){const i=r||t.read();e?._streamReadAhead&&(r=t.read());const{done:s,value:l}=await i;if(s)return;yield dv(l)}}catch{t.releaseLock()}}async function*Zx(n,e){for await(const t of n)yield dv(t)}function Qx(n,e){if(typeof n=="string")return Wx(n,e);if(n instanceof ArrayBuffer)return Xx(n,e);if(Mi(n))return Kx(n,e);if(gv(n))return Fm(n,e);if(ki(n))return Fm(n.body,e);throw new Error("makeIterator")}const Ev="Cannot convert supplied data type";function Jx(n,e,t){if(e.text&&typeof n=="string")return n;if(ax(n)&&(n=n.buffer),n instanceof ArrayBuffer){const r=n;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(n)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(n);let r=n.buffer;const i=n.byteLength||n.length;return(n.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(n.byteOffset,n.byteOffset+i)),r}throw new Error(Ev)}async function Gx(n,e,t){const r=n instanceof ArrayBuffer||ArrayBuffer.isView(n);if(typeof n=="string"||r)return Jx(n,e);if(Mi(n)&&(n=await mv(n)),ki(n)){const i=n;return await mx(i),e.binary?await i.arrayBuffer():await i.text()}if(gv(n)&&(n=Qx(n,t)),sx(n)||ox(n))return GT(n);throw new Error(Ev)}function Av(n,e){const t=bv(),r=n||t;return typeof r.fetch=="function"?r.fetch:qo(r.fetch)?i=>Pm(i,r.fetch):e?.fetch?e?.fetch:Pm}function eS(n,e,t){if(t)return t;const r={fetch:Av(e,n),...n};if(r.url){const i=Nd(r.url);r.baseUrl=i,r.queryString=px(r.url),r.filename=pv(i),r.baseUrl=rx(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function tS(n,e){if(n&&!Array.isArray(n))return n;let t;if(n&&(t=Array.isArray(n)?n:[n]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];t=t?[...t,...r]:r}return t&&t.length?t:void 0}async function jl(n,e,t,r){e&&!Array.isArray(e)&&!Fd(e)&&(r=void 0,t=e,e=void 0),n=await n,t=t||{};const i=Nc(n),l=tS(e,r),c=await Dx(n,l,t);return c?(t=Rx(t,c,l,i),r=eS({url:i,_parse:jl,loaders:l},t,r||null),await nS(c,n,t,r)):null}async function nS(n,e,t,r){if(XT(n),t=NT(n.options,t),ki(e)){const s=e,{ok:l,redirected:c,status:f,statusText:h,type:p,url:_}=s,y=Object.fromEntries(s.headers.entries());r.response={headers:y,ok:l,redirected:c,status:f,statusText:h,type:p,url:_}}e=await Gx(e,n,t);const i=n;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,t,r);if(YT(n,t))return await KT(n,e,t,r,jl);if(i.parseText&&typeof e=="string")return await i.parseText(e,t,r);if(i.parse)return await i.parse(e,t,r);throw Gr(!i.parseSync),new Error(`${n.id} loader - no parser found and worker is disabled`)}function rS(n){let e=1/0,t=1/0,r=1/0,i=-1/0,s=-1/0,l=-1/0;const c=n.POSITION?n.POSITION.value:[],f=c&&c.length;for(let h=0;h<f;h+=3){const p=c[h],_=c[h+1],y=c[h+2];e=p<e?p:e,t=_<t?_:t,r=y<r?y:r,i=p>i?p:i,s=_>s?_:s,l=y>l?y:l}return[[e,t,r],[i,s,l]]}async function Bh(n,e,t,r){let i,s;!Array.isArray(e)&&!Fd(e)?(i=[],s=e):(i=e,s=t);const l=Av(s);let c=n;return typeof n=="string"&&(c=await l(n)),Mi(n)&&(c=await l(n)),Array.isArray(i)?await jl(c,i,s):await jl(c,i,s)}const iS="4.3.3",sS=globalThis.loaders?.parseImageNode,Uh=typeof Image<"u",Vh=typeof ImageBitmap<"u",oS=!!sS,zh=Md?!0:oS;function aS(n){switch(n){case"auto":return Vh||Uh||zh;case"imagebitmap":return Vh;case"image":return Uh;case"data":return zh;default:throw new Error(`@loaders.gl/images: image ${n} not supported in this environment`)}}function lS(){if(Vh)return"imagebitmap";if(Uh)return"image";if(zh)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function cS(n){const e=fS(n);if(!e)throw new Error("Not an image");return e}function uS(n){switch(cS(n)){case"data":return n;case"image":case"imagebitmap":const e=document.createElement("canvas"),t=e.getContext("2d");if(!t)throw new Error("getImageData");return e.width=n.width,e.height=n.height,t.drawImage(n,0,0),t.getImageData(0,0,n.width,n.height);default:throw new Error("getImageData")}}function fS(n){return typeof ImageBitmap<"u"&&n instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&n instanceof Image?"image":n&&typeof n=="object"&&n.data&&n.width&&n.height?"data":null}const hS=/^data:image\/svg\+xml/,dS=/\.svg((\?|#).*)?$/;function Bd(n){return n&&(hS.test(n)||dS.test(n))}function pS(n,e){if(Bd(e)){let r=new TextDecoder().decode(n);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return Rv(n,e)}function Rv(n,e){if(Bd(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(n)])}async function Cv(n,e,t){const r=pS(n,t),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await gS(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function gS(n,e){const t=new Image;return t.src=n,e.image&&e.image.decode&&t.decode?(await t.decode(),t):await new Promise((r,i)=>{try{t.onload=()=>r(t),t.onerror=s=>{const l=s instanceof Error?s.message:"error";i(new Error(l))}}catch(s){i(s)}})}const _S={};let Lm=!0;async function mS(n,e,t){let r;Bd(t)?r=await Cv(n,e,t):r=Rv(n,t);const i=e&&e.imagebitmap;return await yS(r,i)}async function yS(n,e=null){if((vS(e)||!Lm)&&(e=null),e)try{return await createImageBitmap(n,e)}catch(t){console.warn(t),Lm=!1}return await createImageBitmap(n)}function vS(n){for(const e in n||_S)return!1;return!0}function bS(n){return!SS(n,"ftyp",4)||(n[8]&96)===0?null:wS(n)}function wS(n){switch(TS(n,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function TS(n,e,t){return String.fromCharCode(...n.slice(e,t))}function xS(n){return[...n].map(e=>e.charCodeAt(0))}function SS(n,e,t=0){const r=xS(e);for(let i=0;i<r.length;++i)if(r[i]!==n[i+t])return!1;return!0}const er=!1,Oo=!0;function Iv(n){const e=Zo(n);return AS(e)||IS(e)||RS(e)||CS(e)||ES(e)}function ES(n){const e=new Uint8Array(n instanceof DataView?n.buffer:n),t=bS(e);return t?{mimeType:t.mimeType,width:0,height:0}:null}function AS(n){const e=Zo(n);return e.byteLength>=24&&e.getUint32(0,er)===2303741511?{mimeType:"image/png",width:e.getUint32(16,er),height:e.getUint32(20,er)}:null}function RS(n){const e=Zo(n);return e.byteLength>=10&&e.getUint32(0,er)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Oo),height:e.getUint16(8,Oo)}:null}function CS(n){const e=Zo(n);return e.byteLength>=14&&e.getUint16(0,er)===16973&&e.getUint32(2,Oo)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Oo),height:e.getUint32(22,Oo)}:null}function IS(n){const e=Zo(n);if(!(e.byteLength>=3&&e.getUint16(0,er)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=PS();let s=2;for(;s+9<e.byteLength;){const l=e.getUint16(s,er);if(i.has(l))return{mimeType:"image/jpeg",height:e.getUint16(s+5,er),width:e.getUint16(s+7,er)};if(!r.has(l))return null;s+=2,s+=e.getUint16(s,er)}return null}function PS(){const n=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)n.add(t);return{tableMarkers:n,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Zo(n){if(n instanceof DataView)return n;if(ArrayBuffer.isView(n))return new DataView(n.buffer);if(n instanceof ArrayBuffer)return new DataView(n);throw new Error("toDataView")}async function kS(n,e){const{mimeType:t}=Iv(n)||{},r=globalThis.loaders?.parseImageNode;return Vl(r),await r(n,t)}async function MS(n,e,t){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=t||{},l=OS(i);let c;switch(l){case"imagebitmap":c=await mS(n,e,s);break;case"image":c=await Cv(n,e,s);break;case"data":c=await kS(n);break;default:Vl(!1)}return i==="data"&&(c=uS(c)),c}function OS(n){switch(n){case"auto":case"data":return lS();default:return aS(n),n}}const NS=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],DS=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],FS={image:{type:"auto",decode:!0}},LS={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:iS,mimeTypes:DS,extensions:NS,parse:MS,tests:[n=>!!Iv(new DataView(n))],options:FS},Je=new Ko({id:"deck"});let $h={};function BS(n){$h=n}function qt(n,e,t,r){Je.level>0&&$h[n]&&$h[n].call(null,e,t,r)}function US(n){const e=n[0],t=n[n.length-1];return e==="{"&&t==="}"||e==="["&&t==="]"}const VS={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:US,parseTextSync:JSON.parse};function zS(){const n="9.1.12",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==n)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${n}`);return e||(Je.log(1,`deck.gl ${n}`)(),globalThis.deck={...globalThis.deck,VERSION:n,version:n,log:Je,_registerLoggers:BS},Mx([VS,[LS,{imagebitmap:{premultiplyAlpha:"none"}}]])),n}const $S=zS();function Ud(n,e){if(!n)throw new Error(e||"shadertools: assertion failed.")}const nh={number:{type:"number",validate(n,e){return Number.isFinite(n)&&typeof e=="object"&&(e.max===void 0||n<=e.max)&&(e.min===void 0||n>=e.min)}},array:{type:"array",validate(n,e){return Array.isArray(n)||ArrayBuffer.isView(n)}}};function jS(n){const e={};for(const[t,r]of Object.entries(n))e[t]=WS(r);return e}function WS(n){let e=Bm(n);if(e!=="object")return{value:n,...nh[e],type:e};if(typeof n=="object")return n?n.type!==void 0?{...n,...nh[n.type],type:n.type}:n.value===void 0?{type:"object",value:n}:(e=Bm(n.value),{...n,...nh[e],type:e}):{type:"object",value:null};throw new Error("props")}function Bm(n){return Array.isArray(n)||ArrayBuffer.isView(n)?"array":typeof n}const HS=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,XS=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,YS={vertex:HS,fragment:XS},Um=/void\s+main\s*\([^)]*\)\s*\{\n?/,Vm=/}\n?[^{}]*$/,rh=[],Pl="__LUMA_INJECT_DECLARATIONS__";function KS(n){const e={vertex:{},fragment:{}};for(const t in n){let r=n[t];const i=qS(t);typeof r=="string"&&(r={order:0,injection:r}),e[i][t]=r}return e}function qS(n){const e=n.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Wl(n,e,t,r=!1){const i=e==="vertex";for(const s in t){const l=t[s];l.sort((f,h)=>f.order-h.order),rh.length=l.length;for(let f=0,h=l.length;f<h;++f)rh[f]=l[f].injection;const c=`${rh.join(`
`)}
`;switch(s){case"vs:#decl":i&&(n=n.replace(Pl,c));break;case"vs:#main-start":i&&(n=n.replace(Um,f=>f+c));break;case"vs:#main-end":i&&(n=n.replace(Vm,f=>c+f));break;case"fs:#decl":i||(n=n.replace(Pl,c));break;case"fs:#main-start":i||(n=n.replace(Um,f=>f+c));break;case"fs:#main-end":i||(n=n.replace(Vm,f=>c+f));break;default:n=n.replace(s,f=>f+c)}}return n=n.replace(Pl,""),r&&(n=n.replace(/\}\s*$/,s=>s+YS[e])),n}function Hl(n){n.map(e=>ZS(e))}function ZS(n){if(n.instance)return;Hl(n.dependencies||[]);const{propTypes:e={},deprecations:t=[],inject:r={}}=n,i={normalizedInjections:KS(r),parsedDeprecations:QS(t)};e&&(i.propValidators=jS(e)),n.instance=i;let s={};e&&(s=Object.entries(e).reduce((l,[c,f])=>{const h=f?.value;return h&&(l[c]=h),l},{})),n.defaultUniforms={...n.defaultUniforms,...s}}function Pv(n,e,t){n.deprecations?.forEach(r=>{r.regex?.test(e)&&(r.deprecated?t.deprecated(r.old,r.new)():t.removed(r.old,r.new)())})}function QS(n){return n.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),n}function Vd(n){Hl(n);const e={},t={};kv({modules:n,level:0,moduleMap:e,moduleDepth:t});const r=Object.keys(t).sort((i,s)=>t[s]-t[i]).map(i=>e[i]);return Hl(r),r}function kv(n){const{modules:e,level:t,moduleMap:r,moduleDepth:i}=n;if(t>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<t)&&(i[s.name]=t);for(const s of e)s.dependencies&&kv({modules:s.dependencies,level:t+1,moduleMap:r,moduleDepth:i})}function JS(n){switch(n?.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function GS(n,e){if(Number(n.match(/^#version[ \t]+(\d+)/m)?.[1]||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return n=zm(n,eE),n;case"fragment":return n=zm(n,tE),n;default:throw new Error(e)}}const Mv=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],eE=[...Mv,[jh("attribute"),"in $1"],[jh("varying"),"out $1"]],tE=[...Mv,[jh("varying"),"in $1"]];function zm(n,e){for(const[t,r]of e)n=n.replace(t,r);return n}function jh(n){return new RegExp(`\\b${n}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function Ov(n,e){let t="";for(const r in n){const i=n[r];if(t+=`void ${i.signature} {
`,i.header&&(t+=`  ${i.header}`),e[r]){const s=e[r];s.sort((l,c)=>l.order-c.order);for(const l of s)t+=`  ${l.injection}
`}i.footer&&(t+=`  ${i.footer}`),t+=`}
`}return t}function Nv(n){const e={vertex:{},fragment:{}};for(const t of n){let r,i;typeof t!="string"?(r=t,i=r.hook):(r={},i=t),i=i.trim();const[s,l]=i.split(":"),c=i.replace(/\(.+/,""),f=Object.assign(r,{signature:l});switch(s){case"vs":e.vertex[c]=f;break;case"fs":e.fragment[c]=f;break;default:throw new Error(s)}}return e}function nE(n,e){return{name:rE(n,e),language:"glsl",version:iE(n)}}function rE(n,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(n);return r?r[1]:e}function iE(n){let e=100;const t=n.match(/[^\s]+/g);if(t&&t.length>=2&&t[0]==="#version"){const r=parseInt(t[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const Dv=`

${Pl}
`,sE=`precision highp float;
`;function oE(n){const e=Vd(n.modules||[]);return{source:lE(n.platformInfo,{...n,source:n.source,stage:"vertex",modules:e}),getUniforms:Fv(e)}}function aE(n){const{vs:e,fs:t}=n,r=Vd(n.modules||[]);return{vs:$m(n.platformInfo,{...n,source:e,stage:"vertex",modules:r}),fs:$m(n.platformInfo,{...n,source:t,stage:"fragment",modules:r}),getUniforms:Fv(r)}}function lE(n,e){const{source:t,stage:r,modules:i,hookFunctions:s=[],inject:l={},log:c}=e;Ud(typeof t=="string","shader source must be a string");const f=t;let h="";const p=Nv(s),_={},y={},b={};for(const S in l){const C=typeof l[S]=="string"?{injection:l[S],order:0}:l[S],P=/^(v|f)s:(#)?([\w-]+)$/.exec(S);if(P){const z=P[2],k=P[3];z?k==="decl"?y[S]=[C]:b[S]=[C]:_[S]=[C]}else b[S]=[C]}const x=i;for(const S of x){c&&Pv(S,f,c);const C=Lv(S,"wgsl");h+=C;const P=S.injections?.[r]||{};for(const z in P){const k=/^(v|f)s:#([\w-]+)$/.exec(z);if(k){const Z=k[2]==="decl"?y:b;Z[z]=Z[z]||[],Z[z].push(P[z])}else _[z]=_[z]||[],_[z].push(P[z])}}return h+=Dv,h=Wl(h,r,y),h+=Ov(p[r],_),h+=f,h=Wl(h,r,b),h}function $m(n,e){const{id:t,source:r,stage:i,language:s="glsl",modules:l,defines:c={},hookFunctions:f=[],inject:h={},prologue:p=!0,log:_}=e;Ud(typeof r=="string","shader source must be a string");const y=s==="glsl"?nE(r).version:-1,b=n.shaderLanguageVersion,x=y===100?"#version 100":"#version 300 es",C=r.split(`
`).slice(1).join(`
`),P={};l.forEach(L=>{Object.assign(P,L.defines)}),Object.assign(P,c);let z="";switch(s){case"wgsl":break;case"glsl":z=p?`${x}

// ----- PROLOGUE -------------------------
${cE({id:t,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${JS(n)}
${i==="fragment"?sE:""}

// ----- APPLICATION DEFINES -------------------------

${uE(P)}

`:`${x}
`;break}const k=Nv(f),V={},Z={},Y={};for(const L in h){const E=typeof h[L]=="string"?{injection:h[L],order:0}:h[L],R=/^(v|f)s:(#)?([\w-]+)$/.exec(L);if(R){const N=R[2],j=R[3];N?j==="decl"?Z[L]=[E]:Y[L]=[E]:V[L]=[E]}else Y[L]=[E]}for(const L of l){_&&Pv(L,C,_);const E=Lv(L,i);z+=E;const R=L.instance?.normalizedInjections[i]||{};for(const N in R){const j=/^(v|f)s:#([\w-]+)$/.exec(N);if(j){const G=j[2]==="decl"?Z:Y;G[N]=G[N]||[],G[N].push(R[N])}else V[N]=V[N]||[],V[N].push(R[N])}}return z+="// ----- MAIN SHADER SOURCE -------------------------",z+=Dv,z=Wl(z,i,Z),z+=Ov(k[i],V),z+=C,z=Wl(z,i,Y),s==="glsl"&&y!==b&&(z=GS(z,i)),z.trim()}function Fv(n){return function(t){const r={};for(const i of n){const s=i.getUniforms?.(t,r);Object.assign(r,s)}return r}}function cE(n){const{id:e,source:t,stage:r}=n;return e&&t.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function uE(n={}){let e="";for(const t in n){const r=n[t];(r||Number.isFinite(r))&&(e+=`#define ${t.toUpperCase()} ${n[t]}
`)}return e}function Lv(n,e){let t;switch(e){case"vertex":t=n.vs||"";break;case"fragment":t=n.fs||"";break;case"wgsl":t=n.source||"";break;default:Ud(!1)}if(!n.name)throw new Error("Shader module must have a name");const r=n.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${n.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${t}
`,i}const fE=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,hE=/^\s*\#\s*endif\s*$/;function dE(n,e){const t=n.split(`
`),r=[];let i=!0,s=null;for(const l of t){const c=l.match(fE),f=l.match(hE);c?(s=c[1],i=!!e?.defines?.[s]):f?i=!0:i&&r.push(l)}return r.join(`
`)}const mi=class mi{constructor(){w(this,"_hookFunctions",[]);w(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return mi.defaultShaderAssembler=mi.defaultShaderAssembler||new mi,mi.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const t=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const t=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=oE({...e,source:e.source,modules:t,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?dE(i):i,getUniforms:s,modules:t}}assembleGLSLShaderPair(e){const t=this._getModuleList(e.modules),r=this._hookFunctions;return{...aE({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){const t=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,l=this._defaultModules.length;s<l;++s){const c=this._defaultModules[s],f=c.name;t[i++]=c,r[f]=!0}for(let s=0,l=e.length;s<l;++s){const c=e[s],f=c.name;r[f]||(t[i++]=c,r[f]=!0)}return t.length=i,Hl(t),t}};w(mi,"defaultShaderAssembler");let Xl=mi;const pE=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,gE=`#version 300 es
${pE}`;function _E(n){const{input:e,inputChannels:t,output:r}={};if(!e)return gE;if(!t)throw new Error("inputChannels");const i=mE(t),s=yE(e,t);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function mE(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${n}`)}}function yE(n,e){switch(e){case 1:return`vec4(${n}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${n}, 0.0, 1.0)`;case 3:return`vec4(${n}, 1.0)`;case 4:return n;default:throw new Error(`invalid channels: ${e}`)}}class vE{constructor(){w(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Oc({id:e})),this.stats.get(e)}}const Bv=new vE,oe=new Ko({id:"luma.gl"}),ih={};function Dc(n="id"){ih[n]=ih[n]||1;const e=ih[n]++;return`${n}-${e}`}var Nh;let Ze=(Nh=class{constructor(e,t,r){w(this,"id");w(this,"props");w(this,"userData",{});w(this,"_device");w(this,"destroyed",!1);w(this,"allocatedBytes",0);w(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=bE(t,r);const i=this.props.id!=="undefined"?this.props.id:Dc(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}},w(Nh,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Nh);function bE(n,e){const t={...e};for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}const Ot=class Ot extends Ze{constructor(t,r){const i={...r};(r.usage||0)&Ot.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(t,i,Ot.defaultProps);w(this,"usage");w(this,"indexType");w(this,"updateTimestamp");w(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(t){return this.device.createBuffer({...this.props,...t})}readSyncWebGL(t,r){throw new Error("not implemented")}_setDebugData(t,r,i){const s=ArrayBuffer.isView(t)?t.buffer:t,l=Math.min(t?t.byteLength:i,Ot.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(l):r===0&&i===s.byteLength?this.debugData=s.slice(0,l):this.debugData=s.slice(r,r+l)}};w(Ot,"defaultProps",{...Ze.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),w(Ot,"MAP_READ",1),w(Ot,"MAP_WRITE",2),w(Ot,"COPY_SRC",4),w(Ot,"COPY_DST",8),w(Ot,"INDEX",16),w(Ot,"VERTEX",32),w(Ot,"UNIFORM",64),w(Ot,"STORAGE",128),w(Ot,"INDIRECT",256),w(Ot,"QUERY_RESOLVE",512),w(Ot,"DEBUG_DATA_MAX_LENGTH",32);let st=Ot;function Uv(n){const e=jm[n],t=wE(e),r=n.includes("norm"),i=!r&&!n.startsWith("float"),s=n.startsWith("s");return{dataType:jm[n],byteLength:t,integer:i,signed:s,normalized:r}}function wE(n){return TE[n]}const jm={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},TE={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},Ut="texture-compression-bc",qe="texture-compression-astc",Zn="texture-compression-etc2",xE="texture-compression-etc1-webgl",fl="texture-compression-pvrtc-webgl",sh="texture-compression-atc-webgl",hl="float32-renderable-webgl",oh="float16-renderable-webgl",SE="rgb9e5ufloat-renderable-webgl",ah="snorm8-renderable-webgl",xo="norm16-renderable-webgl",lh="snorm16-renderable-webgl",dl="float32-filterable",Wm="float16-filterable-webgl";function Vv(n){const e=EE[n];if(!e)throw new Error(`Unsupported texture format ${n}`);return e}const EE={r8unorm:{},r8snorm:{render:ah},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:ah},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:oh,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:xo},"r16snorm-webgl":{f:lh},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:ah},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:oh,filter:Wm},"rg16unorm-webgl":{render:xo},"rg16snorm-webgl":{render:lh},r32uint:{},r32sint:{},r32float:{render:hl,filter:dl},rgb9e5ufloat:{channels:"rgb",packed:!0,render:SE},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:hl},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:xo},"rgb16snorm-webgl":{f:xo},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:dl},rgba16uint:{},rgba16sint:{},rgba16float:{render:oh,filter:Wm},"rgba16unorm-webgl":{render:xo},"rgba16snorm-webgl":{render:lh},"rgb32float-webgl":{render:hl,filter:dl},rgba32uint:{},rgba32sint:{},rgba32float:{render:hl,filter:dl},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:Ut},"bc1-rgb-unorm-srgb-webgl":{f:Ut},"bc1-rgba-unorm":{f:Ut},"bc1-rgba-unorm-srgb":{f:Ut},"bc2-rgba-unorm":{f:Ut},"bc2-rgba-unorm-srgb":{f:Ut},"bc3-rgba-unorm":{f:Ut},"bc3-rgba-unorm-srgb":{f:Ut},"bc4-r-unorm":{f:Ut},"bc4-r-snorm":{f:Ut},"bc5-rg-unorm":{f:Ut},"bc5-rg-snorm":{f:Ut},"bc6h-rgb-ufloat":{f:Ut},"bc6h-rgb-float":{f:Ut},"bc7-rgba-unorm":{f:Ut},"bc7-rgba-unorm-srgb":{f:Ut},"etc2-rgb8unorm":{f:Zn},"etc2-rgb8unorm-srgb":{f:Zn},"etc2-rgb8a1unorm":{f:Zn},"etc2-rgb8a1unorm-srgb":{f:Zn},"etc2-rgba8unorm":{f:Zn},"etc2-rgba8unorm-srgb":{f:Zn},"eac-r11unorm":{f:Zn},"eac-r11snorm":{f:Zn},"eac-rg11unorm":{f:Zn},"eac-rg11snorm":{f:Zn},"astc-4x4-unorm":{f:qe},"astc-4x4-unorm-srgb":{f:qe},"astc-5x4-unorm":{f:qe},"astc-5x4-unorm-srgb":{f:qe},"astc-5x5-unorm":{f:qe},"astc-5x5-unorm-srgb":{f:qe},"astc-6x5-unorm":{f:qe},"astc-6x5-unorm-srgb":{f:qe},"astc-6x6-unorm":{f:qe},"astc-6x6-unorm-srgb":{f:qe},"astc-8x5-unorm":{f:qe},"astc-8x5-unorm-srgb":{f:qe},"astc-8x6-unorm":{f:qe},"astc-8x6-unorm-srgb":{f:qe},"astc-8x8-unorm":{f:qe},"astc-8x8-unorm-srgb":{f:qe},"astc-10x5-unorm":{f:qe},"astc-10x5-unorm-srgb":{f:qe},"astc-10x6-unorm":{f:qe},"astc-10x6-unorm-srgb":{f:qe},"astc-10x8-unorm":{f:qe},"astc-10x8-unorm-srgb":{f:qe},"astc-10x10-unorm":{f:qe},"astc-10x10-unorm-srgb":{f:qe},"astc-12x10-unorm":{f:qe},"astc-12x10-unorm-srgb":{f:qe},"astc-12x12-unorm":{f:qe},"astc-12x12-unorm-srgb":{f:qe},"pvrtc-rgb4unorm-webgl":{f:fl},"pvrtc-rgba4unorm-webgl":{f:fl},"pvrtc-rbg2unorm-webgl":{f:fl},"pvrtc-rgba2unorm-webgl":{f:fl},"etc1-rbg-unorm-webgl":{f:xE},"atc-rgb-unorm-webgl":{f:sh},"atc-rgba-unorm-webgl":{f:sh},"atc-rgbai-unorm-webgl":{f:sh}},AE=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],RE=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function zv(n){return AE.some(e=>n.startsWith(e))}function zd(n){let e=CE(n);if(zv(n)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=IE(n);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const t=RE.exec(n);if(t){const[,r,i,s,l,c]=t,f=`${s}${i}`,h=Uv(f),p=h.byteLength*8,_=r.length,y=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];e={format:n,attachment:e.attachment,dataType:h.dataType,components:_,channels:r,integer:h.integer,signed:h.signed,normalized:h.normalized,bitsPerChannel:y,bytesPerPixel:h.byteLength*r.length,packed:e.packed,srgb:e.srgb},c==="-webgl"&&(e.webgl=!0),l==="-srgb"&&(e.srgb=!0)}return n.endsWith("-webgl")&&(e.webgl=!0),n.endsWith("-srgb")&&(e.srgb=!0),e}function CE(n){const e=Vv(n),t=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:n,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||e.channels?.length||1,bytesPerPixel:t,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function IE(n){const t=/.*-(\d+)x(\d+)-.*/.exec(n);if(t){const[,r,i]=t;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function PE(n){const e=Vv(n),t={format:n,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=zd(n),i=n.startsWith("depth")||n.startsWith("stencil"),s=r?.signed,l=r?.integer,c=r?.webgl;return t.render&&(t.render=!s),t.filter&&(t.filter=!i&&!s&&!l&&!c),t}class kE{}class ME{constructor(e=[],t){w(this,"features");w(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}const _c=class _c{constructor(e){w(this,"id");w(this,"props");w(this,"userData",{});w(this,"statsManager",Bv);w(this,"timestamp",0);w(this,"_reused",!1);w(this,"_lumaData",{});this.props={..._c.defaultProps,...e},this.id=this.props.id||Dc(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const t=PE(e),r=l=>(typeof l=="string"?this.features.has(l):l)??!0,i=r(t.create),s={format:e,create:i,render:i&&r(t.render),filter:i&&r(t.filter),blend:i&&r(t.blend),store:i&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return zv(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&st.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":oe.warn("indices buffer content must be of integer type")()),t}};w(_c,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>oe.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:oe.get("debug")||void 0,debugShaders:oe.get("debug-shaders")||void 0,debugFramebuffers:!!oe.get("debug-framebuffers"),debugWebGL:!!oe.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let Qr=_c;const OE=Pi()&&typeof document<"u",NE=()=>OE&&document.readyState==="complete",DE="set luma.log.level=1 (or higher) to trace rendering",Hm="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Yr=class Yr{constructor(){w(this,"stats",Bv);w(this,"log",oe);w(this,"VERSION","9.1.9");w(this,"spector");w(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw oe.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),oe.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");oe.error("This version of luma.gl has already been initialized")()}oe.log(1,`${this.VERSION} - ${DE}`)(),globalThis.luma=this}registerAdapters(e){for(const t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){const t=this.getAdapterMap(e);return Array.from(t).map(([,r])=>r).filter(r=>r.isSupported?.()).map(r=>r.type)}getBestAvailableAdapter(e=[]){const t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(Yr.defaultProps,e)}async createDevice(e={}){e={...Yr.defaultProps,...e},e.waitForPageLoad&&await Yr.pageLoaded;const t=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const l=await(this.getAdapterMap(e.adapters)||t).get(r)?.create?.(e);if(l)return l;throw new Error(Hm)}async attachDevice(e){const t=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Yr.pageLoaded,e.handle===null&&(r="unknown");const s=await t.get(r)?.attach?.(null);if(s)return s;throw new Error(Hm)}enforceWebGL2(e=!0,t=[]){const i=this.getAdapterMap(t).get("webgl");i||oe.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}getAdapterMap(e=[]){const t=new Map(this.preregisteredAdapters);for(const r of e)t.set(r.type,r);return t}registerDevices(e){oe.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const t of e){const r=t.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};w(Yr,"defaultProps",{...Qr.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),w(Yr,"pageLoaded",FE().then(()=>{oe.probe(2,"DOM is loaded")()}));let Wh=Yr;const Hh=new Wh;function FE(){return NE()||typeof window>"u"?Promise.resolve():new Promise(n=>{window.addEventListener("load",()=>n())})}class LE{}const mc=class mc{constructor(e){w(this,"id");w(this,"props");w(this,"canvas");w(this,"htmlCanvas");w(this,"offscreenCanvas");w(this,"type");w(this,"width",1);w(this,"height",1);w(this,"resizeObserver");w(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...mc.defaultProps,...e},e=this.props,!Pi()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=UE(e.canvas):this.canvas=e.canvas;else{const t=VE(e),r=BE(e?.container||null);r.insertBefore(t,r.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(t=>{for(const r of t)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return zE(e,r,i,s,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;(!r||!i)&&(oe.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let l=e;const c=Math.floor(r*l),f=Math.floor(i*l);if(this.htmlCanvas.width=c,this.htmlCanvas.height=f,this.device.gl){const[p,_]=this.getDrawingBufferSize();(p!==c||_!==f)&&(l=Math.min(p/r,_/i),this.htmlCanvas.width=Math.floor(r*l),this.htmlCanvas.height=Math.floor(i*l),oe.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};w(mc,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Xh=mc;function BE(n){if(typeof n=="string"){const e=document.getElementById(n);if(!e)throw new Error(`${n} is not an HTML element`);return e}else if(n)return n;return document.body}function UE(n){const e=document.getElementById(n);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function VE(n){const{width:e,height:t}=n,r=document.createElement("canvas");return r.id=Dc("lumagl-auto-created-canvas"),r.width=e||1,r.height=t||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(t)?`${t}px`:"100%",r}function zE(n,e,t,r,i){const s=n,l=Xm(s[0],e,t);let c=Ym(s[1],e,r,i),f=Xm(s[0]+1,e,t);const h=f===t-1?f:f-1;f=Ym(s[1]+1,e,r,i);let p;return i?(f=f===0?f:f+1,p=c,c=f):p=f===r-1?f:f-1,{x:l,y:c,width:Math.max(h-l+1,1),height:Math.max(p-c+1,1)}}function Xm(n,e,t){return Math.min(Math.round(n*e),t-1)}function Ym(n,e,t,r){return r?Math.max(0,t-1-Math.round(n*e)):Math.min(Math.round(n*e),t-1)}const Nt=class Nt extends Ze{constructor(t,r){r=Nt.normalizeProps(t,r);super(t,r,Nt.defaultProps);w(this,"dimension");w(this,"format");w(this,"width");w(this,"height");w(this,"depth");w(this,"mipLevels");w(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=Nt.getTextureDataSize(this.props.data);this.width=i?.width||1,this.height=i?.height||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?Nt.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=t.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(t){return this.device.createTexture({...this.props,...t})}static isExternalImage(t){return typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement||typeof VideoFrame<"u"&&t instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas}static getExternalImageSize(t){if(typeof ImageData<"u"&&t instanceof ImageData||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas)return{width:t.width,height:t.height};if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)return{width:t.naturalWidth,height:t.naturalHeight};if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)return{width:t.videoWidth,height:t.videoHeight};if(typeof VideoFrame<"u"&&t instanceof VideoFrame)return{width:t.displayWidth,height:t.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(t){const r=t?.data;return ArrayBuffer.isView(r)}static getTextureDataSize(t){if(!t||ArrayBuffer.isView(t))return null;if(Array.isArray(t))return Nt.getTextureDataSize(t[0]);if(Nt.isExternalImage(t))return Nt.getExternalImageSize(t);if(t&&typeof t=="object"&&t.constructor===Object){const i=Object.values(t)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(t,r){let i;return ArrayBuffer.isView(t)?i=[{data:t,width:r.width,height:r.height}]:Array.isArray(t)?i=t:i=[t],i}static getMipLevelCount(t,r){return Math.floor(Math.log2(Math.max(t,r)))+1}static getCubeFaceDepth(t){switch(t){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(t)}}static normalizeProps(t,r){const i={...r},s=t?.props?._resourceDefaults?.texture||{};Object.assign(i,s);const{width:l,height:c}=i;return typeof l=="number"&&(i.width=Math.max(1,Math.ceil(l))),typeof c=="number"&&(i.height=Math.max(1,Math.ceil(c))),i}};w(Nt,"COPY_SRC",1),w(Nt,"COPY_DST",2),w(Nt,"TEXTURE",4),w(Nt,"STORAGE",8),w(Nt,"RENDER_ATTACHMENT",16),w(Nt,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),w(Nt,"defaultProps",{...Ze.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),w(Nt,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let ct=Nt;const yc=class yc extends Ze{get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,yc.defaultProps)}};w(yc,"defaultProps",{...Ze.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Yl=yc;function $E(n,e,t){let r="";const i=e.split(/\r?\n/),s=n.slice().sort((l,c)=>l.lineNum-c.lineNum);switch(t?.showSourceCode||"no"){case"all":let l=0;for(let c=1;c<=i.length;c++)for(r+=$v(i[c-1],c,t);s.length>l&&s[l].lineNum===c;){const f=s[l++];r+=Km(f,i,f.lineNum,{...t,inlineSource:!1})}return r;case"issues":case"no":for(const c of n)r+=Km(c,i,c.lineNum,{inlineSource:t?.showSourceCode!=="no"});return r}}function Km(n,e,t,r){if(r?.inlineSource){const s=jE(e,t),l=n.linePos>0?`${" ".repeat(n.linePos+5)}^^^
`:"";return`
${s}${l}${n.type.toUpperCase()}: ${n.message}

`}const i=n.type==="error"?"red":"#8B4000";return r?.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${n.type.toUpperCase()}: ${n.message}</b></div>`:`${n.type.toUpperCase()}: ${n.message}`}function jE(n,e,t){let r="";for(let i=e-2;i<=e;i++){const s=n[i-1];s!==void 0&&(r+=$v(s,e,t))}return r}function $v(n,e,t){const r=t?.html?HE(n):n;return`${WE(String(e),4)}: ${r}${t?.html?"<br/>":`
`}`}function WE(n,e){let t="";for(let r=n.length;r<e;++r)t+=" ";return t+n}function HE(n){return n.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const vc=class vc extends Ze{constructor(t,r){r={...r,debugShaders:r.debugShaders||t.props.debugShaders||"errors"};super(t,{id:XE(r),...r},vc.defaultProps);w(this,"stage");w(this,"source");w(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const t=this.props.debugShaders;switch(t){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();t==="warnings"&&r?.length===0||this._displayShaderLog(r)}_displayShaderLog(t){if(typeof document>"u"||!document?.createElement)return;const r=jv(this.source),i=`${this.stage} ${r}`;let s=$E(t,this.source,{showSourceCode:"all",html:!0});const l=this.getTranslatedSource();l&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${l}</pre></code>`);const c=document.createElement("Button");c.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,c.style.top="10px",c.style.left="10px",c.style.position="absolute",c.style.zIndex="9999",c.style.width="100%",c.style.textAlign="left",document.body.appendChild(c),document.getElementsByClassName("luma-compiler-log-error")[0]?.scrollIntoView(),c.onclick=()=>{const h=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(h)}}};w(vc,"defaultProps",{...Ze.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Kl=vc;function XE(n){return jv(n.source)||n.id||Dc(`unnamed ${n.stage}-shader`)}function jv(n,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(n);return r?r[1]:e}const Uo=class Uo extends Ze{get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){t=Uo.normalizeProps(e,t),super(e,t,Uo.defaultProps)}static normalizeProps(e,t){const r=e?.props?._resourceDefaults?.sampler||{};return{...t,...r}}};w(Uo,"defaultProps",{...Ze.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let ql=Uo;const bc=class bc extends Ze{constructor(t,r={}){super(t,r,bc.defaultProps);w(this,"width");w(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(t){const r=this.colorAttachments.map(s=>s.texture.clone(t)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(t);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(t){let r=!t;if(t){const[i,s]=Array.isArray(t)?t:[t.width,t.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(oe.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof ct?r.view:r});const t=this.props.depthStencilAttachment;if(t)if(typeof t=="string"){const r=this.createDepthStencilTexture(t);this.attachResource(r),this.depthStencilAttachment=r.view}else t instanceof ct?this.depthStencilAttachment=t.view:this.depthStencilAttachment=t}createColorTexture(t,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:ct.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(t){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ct.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(t,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:t,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:t,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};w(bc,"defaultProps",{...Ze.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Zl=bc;const wc=class wc extends Ze{constructor(t,r){super(t,r,wc.defaultProps);w(this,"shaderLayout");w(this,"bufferLayout");w(this,"linkStatus","pending");w(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(t){throw new Error("Use uniform blocks")}};w(wc,"defaultProps",{...Ze.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Es=wc;const Vn=class Vn extends Ze{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){t=Vn.normalizeProps(e,t),super(e,t,Vn.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}};w(Vn,"defaultClearColor",[0,0,0,1]),w(Vn,"defaultClearDepth",1),w(Vn,"defaultClearStencil",0),w(Vn,"defaultProps",{...Ze.defaultProps,framebuffer:null,parameters:void 0,clearColor:Vn.defaultClearColor,clearColors:void 0,clearDepth:Vn.defaultClearDepth,clearStencil:Vn.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Yh=Vn;const Tc=class Tc extends Ze{constructor(t,r){super(t,r,Tc.defaultProps);w(this,"hash","");w(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};w(Tc,"defaultProps",{...Ze.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Ql=Tc;const xc=class xc extends Ze{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,xc.defaultProps)}};w(xc,"defaultProps",{...Ze.defaultProps,measureExecutionTime:void 0});let Kh=xc;const Sc=class Sc extends Ze{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,Sc.defaultProps)}};w(Sc,"defaultProps",{...Ze.defaultProps});let qh=Sc;function YE(n){const[e,t]=qE[n],r=e==="i32"||e==="u32",i=e!=="u32",s=ZE[e]*t,l=KE(e,t);return{dataType:e,components:t,defaultVertexFormat:l,byteLength:s,integer:r,signed:i}}function KE(n,e){let t;switch(n){case"f32":t="float32";break;case"i32":t="sint32";break;case"u32":t="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?t:`${t}x${e}`}const qE={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},ZE={f32:4,f16:2,i32:4,u32:4};function Wv(n){let e;n.endsWith("-webgl")&&(n.replace("-webgl",""),e=!0);const[t,r]=n.split("x"),i=t,s=r?parseInt(r):1,l=Uv(i),c={type:i,components:s,byteLength:l.byteLength*s,integer:l.integer,signed:l.signed,normalized:l.normalized};return e&&(c.webglOnly=!0),c}function Hv(n,e){const t={};for(const r of n.attributes){const i=JE(n,e,r.name);i&&(t[r.name]=i)}return t}function QE(n,e,t=16){const r=Hv(n,e),i=new Array(t).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function JE(n,e,t){const r=GE(n,t),i=eA(e,t);if(!r)return null;const s=YE(r.type),l=i?.vertexFormat||s.defaultVertexFormat,c=Wv(l);return{attributeName:i?.attributeName||r.name,bufferName:i?.bufferName||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:l,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:s.integer,stepMode:i?.stepMode||r.stepMode||"vertex",byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function GE(n,e){const t=n.attributes.find(r=>r.name===e);return t||oe.warn(`shader layout attribute "${e}" not present in shader`),t||null}function eA(n,e){tA(n);let t=nA(n,e);return t||(t=rA(n,e),t)?t:(oe.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function tA(n){for(const e of n)(e.attributes&&e.format||!e.attributes&&!e.format)&&oe.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function nA(n,e){for(const t of n)if(t.format&&t.name===e)return{attributeName:t.name,bufferName:e,stepMode:t.stepMode,vertexFormat:t.format,byteOffset:0,byteStride:t.byteStride||0};return null}function rA(n,e){for(const t of n){let r=t.byteStride;if(typeof t.byteStride!="number")for(const s of t.attributes||[]){const l=Wv(s.format);r+=l.byteLength}const i=t.attributes?.find(s=>s.attribute===e);if(i)return{attributeName:i.attribute,bufferName:t.name,stepMode:t.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:r}}return null}const Ec=class Ec extends Ze{constructor(t,r){super(t,r,Ec.defaultProps);w(this,"maxVertexAttributes");w(this,"attributeInfos");w(this,"indexBuffer",null);w(this,"attributes");this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=QE(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(t,r){this.device.reportError(new Error("constant attributes not supported"))}};w(Ec,"defaultProps",{...Ze.defaultProps,renderPipeline:null});let Zh=Ec;const Ac=class Ac extends Ze{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,Ac.defaultProps)}};w(Ac,"defaultProps",{...Ze.defaultProps,layout:void 0,buffers:{}});let Qh=Ac;const Rc=class Rc extends Ze{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,Rc.defaultProps)}};w(Rc,"defaultProps",{...Ze.defaultProps,type:void 0,count:void 0});let Jh=Rc;const iA={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function sA(n){return iA[n]}function oA(n,e){switch(e){case 1:return n;case 2:return n+n%2;default:return n+(4-n%4)%4}}let pl;function Xv(n){return(!pl||pl.byteLength<n)&&(pl=new ArrayBuffer(n)),pl}function aA(n,e){const t=Xv(n.BYTES_PER_ELEMENT*e);return new n(t,0,e)}function lA(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function Jl(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":lA(n)}const qm=1024;class cA{constructor(e){w(this,"layout",{});w(this,"byteLength");let t=0;for(const[i,s]of Object.entries(e)){const l=sA(s),{type:c,components:f}=l;t=oA(t,f);const h=t;t+=f,this.layout[i]={type:c,size:f,offset:h}}t+=(4-t%4)%4;const r=t*4;this.byteLength=Math.max(r,qm)}getData(e){const t=Math.max(this.byteLength,qm),r=Xv(t),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,l]of Object.entries(e)){const c=this.layout[s];if(!c){oe.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:f,size:h,offset:p}=c,_=i[f];if(h===1){if(typeof l!="number"&&typeof l!="boolean"){oe.warn(`Supplied value for single component uniform ${s} is not a number: ${l}`)();continue}_[p]=Number(l)}else{if(!Jl(l)){oe.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${l}`)();continue}_.set(l,p)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function uA(n,e,t=16){if(n!==e)return!1;const r=n,i=e;if(!Jl(r))return!1;if(Jl(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function fA(n){return Jl(n)?n.slice():n}class hA{constructor(e){w(this,"name");w(this,"uniforms",{});w(this,"modifiedUniforms",{});w(this,"modified",!0);w(this,"bindingLayout",{});w(this,"needsRedraw","initialized");if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(i=>i.type==="uniform"&&i.name===e?.name);if(!t)throw new Error(e?.name);const r=t;for(const i of r.uniforms||[])this.bindingLayout[i.name]=i}}setUniforms(e){for(const[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){uA(this.uniforms[e],t)||(this.uniforms[e]=fA(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}class dA{constructor(e){w(this,"uniformBlocks",new Map);w(this,"uniformBufferLayouts",new Map);w(this,"uniformBuffers",new Map);for(const[t,r]of Object.entries(e)){const i=t,s=new cA(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const l=new hA({name:t});l.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,l)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){const t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:st.UNIFORM|st.COPY_DST,byteLength:i}),l=this.getUniformBufferData(t);return s.write(l),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:st.UNIFORM|st.COPY_DST,byteLength:r});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(t);e||(e=r)}return e&&oe.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&t?.needsRedraw){i||(i=t.needsRedraw);const s=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(s);const l=this.uniformBlocks.get(e)?.getAllUniforms();oe.log(4,`Writing to uniform buffer ${String(e)}`,s,l)()}return i}}function Yv(n){const e=ArrayBuffer.isView(n)?n.constructor:n;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function Kv(n){switch(n){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(n)}}function pA(n,e,t){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=Yv(n);if(i==="uint8"&&t&&r===1)return"unorm8-webgl";if(i==="uint8"&&t&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return t&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class ch{constructor(e){w(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(t=>t.attribute):[e.name]}mergeBufferLayouts(e,t){const r=[...e];for(const i of t){const s=r.findIndex(l=>l.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const t=this.bufferLayouts.findIndex(r=>r.name===e);return t===-1&&oe.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}function gA(n,e){const t=Object.fromEntries(n.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const l=i.attributes?i.attributes.map(p=>p.attribute):[i.name],c=s.attributes?s.attributes.map(p=>p.attribute):[s.name],f=Math.min(...l.map(p=>t[p])),h=Math.min(...c.map(p=>t[p]));return f-h}),r}class An{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class Zm{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Kr extends An{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class Jr extends An{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class Gh extends An{constructor(e,t,r){super(e,r),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ei extends An{constructor(e,t,r,i){super(e,r),this.format=t,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Hr;(n=>{n[n.Uniform=0]="Uniform",n[n.Storage=1]="Storage",n[n.Texture=2]="Texture",n[n.Sampler=3]="Sampler",n[n.StorageTexture=4]="StorageTexture"})(Hr||(Hr={}));class gl{constructor(e,t,r,i,s,l,c){this.name=e,this.type=t,this.group=r,this.binding=i,this.attributes=s,this.resourceType=l,this.access=c}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class _A{constructor(e,t){this.name=e,this.type=t}}class mA{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i,this.interpolation=null}}class Qm{constructor(e,t,r,i){this.name=e,this.type=t,this.locationType=r,this.location=i}}class yA{constructor(e,t,r,i){this.name=e,this.type=t,this.attributes=r,this.id=i}}class vA{constructor(e,t,r){this.name=e,this.type=t,this.attributes=r}}class bA{constructor(e,t=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=r}}class wA{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}const qv=new Float32Array(1),TA=new Int32Array(qv.buffer),Vt=new Uint16Array(1);function xA(n){qv[0]=n;const e=TA[0],t=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return Vt[0]=t<<15|31744|(i!==0?512:0),Vt[0];if(r===0){if(i===0)return Vt[0]=t<<15,Vt[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),Vt[0]=t<<15|r<<10|i>>13,Vt[0]):(Vt[0]=t<<15,Vt[0])}return r=r-127+15,r>=31?(Vt[0]=t<<15|31744,Vt[0]):r<=0?r<-10?(Vt[0]=t<<15,Vt[0]):(i=(8388608|i)>>1-r,Vt[0]=t<<15|i>>13,Vt[0]):(i>>=13,Vt[0]=t<<15|r<<10|i,Vt[0])}const $d=new Uint32Array(1),Zv=new Float32Array($d.buffer,0,1);function Jm(n){const e=112+(n>>6&31)<<23|(63&n)<<17;return $d[0]=e,Zv[0]}function SA(n,e,t,r,i,s,l,c,f){const h=r*(l>>=i)*(s>>=i)+t*l+e*c;switch(f){case"r8unorm":return[He(n,h,"8unorm",1)[0]];case"r8snorm":return[He(n,h,"8snorm",1)[0]];case"r8uint":return[He(n,h,"8uint",1)[0]];case"r8sint":return[He(n,h,"8sint",1)[0]];case"rg8unorm":{const p=He(n,h,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=He(n,h,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=He(n,h,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=He(n,h,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=He(n,h,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=He(n,h,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=He(n,h,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=He(n,h,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=He(n,h,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[He(n,h,"16uint",1)[0]];case"r16sint":return[He(n,h,"16sint",1)[0]];case"r16float":return[He(n,h,"16float",1)[0]];case"rg16uint":{const p=He(n,h,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=He(n,h,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=He(n,h,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=He(n,h,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=He(n,h,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=He(n,h,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[He(n,h,"32uint",1)[0]];case"r32sint":return[He(n,h,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[He(n,h,"32float",1)[0]];case"rg32uint":{const p=He(n,h,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=He(n,h,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=He(n,h,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=He(n,h,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=He(n,h,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=He(n,h,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(n.buffer,h,1)[0],_=(4192256&p)>>11,y=(4290772992&p)>>22;return[Jm(2047&p),Jm(_),function(b){const x=112+(b>>5&31)<<23|(31&b)<<18;return $d[0]=x,Zv[0]}(y),1]}}return null}function He(n,e,t,r){const i=[0,0,0,0];for(let h=0;h<r;++h)switch(t){case"8unorm":i[h]=n[e]/255,e++;break;case"8snorm":i[h]=n[e]/255*2-1,e++;break;case"8uint":i[h]=n[e],e++;break;case"8sint":i[h]=n[e]-127,e++;break;case"16uint":i[h]=n[e]|n[e+1]<<8,e+=2;break;case"16sint":i[h]=(n[e]|n[e+1]<<8)-32768,e+=2;break;case"16float":i[h]=(s=n[e]|n[e+1]<<8,l=void 0,c=void 0,f=void 0,l=(32768&s)>>15,f=1023&s,(c=(31744&s)>>10)==0?(l?-1:1)*Math.pow(2,-14)*(f/Math.pow(2,10)):c==31?f?NaN:1/0*(l?-1:1):(l?-1:1)*Math.pow(2,c-15)*(1+f/Math.pow(2,10))),e+=2;break;case"32uint":case"32sint":i[h]=n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24,e+=4;break;case"32float":i[h]=new Float32Array(n.buffer,e,1)[0],e+=4}var s,l,c,f;return i}function Xe(n,e,t,r,i){for(let s=0;s<r;++s)switch(t){case"8unorm":n[e]=255*i[s],e++;break;case"8snorm":n[e]=.5*(i[s]+1)*255,e++;break;case"8uint":n[e]=i[s],e++;break;case"8sint":n[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(n.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const l=xA(i[s]);new Uint16Array(n.buffer,e,1)[0]=l,e+=2;break}case"32uint":new Uint32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(n.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(n.buffer,e,1)[0]=i[s],e+=4}return i}const uh={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class Pn{constructor(){this.id=Pn._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){t(Gl.instance);for(const r of e)r instanceof Array?this.searchBlock(r,t):r.search(t);t(ec.instance)}}constEvaluate(e,t){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}Pn._id=0;class Gl extends Pn{}Gl.instance=new Gl;class ec extends Pn{}ec.instance=new ec;const Qv=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class ot extends Pn{constructor(){super()}}class $o extends ot{constructor(e,t,r,i,s,l){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=r,this.body=i,this.startLine=s,this.endLine=l}get astNodeType(){return"function"}search(e){if(this.attributes)for(const t of this.attributes)e(t);e(this);for(const t of this.args)e(t);this.searchBlock(this.body,e)}}class EA extends ot{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Jv extends ot{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ed extends ot{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Gv extends ot{constructor(e,t,r,i){super(),this.init=e,this.condition=t,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var t,r,i;(t=this.init)===null||t===void 0||t.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class _r extends ot{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class jd extends ot{constructor(e,t,r){super(),this.attributes=null,this.name=e,this.type=t,this.value=r}get astNodeType(){return"override"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class No extends ot{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}class kl extends ot{constructor(e,t,r,i,s){super(),this.attributes=null,this.name=e,this.type=t,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),(t=this.value)===null||t===void 0||t.search(e)}}var gs,Ro,W,B;(n=>{n.increment="++",n.decrement="--"})(gs||(gs={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for IncrementOperator");return n[t]}})(gs||(gs={}));class eb extends ot{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(n=>{n.assign="=",n.addAssign="+=",n.subtractAssin="-=",n.multiplyAssign="*=",n.divideAssign="/=",n.moduloAssign="%=",n.andAssign="&=",n.orAssign="|=",n.xorAssign="^=",n.shiftLeftAssign="<<=",n.shiftRightAssign=">>="})(Ro||(Ro={})),(n=>{n.parse=function(e){const t=e;if(t=="parse")throw new Error("Invalid value for AssignOperator");return t}})(Ro||(Ro={}));class tb extends ot{constructor(e,t,r){super(),this.operator=e,this.variable=t,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Wd extends ot{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return Qv.has(this.name)}search(e){for(const t of this.args)t.search(e);e(this)}}class nb extends ot{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class rb extends ot{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){e(this);for(const t of this.cases)t.search(e)}}class ib extends ot{constructor(e,t,r,i){super(),this.condition=e,this.body=t,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class sb extends ot{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;(t=this.value)===null||t===void 0||t.search(e)}}class AA extends ot{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class RA extends ot{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class ob extends ot{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class Hd extends ot{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class CA extends ot{constructor(){super()}get astNodeType(){return"discard"}}class ab extends ot{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class lb extends ot{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class J extends ot{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=J._priority.get(t.name);J._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?J.i32:t}getTypeName(){return this.name}}J.x32=new J("x32"),J.f32=new J("f32"),J.i32=new J("i32"),J.u32=new J("u32"),J.f16=new J("f16"),J.bool=new J("bool"),J.void=new J("void"),J._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Gm extends J{constructor(e){super(e)}}class pr extends J{constructor(e,t,r,i){super(e),this.members=t,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}search(e){for(const t of this.members)e(t)}}class $ extends J{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}$.vec2f=new $("vec2",J.f32,null),$.vec3f=new $("vec3",J.f32,null),$.vec4f=new $("vec4",J.f32,null),$.vec2i=new $("vec2",J.i32,null),$.vec3i=new $("vec3",J.i32,null),$.vec4i=new $("vec4",J.i32,null),$.vec2u=new $("vec2",J.u32,null),$.vec3u=new $("vec3",J.u32,null),$.vec4u=new $("vec4",J.u32,null),$.vec2h=new $("vec2",J.f16,null),$.vec3h=new $("vec3",J.f16,null),$.vec4h=new $("vec4",J.f16,null),$.vec2b=new $("vec2",J.bool,null),$.vec3b=new $("vec3",J.bool,null),$.vec4b=new $("vec4",J.bool,null),$.mat2x2f=new $("mat2x2",J.f32,null),$.mat2x3f=new $("mat2x3",J.f32,null),$.mat2x4f=new $("mat2x4",J.f32,null),$.mat3x2f=new $("mat3x2",J.f32,null),$.mat3x3f=new $("mat3x3",J.f32,null),$.mat3x4f=new $("mat3x4",J.f32,null),$.mat4x2f=new $("mat4x2",J.f32,null),$.mat4x3f=new $("mat4x3",J.f32,null),$.mat4x4f=new $("mat4x4",J.f32,null),$.mat2x2h=new $("mat2x2",J.f16,null),$.mat2x3h=new $("mat2x3",J.f16,null),$.mat2x4h=new $("mat2x4",J.f16,null),$.mat3x2h=new $("mat3x2",J.f16,null),$.mat3x3h=new $("mat3x3",J.f16,null),$.mat3x4h=new $("mat3x4",J.f16,null),$.mat4x2h=new $("mat4x2",J.f16,null),$.mat4x3h=new $("mat4x3",J.f16,null),$.mat4x4h=new $("mat4x4",J.f16,null),$.mat2x2i=new $("mat2x2",J.i32,null),$.mat2x3i=new $("mat2x3",J.i32,null),$.mat2x4i=new $("mat2x4",J.i32,null),$.mat3x2i=new $("mat3x2",J.i32,null),$.mat3x3i=new $("mat3x3",J.i32,null),$.mat3x4i=new $("mat3x4",J.i32,null),$.mat4x2i=new $("mat4x2",J.i32,null),$.mat4x3i=new $("mat4x3",J.i32,null),$.mat4x4i=new $("mat4x4",J.i32,null),$.mat2x2u=new $("mat2x2",J.u32,null),$.mat2x3u=new $("mat2x3",J.u32,null),$.mat2x4u=new $("mat2x4",J.u32,null),$.mat3x2u=new $("mat3x2",J.u32,null),$.mat3x3u=new $("mat3x3",J.u32,null),$.mat3x4u=new $("mat3x4",J.u32,null),$.mat4x2u=new $("mat4x2",J.u32,null),$.mat4x3u=new $("mat4x3",J.u32,null),$.mat4x4u=new $("mat4x4",J.u32,null);class Ml extends J{constructor(e,t,r,i){super(e),this.storage=t,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Do extends J{constructor(e,t,r,i){super(e),this.attributes=t,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Co extends J{constructor(e,t,r){super(e),this.format=t,this.access=r}get astNodeType(){return"sampler"}}class Wn extends Pn{constructor(){super(),this.postfix=null}}class Ai extends Wn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class Jn extends Wn{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class Xd extends Wn{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return Qv.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(const t of this.args)t.search(e);e(this)}}class _n extends Wn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class cb extends Wn{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class St extends Wn{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return t!==void 0&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof F}get isVector(){return this.value instanceof A||this.value instanceof Ae}get scalarValue(){return this.value instanceof F?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof A||this.value instanceof Ae?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class ub extends Wn{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class As extends Wn{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class fb extends Wn{constructor(){super()}}class vt extends fb{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Un extends fb{constructor(e,t,r){super(),this.operator=e,this.left=t,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:e.name==="f32"||t.name==="f32"?J.f32:e.name==="u32"||t.name==="u32"?J.u32:J.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class hb extends Pn{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class Ol extends Wn{constructor(){super()}get astNodeType(){return"default"}}class db extends hb{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class pb extends hb{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class ey extends Pn{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"argument"}}class IA extends Pn{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class ty extends Pn{constructor(e,t,r){super(),this.name=e,this.type=t,this.attributes=r}get astNodeType(){return"member"}}class gb extends Pn{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class In{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=In._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}In._id=0;class td extends In{constructor(){super(new An("void",null),null)}toString(){return"void"}}td.void=new td;class fs extends In{constructor(e){super(new Gh("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,r,i){this.reference.setDataValue(e,t,r,i)}getSubData(e,t,r){return t?this.reference.getSubData(e,t,r):this}toString(){return`&${this.reference.toString()}`}}class F extends In{constructor(e,t,r=null){super(t,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new F(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new F(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new F(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(t instanceof F))return void console.error("SetDataValue: Invalid value",t);let s=t.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,t,r){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}function PA(n,e,t){const r=e.length;return r===2?t==="f32"?new A(new Float32Array(e),n.getTypeInfo("vec2f")):t==="i32"||t==="bool"?new A(new Int32Array(e),n.getTypeInfo("vec2i")):t==="u32"?new A(new Uint32Array(e),n.getTypeInfo("vec2u")):t==="f16"?new A(new Float32Array(e),n.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${t}`),null):r===3?t==="f32"?new A(new Float32Array(e),n.getTypeInfo("vec3f")):t==="i32"||t==="bool"?new A(new Int32Array(e),n.getTypeInfo("vec3i")):t==="u32"?new A(new Uint32Array(e),n.getTypeInfo("vec3u")):t==="f16"?new A(new Float32Array(e),n.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${t}`),null):r===4?t==="f32"?new A(new Float32Array(e),n.getTypeInfo("vec4f")):t==="i32"||t==="bool"?new A(new Int32Array(e),n.getTypeInfo("vec4i")):t==="u32"?new A(new Uint32Array(e),n.getTypeInfo("vec4u")):t==="f16"?new A(new Float32Array(e),n.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${t}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class A extends In{constructor(e,t,r=null){if(super(t,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new A(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new A(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new A(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,r,i){r instanceof Ai?console.error("TODO: Set vector postfix"):t instanceof A?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Ei)i=this.typeInfo.format||i;else{const l=this.typeInfo.name;l==="vec2f"||l==="vec3f"||l==="vec4f"?i=e.getTypeInfo("f32"):l==="vec2i"||l==="vec3i"||l==="vec4i"?i=e.getTypeInfo("i32"):l==="vec2b"||l==="vec3b"||l==="vec4b"?i=e.getTypeInfo("bool"):l==="vec2u"||l==="vec3u"||l==="vec4u"?i=e.getTypeInfo("u32"):l==="vec2h"||l==="vec3h"||l==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${l}`)}let s=this;for(;t!==null&&s!==null;){if(t instanceof As){const l=t.index;let c=-1;if(l instanceof St){if(!(l.value instanceof F))return console.error(`GetSubData: Invalid array index ${l.value}`),null;c=l.value.value}else{const f=e.evalExpression(l,r);if(!(f instanceof F))return console.error("GetSubData: Unknown index type",l),null;c=f.value}if(c<0||c>=s.data.length)return console.error("GetSubData: Index out of range",c),null;if(s.data instanceof Float32Array){const f=new Float32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new F(f,i)}if(s.data instanceof Int32Array){const f=new Int32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new F(f,i)}if(s.data instanceof Uint32Array){const f=new Uint32Array(s.data.buffer,s.data.byteOffset+4*c,1);return new F(f,i)}throw"GetSubData: Invalid data type"}if(!(t instanceof Ai))return console.error("GetSubData: Unknown postfix",t),null;{const l=t.value.toLowerCase();if(l.length===1){let f=0;if(l==="x"||l==="r")f=0;else if(l==="y"||l==="g")f=1;else if(l==="z"||l==="b")f=2;else{if(l!=="w"&&l!=="a")return console.error(`GetSubData: Unknown member ${l}`),null;f=3}if(this.data instanceof Float32Array){let h=new Float32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new F(h,i,this)}if(this.data instanceof Int32Array){let h=new Int32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new F(h,i,this)}if(this.data instanceof Uint32Array){let h=new Uint32Array(this.data.buffer,this.data.byteOffset+4*f,1);return new F(h,i,this)}}const c=[];for(const f of l)f==="x"||f==="r"?c.push(this.data[0]):f==="y"||f==="g"?c.push(this.data[1]):f==="z"||f==="b"?c.push(this.data[2]):f==="w"||f==="a"?c.push(this.data[3]):console.error(`GetDataValue: Unknown member ${f}`);s=PA(e,c,i.name)}t=t.postfix}return s}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class Ae extends In{constructor(e,t,r=null){super(t,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new Ae(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,r,i){r instanceof Ai?console.error("TODO: Set matrix postfix"):t instanceof Ae?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,r){if(t===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ei)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(t instanceof As){const s=t.index;let l=-1;if(s instanceof St){if(!(s.value instanceof F))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;l=s.value.value}else{const h=e.evalExpression(s,r);if(!(h instanceof F))return console.error("GetDataValue: Unknown index type",s),null;l=h.value}if(l<0||l>=this.data.length)return console.error("GetDataValue: Index out of range",l),null;const c=i.endsWith("h")?"h":"f";let f;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")f=new A(new Float32Array(this.data.buffer,this.data.byteOffset+2*l*4,2),e.getTypeInfo(`vec2${c}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")f=new A(new Float32Array(this.data.buffer,this.data.byteOffset+3*l*4,3),e.getTypeInfo(`vec3${c}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;f=new A(new Float32Array(this.data.buffer,this.data.byteOffset+4*l*4,4),e.getTypeInfo(`vec4${c}`))}return t.postfix?f.getSubData(e,t.postfix,r):f}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class ht extends In{constructor(e,t,r=0,i=null){super(t,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new ht(e.buffer,this.typeInfo,0,null)}setDataValue(e,t,r,i){if(t===null)return void console.log("setDataValue: NULL data.");let s=this.offset,l=this.typeInfo;for(;r;){if(r instanceof As)if(l instanceof Jr){const c=r.index;if(c instanceof St){if(!(c.value instanceof F))return void console.error(`SetDataValue: Invalid index type ${c.value}`);s+=c.value.value*l.stride}else{const f=e.evalExpression(c,i);if(!(f instanceof F))return void console.error("SetDataValue: Unknown index type",c);s+=f.value*l.stride}l=l.format}else console.error(`SetDataValue: Type ${l.getTypeName()} is not an array`);else{if(!(r instanceof Ai))return void console.error("SetDataValue: Unknown postfix type",r);{const c=r.value;if(l instanceof Kr){let f=!1;for(const h of l.members)if(h.name===c){s+=h.offset,l=h.type,f=!0;break}if(!f)return void console.error(`SetDataValue: Member ${c} not found`)}else if(l instanceof An){const f=l.getTypeName();let h=0;if(c==="x"||c==="r")h=0;else if(c==="y"||c==="g")h=1;else if(c==="z"||c==="b")h=2;else{if(c!=="w"&&c!=="a")return void console.error(`SetDataValue: Unknown member ${c}`);h=3}if(!(t instanceof F))return void console.error("SetDataValue: Invalid value",t);const p=t.value;return f==="vec2f"?void(new Float32Array(this.buffer,s,2)[h]=p):f==="vec3f"?void(new Float32Array(this.buffer,s,3)[h]=p):f==="vec4f"?void(new Float32Array(this.buffer,s,4)[h]=p):f==="vec2i"?void(new Int32Array(this.buffer,s,2)[h]=p):f==="vec3i"?void(new Int32Array(this.buffer,s,3)[h]=p):f==="vec4i"?void(new Int32Array(this.buffer,s,4)[h]=p):f==="vec2u"?void(new Uint32Array(this.buffer,s,2)[h]=p):f==="vec3u"?void(new Uint32Array(this.buffer,s,3)[h]=p):f==="vec4u"?void(new Uint32Array(this.buffer,s,4)[h]=p):void console.error(`SetDataValue: Type ${f} is not a struct`)}}}r=r.postfix}this.setData(e,t,l,s,i)}setData(e,t,r,i,s){const l=r.getTypeName();if(l!=="f32"&&l!=="f16")if(l!=="i32"&&l!=="atomic<i32>"&&l!=="x32")if(l!=="u32"&&l!=="atomic<u32>")if(l!=="bool")if(l!=="vec2f"&&l!=="vec2h")if(l!=="vec3f"&&l!=="vec3h")if(l!=="vec4f"&&l!=="vec4h")if(l!=="vec2i")if(l!=="vec3i")if(l!=="vec4i")if(l!=="vec2u")if(l!=="vec3u")if(l!=="vec4u")if(l!=="vec2b")if(l!=="vec3b")if(l!=="vec4b")if(l!=="mat2x2f"&&l!=="mat2x2h")if(l!=="mat2x3f"&&l!=="mat2x3h")if(l!=="mat2x4f"&&l!=="mat2x4h")if(l!=="mat3x2f"&&l!=="mat3x2h")if(l!=="mat3x3f"&&l!=="mat3x3h")if(l!=="mat3x4f"&&l!=="mat3x4h")if(l!=="mat4x2f"&&l!=="mat4x2h")if(l!=="mat4x3f"&&l!=="mat4x3h")if(l!=="mat4x4f"&&l!=="mat4x4h")if(t instanceof ht){if(r===t.typeInfo)return void new Uint8Array(this.buffer,i,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",l,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${l}`);else{const c=new Float32Array(this.buffer,i,16);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11],c[12]=t.data[12],c[13]=t.data[13],c[14]=t.data[14],c[15]=t.data[15]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11],c[12]=t[12],c[13]=t[13],c[14]=t[14],c[15]=t[15])}else{const c=new Float32Array(this.buffer,i,12);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{const c=new Float32Array(this.buffer,i,8);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{const c=new Float32Array(this.buffer,i,12);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8],c[9]=t.data[9],c[10]=t.data[10],c[11]=t.data[11]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8],c[9]=t[9],c[10]=t[10],c[11]=t[11])}else{const c=new Float32Array(this.buffer,i,9);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7],c[8]=t.data[8]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7],c[8]=t[8])}else{const c=new Float32Array(this.buffer,i,6);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{const c=new Float32Array(this.buffer,i,8);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5],c[6]=t.data[6],c[7]=t.data[7]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5],c[6]=t[6],c[7]=t[7])}else{const c=new Float32Array(this.buffer,i,6);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3],c[4]=t.data[4],c[5]=t.data[5]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3],c[4]=t[4],c[5]=t[5])}else{const c=new Float32Array(this.buffer,i,4);t instanceof Ae?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,i,4);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,i,3);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Uint32Array(this.buffer,i,2);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Uint32Array(this.buffer,i,4);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Uint32Array(this.buffer,i,3);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Uint32Array(this.buffer,i,2);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Int32Array(this.buffer,i,4);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Int32Array(this.buffer,i,3);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Int32Array(this.buffer,i,2);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else{const c=new Float32Array(this.buffer,i,4);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2],c[3]=t.data[3]):(c[0]=t[0],c[1]=t[1],c[2]=t[2],c[3]=t[3])}else{const c=new Float32Array(this.buffer,i,3);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1],c[2]=t.data[2]):(c[0]=t[0],c[1]=t[1],c[2]=t[2])}else{const c=new Float32Array(this.buffer,i,2);t instanceof A?(c[0]=t.data[0],c[1]=t.data[1]):(c[0]=t[0],c[1]=t[1])}else t instanceof F&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof F&&(new Uint32Array(this.buffer,i,1)[0]=t.value);else t instanceof F&&(new Int32Array(this.buffer,i,1)[0]=t.value);else t instanceof F&&(new Float32Array(this.buffer,i,1)[0]=t.value)}getSubData(e,t,r){var i,s,l;if(t===null)return this;let c=this.offset,f=this.typeInfo;for(;t;){if(t instanceof As){const p=t.index,_=p instanceof Wn?e.evalExpression(p,r):p;let y=0;if(_ instanceof F?y=_.value:typeof _=="number"?y=_:console.error("GetDataValue: Invalid index type",p),f instanceof Jr)c+=y*f.stride,f=f.format;else{const b=f.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(c+=16*y,f=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${f.getTypeName()} is not an array`)}}else{if(!(t instanceof Ai))return console.error("GetDataValue: Unknown postfix type",t),null;{const p=t.value;if(f instanceof Kr){let _=!1;for(const y of f.members)if(y.name===p){c+=y.offset,f=y.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${p} not found`),null}else if(f instanceof An){const _=f.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(p.length>0&&p.length<5){let y="f";const b=[];for(let x=0;x<p.length;++x){const S=p[x].toLowerCase();let C=0;if(S==="x"||S==="r")C=0;else if(S==="y"||S==="g")C=1;else if(S==="z"||S==="b")C=2;else{if(S!=="w"&&S!=="a")return console.error(`Unknown member ${p}`),null;C=3}if(p.length===1){if(_.endsWith("f"))return this.buffer.byteLength<c+4*C+4?(console.log("Insufficient buffer data"),null):new F(new Float32Array(this.buffer,c+4*C,1),e.getTypeInfo("f32"),this);if(_.endsWith("h"))return new F(new Float32Array(this.buffer,c+4*C,1),e.getTypeInfo("f16"),this);if(_.endsWith("i"))return new F(new Int32Array(this.buffer,c+4*C,1),e.getTypeInfo("i32"),this);if(_.endsWith("b"))return new F(new Int32Array(this.buffer,c+4*C,1),e.getTypeInfo("bool"),this);if(_.endsWith("u"))return new F(new Uint32Array(this.buffer,c+4*C,1),e.getTypeInfo("i32"),this)}if(_==="vec2f")b.push(new Float32Array(this.buffer,c,2)[C]);else if(_==="vec3f"){if(c+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const P=new Float32Array(this.buffer,c,3);b.push(P[C])}else if(_==="vec4f")b.push(new Float32Array(this.buffer,c,4)[C]);else if(_==="vec2i")y="i",b.push(new Int32Array(this.buffer,c,2)[C]);else if(_==="vec3i")y="i",b.push(new Int32Array(this.buffer,c,3)[C]);else if(_==="vec4i")y="i",b.push(new Int32Array(this.buffer,c,4)[C]);else if(_==="vec2u"){y="u";const P=new Uint32Array(this.buffer,c,2);b.push(P[C])}else _==="vec3u"?(y="u",b.push(new Uint32Array(this.buffer,c,3)[C])):_==="vec4u"&&(y="u",b.push(new Uint32Array(this.buffer,c,4)[C]))}return b.length===2?f=e.getTypeInfo(`vec2${y}`):b.length===3?f=e.getTypeInfo(`vec3${y}`):b.length===4?f=e.getTypeInfo(`vec4${y}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new A(b,f,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}t=t.postfix}const h=f.getTypeName();return h==="f32"?new F(new Float32Array(this.buffer,c,1),f,this):h==="i32"?new F(new Int32Array(this.buffer,c,1),f,this):h==="u32"?new F(new Uint32Array(this.buffer,c,1),f,this):h==="vec2f"?new A(new Float32Array(this.buffer,c,2),f,this):h==="vec3f"?new A(new Float32Array(this.buffer,c,3),f,this):h==="vec4f"?new A(new Float32Array(this.buffer,c,4),f,this):h==="vec2i"?new A(new Int32Array(this.buffer,c,2),f,this):h==="vec3i"?new A(new Int32Array(this.buffer,c,3),f,this):h==="vec4i"?new A(new Int32Array(this.buffer,c,4),f,this):h==="vec2u"?new A(new Uint32Array(this.buffer,c,2),f,this):h==="vec3u"?new A(new Uint32Array(this.buffer,c,3),f,this):h==="vec4u"?new A(new Uint32Array(this.buffer,c,4),f,this):f instanceof Ei&&f.name==="atomic"?((i=f.format)===null||i===void 0?void 0:i.name)==="u32"?new F(new Uint32Array(this.buffer,c,1)[0],f.format,this):((s=f.format)===null||s===void 0?void 0:s.name)==="i32"?new F(new Int32Array(this.buffer,c,1)[0],f.format,this):(console.error(`GetDataValue: Invalid atomic format ${(l=f.format)===null||l===void 0?void 0:l.name}`),null):new ht(this.buffer,f,c,this)}toString(){let e="";if(this.typeInfo instanceof Jr)if(this.typeInfo.format.name==="f32"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="i32"){const t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="u32"){const t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let r=1;r<t.length;++r)e+=`, ${t[r]}`}else if(this.typeInfo.format.name==="vec2f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let r=1;r<t.length/2;++r)e+=`, [${t[2*r]}, ${t[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let r=4;r<t.length;r+=4)e+=`, [${t[r]}, ${t[r+1]}, ${t[r+2]}, ${t[r+3]}]`}else e="[...]";else this.typeInfo instanceof Kr?e+="{...}":e="[...]";return e}}class gr extends In{constructor(e,t,r,i){super(t,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new gr(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.width)!==null&&t!==void 0?t:0}get height(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.height)!==null&&t!==void 0?t:0}get depthOrArrayLayers(){var e,t;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(t=r.depthOrArrayLayers)!==null&&t!==void 0?t:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const t=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<t.length;++r)t[r]=Math.max(1,t[r]>>e);return t}get texelByteSize(){const e=this.format,t=uh[e];return t?t.isDepthStencil?4:t.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,t=uh[e];return!!t&&t.isDepthStencil}getGpuSize(){const e=this.format,t=uh[e],r=this.width;if(!e||r<=0||!t)return-1;const i=this.height,s=this.depthOrArrayLayers,l=this.dimension;return r/t.blockWidth*(l==="1d"?1:i/t.blockHeight)*t.bytesPerBlock*s}getPixel(e,t,r=0,i=0){const s=this.texelByteSize,l=this.bytesPerRow,c=this.height,f=this.data[i];return SA(new Uint8Array(f),e,t,r,i,c,l,s,this.format)}setPixel(e,t,r,i,s){const l=this.texelByteSize,c=this.bytesPerRow,f=this.height,h=this.data[i];(function(p,_,y,b,x,S,C,P,z,k){const V=b*(C>>=x)*(S>>=x)+y*C+_*P;switch(z){case"r8unorm":return void Xe(p,V,"8unorm",1,k);case"r8snorm":return void Xe(p,V,"8snorm",1,k);case"r8uint":return void Xe(p,V,"8uint",1,k);case"r8sint":return void Xe(p,V,"8sint",1,k);case"rg8unorm":return void Xe(p,V,"8unorm",2,k);case"rg8snorm":return void Xe(p,V,"8snorm",2,k);case"rg8uint":return void Xe(p,V,"8uint",2,k);case"rg8sint":return void Xe(p,V,"8sint",2,k);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void Xe(p,V,"8unorm",4,k);case"rgba8snorm":return void Xe(p,V,"8snorm",4,k);case"rgba8uint":return void Xe(p,V,"8uint",4,k);case"rgba8sint":return void Xe(p,V,"8sint",4,k);case"r16uint":return void Xe(p,V,"16uint",1,k);case"r16sint":return void Xe(p,V,"16sint",1,k);case"r16float":return void Xe(p,V,"16float",1,k);case"rg16uint":return void Xe(p,V,"16uint",2,k);case"rg16sint":return void Xe(p,V,"16sint",2,k);case"rg16float":return void Xe(p,V,"16float",2,k);case"rgba16uint":return void Xe(p,V,"16uint",4,k);case"rgba16sint":return void Xe(p,V,"16sint",4,k);case"rgba16float":return void Xe(p,V,"16float",4,k);case"r32uint":return void Xe(p,V,"32uint",1,k);case"r32sint":return void Xe(p,V,"32sint",1,k);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void Xe(p,V,"32float",1,k);case"rg32uint":return void Xe(p,V,"32uint",2,k);case"rg32sint":return void Xe(p,V,"32sint",2,k);case"rg32float":return void Xe(p,V,"32float",2,k);case"rgba32uint":return void Xe(p,V,"32uint",4,k);case"rgba32sint":return void Xe(p,V,"32sint",4,k);case"rgba32float":return void Xe(p,V,"32float",4,k);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(h),e,t,r,i,f,c,l,this.format,s)}}(n=>{n[n.token=0]="token",n[n.keyword=1]="keyword",n[n.reserved=2]="reserved"})(B||(B={}));class U{constructor(e,t,r){this.name=e,this.type=t,this.rule=r}toString(){return this.name}}class T{}W=T,T.none=new U("",B.reserved,""),T.eof=new U("EOF",B.token,""),T.reserved={asm:new U("asm",B.reserved,"asm"),bf16:new U("bf16",B.reserved,"bf16"),do:new U("do",B.reserved,"do"),enum:new U("enum",B.reserved,"enum"),f16:new U("f16",B.reserved,"f16"),f64:new U("f64",B.reserved,"f64"),handle:new U("handle",B.reserved,"handle"),i8:new U("i8",B.reserved,"i8"),i16:new U("i16",B.reserved,"i16"),i64:new U("i64",B.reserved,"i64"),mat:new U("mat",B.reserved,"mat"),premerge:new U("premerge",B.reserved,"premerge"),regardless:new U("regardless",B.reserved,"regardless"),typedef:new U("typedef",B.reserved,"typedef"),u8:new U("u8",B.reserved,"u8"),u16:new U("u16",B.reserved,"u16"),u64:new U("u64",B.reserved,"u64"),unless:new U("unless",B.reserved,"unless"),using:new U("using",B.reserved,"using"),vec:new U("vec",B.reserved,"vec"),void:new U("void",B.reserved,"void")},T.keywords={array:new U("array",B.keyword,"array"),atomic:new U("atomic",B.keyword,"atomic"),bool:new U("bool",B.keyword,"bool"),f32:new U("f32",B.keyword,"f32"),i32:new U("i32",B.keyword,"i32"),mat2x2:new U("mat2x2",B.keyword,"mat2x2"),mat2x3:new U("mat2x3",B.keyword,"mat2x3"),mat2x4:new U("mat2x4",B.keyword,"mat2x4"),mat3x2:new U("mat3x2",B.keyword,"mat3x2"),mat3x3:new U("mat3x3",B.keyword,"mat3x3"),mat3x4:new U("mat3x4",B.keyword,"mat3x4"),mat4x2:new U("mat4x2",B.keyword,"mat4x2"),mat4x3:new U("mat4x3",B.keyword,"mat4x3"),mat4x4:new U("mat4x4",B.keyword,"mat4x4"),ptr:new U("ptr",B.keyword,"ptr"),sampler:new U("sampler",B.keyword,"sampler"),sampler_comparison:new U("sampler_comparison",B.keyword,"sampler_comparison"),struct:new U("struct",B.keyword,"struct"),texture_1d:new U("texture_1d",B.keyword,"texture_1d"),texture_2d:new U("texture_2d",B.keyword,"texture_2d"),texture_2d_array:new U("texture_2d_array",B.keyword,"texture_2d_array"),texture_3d:new U("texture_3d",B.keyword,"texture_3d"),texture_cube:new U("texture_cube",B.keyword,"texture_cube"),texture_cube_array:new U("texture_cube_array",B.keyword,"texture_cube_array"),texture_multisampled_2d:new U("texture_multisampled_2d",B.keyword,"texture_multisampled_2d"),texture_storage_1d:new U("texture_storage_1d",B.keyword,"texture_storage_1d"),texture_storage_2d:new U("texture_storage_2d",B.keyword,"texture_storage_2d"),texture_storage_2d_array:new U("texture_storage_2d_array",B.keyword,"texture_storage_2d_array"),texture_storage_3d:new U("texture_storage_3d",B.keyword,"texture_storage_3d"),texture_depth_2d:new U("texture_depth_2d",B.keyword,"texture_depth_2d"),texture_depth_2d_array:new U("texture_depth_2d_array",B.keyword,"texture_depth_2d_array"),texture_depth_cube:new U("texture_depth_cube",B.keyword,"texture_depth_cube"),texture_depth_cube_array:new U("texture_depth_cube_array",B.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new U("texture_depth_multisampled_2d",B.keyword,"texture_depth_multisampled_2d"),texture_external:new U("texture_external",B.keyword,"texture_external"),u32:new U("u32",B.keyword,"u32"),vec2:new U("vec2",B.keyword,"vec2"),vec3:new U("vec3",B.keyword,"vec3"),vec4:new U("vec4",B.keyword,"vec4"),bitcast:new U("bitcast",B.keyword,"bitcast"),block:new U("block",B.keyword,"block"),break:new U("break",B.keyword,"break"),case:new U("case",B.keyword,"case"),continue:new U("continue",B.keyword,"continue"),continuing:new U("continuing",B.keyword,"continuing"),default:new U("default",B.keyword,"default"),diagnostic:new U("diagnostic",B.keyword,"diagnostic"),discard:new U("discard",B.keyword,"discard"),else:new U("else",B.keyword,"else"),enable:new U("enable",B.keyword,"enable"),fallthrough:new U("fallthrough",B.keyword,"fallthrough"),false:new U("false",B.keyword,"false"),fn:new U("fn",B.keyword,"fn"),for:new U("for",B.keyword,"for"),function:new U("function",B.keyword,"function"),if:new U("if",B.keyword,"if"),let:new U("let",B.keyword,"let"),const:new U("const",B.keyword,"const"),loop:new U("loop",B.keyword,"loop"),while:new U("while",B.keyword,"while"),private:new U("private",B.keyword,"private"),read:new U("read",B.keyword,"read"),read_write:new U("read_write",B.keyword,"read_write"),return:new U("return",B.keyword,"return"),requires:new U("requires",B.keyword,"requires"),storage:new U("storage",B.keyword,"storage"),switch:new U("switch",B.keyword,"switch"),true:new U("true",B.keyword,"true"),alias:new U("alias",B.keyword,"alias"),type:new U("type",B.keyword,"type"),uniform:new U("uniform",B.keyword,"uniform"),var:new U("var",B.keyword,"var"),override:new U("override",B.keyword,"override"),workgroup:new U("workgroup",B.keyword,"workgroup"),write:new U("write",B.keyword,"write"),r8unorm:new U("r8unorm",B.keyword,"r8unorm"),r8snorm:new U("r8snorm",B.keyword,"r8snorm"),r8uint:new U("r8uint",B.keyword,"r8uint"),r8sint:new U("r8sint",B.keyword,"r8sint"),r16uint:new U("r16uint",B.keyword,"r16uint"),r16sint:new U("r16sint",B.keyword,"r16sint"),r16float:new U("r16float",B.keyword,"r16float"),rg8unorm:new U("rg8unorm",B.keyword,"rg8unorm"),rg8snorm:new U("rg8snorm",B.keyword,"rg8snorm"),rg8uint:new U("rg8uint",B.keyword,"rg8uint"),rg8sint:new U("rg8sint",B.keyword,"rg8sint"),r32uint:new U("r32uint",B.keyword,"r32uint"),r32sint:new U("r32sint",B.keyword,"r32sint"),r32float:new U("r32float",B.keyword,"r32float"),rg16uint:new U("rg16uint",B.keyword,"rg16uint"),rg16sint:new U("rg16sint",B.keyword,"rg16sint"),rg16float:new U("rg16float",B.keyword,"rg16float"),rgba8unorm:new U("rgba8unorm",B.keyword,"rgba8unorm"),rgba8unorm_srgb:new U("rgba8unorm_srgb",B.keyword,"rgba8unorm_srgb"),rgba8snorm:new U("rgba8snorm",B.keyword,"rgba8snorm"),rgba8uint:new U("rgba8uint",B.keyword,"rgba8uint"),rgba8sint:new U("rgba8sint",B.keyword,"rgba8sint"),bgra8unorm:new U("bgra8unorm",B.keyword,"bgra8unorm"),bgra8unorm_srgb:new U("bgra8unorm_srgb",B.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new U("rgb10a2unorm",B.keyword,"rgb10a2unorm"),rg11b10float:new U("rg11b10float",B.keyword,"rg11b10float"),rg32uint:new U("rg32uint",B.keyword,"rg32uint"),rg32sint:new U("rg32sint",B.keyword,"rg32sint"),rg32float:new U("rg32float",B.keyword,"rg32float"),rgba16uint:new U("rgba16uint",B.keyword,"rgba16uint"),rgba16sint:new U("rgba16sint",B.keyword,"rgba16sint"),rgba16float:new U("rgba16float",B.keyword,"rgba16float"),rgba32uint:new U("rgba32uint",B.keyword,"rgba32uint"),rgba32sint:new U("rgba32sint",B.keyword,"rgba32sint"),rgba32float:new U("rgba32float",B.keyword,"rgba32float"),static_assert:new U("static_assert",B.keyword,"static_assert")},T.tokens={decimal_float_literal:new U("decimal_float_literal",B.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new U("hex_float_literal",B.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new U("int_literal",B.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new U("uint_literal",B.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new U("name",B.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new U("ident",B.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new U("and",B.token,"&"),and_and:new U("and_and",B.token,"&&"),arrow:new U("arrow ",B.token,"->"),attr:new U("attr",B.token,"@"),forward_slash:new U("forward_slash",B.token,"/"),bang:new U("bang",B.token,"!"),bracket_left:new U("bracket_left",B.token,"["),bracket_right:new U("bracket_right",B.token,"]"),brace_left:new U("brace_left",B.token,"{"),brace_right:new U("brace_right",B.token,"}"),colon:new U("colon",B.token,":"),comma:new U("comma",B.token,","),equal:new U("equal",B.token,"="),equal_equal:new U("equal_equal",B.token,"=="),not_equal:new U("not_equal",B.token,"!="),greater_than:new U("greater_than",B.token,">"),greater_than_equal:new U("greater_than_equal",B.token,">="),shift_right:new U("shift_right",B.token,">>"),less_than:new U("less_than",B.token,"<"),less_than_equal:new U("less_than_equal",B.token,"<="),shift_left:new U("shift_left",B.token,"<<"),modulo:new U("modulo",B.token,"%"),minus:new U("minus",B.token,"-"),minus_minus:new U("minus_minus",B.token,"--"),period:new U("period",B.token,"."),plus:new U("plus",B.token,"+"),plus_plus:new U("plus_plus",B.token,"++"),or:new U("or",B.token,"|"),or_or:new U("or_or",B.token,"||"),paren_left:new U("paren_left",B.token,"("),paren_right:new U("paren_right",B.token,")"),semicolon:new U("semicolon",B.token,";"),star:new U("star",B.token,"*"),tilde:new U("tilde",B.token,"~"),underscore:new U("underscore",B.token,"_"),xor:new U("xor",B.token,"^"),plus_equal:new U("plus_equal",B.token,"+="),minus_equal:new U("minus_equal",B.token,"-="),times_equal:new U("times_equal",B.token,"*="),division_equal:new U("division_equal",B.token,"/="),modulo_equal:new U("modulo_equal",B.token,"%="),and_equal:new U("and_equal",B.token,"&="),or_equal:new U("or_equal",B.token,"|="),xor_equal:new U("xor_equal",B.token,"^="),shift_right_equal:new U("shift_right_equal",B.token,">>="),shift_left_equal:new U("shift_left_equal",B.token,"<<=")},T.simpleTokens={"@":W.tokens.attr,"{":W.tokens.brace_left,"}":W.tokens.brace_right,":":W.tokens.colon,",":W.tokens.comma,"(":W.tokens.paren_left,")":W.tokens.paren_right,";":W.tokens.semicolon},T.literalTokens={"&":W.tokens.and,"&&":W.tokens.and_and,"->":W.tokens.arrow,"/":W.tokens.forward_slash,"!":W.tokens.bang,"[":W.tokens.bracket_left,"]":W.tokens.bracket_right,"=":W.tokens.equal,"==":W.tokens.equal_equal,"!=":W.tokens.not_equal,">":W.tokens.greater_than,">=":W.tokens.greater_than_equal,">>":W.tokens.shift_right,"<":W.tokens.less_than,"<=":W.tokens.less_than_equal,"<<":W.tokens.shift_left,"%":W.tokens.modulo,"-":W.tokens.minus,"--":W.tokens.minus_minus,".":W.tokens.period,"+":W.tokens.plus,"++":W.tokens.plus_plus,"|":W.tokens.or,"||":W.tokens.or_or,"*":W.tokens.star,"~":W.tokens.tilde,_:W.tokens.underscore,"^":W.tokens.xor,"+=":W.tokens.plus_equal,"-=":W.tokens.minus_equal,"*=":W.tokens.times_equal,"/=":W.tokens.division_equal,"%=":W.tokens.modulo_equal,"&=":W.tokens.and_equal,"|=":W.tokens.or_equal,"^=":W.tokens.xor_equal,">>=":W.tokens.shift_right_equal,"<<=":W.tokens.shift_left_equal},T.regexTokens={decimal_float_literal:W.tokens.decimal_float_literal,hex_float_literal:W.tokens.hex_float_literal,int_literal:W.tokens.int_literal,uint_literal:W.tokens.uint_literal,ident:W.tokens.ident},T.storage_class=[W.keywords.function,W.keywords.private,W.keywords.workgroup,W.keywords.uniform,W.keywords.storage],T.access_mode=[W.keywords.read,W.keywords.write,W.keywords.read_write],T.sampler_type=[W.keywords.sampler,W.keywords.sampler_comparison],T.sampled_texture_type=[W.keywords.texture_1d,W.keywords.texture_2d,W.keywords.texture_2d_array,W.keywords.texture_3d,W.keywords.texture_cube,W.keywords.texture_cube_array],T.multisampled_texture_type=[W.keywords.texture_multisampled_2d],T.storage_texture_type=[W.keywords.texture_storage_1d,W.keywords.texture_storage_2d,W.keywords.texture_storage_2d_array,W.keywords.texture_storage_3d],T.depth_texture_type=[W.keywords.texture_depth_2d,W.keywords.texture_depth_2d_array,W.keywords.texture_depth_cube,W.keywords.texture_depth_cube_array,W.keywords.texture_depth_multisampled_2d],T.texture_external_type=[W.keywords.texture_external],T.any_texture_type=[...W.sampled_texture_type,...W.multisampled_texture_type,...W.storage_texture_type,...W.depth_texture_type,...W.texture_external_type],T.texel_format=[W.keywords.r8unorm,W.keywords.r8snorm,W.keywords.r8uint,W.keywords.r8sint,W.keywords.r16uint,W.keywords.r16sint,W.keywords.r16float,W.keywords.rg8unorm,W.keywords.rg8snorm,W.keywords.rg8uint,W.keywords.rg8sint,W.keywords.r32uint,W.keywords.r32sint,W.keywords.r32float,W.keywords.rg16uint,W.keywords.rg16sint,W.keywords.rg16float,W.keywords.rgba8unorm,W.keywords.rgba8unorm_srgb,W.keywords.rgba8snorm,W.keywords.rgba8uint,W.keywords.rgba8sint,W.keywords.bgra8unorm,W.keywords.bgra8unorm_srgb,W.keywords.rgb10a2unorm,W.keywords.rg11b10float,W.keywords.rg32uint,W.keywords.rg32sint,W.keywords.rg32float,W.keywords.rgba16uint,W.keywords.rgba16sint,W.keywords.rgba16float,W.keywords.rgba32uint,W.keywords.rgba32sint,W.keywords.rgba32float],T.const_literal=[W.tokens.int_literal,W.tokens.uint_literal,W.tokens.decimal_float_literal,W.tokens.hex_float_literal,W.keywords.true,W.keywords.false],T.literal_or_ident=[W.tokens.ident,W.tokens.int_literal,W.tokens.uint_literal,W.tokens.decimal_float_literal,W.tokens.hex_float_literal,W.tokens.name],T.element_count_expression=[W.tokens.int_literal,W.tokens.uint_literal,W.tokens.ident],T.template_types=[W.keywords.vec2,W.keywords.vec3,W.keywords.vec4,W.keywords.mat2x2,W.keywords.mat2x3,W.keywords.mat2x4,W.keywords.mat3x2,W.keywords.mat3x3,W.keywords.mat3x4,W.keywords.mat4x2,W.keywords.mat4x3,W.keywords.mat4x4,W.keywords.atomic,W.keywords.bitcast,...W.any_texture_type],T.attribute_name=[W.tokens.ident,W.keywords.block,W.keywords.diagnostic],T.assignment_operators=[W.tokens.equal,W.tokens.plus_equal,W.tokens.minus_equal,W.tokens.times_equal,W.tokens.division_equal,W.tokens.modulo_equal,W.tokens.and_equal,W.tokens.or_equal,W.tokens.xor_equal,W.tokens.shift_right_equal,W.tokens.shift_left_equal],T.increment_operators=[W.tokens.plus_plus,W.tokens.minus_minus];class ny{constructor(e,t,r,i,s){this.type=e,this.lexeme=t,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return T.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==T.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class kA{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new ny(T.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let l=1;for(;l>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),l--,l==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),l++)}return!0}}const t=T.simpleTokens[e];if(t)return this._addToken(t),!0;let r=T.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let l=this._peekAhead();for(;this._isAlphaNumeric(l);)e+=this._advance(),l=this._peekAhead()}if(i){const l=T.keywords[e];if(l)return this._addToken(l),!0}if(i||s)return this._addToken(T.tokens.ident),!0;for(;;){let l=this._findType(e);const c=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(c=="=")return this._current++,e+=c,this._addToken(T.tokens.minus_equal),!0;if(c=="-")return this._current++,e+=c,this._addToken(T.tokens.minus_minus),!0;const f=this._tokens.length-1;if((T.literal_or_ident.indexOf(this._tokens[f].type)!=-1||this._tokens[f].type==T.tokens.paren_right)&&c!=">")return this._addToken(l),!0}if(e==">"&&(c==">"||c=="=")){let f=!1,h=this._tokens.length-1;for(let p=0;p<5&&h>=0&&T.assignment_operators.indexOf(this._tokens[h].type)===-1;++p,--h)if(this._tokens[h].type===T.tokens.less_than){h>0&&this._tokens[h-1].isArrayOrTemplateType()&&(f=!0);break}if(f)return this._addToken(l),!0}if(l===T.none){let f=e,h=0;const p=2;for(let _=0;_<p;++_)if(f+=this._peekAhead(_),l=this._findType(f),l!==T.none){h=_;break}if(l===T.none)return r!==T.none&&(this._current--,this._addToken(r),!0);e=f,this._current+=h+1}if(r=l,this._isAtEnd())break;e+=this._advance()}return r!==T.none&&(this._addToken(r),!0)}_findType(e){for(const r in T.regexTokens){const i=T.regexTokens[r];if(this._match(e,i.rule))return i}return T.literalTokens[e]||T.none}_match(e,t){const r=t.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new ny(e,t,this._line,this._start,this._current))}}function he(n){return Array.isArray(n)||n?.buffer instanceof ArrayBuffer}const tc=new Float32Array(1),MA=new Uint32Array(tc.buffer),OA=new Uint32Array(tc.buffer),nc=new Int32Array(1),NA=new Float32Array(nc.buffer),DA=new Uint32Array(nc.buffer),rc=new Uint32Array(1),FA=new Float32Array(rc.buffer),LA=new Int32Array(rc.buffer);function ry(n,e,t){if(e===t)return n;if(e==="f32"){if(t==="i32"||t==="x32")return tc[0]=n,MA[0];if(t==="u32")return tc[0]=n,OA[0]}else if(e==="i32"||e==="x32"){if(t==="f32")return nc[0]=n,NA[0];if(t==="u32")return nc[0]=n,DA[0]}else if(e==="u32"){if(t==="f32")return rc[0]=n,FA[0];if(t==="i32"||t==="x32")return rc[0]=n,LA[0]}return console.error(`Unsupported cast from ${e} to ${t}`),n}class BA{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class _l{constructor(e,t){this.align=e,this.size=t}}class tr{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new wA,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const t of e)t instanceof $o&&this._functions.set(t.name,new BA(t));for(const t of e)if(t instanceof pr){const r=this.getTypeInfo(t,null);r instanceof Kr&&this.structs.push(r)}for(const t of e)if(t instanceof Hd)this.aliases.push(this._getAliasInfo(t));else if(t instanceof jd){const r=t,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new yA(r.name,s,r.attributes,i))}else if(this._isUniformVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),l=this.getTypeInfo(r.type,r.attributes),c=new gl(r.name,l,i,s,r.attributes,Hr.Uniform,r.access);c.access||(c.access="read"),this.uniforms.push(c)}else if(this._isStorageVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),l=this.getTypeInfo(r.type,r.attributes),c=this._isStorageTexture(l),f=new gl(r.name,l,i,s,r.attributes,c?Hr.StorageTexture:Hr.Storage,r.access);f.access||(f.access="read"),this.storage.push(f)}else if(this._isTextureVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),l=this.getTypeInfo(r.type,r.attributes),c=this._isStorageTexture(l),f=new gl(r.name,l,i,s,r.attributes,c?Hr.StorageTexture:Hr.Texture,r.access);f.access||(f.access="read"),c?this.storage.push(f):this.textures.push(f)}else if(this._isSamplerVar(t)){const r=t,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),l=this.getTypeInfo(r.type,r.attributes),c=new gl(r.name,l,i,s,r.attributes,Hr.Sampler,r.access);this.samplers.push(c)}for(const t of e)if(t instanceof $o){const r=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),s=this._getAttribute(t,"compute"),l=r||i||s,c=new bA(t.name,l?.name,t.attributes);c.attributes=t.attributes,c.startLine=t.startLine,c.endLine=t.endLine,this.functions.push(c),this._functions.get(t.name).info=c,l&&(this._functions.get(t.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(t,!!l),c.inputs=this._getInputs(t.args),c.outputs=this._getOutputs(t.returnType),this.entry[l.name].push(c)),c.arguments=t.args.map(f=>new vA(f.name,this.getTypeInfo(f.type,f.attributes),f.attributes)),c.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null}for(const t of this._functions.values())t.info&&(t.info.inUse=t.inUse,this._addCalls(t.node,t.info.calls));for(const t of this._functions.values())t.node.search(r=>{var i,s,l;if(r instanceof gb){if(r.value)if(he(r.value))for(const c of r.value)for(const f of this.overrides)c===f.name&&((i=t.info)===null||i===void 0||i.overrides.push(f));else for(const c of this.overrides)r.value===c.name&&((s=t.info)===null||s===void 0||s.overrides.push(c))}else if(r instanceof _n)for(const c of this.overrides)r.name===c.name&&((l=t.info)===null||l===void 0||l.overrides.push(c))});for(const t of this.uniforms)this._markStructsInUse(t.type);for(const t of this.storage)this._markStructsInUse(t.type)}getStructInfo(e){for(const t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(const t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&t.add(s)}}findResource(e,t,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==t)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(const i of this.storage)if(i.group==e&&i.binding==t)return i;for(const i of this.textures)if(i.group==e&&i.binding==t)return i;for(const i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(const t of this.uniforms)if(t.name==e)return t;for(const t of this.storage)if(t.name==e)return t;for(const t of this.textures)if(t.name==e)return t;for(const t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){const t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){const r=[],i=this,s=[];return e.search(l=>{if(l instanceof Gl)s.push({});else if(l instanceof ec)s.pop();else if(l instanceof _r){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(l instanceof Jn){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type)}else if(l instanceof No){const c=l;t&&c.type!==null&&this._markStructsFromAST(c.type),s.length>0&&(s[s.length-1][c.name]=c)}else if(l instanceof _n){const c=l;if(s.length>0&&s[s.length-1][c.name])return;const f=i._findResource(c.name);f&&r.push(f)}else if(l instanceof Xd){const c=l,f=i._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,t)),r.push(...f.resources))}else if(l instanceof Wd){const c=l,f=i._functions.get(c.name);f&&(t&&(f.inUse=!0),e.calls.add(f.node),f.resources===null&&(f.resources=i._findResources(f.node,t)),r.push(...f.resources))}}),[...new Map(r.map(l=>[l.name,l])).values()]}getBindGroups(){const e=[];function t(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)t(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)t(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,t=void 0){if(t===void 0&&(t=[]),e instanceof pr)this._getStructOutputs(e,t);else{const r=this._getOutputInfo(e);r!==null&&t.push(r)}return t}_getStructOutputs(e,t){for(const r of e.members)if(r.type instanceof pr)this._getStructOutputs(r.type,t);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),l=this._parseInt(i.value),c=new Qm(r.name,s,i.name,l);t.push(c)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Qm("",r,t.name,i)}return null}_getInputs(e,t=void 0){t===void 0&&(t=[]);for(const r of e)if(r.type instanceof pr)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}return t}_getStructInputs(e,t){for(const r of e.members)if(r.type instanceof pr)this._getStructInputs(r.type,t);else{const i=this._getInputInfo(r);i!==null&&t.push(i)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(t!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(t.value),l=new mA(e.name,i,t.name,s);return r!==null&&(l.interpolation=this._parseString(r.value)),l}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new _A(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const t of this.structs)if(t.name==e)return t;for(const t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof Ml){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new Gh(e.name,i,t);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Do){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,l=new Jr(i.name,t);return l.format=s,l.count=i.count,this._types.set(e,l),this._updateTypeInfo(l),l}if(e instanceof pr){const i=e,s=new Kr(i.name,t);s.startLine=i.startLine,s.endLine=i.endLine;for(const l of i.members){const c=this.getTypeInfo(l.type,l.attributes);s.members.push(new Zm(l.name,c,l.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Co){const i=e,s=i.format instanceof J,l=i.format?s?this.getTypeInfo(i.format,null):new An(i.format,null):null,c=new Ei(i.name,l,t,i.access);return this._types.set(e,c),this._updateTypeInfo(c),c}if(e instanceof $){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,l=new Ei(i.name,s,t,i.access);return this._types.set(e,l),this._updateTypeInfo(l),l}const r=new An(e.name,t);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var t,r,i;const s=this._getTypeSize(e);if(e.size=(t=s?.size)!==null&&t!==void 0?t:0,e instanceof Jr&&e.format){const l=this._getTypeSize(e.format);e.stride=Math.max((r=l?.size)!==null&&r!==void 0?r:0,(i=l?.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof Gh&&this._updateTypeInfo(e.format),e instanceof Kr&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let r=0,i=0,s=0,l=0;for(let c=0,f=e.members.length;c<f;++c){const h=e.members[c],p=this._getTypeSize(h);if(!p)continue;(t=this._getAlias(h.type.name))!==null&&t!==void 0||h.type;const _=p.align,y=p.size;r=this._roundUp(_,r+i),i=y,s=r,l=Math.max(l,_),h.offset=r,h.size=y,this._updateTypeInfo(h.type)}e.size=this._roundUp(l,s+i),e.align=l}_getTypeSize(e){var t,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Zm&&(e=e.type),e instanceof An){const l=this._getAlias(e.name);l!==null&&(e=l)}{const l=tr._typeInfo[e.name];if(l!==void 0){const c=((t=e.format)===null||t===void 0?void 0:t.name)==="f16"?2:1;return new _l(Math.max(s,l.align/c),Math.max(i,l.size/c))}}{const l=tr._typeInfo[e.name.substring(0,e.name.length-1)];if(l){const c=e.name[e.name.length-1]==="h"?2:1;return new _l(Math.max(s,l.align/c),Math.max(i,l.size/c))}}if(e instanceof Jr){let l=e,c=8,f=8;const h=this._getTypeSize(l.format);return h!==null&&(f=h.size,c=h.align),f=l.count*this._getAttributeNum((r=e?.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(c,f)),i&&(f=i),new _l(Math.max(s,c),Math.max(i,f))}if(e instanceof Kr){let l=0,c=0,f=0,h=0,p=0;for(const _ of e.members){const y=this._getTypeSize(_.type);y!==null&&(l=Math.max(y.align,l),f=this._roundUp(y.align,f+h),h=y.size,p=f)}return c=this._roundUp(l,p+h),new _l(Math.max(s,l),Math.max(i,c))}return null}_isUniformVar(e){return e instanceof _r&&e.storage=="uniform"}_isStorageVar(e){return e instanceof _r&&e.storage=="storage"}_isTextureVar(e){return e instanceof _r&&e.type!==null&&tr._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof _r&&e.type!==null&&tr._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,t){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==t)return s;return null}_getAttributeNum(e,t,r){if(e===null)return r;for(let i of e)if(i.name==t){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,t){return Math.ceil(t/e)*e}}tr._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},tr._textureTypes=T.any_texture_type.map(n=>n.name),tr._samplerTypes=T.sampler_type.map(n=>n.name);let Yd=0;class Kd{constructor(e,t,r){this.id=Yd++,this.name=e,this.value=t,this.node=r}clone(){return new Kd(this.name,this.value,this.node)}}class qd{constructor(e){this.id=Yd++,this.name=e.name,this.node=e}clone(){return new qd(this.node)}}class Zd{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=Yd++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?(t=this.variables.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?(t=this.functions.get(e))!==null&&t!==void 0?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,r){this.variables.set(e,new Kd(e,t,r??null))}setVariable(e,t,r){const i=this.getVariable(e);i!==null?i.value=t:this.createVariable(e,t,r)}getVariableValue(e){var t;const r=this.getVariable(e);return(t=r?.value)!==null&&t!==void 0?t:null}clone(){return new Zd(this)}}class UA{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class VA{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){const r=this.exec.evalExpression(e.args[0],t);let i=!0;if(r instanceof A)return r.data.forEach(s=>{s||(i=!1)}),new F(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A){const i=r.data.some(s=>s);return new F(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){const r=this.exec.evalExpression(e.args[2],t);if(!(r instanceof F))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.evalExpression(r,t);if(i instanceof ht&&i.typeInfo.size===0){const s=i.typeInfo,l=i.buffer.byteLength/s.stride;return new F(l,this.getTypeInfo("u32"))}return new F(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new F(Math.abs(i.value),i.typeInfo)}Acos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new F(Math.acos(i.value),r.typeInfo)}Acosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new F(Math.acosh(i.value),r.typeInfo)}Asin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new F(Math.asin(i.value),r.typeInfo)}Asinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new F(Math.asinh(i.value),r.typeInfo)}Atan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new F(Math.atan(i.value),r.typeInfo)}Atanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new F(Math.atanh(i.value),r.typeInfo)}Atan2(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A)return new A(r.data.map((c,f)=>Math.atan2(c,i.data[f])),r.typeInfo);const s=r,l=i;return new F(Math.atan2(s.value,l.value),r.typeInfo)}Ceil(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new F(Math.ceil(i.value),r.typeInfo)}_clamp(e,t,r){return Math.min(Math.max(e,t),r)}Clamp(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof A&&i instanceof A&&s instanceof A)return new A(r.data.map((h,p)=>this._clamp(h,i.data[p],s.data[p])),r.typeInfo);const l=r,c=i,f=s;return new F(this._clamp(l.value,c.value,f.value),r.typeInfo)}Cos(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new F(Math.cos(i.value),r.typeInfo)}Cosh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new F(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new F(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let t=0;for(;e!==0;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new F(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new F(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,l=i.data;return new A([s[1]*l[2]-l[1]*s[2],s[2]*l[0]-l[2]*s[0],s[0]*l[1]-l[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){const r=this.exec.evalExpression(e.args[0],t),i=180/Math.PI;return r instanceof A?new A(r.data.map(s=>s*i),r.typeInfo):new F(r.value*i,this.getTypeInfo("f32"))}Determinant(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof Ae){const i=r.data,s=r.typeInfo.getTypeName(),l=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new F(i[0]*i[3]-i[1]*i[2],l);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new F(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),l);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new F(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),l);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A){let c=0;for(let f=0;f<r.data.length;++f)c+=(r.data[f]-i.data[f])*(r.data[f]-i.data[f]);return new F(Math.sqrt(c),this.getTypeInfo("f32"))}const s=r,l=i;return new F(Math.abs(s.value-l.value),r.typeInfo)}_dot(e,t){let r=0;for(let i=0;i<e.length;++i)r+=t[i]*e[i];return r}Dot(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);return r instanceof A&&i instanceof A?new F(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new F(Math.exp(i.value),r.typeInfo)}Exp2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new F(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const l=i.value,c=s.value;if(r instanceof A)return new A(r.data.map(h=>h>>l&(1<<c)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const f=r.value;return new F(f>>l&(1<<c)-1,this.getTypeInfo("i32"))}FaceForward(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof A&&i instanceof A&&s instanceof A){const l=this._dot(i.data,s.data);return new A(l<0?Array.from(r.data):r.data.map(c=>-c),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new F(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new F(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new F(Math.floor(i.value),r.typeInfo)}Fma(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof A&&i instanceof A&&s instanceof A)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new A(r.data.map((h,p)=>h*i.data[p]+s.data[p]),r.typeInfo);const l=r,c=i,f=s;return new F(l.value*c.value+f.value,l.typeInfo)}Fract(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new F(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t),l=this.exec.evalExpression(e.args[3],t);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const c=s.value,f=(1<<l.value)-1<<c,h=~f;if(r instanceof A&&i instanceof A)return new A(r.data.map((y,b)=>y&h|i.data[b]<<c&f),r.typeInfo);const p=r.value,_=i.value;return new F(p&h|_<<c&f,r.typeInfo)}InverseSqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new F(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A){let s=0;return r.data.forEach(l=>{s+=l*l}),new F(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new F(Math.abs(i.value),r.typeInfo)}Log(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new F(Math.log(i.value),r.typeInfo)}Log2(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new F(Math.log2(i.value),r.typeInfo)}Max(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A)return new A(r.data.map((c,f)=>Math.max(c,i.data[f])),r.typeInfo);const s=r,l=i;return new F(Math.max(s.value,l.value),r.typeInfo)}Min(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A)return new A(r.data.map((c,f)=>Math.min(c,i.data[f])),r.typeInfo);const s=r,l=i;return new F(Math.min(s.value,l.value),r.typeInfo)}Mix(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof A&&i instanceof A&&s instanceof A)return new A(r.data.map((f,h)=>r.data[h]*(1-s.data[h])+i.data[h]*s.data[h]),r.typeInfo);const l=i,c=s;return new F(r.value*(1-c.value)+l.value*c.value,r.typeInfo)}Modf(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A)return new A(r.data.map((l,c)=>l%i.data[c]),r.typeInfo);const s=i;return new F(r.value%s.value,r.typeInfo)}Normalize(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A){const i=this.Length(e,t).value;return new A(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A)return new A(r.data.map((c,f)=>Math.pow(c,i.data[f])),r.typeInfo);const s=r,l=i;return new F(Math.pow(s.value,l.value),r.typeInfo)}QuantizeToF16(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof A?new A(r.data.map(i=>i),r.typeInfo):new F(r.value,r.typeInfo)}Radians(e,t){const r=this.exec.evalExpression(e.args[0],t);return r instanceof A?new A(r.data.map(i=>i*Math.PI/180),r.typeInfo):new F(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(r instanceof A&&i instanceof A){const s=this._dot(r.data,i.data);return new A(r.data.map((l,c)=>l-2*s*i.data[c]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(r instanceof A&&i instanceof A&&s instanceof F){const l=this._dot(i.data,r.data);return new A(r.data.map((c,f)=>{const h=1-s.value*s.value*(1-l*l);if(h<0)return 0;const p=Math.sqrt(h);return s.value*c-(s.value*l+p)*i.data[f]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new F(Math.round(i.value),r.typeInfo)}Saturate(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new F(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new F(Math.sign(i.value),r.typeInfo)}Sin(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new F(Math.sin(i.value),r.typeInfo)}Sinh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new F(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,t,r){const i=Math.min(Math.max((r-e)/(t-e),0),1);return i*i*(3-2*i)}SmoothStep(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t),s=this.exec.evalExpression(e.args[2],t);if(s instanceof A&&r instanceof A&&i instanceof A)return new A(s.data.map((h,p)=>this._smoothstep(r.data[p],i.data[p],h)),s.typeInfo);const l=r,c=i,f=s;return new F(this._smoothstep(l.value,c.value,f.value),s.typeInfo)}Sqrt(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new F(Math.sqrt(i.value),r.typeInfo)}Step(e,t){const r=this.exec.evalExpression(e.args[0],t),i=this.exec.evalExpression(e.args[1],t);if(i instanceof A&&r instanceof A)return new A(i.data.map((l,c)=>l<r.data[c]?0:1),i.typeInfo);const s=r;return new F(i.value<s.value?0:1,s.typeInfo)}Tan(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new F(Math.tan(i.value),r.typeInfo)}Tanh(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new F(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const t=e.getTypeName();return t==="mat2x2f"||t==="mat2x2h"?e:t==="mat2x3f"?this.getTypeInfo("mat3x2f"):t==="mat2x3h"?this.getTypeInfo("mat3x2h"):t==="mat2x4f"?this.getTypeInfo("mat4x2f"):t==="mat2x4h"?this.getTypeInfo("mat4x2h"):t==="mat3x2f"?this.getTypeInfo("mat2x3f"):t==="mat3x2h"?this.getTypeInfo("mat2x3h"):t==="mat3x3f"||t==="mat3x3h"?e:t==="mat3x4f"?this.getTypeInfo("mat4x3f"):t==="mat3x4h"?this.getTypeInfo("mat4x3h"):t==="mat4x2f"?this.getTypeInfo("mat2x4f"):t==="mat4x2h"?this.getTypeInfo("mat2x4h"):t==="mat4x3f"?this.getTypeInfo("mat3x4f"):t==="mat4x3h"?this.getTypeInfo("mat3x4h"):(t==="mat4x4f"||t==="mat4x4h"||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){const r=this.exec.evalExpression(e.args[0],t);if(!(r instanceof Ae))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new Ae([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new Ae([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new Ae([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new Ae([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new Ae([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new Ae([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new Ae([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new Ae([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new Ae([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,t){const r=this.exec.evalExpression(e.args[0],t);if(r instanceof A)return new A(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new F(Math.trunc(i.value),r.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(r instanceof _n){const s=r.name,l=t.getVariableValue(s);if(l instanceof gr){if(i<0||i>=l.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const c=l.getMipLevelSize(i),f=l.dimension;return f==="1d"?new F(c[0],this.getTypeInfo("u32")):f==="3d"?new A(c,this.getTypeInfo("vec3u")):f==="2d"?new A(c.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${f} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(i instanceof A)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof _n){const l=r.name,c=t.getVariableValue(l);if(c instanceof gr){const f=Math.floor(i.data[0]),h=Math.floor(i.data[1]);if(f<0||f>=c.width||h<0||h>=c.height)return console.error(`Texture ${l} out of bounds. Line ${e.line}`),null;const p=c.getPixel(f,h,0,s);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new A(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${l} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){const r=e.args[0];if(r instanceof _n){const i=r.name,s=t.getVariableValue(i);return s instanceof gr?new F(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){const r=e.args[0];if(r instanceof _n){const i=r.name,s=t.getVariableValue(i);return s instanceof gr?new F(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){const r=e.args[0];if(r instanceof _n){const i=r.name,s=t.getVariableValue(i);return s instanceof gr?new F(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){const r=e.args[0],i=this.exec.evalExpression(e.args[1],t),s=e.args.length===4?this.exec.evalExpression(e.args[2],t).value:0,l=e.args.length===4?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(l.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof A)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof _n){const c=r.name,f=t.getVariableValue(c);if(f instanceof gr){const h=f.getMipLevelSize(0),p=Math.floor(i.data[0]),_=Math.floor(i.data[1]);return p<0||p>=h[0]||_<0||_>=h[1]?(console.error(`Texture ${c} out of bounds. Line ${e.line}`),null):(f.setPixel(p,_,0,s,Array.from(l)),null)}return console.error(`Texture ${c} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t);return t.getVariable(i).value.getSubData(this.exec,r.postfix,t)}AtomicStore(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t);return f instanceof F&&c instanceof F&&(f.value=c.value),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),null}AtomicAdd(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value+=c.value),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicSub(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value-=c.value),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicMax(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value=Math.max(f.value,c.value)),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicMin(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value=Math.min(f.value,c.value)),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicAnd(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value=f.value&c.value),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicOr(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value=f.value|c.value),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicXor(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value=f.value^c.value),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicExchange(e,t){let r=e.args[0];r instanceof vt&&(r=r.right);const i=this.exec.getVariableName(r,t),s=t.getVariable(i);let l=e.args[1];const c=this.exec.evalExpression(l,t),f=s.value.getSubData(this.exec,r.postfix,t),h=new F(f.value,f.typeInfo);return f instanceof F&&c instanceof F&&(f.value=c.value),s.value instanceof ht&&s.value.setDataValue(this.exec,f,r.postfix,t),h}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}const fh={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Kt={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class zt extends UA{constructor(e,t){var r;super(),this.ast=e??[],this.reflection=new tr,this.reflection.updateAST(this.ast),this.context=(r=t?.clone())!==null&&r!==void 0?r:new Zd,this.builtins=new VA(this),this.typeInfo={bool:this.getTypeInfo(J.bool),i32:this.getTypeInfo(J.i32),u32:this.getTypeInfo(J.u32),f32:this.getTypeInfo(J.f32),f16:this.getTypeInfo(J.f16),vec2f:this.getTypeInfo($.vec2f),vec2u:this.getTypeInfo($.vec2u),vec2i:this.getTypeInfo($.vec2i),vec2h:this.getTypeInfo($.vec2h),vec3f:this.getTypeInfo($.vec3f),vec3u:this.getTypeInfo($.vec3u),vec3i:this.getTypeInfo($.vec3i),vec3h:this.getTypeInfo($.vec3h),vec4f:this.getTypeInfo($.vec4f),vec4u:this.getTypeInfo($.vec4u),vec4i:this.getTypeInfo($.vec4i),vec4h:this.getTypeInfo($.vec4h),mat2x2f:this.getTypeInfo($.mat2x2f),mat2x3f:this.getTypeInfo($.mat2x3f),mat2x4f:this.getTypeInfo($.mat2x4f),mat3x2f:this.getTypeInfo($.mat3x2f),mat3x3f:this.getTypeInfo($.mat3x3f),mat3x4f:this.getTypeInfo($.mat3x4f),mat4x2f:this.getTypeInfo($.mat4x2f),mat4x3f:this.getTypeInfo($.mat4x3f),mat4x4f:this.getTypeInfo($.mat4x4f)}}getVariableValue(e){var t,r;const i=(r=(t=this.context.getVariable(e))===null||t===void 0?void 0:t.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof F)return i.value;if(i instanceof A||i instanceof Ae)return Array.from(i.data);if(i instanceof ht&&i.typeInfo instanceof Jr){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const l=s.getFunction(e);if(!l)return void console.error(`Function ${e} not found`);if(typeof t=="number")t=[t,1,1];else{if(t.length===0)return void console.error("Invalid dispatch count");t.length===1?t=[t[0],1,1]:t.length===2?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}const c=t[0],f=t[1],h=t[2],p=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new A(t,p));for(const _ in r)for(const y in r[_]){const b=r[_][y];s.variables.forEach(x=>{var S;const C=x.node;if(C?.attributes){let P=null,z=null;for(const k of C.attributes)k.name==="binding"?P=k.value:k.name==="group"&&(z=k.value);if(y==P&&_==z)if(b.texture!==void 0&&b.descriptor!==void 0){const k=new gr(b.texture,this.getTypeInfo(C.type),b.descriptor,(S=b.texture.view)!==null&&S!==void 0?S:null);x.value=k}else b.uniform!==void 0?x.value=new ht(b.uniform,this.getTypeInfo(C.type)):x.value=new ht(b,this.getTypeInfo(C.type))}})}for(let _=0;_<h;++_)for(let y=0;y<f;++y)for(let b=0;b<c;++b)s.setVariable("@workgroup_id",new A([b,y,_],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(l,[b,y,_],s)}execStatement(e,t){if(e instanceof sb)return this.evalExpression(e.value,t);if(e instanceof ab){if(e.condition){const r=this.evalExpression(e.condition,t);if(!(r instanceof F))throw new Error("Invalid break-if condition");if(!r.value)return null}return zt._breakObj}if(e instanceof lb)return zt._continueObj;if(e instanceof No)this._let(e,t);else if(e instanceof _r)this._var(e,t);else if(e instanceof kl)this._const(e,t);else if(e instanceof $o)this._function(e,t);else{if(e instanceof ib)return this._if(e,t);if(e instanceof rb)return this._switch(e,t);if(e instanceof Gv)return this._for(e,t);if(e instanceof Jv)return this._while(e,t);if(e instanceof nb)return this._loop(e,t);if(e instanceof ed){const r=t.clone();return r.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof tb)this._assign(e,t);else if(e instanceof eb)this._increment(e,t);else{if(e instanceof pr)return null;if(e instanceof jd){const r=e.name;t.getVariable(r)===null&&t.setVariable(r,new F(0,this.getTypeInfo("u32")))}else if(e instanceof Wd)this._call(e,t);else{if(e instanceof ob||e instanceof Hd)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof Un?this._evalBinaryOp(e,t):e instanceof St?this._evalLiteral(e,t):e instanceof _n?this._evalVariable(e,t):e instanceof Xd?this._evalCall(e,t):e instanceof Jn?this._evalCreate(e,t):e instanceof cb?this._evalConst(e,t):e instanceof ub?this._evalBitcast(e,t):e instanceof vt?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof J){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(t=this.typeInfo[e])!==null&&t!==void 0?t:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,t){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?t.setVariable(r,new F(i,s.type)):s.type.name==="bool"?t.setVariable(r,new F(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?t.setVariable(r,new A(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,r){const i=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const _=r.getVariableValue(p.value[0]);i[0]=_ instanceof F?_.value:parseInt(p.value[0])}if(p.value.length>1){const _=r.getVariableValue(p.value[1]);i[1]=_ instanceof F?_.value:parseInt(p.value[1])}if(p.value.length>2){const _=r.getVariableValue(p.value[2]);i[2]=_ instanceof F?_.value:parseInt(p.value[2])}}const s=this.getTypeInfo("vec3u"),l=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new A(i,s));const c=i[0],f=i[1],h=i[2];for(let p=0,_=0;p<h;++p)for(let y=0;y<f;++y)for(let b=0;b<c;++b,++_){const x=[b,y,p],S=[b+t[0]*i[0],y+t[1]*i[1],p+t[2]*i[2]];r.setVariable("@local_invocation_id",new A(x,s)),r.setVariable("@global_invocation_id",new A(S,s)),r.setVariable("@local_invocation_index",new F(_,l)),this._dispatchExec(e,r)}}_dispatchExec(e,t){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,l=t.getVariable(s);l!==void 0&&t.variables.set(r.name,l)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof vt;)e=e.right;return e instanceof _n?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(const r of e){if(r instanceof Array){const s=t.clone(),l=this._execStatements(r,s);if(l)return l;continue}const i=this.execStatement(r,t);if(i)return i}return null}_call(e,t){const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const l=i.node.args[s],c=this.evalExpression(e.args[s],r);r.setVariable(l.name,c,l)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){const r=this.getVariableName(e.variable,t),i=t.getVariable(r);i?e.operator==="++"?i.value instanceof F?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof F?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof _n){const r=this.getVariableName(e,t),i=t.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,t)}if(e instanceof vt){if(e.operator==="*"){const r=this._getVariableData(e.right,t);return r instanceof fs?r.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,t);return new fs(r)}}return null}_assign(e,t){let r=null,i="<var>",s=null;if(e.variable instanceof vt){const f=this._getVariableData(e.variable,t),h=this.evalExpression(e.value,t),p=e.operator;if(p==="="){if(f instanceof F||f instanceof A||f instanceof Ae){if(h instanceof F||h instanceof A||h instanceof Ae&&f.data.length===h.data.length)return void f.data.set(h.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(f instanceof ht&&h instanceof ht&&f.buffer.byteLength-f.offset>=h.buffer.byteLength-h.offset)return void(f.buffer.byteLength%4==0?new Uint32Array(f.buffer,f.offset,f.typeInfo.size/4).set(new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4)):new Uint8Array(f.buffer,f.offset,f.typeInfo.size).set(new Uint8Array(h.buffer,h.offset,h.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return f instanceof F||f instanceof A||f instanceof Ae?h instanceof F||h instanceof A||h instanceof Ae?void f.data.set(h.data.map((_,y)=>f.data[y]+_)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(f instanceof F||f instanceof A||f instanceof Ae)&&(h instanceof F||h instanceof A||h instanceof Ae)?void f.data.set(h.data.map((_,y)=>f.data[y]-_)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof vt){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,t);const f=t.getVariable(i);if(!(f&&f.value instanceof fs))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=f.value.reference;let h=e.variable.postfix;if(!h){let p=e.variable.right;for(;p instanceof vt;){if(p.postfix){h=p.postfix;break}p=p.right}}h&&(r=r.getSubData(this,h,t))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,t);const f=t.getVariable(i);if(f===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=f.value}if(r instanceof fs&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const l=this.evalExpression(e.value,t),c=e.operator;if(c==="=")if(r instanceof ht)r.setDataValue(this,l,s,t);else if(s){if(!(r instanceof A||r instanceof Ae))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof As){const f=this.evalExpression(s.index,t).value;if(r instanceof A){if(!(l instanceof F))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[f]=l.value}else{if(!(r instanceof Ae))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=this.evalExpression(s.index,t).value;if(h<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(l instanceof A))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const p=r.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(h<2&&l.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=l.data[0],r.data[2*h+1]=l.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(h<2&&l.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=l.data[0],r.data[3*h+1]=l.data[1],r.data[3*h+2]=l.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(h<2&&l.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=l.data[0],r.data[4*h+1]=l.data[1],r.data[4*h+2]=l.data[2],r.data[4*h+3]=l.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(h<3&&l.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=l.data[0],r.data[2*h+1]=l.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(h<3&&l.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=l.data[0],r.data[3*h+1]=l.data[1],r.data[3*h+2]=l.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(h<3&&l.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=l.data[0],r.data[4*h+1]=l.data[1],r.data[4*h+2]=l.data[2],r.data[4*h+3]=l.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(h<4&&l.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=l.data[0],r.data[2*h+1]=l.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(h<4&&l.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=l.data[0],r.data[3*h+1]=l.data[1],r.data[3*h+2]=l.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(h<4&&l.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=l.data[0],r.data[4*h+1]=l.data[1],r.data[4*h+2]=l.data[2],r.data[4*h+3]=l.data[3]}}}}}else if(s instanceof Ai){const f=s.value;if(!(r instanceof A))return void console.error(`Invalid assignment to ${f}. Variable ${i} is not a vector. Line ${e.line}`);if(l instanceof F){if(f.length>1)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);if(f==="x")r.data[0]=l.value;else if(f==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);r.data[1]=l.value}else if(f==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);r.data[2]=l.value}else if(f==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);r.data[3]=l.value}}else{if(!(l instanceof A))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(f.length!==l.data.length)return void console.error(`Invalid assignment to ${f} for variable ${i}. Line ${e.line}`);for(let h=0;h<f.length;++h){const p=f[h];if(p==="x"||p==="r")r.data[0]=l.data[h];else if(p==="y"||p==="g"){if(l.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);r.data[1]=l.data[h]}else if(p==="z"||p==="b"){if(l.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);r.data[2]=l.data[h]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);if(l.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);r.data[3]=l.data[h]}}}}}else r instanceof F&&l instanceof F?r.value=l.value:r instanceof A&&l instanceof A||r instanceof Ae&&l instanceof Ae?r.data.set(l.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`);else{const f=r.getSubData(this,s,t);if(f instanceof A&&l instanceof F){const h=f.data,p=l.value;if(c==="+=")for(let _=0;_<h.length;++_)h[_]+=p;else if(c==="-=")for(let _=0;_<h.length;++_)h[_]-=p;else if(c==="*=")for(let _=0;_<h.length;++_)h[_]*=p;else if(c==="/=")for(let _=0;_<h.length;++_)h[_]/=p;else if(c==="%=")for(let _=0;_<h.length;++_)h[_]%=p;else if(c==="&=")for(let _=0;_<h.length;++_)h[_]&=p;else if(c==="|=")for(let _=0;_<h.length;++_)h[_]|=p;else if(c==="^=")for(let _=0;_<h.length;++_)h[_]^=p;else if(c==="<<=")for(let _=0;_<h.length;++_)h[_]<<=p;else if(c===">>=")for(let _=0;_<h.length;++_)h[_]>>=p;else console.error(`Invalid operator ${c}. Line ${e.line}`)}else if(f instanceof A&&l instanceof A){const h=f.data,p=l.data;if(h.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(c==="+=")for(let _=0;_<h.length;++_)h[_]+=p[_];else if(c==="-=")for(let _=0;_<h.length;++_)h[_]-=p[_];else if(c==="*=")for(let _=0;_<h.length;++_)h[_]*=p[_];else if(c==="/=")for(let _=0;_<h.length;++_)h[_]/=p[_];else if(c==="%=")for(let _=0;_<h.length;++_)h[_]%=p[_];else if(c==="&=")for(let _=0;_<h.length;++_)h[_]&=p[_];else if(c==="|=")for(let _=0;_<h.length;++_)h[_]|=p[_];else if(c==="^=")for(let _=0;_<h.length;++_)h[_]^=p[_];else if(c==="<<=")for(let _=0;_<h.length;++_)h[_]<<=p[_];else if(c===">>=")for(let _=0;_<h.length;++_)h[_]>>=p[_];else console.error(`Invalid operator ${c}. Line ${e.line}`)}else{if(!(f instanceof F&&l instanceof F))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);c==="+="?f.value+=l.value:c==="-="?f.value-=l.value:c==="*="?f.value*=l.value:c==="/="?f.value/=l.value:c==="%="?f.value%=l.value:c==="&="?f.value&=l.value:c==="|="?f.value|=l.value:c==="^="?f.value^=l.value:c==="<<="?f.value<<=l.value:c===">>="?f.value>>=l.value:console.error(`Invalid operator ${c}. Line ${e.line}`)}r instanceof ht&&r.setDataValue(this,f,s,t)}}_function(e,t){const r=new qd(e);t.functions.set(e.name,r)}_const(e,t){let r=null;e.value!==null&&(r=this.evalExpression(e.value,t)),t.createVariable(e.name,r,e)}_let(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof vt||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new Jn(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_var(e,t){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,t),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof vt||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof Do||e.type instanceof pr||e.type instanceof $){const s=new Jn(e.type,[]);r=this._evalCreate(s,t)}}t.createVariable(e.name,r,e)}_switch(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof db)for(const l of s.selectors){if(l instanceof Ol){i=s;continue}const c=this.evalExpression(l,t);if(!(c instanceof F))return console.error(`Invalid case selector. Line ${e.line}`),null;if(c.value===r.value)return this._execStatements(s.body,t)}else s instanceof pb&&(i=s);return i?this._execStatements(i.body,t):null}_if(e,t){t=t.clone();const r=this.evalExpression(e.condition,t);if(!(r instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,t);for(const i of e.elseif){const s=this.evalExpression(i.condition,t);if(!(s instanceof F))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof F?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===zt._breakObj)break;if(r!==null&&r!==zt._continueObj)return r;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){const r=this._execStatements(e.body,t);if(r===zt._breakObj)break;if(r===zt._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===zt._breakObj)break}else if(r!==null)return r}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){const r=this._execStatements(e.body,t);if(r===zt._breakObj)break;if(r!==zt._continueObj&&r!==null)return r}return null}_evalBitcast(e,t){const r=this.evalExpression(e.value,t),i=e.type;if(r instanceof F){const s=ry(r.value,r.typeInfo.name,i.name);return new F(s,this.getTypeInfo(i))}if(r instanceof A){const s=r.typeInfo.getTypeName();let l="";if(s.endsWith("f"))l="f32";else if(s.endsWith("i"))l="i32";else if(s.endsWith("u"))l="u32";else if(s.endsWith("b"))l="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;l="f16"}const c=i.getTypeName();let f="";if(c.endsWith("f"))f="f32";else if(c.endsWith("i"))f="i32";else if(c.endsWith("u"))f="u32";else if(c.endsWith("b"))f="bool";else{if(!c.endsWith("h"))return console.error(`Unknown vector type ${f}. Line ${e.line}`),null;f="f16"}const h=function(p,_,y){if(_===y)return p;const b=new Array(p.length);for(let x=0;x<p.length;x++)b[x]=ry(p[x],_,y);return b}(Array.from(r.data),l,f);return new A(h,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var r;if(e instanceof Jn){if(e.type===null)return td.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}const i=e instanceof Jn?e.type.name:e.name,s=e instanceof Jn?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const l=new ht(new ArrayBuffer(s.size),s,0);if(s instanceof Kr){if(e.args)for(let c=0;c<e.args.length;++c){const f=s.members[c],h=e.args[c],p=this.evalExpression(h,t);l.setData(this,p,f.type,f.offset,t)}}else if(s instanceof Jr){let c=0;if(e.args)for(let f=0;f<e.args.length;++f){const h=e.args[f],p=this.evalExpression(h,t);s.format===null&&(((r=p.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=p.typeInfo),l.setData(this,p,s.format,c,t),c+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof Jn?l.getSubData(this,e.postfix,t):l}_evalLiteral(e,t){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new F(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,t):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){const r=t.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if(t.name==="f32")return t;for(let r=1;r<e.length;++r){const i=zt._priority.get(t.name);zt._priority.get(e[r].name)<i&&(t=e[r])}return t.name==="x32"?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){const r=this.evalExpression(e.right,t);if(e.operator==="&")return new fs(r);if(e.operator==="*")return r instanceof fs?r.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof F?r.value:r instanceof A?Array.from(r.data):null;switch(e.operator){case"+":{if(he(i)){const c=i.map((f,h)=>+f);return new A(c,r.typeInfo)}const s=i,l=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new F(+s,l)}case"-":{if(he(i)){const c=i.map((f,h)=>-f);return new A(c,r.typeInfo)}const s=i,l=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new F(-s,l)}case"!":{if(he(i)){const c=i.map((f,h)=>f?0:1);return new A(c,r.typeInfo)}const s=i,l=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new F(s?0:1,l)}case"~":{if(he(i)){const c=i.map((f,h)=>~f);return new A(c,r.typeInfo)}const s=i,l=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new F(~s,l)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){const r=this.evalExpression(e.left,t),i=this.evalExpression(e.right,t),s=r instanceof F?r.value:r instanceof A||r instanceof Ae?Array.from(r.data):null,l=i instanceof F?i.value:i instanceof A||i instanceof Ae?Array.from(i.data):null;switch(e.operator){case"+":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b+_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y+p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p+y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c+f,h)}case"-":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b-_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y-p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p-y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c-f,h)}case"*":{if(he(s)&&he(l)){const p=s,_=l;if(r instanceof Ae&&i instanceof Ae){const y=function(C,P,z,k){if(Kt[P.name]===void 0||Kt[k.name]===void 0)return null;const V=Kt[P.name][0],Z=Kt[P.name][1],Y=Kt[k.name][0];if(V!==Kt[k.name][1])return null;const L=new Array(Y*Z);for(let E=0;E<Z;E++)for(let R=0;R<Y;R++){let N=0;for(let j=0;j<V;j++)N+=C[j*Z+E]*z[R*V+j];L[E*Y+R]=N}return L}(p,r.typeInfo,_,i.typeInfo);if(y===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const b=Kt[i.typeInfo.name][0],x=Kt[r.typeInfo.name][1],S=this.getTypeInfo(`mat${b}x${x}f`);return new Ae(y,S)}if(r instanceof Ae&&i instanceof A){const y=function(b,x,S,C){if(Kt[x.name]===void 0||fh[C.name]===void 0)return null;const P=Kt[x.name][0],z=Kt[x.name][1];if(P!==S.length)return null;const k=new Array(z);for(let V=0;V<z;V++){let Z=0;for(let Y=0;Y<P;Y++)Z+=b[Y*z+V]*S[Y];k[V]=Z}return k}(p,r.typeInfo,_,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new A(y,i.typeInfo)}if(r instanceof A&&i instanceof Ae){const y=function(b,x,S,C){if(fh[x.name]===void 0||Kt[C.name]===void 0)return null;const P=Kt[C.name][0],z=Kt[C.name][1];if(z!==b.length)return null;const k=[];for(let V=0;V<P;V++){let Z=0;for(let Y=0;Y<z;Y++)Z+=b[Y]*S[Y*P+V];k[V]=Z}return k}(p,r.typeInfo,_,i.typeInfo);return y===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new A(y,r.typeInfo)}{if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b*_[x]);return new A(y,r.typeInfo)}}if(he(s)){const p=l,_=s.map((y,b)=>y*p);return r instanceof Ae?new Ae(_,r.typeInfo):new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p*y);return i instanceof Ae?new Ae(_,i.typeInfo):new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c*f,h)}case"%":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b%_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y%p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p%y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c%f,h)}case"/":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b/_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y/p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p/y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c/f,h)}case"&":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b&_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y&p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p&y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c&f,h)}case"|":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b|_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y|p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p|y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c|f,h)}case"^":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b^_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y^p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p^y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c^f,h)}case"<<":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b<<_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y<<p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p<<y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c<<f,h)}case">>":{if(he(s)&&he(l)){const p=s,_=l;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const y=p.map((b,x)=>b>>_[x]);return new A(y,r.typeInfo)}if(he(s)){const p=l,_=s.map((y,b)=>y>>p);return new A(_,r.typeInfo)}if(he(l)){const p=s,_=l.map((y,b)=>p>>y);return new A(_,i.typeInfo)}const c=s,f=l,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new F(c>>f,h)}case">":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p>f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h>c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c>h?1:0);return new A(f,i.typeInfo)}return new F(s>l?1:0,this.getTypeInfo("bool"));case"<":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p<f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h<c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c<h?1:0);return new A(f,i.typeInfo)}return new F(s<l?1:0,this.getTypeInfo("bool"));case"==":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p===f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h==c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c==h?1:0);return new A(f,i.typeInfo)}return new F(s===l?1:0,this.getTypeInfo("bool"));case"!=":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p!==f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h!==c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c!==h?1:0);return new A(f,i.typeInfo)}return new F(s!==l?1:0,this.getTypeInfo("bool"));case">=":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p>=f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h>=c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c>=h?1:0);return new A(f,i.typeInfo)}return new F(s>=l?1:0,this.getTypeInfo("bool"));case"<=":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p<=f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h<=c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c<=h?1:0);return new A(f,i.typeInfo)}return new F(s<=l?1:0,this.getTypeInfo("bool"));case"&&":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p&&f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h&&c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c&&h?1:0);return new A(f,i.typeInfo)}return new F(s&&l?1:0,this.getTypeInfo("bool"));case"||":if(he(s)&&he(l)){const c=s,f=l;if(c.length!==f.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=c.map((p,_)=>p||f[_]?1:0);return new A(h,r.typeInfo)}if(he(s)){const c=l,f=s.map((h,p)=>h||c?1:0);return new A(f,r.typeInfo)}if(he(l)){const c=s,f=l.map((h,p)=>c||h?1:0);return new A(f,i.typeInfo)}return new F(s||l?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=t.clone();r.currentFunctionName=e.name;const i=t.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const l=i.node.args[s],c=this.evalExpression(e.args[s],r);r.createVariable(l.name,c,l)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothStep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}const r=t.getFunction(e.name);if(r){const i=t.clone();for(let s=0;s<r.node.args.length;++s){const l=r.node.args[s],c=this.evalExpression(e.args[s],i);i.setVariable(l.name,c,l)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,t){if(!e.args||e.args.length===0)return new F(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],t);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=fh[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const l=[];if(e instanceof St)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,t);if(f instanceof A){const h=f.data;for(let p=0;p<h.length;++p){let _=h[p];l.push(_)}}else if(f instanceof F){let h=f.value;l.push(h)}}if(e.type instanceof $&&e.type.format===null&&(e.type.format=$.f32),l.length===0){const c=new Array(s).fill(0);return new A(c,r).getSubData(this,e.postfix,t)}if(l.length===1)for(;l.length<s;)l.push(l[0]);return l.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new A(l.length>s?l.slice(0,s):l,r).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Kt[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const l=[];if(e instanceof St)if(e.isVector){const c=e.vectorValue;for(const f of c)l.push(f)}else l.push(e.scalarValue);else if(e.args)for(const c of e.args){const f=this.evalExpression(c,t);f instanceof A?l.push(...f.data):f instanceof F?l.push(f.value):f instanceof Ae&&l.push(...f.data)}if(r instanceof Ei&&r.format===null&&(r.format=this.getTypeInfo("f32")),l.length===0){const c=new Array(s[2]).fill(0);return new Ae(c,r).getSubData(this,e.postfix,t)}return l.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new Ae(l,r).getSubData(this,e.postfix,t)}}zt._breakObj=new In(new An("BREAK",null),null),zt._continueObj=new In(new An("CONTINUE",null),null),zt._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class zA{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class $A{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new zA,this._exec=new zt,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const t=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;t.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof _n){const l=s.name,c=this._context.constants.get(l);if(c)try{const f=c.constEvaluate(this._exec);i.count=f}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of t)r.search(i=>{i instanceof ty||i instanceof Ml?i.type=this._forwardType(i.type):i instanceof Do?i.format=this._forwardType(i.format):i instanceof _r||i instanceof No||i instanceof kl?i.type=this._forwardType(i.type):i instanceof $o?i.returnType=this._forwardType(i.returnType):i instanceof ey&&(i.type=this._forwardType(i.type))});return t}_forwardType(e){if(e instanceof Gm){const t=this._getType(e.name);if(t)return t}else e instanceof Ml?e.type=this._forwardType(e.type):e instanceof Do&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const t=new kA(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=t??this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==T.eof}_match(e){if(e instanceof U)return!!this._check(e)&&(this._advance(),!0);for(let t=0,r=e.length;t<r;++t){const i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){const r=t.type;let i=!1;for(const s of e){if(r===s)return!0;s===T.tokens.name&&(i=!0)}if(i){const s=T.tokens.name.rule.exec(t.lexeme);if(s&&s.index==0&&s[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===T.tokens.name){const r=T.tokens.name.rule.exec(t.lexeme);return r&&r.index==0&&r[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=(t=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&t!==void 0?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(T.tokens.semicolon)&&!this._isAtEnd(););if(this._match(T.keywords.alias)){const t=this._type_alias();return this._consume(T.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(T.keywords.diagnostic)){const t=this._diagnostic();return this._consume(T.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(T.keywords.requires)){const t=this._requires_directive();return this._consume(T.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}if(this._match(T.keywords.enable)){const t=this._enable_directive();return this._consume(T.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([t]),t}const e=this._attribute();if(this._check(T.keywords.var)){const t=this._global_variable_decl();return t!=null&&(t.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(T.keywords.override)){const t=this._override_variable_decl();return t!=null&&(t.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(T.keywords.let)){const t=this._global_let_decl();return t!=null&&(t.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(T.keywords.const)){const t=this._global_const_decl();return t!=null&&(t.attributes=e),this._consume(T.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(T.keywords.struct)){const t=this._struct_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(T.keywords.fn)){const t=this._function_decl();return t!=null&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(T.keywords.fn))return null;const e=this._currentLine,t=this._consume(T.tokens.ident,"Expected function name.").toString();this._consume(T.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(T.tokens.paren_right))do{if(this._check(T.tokens.paren_right))break;const c=this._attribute(),f=this._consume(T.tokens.name,"Expected argument name.").toString();this._consume(T.tokens.colon,"Expected ':' for argument type.");const h=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=h,r.push(this._updateNode(new ey(f,p,c))))}while(this._match(T.tokens.comma));this._consume(T.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(T.tokens.arrow)){const c=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=c)}const s=this._compound_statement(),l=this._currentLine;return this._updateNode(new $o(t,r,i,s,e,l),e)}_compound_statement(){const e=[];for(this._consume(T.tokens.brace_left,"Expected '{' for block.");!this._check(T.tokens.brace_right);){const t=this._statement();t!==null&&e.push(t)}return this._consume(T.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(T.tokens.semicolon)&&!this._isAtEnd(););if(this._check(T.tokens.attr)&&this._attribute(),this._check(T.keywords.if))return this._if_statement();if(this._check(T.keywords.switch))return this._switch_statement();if(this._check(T.keywords.loop))return this._loop_statement();if(this._check(T.keywords.for))return this._for_statement();if(this._check(T.keywords.while))return this._while_statement();if(this._check(T.keywords.continuing))return this._continuing_statement();if(this._check(T.keywords.static_assert))return this._static_assert_statement();if(this._check(T.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(T.keywords.return))e=this._return_statement();else if(this._check([T.keywords.var,T.keywords.let,T.keywords.const]))e=this._variable_statement();else if(this._match(T.keywords.discard))e=this._updateNode(new CA);else if(this._match(T.keywords.break)){const t=this._updateNode(new ab);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t,this._check(T.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(T.keywords.continue)){const t=this._updateNode(new lb);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);{const r=this._currentLoop[this._currentLoop.length-1];t.loopId=r.id}e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(T.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(T.keywords.static_assert))return null;const e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new EA(t),e)}_while_statement(){if(!this._match(T.keywords.while))return null;const e=this._updateNode(new Jv(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(T.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(T.keywords.continuing))return null;const t=this._currentLine,r=this._compound_statement();return this._updateNode(new ed(r,e),t)}_for_statement(){if(!this._match(T.keywords.for))return null;this._consume(T.tokens.paren_left,"Expected '('.");const e=this._updateNode(new Gv(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(T.tokens.semicolon)?null:this._for_init(),this._consume(T.tokens.semicolon,"Expected ';'."),e.condition=this._check(T.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(T.tokens.semicolon,"Expected ';'."),e.increment=this._check(T.tokens.paren_right)?null:this._for_increment(),this._consume(T.tokens.paren_right,"Expected ')'."),this._check(T.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(T.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(T.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new _r(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(T.keywords.let)){const e=this._currentLine,t=this._consume(T.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(T.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(T.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new No(t,r,null,null,i),e)}if(this._match(T.keywords.const)){const e=this._currentLine,t=this._consume(T.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(T.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(T.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof St&&(r=i.type),this._updateNode(new kl(t,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(t==null)return null;if(!this._check(T.increment_operators))return this._current=e,null;const r=this._consume(T.increment_operators,"Expected increment operator");return this._updateNode(new eb(r.type===T.tokens.plus_plus?gs.increment:gs.decrement,t))}_assignment_statement(){let e=null;const t=this._currentLine;if(this._check(T.tokens.brace_right))return null;let r=this._match(T.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(T.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new tb(Ro.parse(i.lexeme),e,s),t)}_func_call_statement(){if(!this._check(T.tokens.ident))return null;const e=this._currentLine,t=this._current,r=this._consume(T.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=t,null):this._updateNode(new Wd(r.lexeme,i),e)}_loop_statement(){if(!this._match(T.keywords.loop))return null;this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new nb([],null));this._currentLoop.push(e);let t=this._statement();for(;t!==null;){if(Array.isArray(t))for(let r of t)e.body.push(r);else e.body.push(t);if(t instanceof ed){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(T.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(T.keywords.switch))return null;const e=this._updateNode(new rb(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(T.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let t=!1;for(;this._check([T.keywords.default,T.keywords.case]);){if(this._match(T.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof Ol){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(T.tokens.colon),this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(T.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new db(r,i)))}if(this._match(T.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(T.tokens.colon),this._check(T.tokens.attr)&&this._attribute(),this._consume(T.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(T.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new pb(r)))}}return e}_case_selectors(){const e=[];for(this._match(T.keywords.default)?e.push(this._updateNode(new Ol)):e.push(this._shift_expression());this._match(T.tokens.comma);)this._match(T.keywords.default)?e.push(this._updateNode(new Ol)):e.push(this._shift_expression());return e}_case_body(){if(this._match(T.keywords.fallthrough))return this._consume(T.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const t=this._case_body();return t.length==0?e:[...e,t[0]]}_if_statement(){if(!this._match(T.keywords.if))return null;const e=this._currentLine,t=this._optional_paren_expression();this._check(T.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(T.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(T.keywords.else)&&(this._check(T.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new ib(t,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===T.keywords.else&&this._tokens[this._current+1].type===T.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const t=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new IA(t,r))),this._match_elseif()&&(this._check(T.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(T.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new sb(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(T.tokens.or_or);)e=this._updateNode(new Un(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(T.tokens.and_and);)e=this._updateNode(new Un(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(T.tokens.or);)e=this._updateNode(new Un(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(T.tokens.xor);)e=this._updateNode(new Un(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(T.tokens.and);)e=this._updateNode(new Un(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([T.tokens.equal_equal,T.tokens.not_equal])?this._updateNode(new Un(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([T.tokens.less_than,T.tokens.greater_than,T.tokens.less_than_equal,T.tokens.greater_than_equal]);)e=this._updateNode(new Un(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([T.tokens.shift_left,T.tokens.shift_right]);)e=this._updateNode(new Un(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([T.tokens.plus,T.tokens.minus]);)e=this._updateNode(new Un(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([T.tokens.star,T.tokens.forward_slash,T.tokens.modulo]);)e=this._updateNode(new Un(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([T.tokens.minus,T.tokens.bang,T.tokens.tilde,T.tokens.star,T.tokens.and])?this._updateNode(new vt(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(T.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(T.tokens.bracket_right,"Expected ']'.");const t=this._updateNode(new As(e)),r=this._postfix_expression();return r&&(t.postfix=r),t}if(this._match(T.tokens.period)){const e=this._consume(T.tokens.name,"Expected member name."),t=this._postfix_expression(),r=this._updateNode(new Ai(e.lexeme));return t&&(r.postfix=t),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const t=this._getStruct(e);if(t!==null)return t;switch(e){case"void":return J.void;case"bool":return J.bool;case"i32":return J.i32;case"u32":return J.u32;case"f32":return J.f32;case"f16":return J.f16;case"vec2f":return $.vec2f;case"vec3f":return $.vec3f;case"vec4f":return $.vec4f;case"vec2i":return $.vec2i;case"vec3i":return $.vec3i;case"vec4i":return $.vec4i;case"vec2u":return $.vec2u;case"vec3u":return $.vec3u;case"vec4u":return $.vec4u;case"vec2h":return $.vec2h;case"vec3h":return $.vec3h;case"vec4h":return $.vec4h;case"mat2x2f":return $.mat2x2f;case"mat2x3f":return $.mat2x3f;case"mat2x4f":return $.mat2x4f;case"mat3x2f":return $.mat3x2f;case"mat3x3f":return $.mat3x3f;case"mat3x4f":return $.mat3x4f;case"mat4x2f":return $.mat4x2f;case"mat4x3f":return $.mat4x3f;case"mat4x4f":return $.mat4x4f;case"mat2x2h":return $.mat2x2h;case"mat2x3h":return $.mat2x3h;case"mat2x4h":return $.mat2x4h;case"mat3x2h":return $.mat3x2h;case"mat3x3h":return $.mat3x3h;case"mat3x4h":return $.mat3x4h;case"mat4x2h":return $.mat4x2h;case"mat4x3h":return $.mat4x3h;case"mat4x4h":return $.mat4x4h;case"mat2x2i":return $.mat2x2i;case"mat2x3i":return $.mat2x3i;case"mat2x4i":return $.mat2x4i;case"mat3x2i":return $.mat3x2i;case"mat3x3i":return $.mat3x3i;case"mat3x4i":return $.mat3x4i;case"mat4x2i":return $.mat4x2i;case"mat4x3i":return $.mat4x3i;case"mat4x4i":return $.mat4x4i;case"mat2x2u":return $.mat2x2u;case"mat2x3u":return $.mat2x3u;case"mat2x4u":return $.mat2x4u;case"mat3x2u":return $.mat3x2u;case"mat3x3u":return $.mat3x3u;case"mat3x4u":return $.mat3x4u;case"mat4x2u":return $.mat4x2u;case"mat4x3u":return $.mat4x3u;case"mat4x4u":return $.mat4x4u}return null}_validateTypeRange(e,t){if(t.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(t.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(T.tokens.ident)){const r=this._previous().toString();if(this._check(T.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new Jn(s,i)):this._updateNode(new Xd(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new cb(r,i.value))}return this._updateNode(new _n(r))}if(this._match(T.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?J.i32:r.endsWith("u")||r.endsWith("U")?J.u32:J.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new St(new F(s,this._exec.getTypeInfo(i)),i))}if(this._match(T.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,J.u32),this._updateNode(new St(new F(r,this._exec.getTypeInfo(J.u32)),J.u32))}if(this._match([T.tokens.decimal_float_literal,T.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?J.f16:J.f32);const l=i?J.f16:J.f32;return this._updateNode(new St(new F(s,this._exec.getTypeInfo(l)),l))}if(this._match([T.keywords.true,T.keywords.false])){let r=this._previous().toString()===T.keywords.true.rule;return this._updateNode(new St(new F(r?1:0,this._exec.getTypeInfo(J.bool)),J.bool))}if(this._check(T.tokens.paren_left))return this._paren_expression();if(this._match(T.keywords.bitcast)){this._consume(T.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(T.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new ub(r,i))}const e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new Jn(e,t))}_argument_expression_list(){if(!this._match(T.tokens.paren_left))return null;const e=[];do{if(this._check(T.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(T.tokens.comma));return this._consume(T.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(T.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(T.tokens.paren_right),e}_paren_expression(){this._consume(T.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(T.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(T.keywords.struct))return null;const e=this._currentLine,t=this._consume(T.tokens.ident,"Expected name for struct.").toString();this._consume(T.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(T.tokens.brace_right);){const l=this._attribute(),c=this._consume(T.tokens.name,"Expected variable name.").toString();this._consume(T.tokens.colon,"Expected ':' for struct member type.");const f=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=f),this._check(T.tokens.brace_right)?this._match(T.tokens.comma):this._consume(T.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new ty(c,h,l)))}this._consume(T.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new pr(t,r,e,i),e);return this._context.structs.set(t,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(T.tokens.equal)){const t=this._const_expression();e.value=t}if(e.type!==null&&e.value instanceof St){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof St&&(e.type=e.value.type.name==="x32"?J.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(T.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(T.keywords.const))return null;const t=this._consume(T.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(T.tokens.colon)){const f=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=f)}let s=null;this._consume(T.tokens.equal,"const declarations require an assignment");const l=this._short_circuit_or_expression();try{let f=[J.f32],h=l.constEvaluate(this._exec,f);h instanceof F&&this._validateTypeRange(h.value,f[0]),f[0]instanceof $&&f[0].format===null&&h.typeInfo instanceof Ei&&h.typeInfo.format!==null&&(h.typeInfo.format.name==="f16"?f[0].format=J.f16:h.typeInfo.format.name==="f32"?f[0].format=J.f32:h.typeInfo.format.name==="i32"?f[0].format=J.i32:h.typeInfo.format.name==="u32"?f[0].format=J.u32:h.typeInfo.format.name==="bool"?f[0].format=J.bool:console.error(`TODO: impelement template format type ${h.typeInfo.format.name}`)),s=this._updateNode(new St(h,f[0])),this._exec.context.setVariable(t.toString(),h)}catch{s=l}if(i!==null&&s instanceof St){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof St&&(i=(e=s?.type)!==null&&e!==void 0?e:J.f32,i===J.x32&&(i=J.i32));const c=this._updateNode(new kl(t.toString(),i,"","",s),r);return this._context.constants.set(c.name,c),c}_global_let_decl(){if(!this._match(T.keywords.let))return null;const e=this._currentLine,t=this._consume(T.tokens.name,"Expected variable name");let r=null;if(this._match(T.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(T.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof St){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof St&&(r=i.type.name==="x32"?J.i32:i.type);return i instanceof St&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new No(t.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(T.keywords.var))return null;const e=this._currentLine;let t="",r="";this._match(T.tokens.less_than)&&(t=this._consume(T.storage_class,"Expected storage_class.").toString(),this._match(T.tokens.comma)&&(r=this._consume(T.access_mode,"Expected access_mode.").toString()),this._consume(T.tokens.greater_than,"Expected '>'."));const i=this._consume(T.tokens.name,"Expected variable name");let s=null;if(this._match(T.tokens.colon)){const l=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=l)}return this._updateNode(new _r(i.toString(),s,t,r,null),e)}_override_decl(){if(!this._match(T.keywords.override))return null;const e=this._consume(T.tokens.name,"Expected variable name");let t=null;if(this._match(T.tokens.colon)){const r=this._attribute();t=this._type_decl(),t!=null&&(t.attributes=r)}return this._updateNode(new jd(e.toString(),t,null))}_diagnostic(){this._consume(T.tokens.paren_left,"Expected '('");const e=this._consume(T.tokens.ident,"Expected severity control name.");this._consume(T.tokens.comma,"Expected ','");let t=this._consume(T.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(T.tokens.period)&&(t+=`.${this._consume(T.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(T.tokens.paren_right,"Expected ')'"),this._updateNode(new ob(e.toString(),t))}_enable_directive(){const e=this._consume(T.tokens.ident,"identity expected.");return this._updateNode(new AA(e.toString()))}_requires_directive(){const e=[this._consume(T.tokens.ident,"identity expected.").toString()];for(;this._match(T.tokens.comma);){const t=this._consume(T.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new RA(e))}_type_alias(){const e=this._consume(T.tokens.ident,"identity expected.");this._consume(T.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(t===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const r=this._updateNode(new Hd(e.toString(),t));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([T.tokens.ident,...T.texel_format,T.keywords.bool,T.keywords.f32,T.keywords.i32,T.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new Gm(r));return this._forwardTypeCount++,i}return this._updateNode(new J(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(T.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(T.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(T.tokens.comma)&&(s=this._consume(T.access_mode,"Expected access_mode for pointer").toString()),this._consume(T.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new $(r,i,s))}if(this._match(T.keywords.ptr)){let r=this._previous().toString();this._consume(T.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(T.storage_class,"Expected storage_class for pointer");this._consume(T.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let l=null;return this._match(T.tokens.comma)&&(l=this._consume(T.access_mode,"Expected access_mode for pointer").toString()),this._consume(T.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new Ml(r,i.toString(),s,l))}const t=this._attribute();if(this._match(T.keywords.array)){let r=null,i=-1;const s=this._previous();let l=null;if(this._match(T.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let f="";if(this._match(T.tokens.comma)){l=this._shift_expression();try{f=l.constEvaluate(this._exec).toString(),l=null}catch{f="1"}}this._consume(T.tokens.greater_than,"Expected '>' for array."),i=f?parseInt(f):0}const c=this._updateNode(new Do(s.toString(),t,r,i));return l&&this._deferArrayCountEval.push({arrayType:c,countNode:l}),c}return null}_texture_sampler_types(){if(this._match(T.sampler_type))return this._updateNode(new Co(this._previous().toString(),null,null));if(this._match(T.depth_texture_type))return this._updateNode(new Co(this._previous().toString(),null,null));if(this._match(T.sampled_texture_type)||this._match(T.multisampled_texture_type)){const e=this._previous();this._consume(T.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(T.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Co(e.toString(),t,null))}if(this._match(T.storage_texture_type)){const e=this._previous();this._consume(T.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(T.texel_format,"Invalid texel format.").toString();this._consume(T.tokens.comma,"Expected ',' after texel format.");const r=this._consume(T.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(T.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Co(e.toString(),t,r))}return null}_attribute(){let e=[];for(;this._match(T.tokens.attr);){const t=this._consume(T.attribute_name,"Expected attribute name"),r=this._updateNode(new gb(t.toString(),null));if(this._match(T.tokens.paren_left)){if(r.value=this._consume(T.literal_or_ident,"Expected attribute value").toString(),this._check(T.tokens.comma)){this._advance();do{const i=this._consume(T.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(T.tokens.comma))}this._consume(T.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class jA extends tr{constructor(e){super(),e&&this.update(e)}update(e){const t=new $A().parse(e);this.updateAST(t)}}function WA(n){const e={attributes:[],bindings:[]};let t;try{t=HA(n)}catch(s){return oe.error(s.message)(),e}for(const s of t.uniforms){const l=[];for(const c of s.type?.members||[])l.push({name:c.name,type:iy(c.type)});e.bindings.push({type:"uniform",name:s.name,group:s.group,location:s.binding,members:l})}for(const s of t.textures)e.bindings.push({type:"texture",name:s.name,group:s.group,location:s.binding});for(const s of t.samplers)e.bindings.push({type:"sampler",name:s.name,group:s.group,location:s.binding});const r=t.entry.vertex[0],i=r?.inputs.length||0;for(let s=0;s<i;s++){const l=r.inputs[s];if(l.locationType==="location"){const c=iy(l.type);e.attributes.push({name:l.name,location:Number(l.location),type:c})}}return e}function iy(n){return n.format?`${n.name}<${n.format.name}>`:n.name}function HA(n){try{return new jA(n)}catch(e){if(e instanceof Error)throw e;let t="WGSL parse error";throw typeof e=="object"&&e?.message&&(t+=`: ${e.message} `),typeof e=="object"&&e?.token&&(t+=e.token.line||""),new Error(t,{cause:e})}}const XA={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...XA}};const Rn=globalThis.mathgl.config;function YA(n,{precision:e=Rn.precision}={}){return n=KA(n),`${parseFloat(n.toPrecision(e))}`}function Rs(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}function qr(n,e,t){return ZA(n,r=>Math.max(e,Math.min(t,r)))}function ic(n,e,t){return Rs(n)?n.map((r,i)=>ic(r,e[i],t)):t*e+(1-t)*n}function jo(n,e,t){const r=Rn.EPSILON;try{if(n===e)return!0;if(Rs(n)&&Rs(e)){if(n.length!==e.length)return!1;for(let i=0;i<n.length;++i)if(!jo(n[i],e[i]))return!1;return!0}return n&&n.equals?n.equals(e):e&&e.equals?e.equals(n):typeof n=="number"&&typeof e=="number"?Math.abs(n-e)<=Rn.EPSILON*Math.max(1,Math.abs(n),Math.abs(e)):!1}finally{Rn.EPSILON=r}}function KA(n){return Math.round(n/Rn.EPSILON)*Rn.EPSILON}function qA(n){return n.clone?n.clone():new Array(n.length)}function ZA(n,e,t){if(Rs(n)){const r=n;t=t||qA(r);for(let i=0;i<t.length&&i<r.length;++i){const s=typeof n=="number"?n:n[i];t[i]=e(s,i,t)}return t}return e(n)}class _b extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Rs(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Rn)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+YA(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!jo(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(r===void 0)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],l=typeof t=="number"?t:t[i];this[i]=s+r*(l-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=t[r];return this.check()}subtract(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=t[r];return this.check()}scale(e){if(typeof e=="number")for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Rn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}function QA(n,e){if(n.length!==e)return!1;for(let t=0;t<n.length;++t)if(!Number.isFinite(n[t]))return!1;return!0}function gn(n){if(!Number.isFinite(n))throw new Error(`Invalid number ${JSON.stringify(n)}`);return n}function hh(n,e,t=""){if(Rn.debug&&!QA(n,e))throw new Error(`math.gl: ${t} some fields set to invalid numbers'`);return n}function sy(n,e){if(!n)throw new Error(`math.gl assertion ${e}`)}class JA extends _b{get x(){return this[0]}set x(e){this[0]=gn(e)}get y(){return this[1]}set y(e){this[1]=gn(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];t+=i*i}return gn(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return gn(t)}normalize(){const e=this.magnitude();if(e!==0)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=t[r];return this.check()}divide(...e){for(const t of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=t[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return sy(e>=0&&e<this.ELEMENTS,"index is out of range"),gn(this[e])}setComponent(e,t){return sy(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}const Nl=1e-6;let Cs=typeof Float32Array<"u"?Float32Array:Array;function GA(){const n=new Cs(2);return Cs!=Float32Array&&(n[0]=0,n[1]=0),n}function oy(n,e,t){return n[0]=e[0]+t[0],n[1]=e[1]+t[1],n}function eR(n,e){return n[0]=-e[0],n[1]=-e[1],n}function mb(n,e,t,r){const i=e[0],s=e[1];return n[0]=i+r*(t[0]-i),n[1]=s+r*(t[1]-s),n}function tR(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[4]*i+t[12],n[1]=t[1]*r+t[5]*i+t[13],n}(function(){const n=GA();return function(e,t,r,i,s,l){let c,f;for(t||(t=2),r||(r=0),i?f=Math.min(i*t+r,e.length):f=e.length,c=r;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],s(n,n,l),e[c]=n[0],e[c+1]=n[1];return e}})();function nR(n,e,t){const r=e[0],i=e[1],s=t[3]*r+t[7]*i||1;return n[0]=(t[0]*r+t[4]*i)/s,n[1]=(t[1]*r+t[5]*i)/s,n}function yb(n,e,t){const r=e[0],i=e[1],s=e[2],l=t[3]*r+t[7]*i+t[11]*s||1;return n[0]=(t[0]*r+t[4]*i+t[8]*s)/l,n[1]=(t[1]*r+t[5]*i+t[9]*s)/l,n[2]=(t[2]*r+t[6]*i+t[10]*s)/l,n}function rR(n,e,t){const r=e[0],i=e[1];return n[0]=t[0]*r+t[2]*i,n[1]=t[1]*r+t[3]*i,n[2]=e[2],n}function iR(){const n=new Cs(3);return Cs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0),n}function sR(n,e,t){return n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}function oR(n,e){return n[0]=-e[0],n[1]=-e[1],n[2]=-e[2],n}function aR(n,e){return n[0]*e[0]+n[1]*e[1]+n[2]*e[2]}function lR(n,e,t){const r=e[0],i=e[1],s=e[2],l=t[0],c=t[1],f=t[2];return n[0]=i*f-s*c,n[1]=s*l-r*f,n[2]=r*c-i*l,n}function vb(n,e,t){const r=e[0],i=e[1],s=e[2];let l=t[3]*r+t[7]*i+t[11]*s+t[15];return l=l||1,n[0]=(t[0]*r+t[4]*i+t[8]*s+t[12])/l,n[1]=(t[1]*r+t[5]*i+t[9]*s+t[13])/l,n[2]=(t[2]*r+t[6]*i+t[10]*s+t[14])/l,n}function cR(n,e,t){const r=e[0],i=e[1],s=e[2];return n[0]=r*t[0]+i*t[3]+s*t[6],n[1]=r*t[1]+i*t[4]+s*t[7],n[2]=r*t[2]+i*t[5]+s*t[8],n}function uR(n,e,t){const r=t[0],i=t[1],s=t[2],l=t[3],c=e[0],f=e[1],h=e[2];let p=i*h-s*f,_=s*c-r*h,y=r*f-i*c,b=i*y-s*_,x=s*p-r*y,S=r*_-i*p;const C=l*2;return p*=C,_*=C,y*=C,b*=2,x*=2,S*=2,n[0]=c+p+b,n[1]=f+_+x,n[2]=h+y+S,n}function fR(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function hR(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function dR(n,e,t,r){const i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],n[0]=s[0]+t[0],n[1]=s[1]+t[1],n[2]=s[2]+t[2],n}function pR(n,e){const t=n[0],r=n[1],i=n[2],s=e[0],l=e[1],c=e[2],f=Math.sqrt((t*t+r*r+i*i)*(s*s+l*l+c*c)),h=f&&aR(n,e)/f;return Math.acos(Math.min(Math.max(h,-1),1))}const gR=sR;(function(){const n=iR();return function(e,t,r,i,s,l){let c,f;for(t||(t=3),r||(r=0),i?f=Math.min(i*t+r,e.length):f=e.length,c=r;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],s(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2];return e}})();const dh=[0,0,0];let ml;class nr extends JA{static get ZERO(){return ml||(ml=new nr(0,0,0),Object.freeze(ml)),ml}constructor(e=0,t=0,r=0){super(-0,-0,-0),arguments.length===1&&Rs(e)?this.copy(e):(Rn.debug&&(gn(e),gn(t),gn(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Rn.debug&&(gn(e.x),gn(e.y),gn(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=gn(e)}angle(e){return pR(this,e)}cross(e){return lR(this,this,e),this.check()}rotateX({radians:e,origin:t=dh}){return fR(this,this,t,e),this.check()}rotateY({radians:e,origin:t=dh}){return hR(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=dh}){return dR(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return vb(this,this,e),this.check()}transformAsVector(e){return yb(this,this,e),this.check()}transformByMatrix3(e){return cR(this,this,e),this.check()}transformByMatrix2(e){return rR(this,this,e),this.check()}transformByQuaternion(e){return uR(this,this,e),this.check()}}class _R extends _b{toString(){let e="[";if(Rn.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=gn(r),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)t[i]=this[r+i];return t}setColumn(e,t){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=t[i];return this}}function mR(n){return n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function yR(n,e){if(n===e){const t=e[1],r=e[2],i=e[3],s=e[6],l=e[7],c=e[11];n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=t,n[6]=e[9],n[7]=e[13],n[8]=r,n[9]=s,n[11]=e[14],n[12]=i,n[13]=l,n[14]=c}else n[0]=e[0],n[1]=e[4],n[2]=e[8],n[3]=e[12],n[4]=e[1],n[5]=e[5],n[6]=e[9],n[7]=e[13],n[8]=e[2],n[9]=e[6],n[10]=e[10],n[11]=e[14],n[12]=e[3],n[13]=e[7],n[14]=e[11],n[15]=e[15];return n}function nd(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],l=e[4],c=e[5],f=e[6],h=e[7],p=e[8],_=e[9],y=e[10],b=e[11],x=e[12],S=e[13],C=e[14],P=e[15],z=t*c-r*l,k=t*f-i*l,V=t*h-s*l,Z=r*f-i*c,Y=r*h-s*c,L=i*h-s*f,E=p*S-_*x,R=p*C-y*x,N=p*P-b*x,j=_*C-y*S,K=_*P-b*S,G=y*P-b*C;let fe=z*G-k*K+V*j+Z*N-Y*R+L*E;return fe?(fe=1/fe,n[0]=(c*G-f*K+h*j)*fe,n[1]=(i*K-r*G-s*j)*fe,n[2]=(S*L-C*Y+P*Z)*fe,n[3]=(y*Y-_*L-b*Z)*fe,n[4]=(f*N-l*G-h*R)*fe,n[5]=(t*G-i*N+s*R)*fe,n[6]=(C*V-x*L-P*k)*fe,n[7]=(p*L-y*V+b*k)*fe,n[8]=(l*K-c*N+h*E)*fe,n[9]=(r*N-t*K-s*E)*fe,n[10]=(x*Y-S*V+P*z)*fe,n[11]=(_*V-p*Y-b*z)*fe,n[12]=(c*R-l*j-f*E)*fe,n[13]=(t*j-r*R+i*E)*fe,n[14]=(S*k-x*Z-C*z)*fe,n[15]=(p*Z-_*k+y*z)*fe,n):null}function vR(n){const e=n[0],t=n[1],r=n[2],i=n[3],s=n[4],l=n[5],c=n[6],f=n[7],h=n[8],p=n[9],_=n[10],y=n[11],b=n[12],x=n[13],S=n[14],C=n[15],P=e*l-t*s,z=e*c-r*s,k=t*c-r*l,V=h*x-p*b,Z=h*S-_*b,Y=p*S-_*x,L=e*Y-t*Z+r*V,E=s*Y-l*Z+c*V,R=h*k-p*z+_*P,N=b*k-x*z+S*P;return f*L-i*E+C*R-y*N}function bi(n,e,t){const r=e[0],i=e[1],s=e[2],l=e[3],c=e[4],f=e[5],h=e[6],p=e[7],_=e[8],y=e[9],b=e[10],x=e[11],S=e[12],C=e[13],P=e[14],z=e[15];let k=t[0],V=t[1],Z=t[2],Y=t[3];return n[0]=k*r+V*c+Z*_+Y*S,n[1]=k*i+V*f+Z*y+Y*C,n[2]=k*s+V*h+Z*b+Y*P,n[3]=k*l+V*p+Z*x+Y*z,k=t[4],V=t[5],Z=t[6],Y=t[7],n[4]=k*r+V*c+Z*_+Y*S,n[5]=k*i+V*f+Z*y+Y*C,n[6]=k*s+V*h+Z*b+Y*P,n[7]=k*l+V*p+Z*x+Y*z,k=t[8],V=t[9],Z=t[10],Y=t[11],n[8]=k*r+V*c+Z*_+Y*S,n[9]=k*i+V*f+Z*y+Y*C,n[10]=k*s+V*h+Z*b+Y*P,n[11]=k*l+V*p+Z*x+Y*z,k=t[12],V=t[13],Z=t[14],Y=t[15],n[12]=k*r+V*c+Z*_+Y*S,n[13]=k*i+V*f+Z*y+Y*C,n[14]=k*s+V*h+Z*b+Y*P,n[15]=k*l+V*p+Z*x+Y*z,n}function sc(n,e,t){const r=t[0],i=t[1],s=t[2];let l,c,f,h,p,_,y,b,x,S,C,P;return e===n?(n[12]=e[0]*r+e[4]*i+e[8]*s+e[12],n[13]=e[1]*r+e[5]*i+e[9]*s+e[13],n[14]=e[2]*r+e[6]*i+e[10]*s+e[14],n[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(l=e[0],c=e[1],f=e[2],h=e[3],p=e[4],_=e[5],y=e[6],b=e[7],x=e[8],S=e[9],C=e[10],P=e[11],n[0]=l,n[1]=c,n[2]=f,n[3]=h,n[4]=p,n[5]=_,n[6]=y,n[7]=b,n[8]=x,n[9]=S,n[10]=C,n[11]=P,n[12]=l*r+p*i+x*s+e[12],n[13]=c*r+_*i+S*s+e[13],n[14]=f*r+y*i+C*s+e[14],n[15]=h*r+b*i+P*s+e[15]),n}function Qd(n,e,t){const r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r,n[1]=e[1]*r,n[2]=e[2]*r,n[3]=e[3]*r,n[4]=e[4]*i,n[5]=e[5]*i,n[6]=e[6]*i,n[7]=e[7]*i,n[8]=e[8]*s,n[9]=e[9]*s,n[10]=e[10]*s,n[11]=e[11]*s,n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function bR(n,e,t,r){let i=r[0],s=r[1],l=r[2],c=Math.sqrt(i*i+s*s+l*l),f,h,p,_,y,b,x,S,C,P,z,k,V,Z,Y,L,E,R,N,j,K,G,fe,Ce;return c<Nl?null:(c=1/c,i*=c,s*=c,l*=c,h=Math.sin(t),f=Math.cos(t),p=1-f,_=e[0],y=e[1],b=e[2],x=e[3],S=e[4],C=e[5],P=e[6],z=e[7],k=e[8],V=e[9],Z=e[10],Y=e[11],L=i*i*p+f,E=s*i*p+l*h,R=l*i*p-s*h,N=i*s*p-l*h,j=s*s*p+f,K=l*s*p+i*h,G=i*l*p+s*h,fe=s*l*p-i*h,Ce=l*l*p+f,n[0]=_*L+S*E+k*R,n[1]=y*L+C*E+V*R,n[2]=b*L+P*E+Z*R,n[3]=x*L+z*E+Y*R,n[4]=_*N+S*j+k*K,n[5]=y*N+C*j+V*K,n[6]=b*N+P*j+Z*K,n[7]=x*N+z*j+Y*K,n[8]=_*G+S*fe+k*Ce,n[9]=y*G+C*fe+V*Ce,n[10]=b*G+P*fe+Z*Ce,n[11]=x*G+z*fe+Y*Ce,e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n)}function bb(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[4],l=e[5],c=e[6],f=e[7],h=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[4]=s*i+h*r,n[5]=l*i+p*r,n[6]=c*i+_*r,n[7]=f*i+y*r,n[8]=h*i-s*r,n[9]=p*i-l*r,n[10]=_*i-c*r,n[11]=y*i-f*r,n}function wR(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],l=e[1],c=e[2],f=e[3],h=e[8],p=e[9],_=e[10],y=e[11];return e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i-h*r,n[1]=l*i-p*r,n[2]=c*i-_*r,n[3]=f*i-y*r,n[8]=s*r+h*i,n[9]=l*r+p*i,n[10]=c*r+_*i,n[11]=f*r+y*i,n}function wb(n,e,t){const r=Math.sin(t),i=Math.cos(t),s=e[0],l=e[1],c=e[2],f=e[3],h=e[4],p=e[5],_=e[6],y=e[7];return e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n[0]=s*i+h*r,n[1]=l*i+p*r,n[2]=c*i+_*r,n[3]=f*i+y*r,n[4]=h*i-s*r,n[5]=p*i-l*r,n[6]=_*i-c*r,n[7]=y*i-f*r,n}function TR(n,e){const t=e[0],r=e[1],i=e[2],s=e[3],l=t+t,c=r+r,f=i+i,h=t*l,p=r*l,_=r*c,y=i*l,b=i*c,x=i*f,S=s*l,C=s*c,P=s*f;return n[0]=1-_-x,n[1]=p+P,n[2]=y-C,n[3]=0,n[4]=p-P,n[5]=1-h-x,n[6]=b+S,n[7]=0,n[8]=y+C,n[9]=b-S,n[10]=1-h-_,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n}function xR(n,e,t,r,i,s,l){const c=1/(t-e),f=1/(i-r),h=1/(s-l);return n[0]=s*2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s*2*f,n[6]=0,n[7]=0,n[8]=(t+e)*c,n[9]=(i+r)*f,n[10]=(l+s)*h,n[11]=-1,n[12]=0,n[13]=0,n[14]=l*s*2*h,n[15]=0,n}function SR(n,e,t,r,i){const s=1/Math.tan(e/2);if(n[0]=s/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=-1,n[12]=0,n[13]=0,n[15]=0,i!=null&&i!==1/0){const l=1/(r-i);n[10]=(i+r)*l,n[14]=2*i*r*l}else n[10]=-1,n[14]=-2*r;return n}const ER=SR;function AR(n,e,t,r,i,s,l){const c=1/(e-t),f=1/(r-i),h=1/(s-l);return n[0]=-2*c,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=-2*f,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=2*h,n[11]=0,n[12]=(e+t)*c,n[13]=(i+r)*f,n[14]=(l+s)*h,n[15]=1,n}const RR=AR;function CR(n,e,t,r){let i,s,l,c,f,h,p,_,y,b;const x=e[0],S=e[1],C=e[2],P=r[0],z=r[1],k=r[2],V=t[0],Z=t[1],Y=t[2];return Math.abs(x-V)<Nl&&Math.abs(S-Z)<Nl&&Math.abs(C-Y)<Nl?mR(n):(_=x-V,y=S-Z,b=C-Y,i=1/Math.sqrt(_*_+y*y+b*b),_*=i,y*=i,b*=i,s=z*b-k*y,l=k*_-P*b,c=P*y-z*_,i=Math.sqrt(s*s+l*l+c*c),i?(i=1/i,s*=i,l*=i,c*=i):(s=0,l=0,c=0),f=y*c-b*l,h=b*s-_*c,p=_*l-y*s,i=Math.sqrt(f*f+h*h+p*p),i?(i=1/i,f*=i,h*=i,p*=i):(f=0,h=0,p=0),n[0]=s,n[1]=f,n[2]=_,n[3]=0,n[4]=l,n[5]=h,n[6]=y,n[7]=0,n[8]=c,n[9]=p,n[10]=b,n[11]=0,n[12]=-(s*x+l*S+c*C),n[13]=-(f*x+h*S+p*C),n[14]=-(_*x+y*S+b*C),n[15]=1,n)}function IR(){const n=new Cs(4);return Cs!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),n}function PR(n,e,t){return n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n}function Qo(n,e,t){const r=e[0],i=e[1],s=e[2],l=e[3];return n[0]=t[0]*r+t[4]*i+t[8]*s+t[12]*l,n[1]=t[1]*r+t[5]*i+t[9]*s+t[13]*l,n[2]=t[2]*r+t[6]*i+t[10]*s+t[14]*l,n[3]=t[3]*r+t[7]*i+t[11]*s+t[15]*l,n}(function(){const n=IR();return function(e,t,r,i,s,l){let c,f;for(t||(t=4),r||(r=0),i?f=Math.min(i*t+r,e.length):f=e.length,c=r;c<f;c+=t)n[0]=e[c],n[1]=e[c+1],n[2]=e[c+2],n[3]=e[c+3],s(n,n,l),e[c]=n[0],e[c+1]=n[1],e[c+2]=n[2],e[c+3]=n[3];return e}})();var rd;(function(n){n[n.COL0ROW0=0]="COL0ROW0",n[n.COL0ROW1=1]="COL0ROW1",n[n.COL0ROW2=2]="COL0ROW2",n[n.COL0ROW3=3]="COL0ROW3",n[n.COL1ROW0=4]="COL1ROW0",n[n.COL1ROW1=5]="COL1ROW1",n[n.COL1ROW2=6]="COL1ROW2",n[n.COL1ROW3=7]="COL1ROW3",n[n.COL2ROW0=8]="COL2ROW0",n[n.COL2ROW1=9]="COL2ROW1",n[n.COL2ROW2=10]="COL2ROW2",n[n.COL2ROW3=11]="COL2ROW3",n[n.COL3ROW0=12]="COL3ROW0",n[n.COL3ROW1=13]="COL3ROW1",n[n.COL3ROW2=14]="COL3ROW2",n[n.COL3ROW3=15]="COL3ROW3"})(rd||(rd={}));const kR=45*Math.PI/180,MR=1,ph=.1,gh=500,OR=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class rr extends _R{static get IDENTITY(){return DR()}static get ZERO(){return NR()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return rd}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,s,l,c,f,h,p,_,y,b,x,S,C){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=l,this[6]=c,this[7]=f,this[8]=h,this[9]=p,this[10]=_,this[11]=y,this[12]=b,this[13]=x,this[14]=S,this[15]=C,this.check()}setRowMajor(e,t,r,i,s,l,c,f,h,p,_,y,b,x,S,C){return this[0]=e,this[1]=s,this[2]=h,this[3]=b,this[4]=t,this[5]=l,this[6]=p,this[7]=x,this[8]=r,this[9]=c,this[10]=_,this[11]=S,this[12]=i,this[13]=f,this[14]=y,this[15]=C,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(OR)}fromObject(e){return this.check()}fromQuaternion(e){return TR(this,e),this.check()}frustum(e){const{left:t,right:r,bottom:i,top:s,near:l=ph,far:c=gh}=e;return c===1/0?FR(this,t,r,i,s,l):xR(this,t,r,i,s,l,c),this.check()}lookAt(e){const{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return CR(this,t,r,i),this.check()}ortho(e){const{left:t,right:r,bottom:i,top:s,near:l=ph,far:c=gh}=e;return RR(this,t,r,i,s,l,c),this.check()}orthographic(e){const{fovy:t=kR,aspect:r=MR,focalDistance:i=1,near:s=ph,far:l=gh}=e;ay(t);const c=t/2,f=i*Math.tan(c),h=f*r;return this.ortho({left:-h,right:h,bottom:-f,top:f,near:s,far:l})}perspective(e){const{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return ay(t),ER(this,t,r,i,s),this.check()}determinant(){return vR(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],l=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*l,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*l,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];const r=this.getScale(t),i=1/r[0],s=1/r[1],l=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*l,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*l,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*l,e}transpose(){return yR(this,this),this.check()}invert(){return nd(this,this),this.check()}multiplyLeft(e){return bi(this,e,this),this.check()}multiplyRight(e){return bi(this,this,e),this.check()}rotateX(e){return bb(this,this,e),this.check()}rotateY(e){return wR(this,this,e),this.check()}rotateZ(e){return wb(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return bR(this,this,e,t),this.check()}scale(e){return Qd(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return sc(this,this,e),this.check()}transform(e,t){return e.length===4?(t=Qo(t||[-0,-0,-0,-0],e,this),hh(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){const{length:r}=e;let i;switch(r){case 2:i=tR(t||[-0,-0],e,this);break;case 3:i=vb(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hh(i,e.length),i}transformAsVector(e,t){let r;switch(e.length){case 2:r=nR(t||[-0,-0],e,this);break;case 3:r=yb(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return hh(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}let yl,vl;function NR(){return yl||(yl=new rr([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(yl)),yl}function DR(){return vl||(vl=new rr,Object.freeze(vl)),vl}function ay(n){if(n>Math.PI*2)throw Error("expected radians")}function FR(n,e,t,r,i,s){const l=2*s/(t-e),c=2*s/(i-r),f=(t+e)/(t-e),h=(i+r)/(i-r),p=-1,_=-1,y=-2*s;return n[0]=l,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=c,n[6]=0,n[7]=0,n[8]=f,n[9]=h,n[10]=p,n[11]=_,n[12]=0,n[13]=0,n[14]=y,n[15]=0,n}function Tb(n,e=[],t=0){const r=Math.fround(n),i=n-r;return e[t]=r,e[t+1]=i,e}function LR(n){return n-Math.fround(n)}function BR(n){const e=new Float32Array(32);for(let t=0;t<4;++t)for(let r=0;r<4;++r){const i=t*4+r;Tb(n[r*4+t],e,i*2)}return e}const UR=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,VR={name:"fp32",vs:UR},zR=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,$R={ONE:1},jR={name:"fp64arithmetic",vs:zR,defaultUniforms:$R,uniformTypes:{ONE:"f32"},fp64ify:Tb,fp64LowPart:LR,fp64ifyMatrix4:BR},WR=[0,1,1,1],HR=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,XR=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,ly={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:WR},vs:HR,fs:XR,getUniforms:YR};function YR(n={},e){const t={};if(n.highlightedObjectColor!==void 0)if(n.highlightedObjectColor===null)t.isHighlightActive=!1;else{t.isHighlightActive=!0;const r=n.highlightedObjectColor.slice(0,3);t.highlightedObjectColor=r}if(n.highlightColor){const r=Array.from(n.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),t.highlightColor=r}return n.isActive!==void 0&&(t.isActive=!!n.isActive,t.isAttribute=!!n.isAttribute),n.useFloatColors!==void 0&&(t.useFloatColors=!!n.useFloatColors),t}const cy=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,KR=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,xb=3,qR=255;var Wo;(function(n){n[n.POINT=0]="POINT",n[n.DIRECTIONAL=1]="DIRECTIONAL"})(Wo||(Wo={}));const Dl={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:xb},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:Wo.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:KR,vs:cy,fs:cy,getUniforms:ZR};function ZR(n,e={}){if(n=n&&{...n},!n)return{...Dl.defaultUniforms};n.lights&&(n={...n,...JR(n.lights),lights:void 0});const{ambientLight:t,pointLights:r,directionalLights:i}=n||{};if(!(t||r&&r.length>0||i&&i.length>0))return{...Dl.defaultUniforms,enabled:0};const l={...Dl.defaultUniforms,...e,...QR({ambientLight:t,pointLights:r,directionalLights:i})};return n.enabled!==void 0&&(l.enabled=n.enabled?1:0),l}function QR({ambientLight:n,pointLights:e=[],directionalLights:t=[]}){const r={};r.ambientLightColor=_h(n);let i=0;for(const s of e){r.lightType=Wo.POINT;const l=i;r[`lightColor${l}`]=_h(s),r[`lightPosition${l}`]=s.position,r[`lightAttenuation${l}`]=s.attenuation||[1,0,0],i++}for(const s of t){r.lightType=Wo.DIRECTIONAL;const l=i;r[`lightColor${l}`]=_h(s),r[`lightDirection${l}`]=s.direction,i++}return i>xb&&oe.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=t.length,r.pointLightCount=e.length,r}function JR(n){const e={pointLights:[],directionalLights:[]};for(const t of n||[])switch(t.type){case"ambient":e.ambientLight=t;break;case"directional":e.directionalLights?.push(t);break;case"point":e.pointLights?.push(t);break}return e}function _h(n={}){const{color:e=[0,0,0],intensity:t=1}=n;return e.map(r=>r*t/qR)}const GR=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,eC=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,tC=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,Sb={name:"phongMaterial",dependencies:[Dl],source:tC,vs:GR,fs:eC,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(n){const e={...n};return e.specularColor&&(e.specularColor=e.specularColor.map(t=>t/255)),{...Sb.defaultUniforms,...e}}},uy=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,nC={name:"layer",vs:uy,fs:uy,getUniforms:n=>({opacity:Math.pow(n.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},rC=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Eb="#define SMOOTH_EDGE_RADIUS 0.5",iC=`${Eb}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,sC=`${Eb}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Ab={name:"geometry",source:rC,vs:iC,fs:sC},oC=25;var bt;(function(n){n[n.Start=1]="Start",n[n.Move=2]="Move",n[n.End=4]="End",n[n.Cancel=8]="Cancel"})(bt||(bt={}));var Et;(function(n){n[n.None=0]="None",n[n.Left=1]="Left",n[n.Right=2]="Right",n[n.Up=4]="Up",n[n.Down=8]="Down",n[n.Horizontal=3]="Horizontal",n[n.Vertical=12]="Vertical",n[n.All=15]="All"})(Et||(Et={}));var ke;(function(n){n[n.Possible=1]="Possible",n[n.Began=2]="Began",n[n.Changed=4]="Changed",n[n.Ended=8]="Ended",n[n.Recognized=8]="Recognized",n[n.Cancelled=16]="Cancelled",n[n.Failed=32]="Failed"})(ke||(ke={}));const aC="compute",lC="auto",id="manipulation",Fl="none",sd="pan-x",od="pan-y";function cC(n){if(n.includes(Fl))return Fl;const e=n.includes(sd),t=n.includes(od);return e&&t?Fl:e||t?e?sd:od:n.includes(id)?id:lC}class uC{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){e===aC&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return cC(e.join(" "))}}function oc(n){return n.trim().split(/\s+/g)}function mh(n,e,t){if(n)for(const r of oc(e))n.addEventListener(r,t,!1)}function yh(n,e,t){if(n)for(const r of oc(e))n.removeEventListener(r,t,!1)}function fy(n){return(n.ownerDocument||n).defaultView}function fC(n,e){let t=n;for(;t;){if(t===e)return!0;t=t.parentNode}return!1}function Rb(n){const e=n.length;if(e===1)return{x:Math.round(n[0].clientX),y:Math.round(n[0].clientY)};let t=0,r=0,i=0;for(;i<e;)t+=n[i].clientX,r+=n[i].clientY,i++;return{x:Math.round(t/e),y:Math.round(r/e)}}function hy(n){const e=[];let t=0;for(;t<n.pointers.length;)e[t]={clientX:Math.round(n.pointers[t].clientX),clientY:Math.round(n.pointers[t].clientY)},t++;return{timeStamp:Date.now(),pointers:e,center:Rb(e),deltaX:n.deltaX,deltaY:n.deltaY}}function Cb(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.sqrt(t*t+r*r)}function dy(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.sqrt(t*t+r*r)}function hC(n,e){const t=e.x-n.x,r=e.y-n.y;return Math.atan2(r,t)*180/Math.PI}function py(n,e){const t=e.clientX-n.clientX,r=e.clientY-n.clientY;return Math.atan2(r,t)*180/Math.PI}function Ib(n,e){return n===e?Et.None:Math.abs(n)>=Math.abs(e)?n<0?Et.Left:Et.Right:e<0?Et.Up:Et.Down}function dC(n,e){const t=e.center;let r=n.offsetDelta,i=n.prevDelta;const s=n.prevInput;return(e.eventType===bt.Start||s?.eventType===bt.End)&&(i=n.prevDelta={x:s?.deltaX||0,y:s?.deltaY||0},r=n.offsetDelta={x:t.x,y:t.y}),{deltaX:i.x+(t.x-r.x),deltaY:i.y+(t.y-r.y)}}function Pb(n,e,t){return{x:e/n||0,y:t/n||0}}function pC(n,e){return dy(e[0],e[1])/dy(n[0],n[1])}function gC(n,e){return py(e[1],e[0])-py(n[1],n[0])}function _C(n,e){const t=n.lastInterval||e,r=e.timeStamp-t.timeStamp;let i,s,l,c;if(e.eventType!==bt.Cancel&&(r>oC||t.velocity===void 0)){const f=e.deltaX-t.deltaX,h=e.deltaY-t.deltaY,p=Pb(r,f,h);s=p.x,l=p.y,i=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,c=Ib(f,h),n.lastInterval=e}else i=t.velocity,s=t.velocityX,l=t.velocityY,c=t.direction;e.velocity=i,e.velocityX=s,e.velocityY=l,e.direction=c}function mC(n,e){const{session:t}=n,{pointers:r}=e,{length:i}=r;t.firstInput||(t.firstInput=hy(e)),i>1&&!t.firstMultiple?t.firstMultiple=hy(e):i===1&&(t.firstMultiple=!1);const{firstInput:s,firstMultiple:l}=t,c=l?l.center:s.center,f=e.center=Rb(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=hC(c,f),e.distance=Cb(c,f);const{deltaX:h,deltaY:p}=dC(t,e);e.deltaX=h,e.deltaY=p,e.offsetDirection=Ib(e.deltaX,e.deltaY);const _=Pb(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=l?pC(l.pointers,r):1,e.rotation=l?gC(l.pointers,r):0,e.maxPointers=t.prevInput?e.pointers.length>t.prevInput.maxPointers?e.pointers.length:t.prevInput.maxPointers:e.pointers.length;let y=n.element;return fC(e.srcEvent.target,y)&&(y=e.srcEvent.target),e.target=y,_C(t,e),e}function yC(n,e,t){const r=t.pointers.length,i=t.changedPointers.length,s=e&bt.Start&&r-i===0,l=e&(bt.End|bt.Cancel)&&r-i===0;t.isFirst=!!s,t.isFinal=!!l,s&&(n.session={}),t.eventType=e;const c=mC(n,t);n.emit("hammer.input",c),n.recognize(c),n.session.prevInput=c}let vC=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=t=>{this.manager.options.enable&&this.handler(t)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){yC(this.manager,e,t)}init(){mh(this.element,this.evEl,this.domHandler),mh(this.target,this.evTarget,this.domHandler),mh(fy(this.element),this.evWin,this.domHandler)}destroy(){yh(this.element,this.evEl,this.domHandler),yh(this.target,this.evTarget,this.domHandler),yh(fy(this.element),this.evWin,this.domHandler)}};const bC={pointerdown:bt.Start,pointermove:bt.Move,pointerup:bt.End,pointercancel:bt.Cancel,pointerout:bt.Cancel},wC="pointerdown",TC="pointermove pointerup pointercancel";class xC extends vC{constructor(e){super(e),this.evEl=wC,this.evWin=TC,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:t}=this;let r=!1;const i=bC[e.type],s=e.pointerType,l=s==="touch";let c=t.findIndex(f=>f.pointerId===e.pointerId);i&bt.Start&&(e.buttons||l)?c<0&&(t.push(e),c=t.length-1):i&(bt.End|bt.Cancel)&&(r=!0),!(c<0)&&(t[c]=e,this.callback(i,{pointers:t,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&t.splice(c,1))}}const SC=["","webkit","Moz","MS","ms","o"];function EC(n,e){const t=e[0].toUpperCase()+e.slice(1);for(const r of SC){const i=r?r+t:e;if(i in n)return i}}const AC=1,gy=2,_y={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class RC{constructor(e,t){this.options={..._y,...t,cssProps:{..._y.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new xC(this),this.touchAction=new uC(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?gy:AC}recognize(e){const{session:t}=this;if(t.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=t;(!s||s&&s.state&ke.Recognized)&&(s=t.curRecognizer=null);let l=0;for(;l<i.length;)r=i[l],t.stopped!==gy&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(ke.Began|ke.Changed|ke.Ended)&&(s=t.curRecognizer=r),l++}get(e){const{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const t=typeof e=="string"?this.get(e):e;if(t){const{recognizers:r}=this,i=r.indexOf(t);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;const{handlers:r}=this;for(const i of oc(e))r[i]=r[i]||[],r[i].push(t)}off(e,t){if(!e)return;const{handlers:r}=this;for(const i of oc(e))t?r[i]&&r[i].splice(r[i].indexOf(t),1):delete r[i]}emit(e,t){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=t;i.type=e,i.preventDefault=function(){t.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:t}=this;if(t){for(const[r,i]of Object.entries(this.options.cssProps)){const s=EC(t.style,r);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let CC=1;function IC(){return CC++}function my(n){return n&ke.Cancelled?"cancel":n&ke.Ended?"end":n&ke.Changed?"move":n&ke.Began?"start":""}class kb{constructor(e){this.options=e,this.id=IC(),this.state=ke.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let t;return typeof e=="string"?t=this.manager.get(e):t=e,t&&delete this.simultaneous[t.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let t;if(typeof e=="string"){if(t=this.manager.get(e),!t)throw new Error(`Cannot find recognizer ${e}`)}else t=e;const{requireFail:r}=this;return r.indexOf(t)===-1&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let t;if(typeof e=="string"?t=this.manager.get(e):t=e,t){const r=this.requireFail.indexOf(t);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:t}=this;t<ke.Ended&&this.manager.emit(this.options.event+my(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=ke.Ended&&this.manager.emit(this.options.event+my(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=ke.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(ke.Failed|ke.Possible)))return!1;e++}return!0}recognize(e){const t={...e};if(!this.options.enable){this.reset(),this.state=ke.Failed;return}this.state&(ke.Recognized|ke.Cancelled|ke.Failed)&&(this.state=ke.Possible),this.state=this.process(t),this.state&(ke.Began|ke.Changed|ke.Ended|ke.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class Mb extends kb{attrTest(e){const t=this.options.pointers;return t===0||e.pointers.length===t}process(e){const{state:t}=this,{eventType:r}=e,i=t&(ke.Began|ke.Changed),s=this.attrTest(e);return i&&(r&bt.Cancel||!s)?t|ke.Cancelled:i||s?r&bt.End?t|ke.Ended:t&ke.Began?t|ke.Changed:ke.Began:ke.Failed}}class yy extends kb{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[id]}process(e){const{options:t}=this,r=e.pointers.length===t.pointers,i=e.distance<t.threshold,s=e.deltaTime<t.time;if(this.reset(),e.eventType&bt.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==bt.End)return this.failTimeout();const l=this.pTime?e.timeStamp-this.pTime<t.interval:!0,c=!this.pCenter||Cb(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!c||!l?this.count=1:this.count+=1,this._input=e,this.count%t.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=ke.Recognized,this.tryEmit(this._input)},t.interval),ke.Began):ke.Recognized}return ke.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=ke.Failed},this.options.interval),ke.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===ke.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const PC=["","start","move","end","cancel","up","down","left","right"];class vy extends Mb{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Et.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,t=[];return e&Et.Horizontal&&t.push(od),e&Et.Vertical&&t.push(sd),t}getEventNames(){return PC.map(e=>this.options.event+e)}directionTest(e){const{options:t}=this;let r=!0,{distance:i}=e,{direction:s}=e;const l=e.deltaX,c=e.deltaY;return s&t.direction||(t.direction&Et.Horizontal?(s=l===0?Et.None:l<0?Et.Left:Et.Right,r=l!==this.pX,i=Math.abs(e.deltaX)):(s=c===0?Et.None:c<0?Et.Up:Et.Down,r=c!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>t.threshold&&!!(s&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&ke.Began)||!(this.state&ke.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const t=Et[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}const kC=["","start","move","end","cancel","in","out"];class MC extends Mb{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Fl]}getEventNames(){return kC.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&ke.Began))}emit(e){if(e.scale!==1){const t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class Fc{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}const OC=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",NC=OC.indexOf("firefox")!==-1,by=4.000244140625,DC=40,FC=.25;class LC extends Fc{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(NC&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=DC)),s!==0&&s%by===0&&(s=Math.floor(s/by)),i.shiftKey&&s&&(s=s*FC),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){e==="wheel"&&(this.options.enable=t)}}const wy=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class BC extends Fc{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,wy.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){wy.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}const Ty=["keydown","keyup"];class UC extends Fc{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",Ty.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){Ty.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){e==="keydown"&&(this.enableDownEvent=t),e==="keyup"&&(this.enableUpEvent=t)}}class VC extends Fc{constructor(e,t,r){super(e,t,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){e==="contextmenu"&&(this.options.enable=t)}}const xy=1,ad=2,Sy=4,zC={pointerdown:xy,pointermove:ad,pointerup:Sy,mousedown:xy,mousemove:ad,mouseup:Sy},$C=0,jC=1,WC=2,HC=1,XC=2,YC=4;function KC(n){const e=zC[n.srcEvent.type];if(!e)return null;const{buttons:t,button:r}=n.srcEvent;let i=!1,s=!1,l=!1;return e===ad?(i=!!(t&HC),s=!!(t&YC),l=!!(t&XC)):(i=r===$C,s=r===jC,l=r===WC),{leftButton:i,middleButton:s,rightButton:l}}function qC(n,e){const t=n.center;if(!t)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,l={x:(t.x-r.left-e.clientLeft)/i,y:(t.y-r.top-e.clientTop)/s};return{center:t,offsetCenter:l}}const ZC={srcElement:"root",priority:0};class QC{constructor(e,t){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,s=!1){const{handlers:l,handlersByElement:c}=this,f={...ZC,...r};let h=c.get(f.srcElement);h||(h=[],c.set(f.srcElement,h));const p={type:e,handler:t,srcElement:f.srcElement,priority:f.priority};i&&(p.once=!0),s&&(p.passive=!0),l.push(p),this._active=this._active||!p.passive;let _=h.length-1;for(;_>=0&&!(h[_].priority>=p.priority);)_--;h.splice(_+1,0,p)}remove(e,t){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const l=r[s];if(l.type===e&&l.handler===t){r.splice(s,1);const c=i.get(l.srcElement);c.splice(c.indexOf(l),1),c.length===0&&i.delete(l.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,t){const r=this.handlersByElement.get(t);if(r){let i=!1;const s=()=>{e.handled=!0},l=()=>{e.handled=!0,i=!0},c=[];for(let f=0;f<r.length;f++){const{type:h,handler:p,once:_}=r[f];if(p({...e,type:h,stopPropagation:s,stopImmediatePropagation:l}),_&&c.push(r[f]),i)break}for(let f=0;f<c.length;f++){const{type:h,handler:p}=c[f];this.remove(h,p)}}}_normalizeEvent(e){const t=this.eventManager.getElement();return{...e,...KC(e),...qC(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}function JC(n){if("recognizer"in n)return n;let e;const t=Array.isArray(n)?[...n]:[n];if(typeof t[0]=="function"){const r=t.shift(),i=t.shift()||{};e=new r(i)}else e=t.shift();return{recognizer:e,recognizeWith:typeof t[0]=="string"?[t[0]]:t[0],requireFailure:typeof t[1]=="string"?[t[1]]:t[1]}}class GC{constructor(e=null,t={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!!e){this.manager=new RC(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:l}=JC(r);this.manager.add(i),s&&i.recognizeWith(s),l&&i.requireFailure(l)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new LC(e,this._onOtherEvent,{enable:!1}),this.moveInput=new BC(e,this._onOtherEvent,{enable:!1}),this.keyInput=new UC(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new VC(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:t}),r.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,r,i,s){if(typeof e!="string"){r=t;for(const[h,p]of Object.entries(e))this._addEventHandler(h,p,r,i,s);return}const{manager:l,events:c}=this;if(!l)return;let f=c.get(e);if(!f){const h=this._getRecognizerName(e)||e;f=new QC(this,h),c.set(e,f),l&&l.on(e,f.handleEvent)}f.add(e,t,r,i,s),f.isEmpty()||this._toggleRecognizer(f.recognizerName,!0)}_removeEventHandler(e,t){if(typeof e!="string"){for(const[s,l]of Object.entries(e))this._removeEventHandler(s,l);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,t),i.isEmpty())){const{recognizerName:s}=i;let l=!1;for(const c of r.values())if(c.recognizerName===s&&!c.isEmpty()){l=!0;break}l||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}const ze={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ze,"IDENTITY",{get:()=>(Je.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const En={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ri={common:0,meters:1,pixels:2},ld={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Ey={multipan:[vy,{threshold:10,direction:Et.Vertical,pointers:2}],pinch:[MC,{},null,["multipan"]],pan:[vy,{threshold:1},["pinch"],["multipan"]],dblclick:[yy,{event:"dblclick",taps:2}],click:[yy,{event:"click"},null,["dblclick"]]};function eI(n,e){if(n===e)return!0;if(Array.isArray(n)){const t=n.length;if(!e||e.length!==t)return!1;for(let r=0;r<t;r++)if(n[r]!==e[r])return!1;return!0}return!1}function Jo(n){let e={},t;return r=>{for(const i in r)if(!eI(r[i],e[i])){t=n(r),e=r;break}return t}}const Ay=[0,0,0,0],tI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Ob=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],nI=[0,0,0],Nb=[0,0,0],rI=Jo(oI);function Db(n,e,t=Nb){t.length<3&&(t=[t[0],t[1],0]);let r=t,i,s=!0;switch(e===ze.LNGLAT_OFFSETS||e===ze.METER_OFFSETS?i=t:i=n.isGeospatial?[Math.fround(n.longitude),Math.fround(n.latitude),0]:null,n.projectionMode){case En.WEB_MERCATOR:(e===ze.LNGLAT||e===ze.CARTESIAN)&&(i=[0,0,0],s=!1);break;case En.WEB_MERCATOR_AUTO_OFFSET:e===ze.LNGLAT?r=i:e===ze.CARTESIAN&&(r=[Math.fround(n.center[0]),Math.fround(n.center[1]),0],i=n.unprojectPosition(r),r[0]-=t[0],r[1]-=t[1],r[2]-=t[2]);break;case En.IDENTITY:r=n.position.map(Math.fround),r[2]=r[2]||0;break;case En.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function iI(n,e,t){const{viewMatrixUncentered:r,projectionMatrix:i}=n;let{viewMatrix:s,viewProjectionMatrix:l}=n,c=Ay,f=Ay,h=n.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:y}=Db(n,e,t);return y&&(f=n.projectPosition(p||_),h=[h[0]-f[0],h[1]-f[1],h[2]-f[2]],f[3]=1,c=Qo([],f,l),s=r||s,l=bi([],i,s),l=bi([],l,tI)),{viewMatrix:s,viewProjectionMatrix:l,projectionCenter:c,originCommon:f,cameraPosCommon:h,shaderCoordinateOrigin:_,geospatialOrigin:p}}function sI({viewport:n,devicePixelRatio:e=1,modelMatrix:t=null,coordinateSystem:r=ze.DEFAULT,coordinateOrigin:i=Nb,autoWrapLongitude:s=!1}){r===ze.DEFAULT&&(r=n.isGeospatial?ze.LNGLAT:ze.CARTESIAN);const l=rI({viewport:n,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return l.wrapLongitude=s,l.modelMatrix=t||Ob,l}function oI({viewport:n,devicePixelRatio:e,coordinateSystem:t,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:h}=iI(n,t,r),p=n.getDistanceScales(),_=[n.width*e,n.height*e],y=Qo([],[0,0,-n.focalDistance,1],n.projectionMatrix)[3]||1,b={coordinateSystem:t,projectionMode:n.projectionMode,coordinateOrigin:f,commonOrigin:l.slice(0,3),center:i,pseudoMeters:!!n._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:y,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:nI,scale:n.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:Ob,cameraPosition:c};if(h){const x=n.getDistanceScales(h);switch(t){case ze.METER_OFFSETS:b.commonUnitsPerWorldUnit=x.unitsPerMeter,b.commonUnitsPerWorldUnit2=x.unitsPerMeter2;break;case ze.LNGLAT:case ze.LNGLAT_OFFSETS:n._pseudoMeters||(b.commonUnitsPerMeter=x.unitsPerMeter),b.commonUnitsPerWorldUnit=x.unitsPerDegree,b.commonUnitsPerWorldUnit2=x.unitsPerDegree2;break;case ze.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,x.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,x.unitsPerMeter2[2]];break}}return b}const aI=Object.keys(ze).map(n=>`const COORDINATE_SYSTEM_${n}: i32 = ${ze[n]};`).join(""),lI=Object.keys(En).map(n=>`const PROJECTION_MODE_${n}: i32 = ${En[n]};`).join(""),cI=Object.keys(Ri).map(n=>`const UNIT_${n.toUpperCase()}: i32 = ${Ri[n]};`).join(""),uI=`${aI}
${lI}
${cI}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,fI=`${uI}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,hI=Object.keys(ze).map(n=>`const int COORDINATE_SYSTEM_${n} = ${ze[n]};`).join(""),dI=Object.keys(En).map(n=>`const int PROJECTION_MODE_${n} = ${En[n]};`).join(""),pI=Object.keys(Ri).map(n=>`const int UNIT_${n.toUpperCase()} = ${Ri[n]};`).join(""),gI=`${hI}
${dI}
${pI}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,_I={};function mI(n=_I){return"viewport"in n?sI(n):{}}const Jd={name:"project",dependencies:[VR,Ab],source:fI,vs:gI,getUniforms:mI,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},yI=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vI=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,Gd={name:"project32",dependencies:[Jd],source:yI,vs:vI};function bI(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ts(n,e){const t=Qo([],e,n);return PR(t,t,1/t[3]),t}function Ry(n,e){const t=n%e;return t<0?e+t:t}function cd(n,e,t){return n<e?e:n>t?t:n}function wI(n){return Math.log(n)*Math.LOG2E}const ep=Math.log2||wI;function mr(n,e){if(!n)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const zn=Math.PI,Fb=zn/4,Cn=zn/180,ud=180/zn,Is=512,ac=4003e4,bl=85.051129,TI=1.5;function xI(n){return ep(n)}function lc(n){const[e,t]=n;mr(Number.isFinite(e)),mr(Number.isFinite(t)&&t>=-90&&t<=90,"invalid latitude");const r=e*Cn,i=t*Cn,s=Is*(r+zn)/(2*zn),l=Is*(zn+Math.log(Math.tan(Fb+i*.5)))/(2*zn);return[s,l]}function Ps(n){const[e,t]=n,r=e/Is*(2*zn)-zn,i=2*(Math.atan(Math.exp(t/Is*(2*zn)-zn))-Fb);return[r*ud,i*ud]}function SI(n){const{latitude:e}=n;mr(Number.isFinite(e));const t=Math.cos(e*Cn);return xI(ac*t)-9}function vh(n){const e=Math.cos(n*Cn);return Is/ac/e}function fd(n){const{latitude:e,longitude:t,highPrecision:r=!1}=n;mr(Number.isFinite(e)&&Number.isFinite(t));const i=Is,s=Math.cos(e*Cn),l=i/360,c=l/s,f=i/ac/s,h={unitsPerMeter:[f,f,f],metersPerUnit:[1/f,1/f,1/f],unitsPerDegree:[l,c,f],degreesPerUnit:[1/l,1/c,1/f]};if(r){const p=Cn*Math.tan(e*Cn)/s,_=l*p/2,y=i/ac*p,b=y/c*f;h.unitsPerDegree2=[0,_,y],h.unitsPerMeter2=[b,0,b]}return h}function Lb(n,e){const[t,r,i]=n,[s,l,c]=e,{unitsPerMeter:f,unitsPerMeter2:h}=fd({longitude:t,latitude:r,highPrecision:!0}),p=lc(n);p[0]+=s*(f[0]+h[0]*l),p[1]+=l*(f[1]+h[1]*l);const _=Ps(p),y=(i||0)+(c||0);return Number.isFinite(i)||Number.isFinite(c)?[_[0],_[1],y]:_}function EI(n){const{height:e,pitch:t,bearing:r,altitude:i,scale:s,center:l}=n,c=bI();sc(c,c,[0,0,-i]),bb(c,c,-t*Cn),wb(c,c,r*Cn);const f=s/e;return Qd(c,c,[f,f,f]),l&&sc(c,c,oR([],l)),c}function AI(n){const{width:e,height:t,altitude:r,pitch:i=0,offset:s,center:l,scale:c,nearZMultiplier:f=1,farZMultiplier:h=1}=n;let{fovy:p=cc(TI)}=n;r!==void 0&&(p=cc(r));const _=p*Cn,y=i*Cn,b=Bb(p);let x=b;l&&(x+=l[2]*c/Math.cos(y)/t);const S=_*(.5+(s?s[1]:0)/t),C=Math.sin(S)*x/Math.sin(cd(Math.PI/2-y-S,.01,Math.PI-.01)),P=Math.sin(y)*C+x,z=x*10,k=Math.min(P*h,z);return{fov:_,aspect:e/t,focalDistance:b,near:f,far:k}}function cc(n){return 2*Math.atan(.5/n)*ud}function Bb(n){return .5/Math.tan(.5*n*Cn)}function Ub(n,e){const[t,r,i=0]=n;return mr(Number.isFinite(t)&&Number.isFinite(r)&&Number.isFinite(i)),Ts(e,[t,r,i,1])}function tp(n,e,t=0){const[r,i,s]=n;if(mr(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Ts(e,[r,i,s,1]);const l=Ts(e,[r,i,0,1]),c=Ts(e,[r,i,1,1]),f=l[2],h=c[2],p=f===h?0:((t||0)-f)/(h-f);return mb([],l,c,p)}function RI(n){const{width:e,height:t,bounds:r,minExtent:i=0,maxZoom:s=24,offset:l=[0,0]}=n,[[c,f],[h,p]]=r,_=CI(n.padding),y=lc([c,cd(p,-bl,bl)]),b=lc([h,cd(f,-bl,bl)]),x=[Math.max(Math.abs(b[0]-y[0]),i),Math.max(Math.abs(b[1]-y[1]),i)],S=[e-_.left-_.right-Math.abs(l[0])*2,t-_.top-_.bottom-Math.abs(l[1])*2];mr(S[0]>0&&S[1]>0);const C=S[0]/x[0],P=S[1]/x[1],z=(_.right-_.left)/2/C,k=(_.top-_.bottom)/2/P,V=[(b[0]+y[0])/2+z,(b[1]+y[1])/2+k],Z=Ps(V),Y=Math.min(s,ep(Math.abs(Math.min(C,P))));return mr(Number.isFinite(Y)),{longitude:Z[0],latitude:Z[1],zoom:Y}}function CI(n=0){return typeof n=="number"?{top:n,bottom:n,left:n,right:n}:(mr(Number.isFinite(n.top)&&Number.isFinite(n.bottom)&&Number.isFinite(n.left)&&Number.isFinite(n.right)),n)}const Cy=Math.PI/180;function II(n,e=0){const{width:t,height:r,unproject:i}=n,s={targetZ:e},l=i([0,r],s),c=i([t,r],s);let f,h;const p=n.fovy?.5*n.fovy*Cy:Math.atan(.5/n.altitude),_=(90-n.pitch)*Cy;return p>_-.01?(f=Iy(n,0,e),h=Iy(n,t,e)):(f=i([0,0],s),h=i([t,0],s)),[l,c,h,f]}function Iy(n,e,t){const{pixelUnprojectionMatrix:r}=n,i=Ts(r,[e,0,1,1]),s=Ts(r,[e,n.height,1,1]),c=(t*n.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),f=mb([],i,s,c),h=Ps(f);return h.push(t),h}const Py=512;function PI(n){const{width:e,height:t,pitch:r=0}=n;let{longitude:i,latitude:s,zoom:l,bearing:c=0}=n;(i<-180||i>180)&&(i=Ry(i+180,360)-180),(c<-180||c>180)&&(c=Ry(c+180,360)-180);const f=ep(t/Py);if(l<=f)l=f,s=0;else{const h=t/2/Math.pow(2,l),p=Ps([0,h])[1];if(s<p)s=p;else{const _=Ps([0,Py-h])[1];s>_&&(s=_)}}return{width:e,height:t,longitude:i,latitude:s,zoom:l,pitch:r,bearing:c}}const Vb=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,kI=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,MI=`
${Vb}
${kI}
`,OI=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,NI=`
${Vb}
${OI}
`,DI=Jo(VI),FI=Jo(zI),LI=[0,0,0,1],BI=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function UI(n,e){const[t,r,i]=n,s=tp([t,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function VI({viewport:n,center:e}){return new rr(n.viewProjectionMatrix).invert().transform(e)}function zI({viewport:n,shadowMatrices:e}){const t=[],r=n.pixelUnprojectionMatrix,i=n.isGeospatial?void 0:1,s=[[0,0,i],[n.width,0,i],[0,n.height,i],[n.width,n.height,i],[0,0,-1],[n.width,0,-1],[0,n.height,-1],[n.width,n.height,-1]].map(l=>UI(l,r));for(const l of e){const c=l.clone().translate(new nr(n.center).negate()),f=s.map(p=>c.transform(p)),h=new rr().ortho({left:Math.min(...f.map(p=>p[0])),right:Math.max(...f.map(p=>p[0])),bottom:Math.min(...f.map(p=>p[1])),top:Math.max(...f.map(p=>p[1])),near:Math.min(...f.map(p=>-p[2])),far:Math.max(...f.map(p=>-p[2]))});t.push(h.multiplyRight(l))}return t}function $I(n){const{shadowEnabled:e=!0,project:t}=n;if(!e||!t||!n.shadowMatrices||!n.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};const r=Jd.getUniforms(t),i=DI({viewport:t.viewport,center:r.center}),s=[],l=FI({shadowMatrices:n.shadowMatrices,viewport:t.viewport}).slice();for(let f=0;f<n.shadowMatrices.length;f++){const h=l[f],p=h.clone().translate(new nr(t.viewport.center).negate());r.coordinateSystem===ze.LNGLAT&&r.projectionMode===En.WEB_MERCATOR?(l[f]=p,s[f]=i):(l[f]=h.clone().multiplyRight(BI),s[f]=p.transform(i))}const c={drawShadowMap:!!n.drawToShadowMap,useShadowMap:n.shadowMaps?n.shadowMaps.length>0:!1,color:n.shadowColor||LI,lightId:n.shadowLightId||0,lightCount:n.shadowMatrices.length,shadow_uShadowMap0:n.dummyShadowMap,shadow_uShadowMap1:n.dummyShadowMap};for(let f=0;f<l.length;f++)c[`viewProjectionMatrix${f}`]=l[f],c[`projectCenter${f}`]=s[f];for(let f=0;f<2;f++)c[`shadow_uShadowMap${f}`]=n.shadowMaps&&n.shadowMaps[f]||n.dummyShadowMap;return c}const ky={name:"shadow",dependencies:[Jd],vs:MI,fs:NI,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:$I,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},np={...ly,defaultUniforms:{...ly.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},jI=[Ab],WI=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],HI=[];function XI(n){const e=Xl.getDefaultShaderAssembler();for(const r of jI)e.addDefaultModule(r);const t=n==="glsl"?WI:HI;for(const r of t)e.addShaderHook(r);return e}const YI=[255,255,255],KI=1;let qI=0;class ZI{constructor(e={}){this.type="ambient";const{color:t=YI}=e,{intensity:r=KI}=e;this.id=e.id||`ambient-${qI++}`,this.color=t,this.intensity=r}}const QI=[255,255,255],JI=1,GI=[0,0,-1];let eP=0;class My{constructor(e={}){this.type="directional";const{color:t=QI}=e,{intensity:r=JI}=e,{direction:i=GI}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${eP++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new nr(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class tP{constructor(e,t={id:"pass"}){const{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class rp extends tP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[t,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),l=i?1:!1,c=i?0:!1,f=e.colorMask??15,h={viewport:[0,0,t,r]};e.colorMask&&(h.colorMask=f),e.scissorRect&&(h.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:s,clearDepth:l,clearStencil:c});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,t){const{target:r,shaderModuleProps:i,viewports:s,views:l,onViewportActive:c,clearStack:f=!0}=t;t.pass=t.pass||"unknown",f&&(this._lastRenderIndex=-1);const h=[];for(const p of s){const _=l&&l[p.id];c?.(p);const y=this._getDrawLayerParams(p,t),b=p.subViewports||[p];for(const x of b){const S=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:x,view:_,pass:t.pass,layers:t.layers},y);h.push(S)}}return h}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:s,cullRect:l,effects:c,shaderModuleProps:f},h=!1){const p=[],_=zb(this._lastRenderIndex+1),y={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:l},b={};for(let x=0;x<t.length;x++){const S=t[x],C=this._shouldDrawLayer(S,y,s,b),P={shouldDrawLayer:C};C&&!h&&(P.shouldDrawLayer=!0,P.layerRenderIndex=_(S,C),P.shaderModuleProps=this._getShaderModuleProps(S,c,r,f),P.layerParameters={...S.context.deck?.props.parameters,...this.getLayerParameters(S,x,e)}),p[x]=P}return p}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:i,target:s,viewport:l,view:c},f){const h=nP(this.device,{shaderModuleProps:r,target:s,viewport:l});if(c&&c.props.clear){const _=c.props.clear===!0?{color:!0,depth:!0}:c.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:h,scissorRect:h},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const p={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:h});for(let _=0;_<t.length;_++){const y=t[_],b=f[_],{shouldDrawLayer:x}=b;if(x&&y.props.pickable&&p.pickableCount++,y.isComposite&&p.compositeCount++,y.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:S,shaderModuleProps:C,layerParameters:P}=b;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,S),C.project&&(C.project.viewport=l),y.context.renderPass=e;try{y._drawLayer({renderPass:e,shaderModuleProps:C,uniforms:{layerIndex:S},parameters:P})}catch(z){y.raiseError(z,`drawing ${y} to ${i}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let l=e.parent;for(;l;){if(!l.props.visible||!l.filterSubLayer(t))return!1;t.layer=l,l=l.parent}if(r){const c=t.layer.id;if(c in i||(i[c]=r(t)),!i[c])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,i){const s=this.device.canvasContext.cssToDeviceRatio(),l=e.internalState?.propsInTransition||e.props,c={layer:l,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:l.modelMatrix,coordinateSystem:l.coordinateSystem,coordinateOrigin:l.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(const f of t)Oy(c,f.getShaderModuleProps?.(e,c));return Oy(c,this.getShaderModuleProps(e,t,c),i)}}function zb(n=0,e={}){const t={},r=(i,s)=>{const l=i.props._offset,c=i.id,f=i.parent&&i.parent.id;let h;if(f&&!(f in e)&&r(i.parent,!1),f in t){const p=t[f]=t[f]||zb(e[f],e);h=p(i,s),t[c]=p}else Number.isFinite(l)?(h=l+(e[f]||0),t[c]=null):h=n;return s&&h>=n&&(n=h+1),e[c]=h,h};return r}function nP(n,{shaderModuleProps:e,target:t,viewport:r}){const i=e?.project?.devicePixelRatio??n.canvasContext.cssToDeviceRatio(),[,s]=n.canvasContext.getDrawingBufferSize(),l=t?t.height:s,c=r;return[c.x*i,l-(c.y+c.height)*i,c.width*i,c.height*i]}function Oy(n,...e){for(const t of e)if(t)for(const r in t)n[r]?Object.assign(n[r],t[r]):n[r]=t[r];return n}class rP extends rp{constructor(e,t){super(e,t);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,l=i.height*r,c=[1,1,1,1];(s!==t.width||l!==t.height)&&t.resize({width:s,height:l}),super.render({...e,clearColor:c,target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const iP={color:[255,255,255],intensity:1},Ny=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],sP=[0,0,0,200/255];class $b{constructor(e={}){this.id="lighting-effect",this.shadowColor=sP,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(ky),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const t in e){const r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(t=>t.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let l=0;l<this.shadowPasses.length;l++)this.shadowPasses[l].render({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:l,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){const r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(l=>l.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(l=>l.getProjectedLight({layer:e})),pointLights:this.pointLights.map(l=>l.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const t of this.shadowPasses)t.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ky))}_calculateMatrices(){const e=[];for(const t of this.directionalLights){const r=new rr().lookAt({eye:new nr(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){const r=new rP(e);this.shadowPasses[t]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:t,directionalLights:r}=this;!e&&t.length===0&&r.length===0&&(this.ambientLight=new ZI(iP),this.directionalLights.push(new My(Ny[0]),new My(Ny[1])))}}class oP{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:s=0,copy:l=!1,initialize:c=!1,maxCount:f}){const h=i||e&&e.constructor||Float32Array,p=t*r+s;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,p)}let _=1/0;f&&(_=f*r+s);const y=this._allocate(h,p,c,_);return e&&l?y.set(e):c||y.fill(0,0,4),this._release(e),y}release(e){this._release(e)}_allocate(e,t,r,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);const l=this._pool,c=e.BYTES_PER_ELEMENT*s,f=l.findIndex(h=>h.byteLength>=c);if(f>=0){const h=new e(l.splice(f,1)[0],0,s);return r&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const t=this._pool,{buffer:r}=e,{byteLength:i}=r,s=t.findIndex(l=>l.byteLength>=i);s<0?t.push(r):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,r),t.length>this.opts.poolSize&&t.shift()}}const Ho=new oP;function Io(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function aP(n){return[n[12],n[13],n[14]]}function lP(n){return{left:hs(n[3]+n[0],n[7]+n[4],n[11]+n[8],n[15]+n[12]),right:hs(n[3]-n[0],n[7]-n[4],n[11]-n[8],n[15]-n[12]),bottom:hs(n[3]+n[1],n[7]+n[5],n[11]+n[9],n[15]+n[13]),top:hs(n[3]-n[1],n[7]-n[5],n[11]-n[9],n[15]-n[13]),near:hs(n[3]+n[2],n[7]+n[6],n[11]+n[10],n[15]+n[14]),far:hs(n[3]-n[2],n[7]-n[6],n[11]-n[10],n[15]-n[14])}}const Dy=new nr;function hs(n,e,t,r){Dy.set(n,e,t);const i=Dy.len();return{distance:r/i,normal:new nr(-n/i,-e/i,-t/i)}}function cP(n){return n-Math.fround(n)}let So;function bh(n,e){const{size:t=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:n.length,s=(i-r)/t;So=Ho.allocate(So,s,{type:Float32Array,size:t*2});let l=r,c=0;for(;l<i;){for(let f=0;f<t;f++){const h=n[l++];So[c+f]=h,So[c+f+t]=cP(h)}c+=t*2}return So.subarray(0,s*t*2)}function uP(n){let e=null,t=!1;for(const r of n)r&&(e?(t||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],t=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const fP=Math.PI/180,hP=Io(),Fy=[0,0,0],dP={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function pP({width:n,height:e,orthographic:t,fovyRadians:r,focalDistance:i,padding:s,near:l,far:c}){const f=n/e,h=t?new rr().orthographic({fovy:r,aspect:f,focalDistance:i,near:l,far:c}):new rr().perspective({fovy:r,aspect:f,near:l,far:c});if(s){const{left:p=0,right:_=0,top:y=0,bottom:b=0}=s,x=qr((p+n-_)/2,0,n)-n/2,S=qr((y+e-b)/2,0,e)-e/2;h[8]-=x*2/n,h[9]+=S*2/e}return h}class Go{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||dP,this.focalDistance=e.focalDistance||1,this.position=e.position||Fy,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?En.WEB_MERCATOR:En.WEB_MERCATOR_AUTO_OFFSET:En.IDENTITY}equals(e){return e instanceof Go?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&jo(e.projectionMatrix,this.projectionMatrix)&&jo(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:t=!0}={}){const r=this.projectPosition(e),i=Ub(r,this.pixelProjectionMatrix),[s,l]=i,c=t?l:this.height-l;return e.length===2?[s,c]:[s,c,i[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){const[i,s,l]=e,c=t?s:this.height-s,f=r&&r*this.distanceScales.unitsPerMeter[2],h=tp([i,c,l],this.pixelUnprojectionMatrix,f),[p,_,y]=this.unprojectPosition(h);return Number.isFinite(l)?[p,_,y]:Number.isFinite(r)?[p,_,r]:[p,_]}projectPosition(e){const[t,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[t,r,i]}unprojectPosition(e){const[t,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[t,r,i]}projectFlat(e){if(this.isGeospatial){const t=lc(e);return t[1]=qr(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?Ps(e):e}getBounds(e={}){const t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),l=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],s[0],l[0]),Math.min(r[1],i[1],s[1],l[1]),Math.max(r[0],i[0],s[0],l[0]),Math.max(r[1],i[1],s[1],l[1])]}getDistanceScales(e){return e&&this.isGeospatial?fd({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,lP(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){const t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=SI({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||fd({latitude:r,longitude:t}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:l}=e;let c=Fy;if(s&&(c=l?new rr(l).transformAsVector(s,[]):s),this.isGeospatial){const f=this.projectPosition([t,r,0]);this.center=new nr(c).scale(this.distanceScales.unitsPerMeter).add(f)}else this.center=this.projectPosition(c)}_initMatrices(e){const{viewMatrix:t=hP,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:l=75,near:c=.1,far:f=1e3,padding:h=null,focalDistance:p=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new rr().multiplyRight(t).translate(new nr(this.center).negate()),this.projectionMatrix=r||pP({width:this.width,height:this.height,orthographic:i,fovyRadians:s||l*fP,focalDistance:p,padding:h,near:c,far:f});const _=Io();bi(_,_,this.projectionMatrix),bi(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=nd([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=aP(this.viewMatrixInverse);const y=Io(),b=Io();Qd(y,y,[this.width/2,-this.height/2,1]),sc(y,y,[1,-1,0]),bi(b,y,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=nd(Io(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||Je.warn("Pixel project matrix not invertible")()}}Go.displayName="Viewport";class ks extends Go{constructor(e={}){const{latitude:t=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:l=0,nearZMultiplier:c=.1,farZMultiplier:f=1.01,nearZ:h,farZ:p,orthographic:_=!1,projectionMatrix:y,repeat:b=!1,worldOffset:x=0,position:S,padding:C,legacyMeterSizes:P=!1}=e;let{width:z,height:k,altitude:V=1.5}=e;const Z=Math.pow(2,i);z=z||1,k=k||1;let Y,L=null;if(y)V=y[5]/2,Y=cc(V);else{e.fovy?(Y=e.fovy,V=Bb(Y)):Y=cc(V);let R;if(C){const{top:N=0,bottom:j=0}=C;R=[0,qr((N+k-j)/2,0,k)-k/2]}L=AI({width:z,height:k,scale:Z,center:S&&[0,0,S[2]*vh(t)],offset:R,pitch:s,fovy:Y,nearZMultiplier:c,farZMultiplier:f}),Number.isFinite(h)&&(L.near=h),Number.isFinite(p)&&(L.far=p)}let E=EI({height:k,pitch:s,bearing:l,scale:Z,altitude:V});x&&(E=new rr().translate([512*x,0,0]).multiplyLeft(E)),super({...e,width:z,height:k,viewMatrix:E,longitude:r,latitude:t,zoom:i,...L,fovy:Y,focalDistance:V}),this.latitude=t,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=l,this.altitude=V,this.fovy=Y,this.orthographic=_,this._subViewports=b?[]:null,this._pseudoMeters=P,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=t;i<=r;i++){const s=i?new ks({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[t,r]=this.projectFlat(e),i=(e[2]||0)*vh(e[1]);return[t,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[t,r]=this.unprojectFlat(e),i=(e[2]||0)/vh(r);return[t,r,i]}addMetersToLngLat(e,t){return Lb(e,t)}panByPosition(e,t){const r=tp(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=oy([],i,eR([],r)),l=oy([],this.center,s),[c,f]=this.unprojectFlat(l);return{longitude:c,latitude:f}}getBounds(e={}){const t=II(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){const{width:r,height:i}=this,{longitude:s,latitude:l,zoom:c}=RI({width:r,height:i,bounds:e,...t});return new ks({width:r,height:i,longitude:s,latitude:l,zoom:c})}}ks.displayName="WebMercatorViewport";const Ly=[0,0,0];function wh(n,e,t=!1){const r=e.projectPosition(n);if(t&&e instanceof ks){const[i,s,l=0]=n,c=e.getDistanceScales([i,s]);r[2]=l*c.unitsPerMeter[2]}return r}function gP(n){const{viewport:e,modelMatrix:t,coordinateOrigin:r}=n;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:l}=n;return i===ze.DEFAULT&&(i=e.isGeospatial?ze.LNGLAT:ze.CARTESIAN),s===void 0&&(s=i),l===void 0&&(l=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:t,fromCoordinateSystem:s,fromCoordinateOrigin:l}}function jb(n,{viewport:e,modelMatrix:t,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[l,c,f=0]=n;switch(t&&([l,c,f]=Qo([],[l,c,f,1],t)),r){case ze.LNGLAT:return wh([l,c,f],e,s);case ze.LNGLAT_OFFSETS:return wh([l+i[0],c+i[1],f+(i[2]||0)],e,s);case ze.METER_OFFSETS:return wh(Lb(i,[l,c,f]),e,s);case ze.CARTESIAN:default:return e.isGeospatial?[l+i[0],c+i[1],f+i[2]]:e.projectPosition([l,c,f])}}function _P(n,e){const{viewport:t,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:l,fromCoordinateOrigin:c}=gP(e),{autoOffset:f=!0}=e,{geospatialOrigin:h=Ly,shaderCoordinateOrigin:p=Ly,offsetMode:_=!1}=f?Db(t,r,i):{},y=jb(n,{viewport:t,modelMatrix:s,coordinateSystem:l,coordinateOrigin:c,offsetMode:_});if(_){const b=t.projectPosition(h||p);gR(y,y,b)}return y}let mP=1,yP=1;class Wb{constructor(){w(this,"time",0);w(this,"channels",new Map);w(this,"animations",new Map);w(this,"playing",!1);w(this,"lastEngineTime",-1)}addChannel(e){const{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,l=mP++,c={time:0,delay:t,duration:r,rate:i,repeat:s};return this._setChannelTime(c,this.time),this.channels.set(l,c),l}removeChannel(e){this.channels.delete(e);for(const[t,r]of this.animations)r.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return t===void 0?!1:this.time>=t.delay+t.duration*t.repeat}getTime(e){if(e===void 0)return this.time;const t=this.channels.get(e);return t===void 0?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:l}=i;s.setTime(this.getTime(l))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const r=yP++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const r=t-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function vP(n){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(n):setTimeout(n,1e3/60)}function bP(n){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(n):clearTimeout(n)}let wP=0;const TP={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:n=>console.error(n),stats:Hh.stats.get(`animation-loop-${wP++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class xP{constructor(e){w(this,"device",null);w(this,"canvas",null);w(this,"props");w(this,"animationProps",null);w(this,"timeline",null);w(this,"stats");w(this,"cpuTime");w(this,"gpuTime");w(this,"frameRate");w(this,"display");w(this,"needsRedraw","initialized");w(this,"_initialized",!1);w(this,"_running",!1);w(this,"_animationFrameId",null);w(this,"_nextFramePromise",null);w(this,"_resolveNextFrame",null);w(this,"_cpuStartTime",0);w(this,"_error",null);if(this.props={...TP,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new Oc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){const r=document.createElement("h1");r.innerHTML=e.message,r.style.position="absolute",r.style.top="20%",r.style.left="10px",r.style.color="black",r.style.backgroundColor="red",document.body.appendChild(r)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=vP(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(bP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){const e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};const[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1];let r=1;const i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Th={};function Oi(n="id"){Th[n]=Th[n]||1;const e=Th[n]++;return`${n}-${e}`}class By{constructor(e){w(this,"id");w(this,"userData",{});w(this,"topology");w(this,"bufferLayout",[]);w(this,"vertexCount");w(this,"indices");w(this,"attributes");if(this.id=e.id||Oi("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&st.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){this.indices?.destroy();for(const e of Object.values(this.attributes))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function SP(n,e){if(e instanceof By)return e;const t=EP(n,e),{attributes:r,bufferLayout:i}=AP(n,e);return new By({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:t,attributes:r})}function EP(n,e){if(!e.indices)return;const t=e.indices.value;return n.createBuffer({usage:st.INDEX,data:t})}function AP(n,e){const t=[],r={};for(const[s,l]of Object.entries(e.attributes)){let c=s;switch(s){case"POSITION":c="positions";break;case"NORMAL":c="normals";break;case"TEXCOORD_0":c="texCoords";break;case"COLOR_0":c="colors";break}if(l){r[c]=n.createBuffer({data:l.value,id:`${s}-buffer`});const{value:f,size:h,normalized:p}=l;t.push({name:c,format:pA(f,h,p)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:t,vertexCount:i}}const Cc=class Cc{constructor(e){w(this,"device");w(this,"destroyPolicy");w(this,"_hashCounter",0);w(this,"_hashes",{});w(this,"_renderPipelineCache",{});w(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Cc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const t={...Es.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const t={...Ql.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const t=e.hash,r=e instanceof Ql?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,r[t].useCount===0&&this.destroyPolicy==="unused"&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${t}/${r}V${i}BL${s}`;default:const l=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V${i}T${e.topology}P${l}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};w(Cc,"defaultProps",{...Es.defaultProps});let hd=Cc;const Ic=class Ic{constructor(e){w(this,"device");w(this,"destroyPolicy");w(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Ic(e)),e._lumaData.defaultShaderFactory}createShader(e){const t=this._hashShader(e);let r=this._cache[t];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};w(Ic,"defaultProps",{...Kl.defaultProps});let dd=Ic;function RP(n,e){const t={},r="Values";if(n.attributes.length===0&&!n.varyings?.length)return{"No attributes or varyings":{[r]:"N/A"}};for(const i of n.attributes)if(i){const s=`${i.location} ${i.name}: ${i.type}`;t[`in ${s}`]={[r]:i.stepMode||"vertex"}}for(const i of n.varyings||[]){const s=`${i.location} ${i.name}`;t[`out ${s}`]={[r]:JSON.stringify(i)}}return t}let Pt=null,xh=null;function CP(n,{id:e,minimap:t,opaque:r,top:i="0",left:s="0",rgbaScale:l=1}){Pt||(Pt=document.createElement("canvas"),Pt.id=e,Pt.title=e,Pt.style.zIndex="100",Pt.style.position="absolute",Pt.style.top=i,Pt.style.left=s,Pt.style.border="blue 5px solid",Pt.style.transform="scaleY(-1)",document.body.appendChild(Pt),xh=Pt.getContext("2d")),(Pt.width!==n.width||Pt.height!==n.height)&&(Pt.width=n.width/2,Pt.height=n.height/2,Pt.style.width="400px",Pt.style.height="400px");const c=n.device.readPixelsToArrayWebGL(n),f=xh?.createImageData(n.width,n.height);if(f){for(let p=0;p<c.length;p+=4)f.data[0+p+0]=c[p+0]*l,f.data[0+p+1]=c[p+1]*l,f.data[0+p+2]=c[p+2]*l,f.data[0+p+3]=r?255:c[p+3]*l;xh?.putImageData(f,0,0)}}function pd(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!pd(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!pd(n[s],e[s],t-1))return!1;return!0}return!1}function IP(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function PP(n){return Array.isArray(n)?n.length===0||typeof n[0]=="number":!1}function Hb(n){return IP(n)||PP(n)}function kP(n){return Hb(n)||typeof n=="number"||typeof n=="boolean"}function Xb(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];kP(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}class MP{constructor(e,t){w(this,"options",{disableWarnings:!1});w(this,"modules");w(this,"moduleUniforms");w(this,"moduleBindings");Object.assign(this.options,t);const r=Vd(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;oe.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&oe.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){for(const t of Object.keys(e)){const r=t,i=e[r]||{},s=this.modules[r];if(!s){this.options.disableWarnings||oe.warn(`Module ${t} not found`)();continue}const l=this.moduleUniforms[r],c=this.moduleBindings[r],f=s.getUniforms?.(i,l)||i,{uniforms:h,bindings:p}=Xb(f);this.moduleUniforms[r]={...l,...h},this.moduleBindings[r]={...c,...p}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[t,r]of Object.entries(this.moduleUniforms))for(const[i,s]of Object.entries(r))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(s)};return e}_addModule(e){const t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}let OP="";async function NP(n,e){const t=new Image;return t.crossOrigin="anonymous",t.src=n.startsWith("http")?n:OP+n,await t.decode(),e?await createImageBitmap(t,e):await createImageBitmap(t)}class Sh{constructor(e,t){w(this,"device");w(this,"id");w(this,"texture");w(this,"sampler");w(this,"view");w(this,"ready");w(this,"isReady",!1);w(this,"destroyed",!1);w(this,"resolveReady",()=>{});w(this,"rejectReady",()=>{});this.device=e,this.id=t.id||Oi("async-texture"),typeof t?.data=="string"&&t.dimension==="2d"&&(t={...t,data:NP(t.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(t)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const t=e.data;let r;try{r=await Yb(t)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function Yb(n){if(n=await n,Array.isArray(n))return await Promise.all(n.map(Yb));if(n&&typeof n=="object"&&n.constructor===Object){const e=n,t=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=t[s];return i}return n}const gi=2,DP=1e4,Pc=class Pc{constructor(e,t){w(this,"device");w(this,"id");w(this,"source");w(this,"vs");w(this,"fs");w(this,"pipelineFactory");w(this,"shaderFactory");w(this,"userData",{});w(this,"parameters");w(this,"topology");w(this,"bufferLayout");w(this,"isInstanced");w(this,"instanceCount",0);w(this,"vertexCount");w(this,"indexBuffer",null);w(this,"bufferAttributes",{});w(this,"constantAttributes",{});w(this,"bindings",{});w(this,"uniforms",{});w(this,"vertexArray");w(this,"transformFeedback",null);w(this,"pipeline");w(this,"shaderInputs");w(this,"_uniformStore");w(this,"_attributeInfos",{});w(this,"_gpuGeometry",null);w(this,"_getModuleUniforms");w(this,"props");w(this,"_pipelineNeedsUpdate","newly created");w(this,"_needsRedraw","initializing");w(this,"_destroyed",!1);w(this,"_lastDrawTimestamp",-1);w(this,"_lastLogTime",0);w(this,"_logOpen",!1);w(this,"_drawCount",0);var f;this.props={...Pc.defaultProps,...t},t=this.props,this.id=t.id||Oi("model"),this.device=e,Object.assign(this.userData,t.userData);const r=Object.fromEntries(this.props.modules?.map(h=>[h.name,h])||[]),i=t.shaderInputs||new MP(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=LP(e),l=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:h,getUniforms:p}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:l});this.source=h,this._getModuleUniforms=p,(f=this.props).shaderLayout||(f.shaderLayout=WA(this.source))}else{const{vs:h,fs:p,getUniforms:_}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:l});this.vs=h,this.fs=p,this._getModuleUniforms=_}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||hd.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||dd.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const t=this._areBindingsLoading();if(t)return oe.info(gi,`>>> DRAWING ABORTED ${this.id}: ${t} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),gd(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,l=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:l,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){this._gpuGeometry?.destroy();const t=e&&SP(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");const r=new ch(this.bufferLayout);this.bufferLayout=r.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const t=new ch(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){pd(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new dA(this.shaderInputs.modules);for(const[t,r]of Object.entries(this.shaderInputs.modules))if(FP(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[`${t}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){const r=t?.disableWarnings??this.props.disableWarnings;e.indices&&oe.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=gA(this.pipeline.shaderLayout,this.bufferLayout);const i=new ch(this.bufferLayout);for(const[s,l]of Object.entries(e)){const c=i.getBufferLayout(s);if(!c){r||oe.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const f=i.getAttributeNamesForBuffer(c);let h=!1;for(const p of f){const _=this._attributeInfos[p];if(_){const y=this.device.type==="webgpu"?i.getBufferIndex(_.bufferName):_.location;this.vertexArray.setBuffer(y,l),h=!0}}!h&&!r&&oe.warn(`Model(${this.id}): Ignoring buffer "${l.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):(t?.disableWarnings??this.props.disableWarnings)||oe.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){gd(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:t,uniforms:r}=Xb(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof Sh&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[t,r]of Object.entries(this.bindings))r instanceof Sh?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const t of Object.values(this.bindings))t instanceof Yl?e=Math.max(e,t.texture.updateTimestamp):t instanceof st||t instanceof ct?e=Math.max(e,t.updateTimestamp):t instanceof Sh?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof ql||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const t={...e.attributes};for(const[r]of Object.entries(t))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete t[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(oe.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=Hv(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=oe.level>3?0:DP;oe.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,oe.group(gi,`>>> DRAWING MODEL ${this.id}`,{collapsed:oe.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=RP(this.pipeline.shaderLayout,this.id);oe.table(gi,e)();const t=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))t[i]={value:s};oe.table(gi,t)();const r=this._getAttributeDebugTable();oe.table(gi,this._attributeInfos)(),oe.table(gi,r)(),oe.groupEnd(gi)(),this._logOpen=!1}}_logFramebuffer(e){const t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;const r=e.props.framebuffer;r&&CP(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,r=t.indexType==="uint32"?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){const r=Kv(t);return(e instanceof st?new r(e.debugData):e).toString()}};w(Pc,"defaultProps",{...Es.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Xl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Ci=Pc;function FP(n){return!!(n.uniformTypes&&!gd(n.uniformTypes))}function LP(n){return{type:n.type,shaderLanguage:n.info.shadingLanguage,shaderLanguageVersion:n.info.shadingLanguageVersion,gpu:n.info.gpu,features:n.features}}function gd(n){for(const e in n)return!1;return!0}const Vo=class Vo{constructor(e,t=Vo.defaultProps){w(this,"device");w(this,"model");w(this,"transformFeedback");if(!Vo.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Ci(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||_E(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){return e?.info?.type==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const t=this.getBuffer(e);if(!t)throw new Error("BufferTransform#getBuffer");if(t instanceof st)return t.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=t;return r.readAsync(i,s)}};w(Vo,"defaultProps",{...Ci.defaultProps,outputs:void 0,feedbackBuffers:void 0});let Xo=Vo;class wi{constructor(e){w(this,"id");w(this,"topology");w(this,"vertexCount");w(this,"indices");w(this,"attributes");w(this,"userData",{});const{attributes:t={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||Oi("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,l]of Object.entries(t)){const c=ArrayBuffer.isView(l)?{value:l}:l;if(!ArrayBuffer.isView(c.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!c.size&&(c.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=c}else this.attributes[s]=c}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:l,constant:c}=i;!c&&s&&l!==void 0&&l>=1&&(r=Math.min(r,s.length/l))}return r}}const BP={x:[2,0,1],y:[0,1,2],z:[1,2,0]};class UP extends wi{constructor(e={}){const{id:t=Oi("truncated-code-geometry")}=e,{indices:r,attributes:i}=VP(e);super({...e,id:t,topology:"triangle-list",indices:r,attributes:{POSITION:{size:3,value:i.POSITION},NORMAL:{size:3,value:i.NORMAL},TEXCOORD_0:{size:2,value:i.TEXCOORD_0},...e.attributes}})}}function VP(n={}){const{bottomRadius:e=0,topRadius:t=0,height:r=1,nradial:i=10,nvertical:s=10,verticalAxis:l="y",topCap:c=!1,bottomCap:f=!1}=n,h=(c?2:0)+(f?2:0),p=(i+1)*(s+1+h),_=Math.atan2(e-t,r),y=Math.sin,b=Math.cos,x=Math.PI,S=b(_),C=y(_),P=c?-2:0,z=s+(f?2:0),k=i+1,V=new Uint16Array(i*(s+h)*6),Z=BP[l],Y=new Float32Array(p*3),L=new Float32Array(p*3),E=new Float32Array(p*2);let R=0,N=0;for(let j=P;j<=z;j++){let K=j/s,G=r*K,fe;j<0?(G=0,K=1,fe=e):j>s?(G=r,K=1,fe=t):fe=e+(t-e)*(j/s),(j===-2||j===s+2)&&(fe=0,K=0),G-=r/2;for(let Ce=0;Ce<k;Ce++){const De=y(Ce*x*2/i),de=b(Ce*x*2/i);Y[R+Z[0]]=De*fe,Y[R+Z[1]]=G,Y[R+Z[2]]=de*fe,L[R+Z[0]]=j<0||j>s?0:De*S,L[R+Z[1]]=j<0?-1:j>s?1:C,L[R+Z[2]]=j<0||j>s?0:de*S,E[N+0]=Ce/i,E[N+1]=K,N+=2,R+=3}}for(let j=0;j<s+h;j++)for(let K=0;K<i;K++){const G=(j*i+K)*6;V[G+0]=k*(j+0)+0+K,V[G+1]=k*(j+0)+1+K,V[G+2]=k*(j+1)+1+K,V[G+3]=k*(j+0)+0+K,V[G+4]=k*(j+1)+1+K,V[G+5]=k*(j+1)+0+K}return{indices:V,attributes:{POSITION:Y,NORMAL:L,TEXCOORD_0:E}}}class zP extends UP{constructor(e={}){const{id:t=Oi("cylinder-geometry"),radius:r=1}=e;super({...e,id:t,bottomRadius:r,topRadius:r})}}class $P extends wi{constructor(e={}){const{id:t=Oi("sphere-geometry")}=e,{indices:r,attributes:i}=jP(e);super({...e,id:t,topology:"triangle-list",indices:r,attributes:{...i,...e.attributes}})}}function jP(n){const{nlat:e=10,nlong:t=10}=n,s=Math.PI-0,f=2*Math.PI-0,h=(e+1)*(t+1),p=(P,z,k,V,Z)=>n.radius||1,_=new Float32Array(h*3),y=new Float32Array(h*3),b=new Float32Array(h*2),x=h>65535?Uint32Array:Uint16Array,S=new x(e*t*6);for(let P=0;P<=e;P++)for(let z=0;z<=t;z++){const k=z/t,V=P/e,Z=z+P*(t+1),Y=Z*2,L=Z*3,E=f*k,R=s*V,N=Math.sin(E),j=Math.cos(E),K=Math.sin(R),G=Math.cos(R),fe=j*K,Ce=G,De=N*K,de=p();_[L+0]=de*fe,_[L+1]=de*Ce,_[L+2]=de*De,y[L+0]=fe,y[L+1]=Ce,y[L+2]=De,b[Y+0]=k,b[Y+1]=1-V}const C=t+1;for(let P=0;P<t;P++)for(let z=0;z<e;z++){const k=(P*e+z)*6;S[k+0]=z*C+P,S[k+1]=z*C+P+1,S[k+2]=(z+1)*C+P,S[k+3]=(z+1)*C+P,S[k+4]=z*C+P+1,S[k+5]=(z+1)*C+P+1}return{indices:{size:1,value:S},attributes:{POSITION:{size:3,value:_},NORMAL:{size:3,value:y},TEXCOORD_0:{size:2,value:b}}}}const WP={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class Kb extends rp{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,pickingFBO:l,deviceRect:{x:c,y:f,width:h,height:p},cullRect:_,effects:y,pass:b="picking",pickZ:x,shaderModuleProps:S}){this.pickZ=x;const C=this._resetColorEncoder(x),P=[c,f,h,p],z=super.render({target:l,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,cullRect:_,effects:y?.filter(V=>V.useInPicking),pass:b,isPicking:!0,shaderModuleProps:S,clearColor:[0,0,0,0],colorMask:15,scissorRect:P});return this._colorEncoderState=null,{decodePickingColor:C&&XP.bind(null,C),stats:z}}shouldDrawLayer(e){const{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){const i={...e.props.parameters},{pickable:s,operation:l}=e.props;return!this._colorEncoderState||l.includes("terrain")?i.blend=!1:s&&l.includes("draw")&&(Object.assign(i,WP),i.blend=!0,i.blendColor=HP(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function HP(n,e,t){const{byLayer:r,byAlpha:i}=n;let s,l=r.get(e);return l?(l.viewports.push(t),s=l.a):(s=r.size+1,s<=255?(l={a:s,layer:e,viewports:[t]},r.set(e,l),i[s]=l):(Je.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function XP(n,e){const t=n.byAlpha[e[3]];return t&&{pickedLayer:t.layer,pickedViewports:t.viewports,pickedObjectIndex:t.layer.decodePickingColor(e)}}const ps={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},uc=Symbol.for("component"),Ti=Symbol.for("propTypes"),Eh=Symbol.for("deprecatedProps"),xs=Symbol.for("asyncPropDefaults"),Ii=Symbol.for("asyncPropOriginal"),Zr=Symbol.for("asyncPropResolved");function qb(n,e=()=>!0){return Array.isArray(n)?Zb(n,e,[]):e(n)?[n]:[]}function Zb(n,e,t){let r=-1;for(;++r<n.length;){const i=n[r];Array.isArray(i)?Zb(i,e,t):e(i)&&t.push(i)}return t}function YP({target:n,source:e,start:t=0,count:r=1}){const i=e.length,s=r*i;let l=0;for(let c=t;l<i;l++)n[c++]=e[l];for(;l<s;)l<s-l?(n.copyWithin(t+l,t,t+l),l*=2):(n.copyWithin(t+l,t,t+s-l),l=s);return n}class KP{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Bh(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class qP{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(t,r):(s=new KP(e,t,this._context),this._resources[e]=s),s.persistent=i}remove(e){const t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const t=this._consumers[e];if(t){for(const r in t){const i=t[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:l}=this;e.startsWith(l)&&(e=e.replace(l,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const c=s[e];if(this._track(r,i,c,t),c)return c.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,t,r,i){const s=this._consumers,l=s[e]=s[e]||{};let c=l[t];const f=c&&c.resourceId&&this._resources[c.resourceId];f&&(f.unsubscribe(c),this.prune()),r&&(c?(c.onChange=i,c.resourceId=r.id):c={onChange:i,resourceId:r.id},l[t]=c,r.subscribe(c))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const t=this._resources[e];!t.persistent&&!t.inUse()&&(t.delete(),delete this._resources[e])}}}const ZP="layerManager.setLayers",QP="layerManager.activateViewport";class JP{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=c=>{qt(QP,this,c),c&&(this.context.viewport=c)};const{deck:r,stats:i,viewport:s,timeline:l}=t||{};this.layers=[],this.resourceManager=new qP({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:r,shaderAssembler:XI(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[nC],renderPass:void 0,stats:i||new Oc({id:"deck.gl"}),viewport:s||new Go({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:l||new Wb,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(r=>t.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){qt(ZP,this,t,e),this._lastRenderedLayers=e;const r=qb(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:t}=this.context;t.find(r=>r.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:t}=this.context,r=t.findIndex(i=>i.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){const r={};for(const l of e)r[l.id]?Je.warn(`Multiple old layers with same id ${l.id}`)():r[l.id]=l;if(this._defaultShaderModulesChanged){for(const l of e)l.setNeedsUpdate(),l.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let s=!1;for(const l of i)if(l.hasUniformTransition()){s=`Uniform transition in ${l}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,r){for(const i of e){i.context=this.context;const s=t[i.id];s===null&&Je.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let l=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),l=i.isComposite?i.getSubLayers():null}catch(c){this._handleError("matching",c,i)}l&&this._updateSublayersRecursively(l,t,r)}}_finalizeOldLayers(e){for(const t in e){const r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ps.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=ps.MATCHED,t!==e&&(e.lifecycle=ps.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ps.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ps.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}function $n(n,e,t){if(n===e)return!0;if(!t||!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let r=0;r<n.length;r++)if(!$n(n[r],e[r],t-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!$n(n[s],e[s],t-1))return!1;return!0}return!1}class GP{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){const t=typeof e=="string"?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const l=r[s];if(l.containsPixel(i)){const c=e.slice();return c[0]-=l.x,c[1]-=l.y,l.unproject(c,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=qb(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!$n(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):Je.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){const r=t.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>this.getView(e.id)?.makeViewport({viewState:s,width:this.width,height:this.height})})}_updateController(e,t,r,i){const s=e.controller;if(s&&r){const l={...t,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,l)),i&&i.setProps(l),i}return null}_rebuildViewports(){const{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],l=this.getViewState(s),c=s.makeViewport({viewState:l,width:this.width,height:this.height});let f=t[s.id];const h=!!s.controller;h&&!f&&(r=!0),(r||!h)&&f&&(f.finalize(),f=null),this.controllers[s.id]=this._updateController(s,l,c,f),c&&this._viewports.unshift(c)}for(const i in t){const s=t[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length?!0:e.some((r,i)=>!e[i].equals(t[i]))}}const ek=/([0-9]+\.?[0-9]*)(%|px)/;function zr(n){switch(typeof n){case"number":return{position:n,relative:!1};case"string":const e=ek.exec(n);if(e&&e.length>=3){const t=e[2]==="%",r=parseFloat(e[1]);return{position:t?r/100:r,relative:t}}default:throw new Error(`Could not parse position string ${n}`)}}function $r(n,e){return n.relative?Math.round(n.position*e):n.position}class Ms{constructor(e){const{id:t,x:r=0,y:i=0,width:s="100%",height:l="100%",padding:c=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=zr(r),this._y=zr(i),this._width=zr(s),this._height=zr(l),this._padding=c&&{left:zr(c.left||0),right:zr(c.right||0),top:zr(c.top||0),bottom:zr(c.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&$n(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:t});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const t={...e};for(const r in this.props.viewState)r!=="id"&&(t[r]=this.props.viewState[r]);return t}return e}getDimensions({width:e,height:t}){const r={x:$r(this._x,e),y:$r(this._y,t),width:$r(this._width,e),height:$r(this._height,t)};return this._padding&&(r.padding={left:$r(this._padding.left,e),top:$r(this._padding.top,t),right:$r(this._padding.right,e),bottom:$r(this._padding.bottom,t)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Lc{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Uy=()=>{},_d={BREAK:1,SNAP_TO_END:2,IGNORE:3},tk=n=>n,nk=_d.BREAK;class rk{constructor(e){this._onTransitionUpdate=t=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:l,duration:c,easing:f}}=t,h=f(r/c),p=i.interpolateProps(s,l,h);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Lc(e.timeline),this.onViewStateChange=e.onViewStateChange||Uy,this.onStateChange=e.onStateChange||Uy}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:l}=this.transition.settings;i={...r,...s===_d.SNAP_TO_END?l:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||t==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===_d.IGNORE||this._isUpdateDueToCurrentTransition(t):this._isTransitionEnabled(t)?t.transitionInterpolator.arePropsEqual(e,t):!0}_triggerTransition(e,t){const r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),s=t.transitionInterpolator,l=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(l===0)return;const c=s.initializeProps(e,i);this.propsInTransition={};const f={duration:l,easing:t.transitionEasing||tk,interpolator:s,interruption:t.transitionInterruption||nk,startProps:c.start,endProps:c.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(f),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function jt(n,e){if(!n)throw new Error(e||"deck.gl: assertion failed.")}class ik{constructor(e){const{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(const r of this._propsToCompare)if(!(r in e)||!(r in t)||!jo(e[r],t[r]))return!1;return!0}initializeProps(e,t){const r={},i={};for(const s of this._propsToExtract)(s in e||s in t)&&(r[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{const r=e[t];jt(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}const sk=["longitude","latitude","zoom","bearing","pitch"],ok=["longitude","latitude","zoom"];class Qb extends ik{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:sk,required:ok},super(r.transitionProps),this.opts=r}initializeProps(e,t){const r=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){const l=i(e),c=i(t),f=l.unproject(s);r.start.around=s,Object.assign(r.end,{around:c.project(f),aroundPosition:f,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){const i={};for(const s of this._propsToExtract)i[s]=ic(e[s]||0,t[s]||0,r);if(t.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,ic(e.around,t.around,r)))}return i}}const jr={transitionDuration:0},ak=300,wl=n=>1-(1-n)*(1-n),ds={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},_i={};class lk{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new rk({...e,getControllerState:t=>new this.ControllerState(t),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(const e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const t=this._eventStartBlocked;switch(e.type){case"panstart":return t?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return t?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return t?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){const{width:r,height:i}=this.props;if(t&&t.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:t}=e;this.inertia=Number.isFinite(t)?t:t===!0?ak:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:l=!0,touchZoom:c=!0,touchRotate:f=!1,keyboard:h=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(ds.WHEEL,p&&r),this.toggleEvents(ds.PAN,p),this.toggleEvents(ds.PINCH,p&&(c||f)),this.toggleEvents(ds.MULTI_PAN,p&&f),this.toggleEvents(ds.DOUBLE_CLICK,p&&l),this.toggleEvents(ds.KEYBOARD,p&&h),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=l,this.touchZoom=c,this.touchRotate=f,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(r=>{this._events[r]!==t&&(this._events[r]=t,t?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,t=null,r={}){const i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const l=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:l,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,jr,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,jr,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:t}=this;if(this.dragPan&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:wl},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,jr,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:wl},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let l=2/(1+Math.exp(-Math.abs(s*r)));s<0&&l!==0&&(l=1/l);const c=this.controllerState.zoom({pos:t,scale:l});return this.updateViewport(c,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,jr,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const t=this.getCenter(e);t[0]-=e.deltaX;const r=this.controllerState.rotate({pos:t});return this.updateViewport(r,jr,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:wl},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return _i._startPinchRotation=e.rotation,_i._lastPinchEvent=e,this.updateViewport(r,jr,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;t=t.rotate({deltaAngleX:_i._startPinchRotation-r})}return this.updateViewport(t,jr,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),_i._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:t}=this,{_lastPinchEvent:r}=_i;if(this.touchZoom&&t&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const l=Math.log2(e.scale),c=(l-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),f=Math.pow(2,l+c*t/2);s=s.zoom({pos:i,scale:f}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:wl},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return _i._startPinchRotation=null,_i._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const t=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:l}=this.keyboard===!0?{}:this.keyboard,{controllerState:c}=this;let f;const h={};switch(e.srcEvent.code){case"Minus":f=t?c.zoomOut(r).zoomOut(r):c.zoomOut(r),h.isZooming=!0;break;case"Equal":f=t?c.zoomIn(r).zoomIn(r):c.zoomIn(r),h.isZooming=!0;break;case"ArrowLeft":t?(f=c.rotateLeft(s),h.isRotating=!0):(f=c.moveLeft(i),h.isPanning=!0);break;case"ArrowRight":t?(f=c.rotateRight(s),h.isRotating=!0):(f=c.moveRight(i),h.isPanning=!0);break;case"ArrowUp":t?(f=c.rotateUp(l),h.isRotating=!0):(f=c.moveUp(i),h.isPanning=!0);break;case"ArrowDown":t?(f=c.rotateDown(l),h.isRotating=!0):(f=c.moveDown(i),h.isPanning=!0);break;default:return!1}return this.updateViewport(f,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:t}=this;return!t||!t.transitionInterpolator?jr:e?{...t,transitionInterpolator:new Qb({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t}}class ck{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Vy=5,uk=1.2;class fk extends ck{constructor(e){const{width:t,height:r,latitude:i,longitude:s,zoom:l,bearing:c=0,pitch:f=0,altitude:h=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:y=0,maxPitch:b=60,minPitch:x=0,startPanLngLat:S,startZoomLngLat:C,startRotatePos:P,startBearing:z,startPitch:k,startZoom:V,normalize:Z=!0}=e;jt(Number.isFinite(s)),jt(Number.isFinite(i)),jt(Number.isFinite(l)),super({width:t,height:r,latitude:i,longitude:s,zoom:l,bearing:c,pitch:f,altitude:h,maxZoom:_,minZoom:y,maxPitch:b,minPitch:x,normalize:Z,position:p},{startPanLngLat:S,startZoomLngLat:C,startRotatePos:P,startBearing:z,startPitch:k,startZoom:V}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){const r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:l}=this.getState();if(!i||s===void 0||l===void 0)return this;let c;return e?c=this._getNewRotation(e,i,l,s):c={bearing:s+t,pitch:l+r},this._getUpdatedState(c)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;const{maxZoom:l,minZoom:c}=this.getViewportProps();let f=i+Math.log2(r);f=qr(f,c,l);const h=this.makeViewport({...this.getViewportProps(),zoom:f});return this._getUpdatedState({zoom:f,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=qr(i,r,t);const{maxPitch:s,minPitch:l,pitch:c}=e;e.pitch=qr(c,l,s);const{normalize:f=!0}=e;return f&&Object.assign(e,PI(e)),e}_zoomFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){const{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){const s=e[0]-t[0],l=e[1]-t[1],c=e[1],f=t[1],{width:h,height:p}=this.getViewportProps(),_=s/h;let y=0;l>0?Math.abs(p-f)>Vy&&(y=l/(f-p)*uk):l<0&&f>Vy&&(y=1-c/f),y=qr(y,-1,1);const{minPitch:b,maxPitch:x}=this.getViewportProps(),S=i+180*_;let C=r;return y>0?C=r+y*(x-r):y<0&&(C=r-y*(b-r)),{pitch:C,bearing:S}}}class hk extends lk{constructor(){super(...arguments),this.ControllerState=fk,this.transition={transitionDuration:300,transitionInterpolator:new Qb({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const t=this.props;super.setProps(e),(!t||t.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}let Jb=class extends Ms{constructor(e={}){super(e)}getViewportType(){return ks}get ControllerType(){return hk}};Jb.displayName="MapView";const dk=new $b;function pk(n,e){const t=n.order??1/0,r=e.order??1/0;return t-r}class gk{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const t=this._defaultEffects;if(!t.find(r=>r.id===e.id)){const r=t.findIndex(i=>pk(i,e)>0);r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&($n(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){const t={};for(const i of this.effects)t[i.id]=i;const r=[];for(const i of e){const s=t[i.id];let l=i;s&&s!==i?s.setProps?(s.setProps(i.props),l=s):s.cleanup(this._context):s||i.setup(this._context),r.push(l),delete t[i.id]}for(const i in t)t[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof $b)||this._resolvedEffects.push(dk),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class _k extends rp{shouldDrawLayer(e){const{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}const mk="deckRenderer.renderLayers";class yk{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new _k(e),this.pickLayersPass=new Kb(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=t.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,qt(mk,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){const{renderBuffers:e}=this;for(const t of e)t.delete();e.length=0}_preRender(e,t){this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{};for(const r of e)t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(t)}_postRender(e,t){const{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;const l=s.postRender(i);i.inputBuffer=l,i.swapBuffer=l===r[0]?r[1]:r[0]}}}const vk={pickedColor:null,pickedObjectIndex:-1};function bk({pickedColors:n,decodePickingColor:e,deviceX:t,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:l,y:c,width:f,height:h}=s;let p=i*i,_=-1,y=0;for(let b=0;b<h;b++){const x=b+c-r,S=x*x;if(S>p)y+=4*f;else for(let C=0;C<f;C++){if(n[y+3]-1>=0){const z=C+l-t,k=z*z+S;k<=p&&(p=k,_=y)}y+=4}}if(_>=0){const b=n.slice(_,_+4),x=e(b);if(x){const S=Math.floor(_/4/f),C=_/4-S*f;return{...x,pickedColor:b,pickedX:l+C,pickedY:c+S}}Je.error("Picked non-existent layer. Is picking buffer corrupt?")()}return vk}function wk({pickedColors:n,decodePickingColor:e}){const t=new Map;if(n){for(let r=0;r<n.length;r+=4)if(n[r+3]-1>=0){const s=n.slice(r,r+4),l=s.join(",");if(!t.has(l)){const c=e(s);c?t.set(l,{...c,color:s}):Je.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(t.values())}function Gb({pickInfo:n,viewports:e,pixelRatio:t,x:r,y:i,z:s}){let l=e[0];e.length>1&&(l=xk(n?.pickedViewports||e,{x:r,y:i}));let c;if(l){const f=[r-l.x,i-l.y];s!==void 0&&(f[2]=s),c=l.unproject(f)}return{color:null,layer:null,viewport:l,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:c,devicePixel:n&&"pickedX"in n?[n.pickedX,n.pickedY]:void 0,pixelRatio:t}}function Tk(n){const{pickInfo:e,lastPickedInfo:t,mode:r,layers:i}=n,{pickedColor:s,pickedLayer:l,pickedObjectIndex:c}=e,f=l?[l]:[];if(r==="hover"){const _=t.index,y=t.layerId,b=l?l.props.id:null;if(b!==y||c!==_){if(b!==y){const x=i.find(S=>S.props.id===y);x&&f.unshift(x)}t.layerId=b,t.index=c,t.info=null}}const h=Gb(n),p=new Map;return p.set(null,h),f.forEach(_=>{let y={...h};_===l&&(y.color=s,y.index=c,y.picked=!0),y=e3({layer:_,info:y,mode:r});const b=y.layer;_===l&&r==="hover"&&(t.info=y),p.set(b.id,y),r==="hover"&&b.updateAutoHighlight(y)}),p}function e3({layer:n,info:e,mode:t}){for(;n&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=n,e=n.getPickingInfo({info:e,mode:t,sourceLayer:r}),n=n.parent}return e}function xk(n,e){for(let t=n.length-1;t>=0;t--){const r=n[t];if(r.containsPixel(e))return r}return n[0]}class Sk{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new Kb(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},s=this.lastPickedInfo.info){const l=s&&s.layer&&s.layer.id,c=s&&s.viewport&&s.viewport.id,f=l?r.find(y=>y.id===l):null,h=c&&i.find(y=>y.id===c)||i[0],p=h&&h.unproject([e-h.x,t-h.y]);return{...s,...{x:e,y:t,viewport:h,coordinate:p,layer:f}}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const t=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=t}const{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const t=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:s,radius:l=0,depth:c=1,mode:f="query",unproject3D:h,onViewportActive:p,effects:_}){const y=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||r.length===0)return{result:[],emptyInfo:Gb({viewports:r,x:i,y:s,pixelRatio:y})};this._resizeBuffer();const x=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=[x.x+Math.floor(x.width/2),x.y+Math.floor(x.height/2)],C=Math.round(l*y),{width:P,height:z}=this.pickingFBO,k=this._getPickingRect({deviceX:S[0],deviceY:S[1],deviceRadius:C,deviceWidth:P,deviceHeight:z}),V={x:i-l,y:s-l,width:l*2+1,height:l*2+1};let Z;const Y=[],L=new Set;for(let E=0;E<c;E++){let R;if(k){const j=this._drawAndSample({layers:b,views:t,viewports:r,onViewportActive:p,deviceRect:k,cullRect:V,effects:_,pass:`picking:${f}`});R=bk({...j,deviceX:S[0],deviceY:S[1],deviceRadius:C,deviceRect:k})}else R={pickedColor:null,pickedObjectIndex:-1};let N;if(R.pickedLayer&&h&&this.depthFBO){const{pickedColors:j}=this._drawAndSample({layers:[R.pickedLayer],views:t,viewports:r,onViewportActive:p,deviceRect:{x:R.pickedX,y:R.pickedY,width:1,height:1},cullRect:V,effects:_,pass:`picking:${f}:z`},!0);j[3]&&(N=j[0])}R.pickedLayer&&E+1<c&&(L.add(R.pickedLayer),R.pickedLayer.disablePickingIndex(R.pickedObjectIndex)),Z=Tk({pickInfo:R,lastPickedInfo:this.lastPickedInfo,mode:f,layers:b,viewports:r,x:i,y:s,z:N,pixelRatio:y});for(const j of Z.values())j.layer&&Y.push(j);if(!R.pickedColor)break}for(const E of L)E.restorePickingColors();return{result:Y,emptyInfo:Z.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:s,width:l=1,height:c=1,mode:f="query",maxObjects:h=null,onViewportActive:p,effects:_}){const y=this._getPickable(e);if(!y||r.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),x=this.device.canvasContext.cssToDevicePixels([i,s],!0),S=x.x,C=x.y+x.height,P=this.device.canvasContext.cssToDevicePixels([i+l,s+c],!0),z=P.x+P.width,k=P.y,V={x:S,y:k,width:z-S,height:C-k},Z=this._drawAndSample({layers:y,views:t,viewports:r,onViewportActive:p,deviceRect:V,cullRect:{x:i,y:s,width:l,height:c},effects:_,pass:`picking:${f}`}),Y=wk(Z),L=new Map,E=[],R=Number.isFinite(h);for(let N=0;N<Y.length&&!(R&&E.length>=h);N++){const j=Y[N];let K={color:j.pickedColor,layer:null,index:j.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:b};K=e3({layer:j.pickedLayer,info:K,mode:f});const G=K.layer.id;L.has(G)||L.set(G,new Set);const fe=L.get(G),Ce=K.object??K.index;fe.has(Ce)||(fe.add(Ce),E.push(K))}return E}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:s,cullRect:l,effects:c,pass:f},h=!1){const p=h?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:p,deviceRect:s,cullRect:l,effects:c,pass:f,pickZ:h,preRenderStats:{},isPicking:!0};for(const z of c)z.useInPicking&&(_.preRenderStats[z.id]=z.preRender(_));const{decodePickingColor:y}=this.pickLayersPass.render(_),{x:b,y:x,width:S,height:C}=s,P=new(h?Float32Array:Uint8Array)(S*C*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:b,sourceY:x,sourceWidth:S,sourceHeight:C,target:P}),{pickedColors:P,decodePickingColor:y}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const l=Math.max(0,e-r),c=Math.max(0,t-r),f=Math.min(i,e+r+1)-l,h=Math.min(s,t+r+1)-c;return f<=0||h<=0?null:{x:l,y:c,width:f,height:h}}}const Ek={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},Ak="top-left",zy="__root";class Rk{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!$n(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const t={};for(const r of this.resolvedWidgets)t[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)t[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=t[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(const r in t){const i=t[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:t=null,placement:r=Ak}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,r).append(i),e._element=i}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){const r=e||zy;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[r]=i);let s=i.querySelector(`.${t}`);return s||(s=document.createElement("div"),s.className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,Ek[t]),i.append(s)),s}_updateContainers(){const e=this.deck.width,t=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===zy||i,l=this.containers[r];s?(l.style.display="block",l.style.left=`${i?i.x:0}px`,l.style.top=`${i?i.y:0}px`,l.style.width=`${i?i.width:e}px`,l.style.height=`${i?i.height:t}px`):l.style.display="none"}}onRedraw({viewports:e,layers:t}){const r=e.reduce((i,s)=>(i[s.id]=s,i),{});for(const i of this.getWidgets()){const{viewId:s}=i;if(s){const l=r[s];l&&(i.onViewportChange&&i.onViewportChange(l),i.onRedraw?.({viewports:[l],layers:t}))}else{if(i.onViewportChange)for(const l of e)i.onViewportChange(l);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(const r of this.getWidgets()){const{viewId:i}=r;(!i||i===e.viewport?.id)&&r.onHover?.(e,t)}}onEvent(e,t){const r=ld[t.type];if(r)for(const i of this.getWidgets()){const{viewId:s}=i;(!s||s===e.viewport?.id)&&i[r]?.(e,t)}}}const Ck={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class Ik{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,Ck),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var _s;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",n[n.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.CULL_FACE=2884]="CULL_FACE",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.BLEND=3042]="BLEND",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.DITHER=3024]="DITHER",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DOUBLE=5130]="DOUBLE",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",n[n.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",n[n.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.READ_BUFFER=3074]="READ_BUFFER",n[n.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",n[n.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",n[n.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",n[n.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",n[n.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",n[n.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",n[n.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",n[n.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",n[n.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",n[n.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",n[n.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",n[n.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",n[n.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",n[n.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",n[n.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",n[n.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",n[n.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",n[n.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",n[n.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",n[n.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",n[n.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",n[n.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",n[n.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",n[n.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",n[n.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",n[n.RED=6403]="RED",n[n.RGB8=32849]="RGB8",n[n.RGBA8=32856]="RGBA8",n[n.RGB10_A2=32857]="RGB10_A2",n[n.TEXTURE_3D=32879]="TEXTURE_3D",n[n.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",n[n.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",n[n.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",n[n.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",n[n.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",n[n.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",n[n.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",n[n.SRGB=35904]="SRGB",n[n.SRGB8=35905]="SRGB8",n[n.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",n[n.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",n[n.RGBA32F=34836]="RGBA32F",n[n.RGB32F=34837]="RGB32F",n[n.RGBA16F=34842]="RGBA16F",n[n.RGB16F=34843]="RGB16F",n[n.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",n[n.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",n[n.R11F_G11F_B10F=35898]="R11F_G11F_B10F",n[n.RGB9_E5=35901]="RGB9_E5",n[n.RGBA32UI=36208]="RGBA32UI",n[n.RGB32UI=36209]="RGB32UI",n[n.RGBA16UI=36214]="RGBA16UI",n[n.RGB16UI=36215]="RGB16UI",n[n.RGBA8UI=36220]="RGBA8UI",n[n.RGB8UI=36221]="RGB8UI",n[n.RGBA32I=36226]="RGBA32I",n[n.RGB32I=36227]="RGB32I",n[n.RGBA16I=36232]="RGBA16I",n[n.RGB16I=36233]="RGB16I",n[n.RGBA8I=36238]="RGBA8I",n[n.RGB8I=36239]="RGB8I",n[n.RED_INTEGER=36244]="RED_INTEGER",n[n.RGB_INTEGER=36248]="RGB_INTEGER",n[n.RGBA_INTEGER=36249]="RGBA_INTEGER",n[n.R8=33321]="R8",n[n.RG8=33323]="RG8",n[n.R16F=33325]="R16F",n[n.R32F=33326]="R32F",n[n.RG16F=33327]="RG16F",n[n.RG32F=33328]="RG32F",n[n.R8I=33329]="R8I",n[n.R8UI=33330]="R8UI",n[n.R16I=33331]="R16I",n[n.R16UI=33332]="R16UI",n[n.R32I=33333]="R32I",n[n.R32UI=33334]="R32UI",n[n.RG8I=33335]="RG8I",n[n.RG8UI=33336]="RG8UI",n[n.RG16I=33337]="RG16I",n[n.RG16UI=33338]="RG16UI",n[n.RG32I=33339]="RG32I",n[n.RG32UI=33340]="RG32UI",n[n.R8_SNORM=36756]="R8_SNORM",n[n.RG8_SNORM=36757]="RG8_SNORM",n[n.RGB8_SNORM=36758]="RGB8_SNORM",n[n.RGBA8_SNORM=36759]="RGBA8_SNORM",n[n.RGB10_A2UI=36975]="RGB10_A2UI",n[n.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",n[n.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",n[n.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",n[n.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",n[n.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",n[n.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",n[n.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",n[n.HALF_FLOAT=5131]="HALF_FLOAT",n[n.RG=33319]="RG",n[n.RG_INTEGER=33320]="RG_INTEGER",n[n.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",n[n.CURRENT_QUERY=34917]="CURRENT_QUERY",n[n.QUERY_RESULT=34918]="QUERY_RESULT",n[n.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",n[n.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",n[n.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",n[n.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",n[n.DRAW_BUFFER0=34853]="DRAW_BUFFER0",n[n.DRAW_BUFFER1=34854]="DRAW_BUFFER1",n[n.DRAW_BUFFER2=34855]="DRAW_BUFFER2",n[n.DRAW_BUFFER3=34856]="DRAW_BUFFER3",n[n.DRAW_BUFFER4=34857]="DRAW_BUFFER4",n[n.DRAW_BUFFER5=34858]="DRAW_BUFFER5",n[n.DRAW_BUFFER6=34859]="DRAW_BUFFER6",n[n.DRAW_BUFFER7=34860]="DRAW_BUFFER7",n[n.DRAW_BUFFER8=34861]="DRAW_BUFFER8",n[n.DRAW_BUFFER9=34862]="DRAW_BUFFER9",n[n.DRAW_BUFFER10=34863]="DRAW_BUFFER10",n[n.DRAW_BUFFER11=34864]="DRAW_BUFFER11",n[n.DRAW_BUFFER12=34865]="DRAW_BUFFER12",n[n.DRAW_BUFFER13=34866]="DRAW_BUFFER13",n[n.DRAW_BUFFER14=34867]="DRAW_BUFFER14",n[n.DRAW_BUFFER15=34868]="DRAW_BUFFER15",n[n.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",n[n.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",n[n.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",n[n.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",n[n.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",n[n.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",n[n.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",n[n.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",n[n.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",n[n.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",n[n.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",n[n.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",n[n.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",n[n.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",n[n.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",n[n.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",n[n.SAMPLER_3D=35679]="SAMPLER_3D",n[n.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",n[n.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",n[n.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",n[n.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",n[n.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",n[n.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",n[n.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",n[n.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",n[n.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",n[n.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",n[n.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",n[n.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",n[n.MAX_SAMPLES=36183]="MAX_SAMPLES",n[n.SAMPLER_BINDING=35097]="SAMPLER_BINDING",n[n.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",n[n.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",n[n.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",n[n.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",n[n.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",n[n.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",n[n.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",n[n.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",n[n.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",n[n.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",n[n.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",n[n.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",n[n.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",n[n.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",n[n.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",n[n.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",n[n.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",n[n.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",n[n.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",n[n.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",n[n.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",n[n.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",n[n.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",n[n.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",n[n.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",n[n.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",n[n.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",n[n.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",n[n.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",n[n.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",n[n.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",n[n.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",n[n.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",n[n.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",n[n.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",n[n.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",n[n.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",n[n.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",n[n.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",n[n.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",n[n.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",n[n.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",n[n.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",n[n.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",n[n.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",n[n.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",n[n.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",n[n.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",n[n.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",n[n.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",n[n.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",n[n.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",n[n.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",n[n.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",n[n.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",n[n.UNIFORM_TYPE=35383]="UNIFORM_TYPE",n[n.UNIFORM_SIZE=35384]="UNIFORM_SIZE",n[n.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",n[n.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",n[n.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",n[n.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",n[n.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",n[n.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",n[n.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",n[n.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",n[n.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",n[n.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",n[n.OBJECT_TYPE=37138]="OBJECT_TYPE",n[n.SYNC_CONDITION=37139]="SYNC_CONDITION",n[n.SYNC_STATUS=37140]="SYNC_STATUS",n[n.SYNC_FLAGS=37141]="SYNC_FLAGS",n[n.SYNC_FENCE=37142]="SYNC_FENCE",n[n.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",n[n.UNSIGNALED=37144]="UNSIGNALED",n[n.SIGNALED=37145]="SIGNALED",n[n.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",n[n.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",n[n.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",n[n.WAIT_FAILED=37149]="WAIT_FAILED",n[n.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",n[n.COLOR=6144]="COLOR",n[n.DEPTH=6145]="DEPTH",n[n.STENCIL=6146]="STENCIL",n[n.MIN=32775]="MIN",n[n.MAX=32776]="MAX",n[n.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",n[n.STREAM_READ=35041]="STREAM_READ",n[n.STREAM_COPY=35042]="STREAM_COPY",n[n.STATIC_READ=35045]="STATIC_READ",n[n.STATIC_COPY=35046]="STATIC_COPY",n[n.DYNAMIC_READ=35049]="DYNAMIC_READ",n[n.DYNAMIC_COPY=35050]="DYNAMIC_COPY",n[n.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",n[n.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",n[n.INVALID_INDEX=4294967295]="INVALID_INDEX",n[n.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",n[n.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",n[n.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",n[n.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",n[n.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",n[n.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",n[n.R16_EXT=33322]="R16_EXT",n[n.RG16_EXT=33324]="RG16_EXT",n[n.RGB16_EXT=32852]="RGB16_EXT",n[n.RGBA16_EXT=32859]="RGBA16_EXT",n[n.R16_SNORM_EXT=36760]="R16_SNORM_EXT",n[n.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",n[n.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",n[n.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",n[n.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",n[n.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",n[n.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",n[n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",n[n.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",n[n.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",n[n.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",n[n.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",n[n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",n[n.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",n[n.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",n[n.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",n[n.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",n[n.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",n[n.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",n[n.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",n[n.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",n[n.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",n[n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",n[n.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",n[n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",n[n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",n[n.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",n[n.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",n[n.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",n[n.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",n[n.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",n[n.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",n[n.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",n[n.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",n[n.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",n[n.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",n[n.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",n[n.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",n[n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",n[n.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",n[n.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",n[n.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",n[n.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",n[n.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",n[n.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",n[n.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",n[n.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",n[n.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",n[n.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",n[n.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",n[n.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",n[n.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",n[n.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",n[n.LINE_WEBGL=6913]="LINE_WEBGL",n[n.FILL_WEBGL=6914]="FILL_WEBGL",n[n.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",n[n.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",n[n.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",n[n.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",n[n.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",n[n.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",n[n.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",n[n.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",n[n.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",n[n.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",n[n.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",n[n.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",n[n.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",n[n.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",n[n.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",n[n.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",n[n.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",n[n.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",n[n.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",n[n.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",n[n.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",n[n.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",n[n.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",n[n.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(_s||(_s={}));const ip={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},yt=(n,e,t)=>e?n.enable(t):n.disable(t),$y=(n,e,t)=>n.hint(t,e),dn=(n,e,t)=>n.pixelStorei(t,e),jy=(n,e,t)=>{const r=t===36006?36009:36008;return n.bindFramebuffer(r,e)},Eo=(n,e,t)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[t];n.bindBuffer(i,e)};function Ah(n){return Array.isArray(n)||ArrayBuffer.isView(n)&&!(n instanceof DataView)}const Pk={3042:yt,32773:(n,e)=>n.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(n,e)=>n.clearColor(...e),3107:(n,e)=>n.colorMask(...e),2884:yt,2885:(n,e)=>n.cullFace(e),2929:yt,2931:(n,e)=>n.clearDepth(e),2932:(n,e)=>n.depthFunc(e),2928:(n,e)=>n.depthRange(...e),2930:(n,e)=>n.depthMask(e),3024:yt,35723:$y,35725:(n,e)=>n.useProgram(e),36007:(n,e)=>n.bindRenderbuffer(36161,e),36389:(n,e)=>n.bindTransformFeedback?.(36386,e),34229:(n,e)=>n.bindVertexArray(e),36006:jy,36010:jy,34964:Eo,36662:Eo,36663:Eo,35053:Eo,35055:Eo,2886:(n,e)=>n.frontFace(e),33170:$y,2849:(n,e)=>n.lineWidth(e),32823:yt,32824:"polygonOffset",10752:"polygonOffset",35977:yt,32926:yt,32928:yt,32938:"sampleCoverage",32939:"sampleCoverage",3089:yt,3088:(n,e)=>n.scissor(...e),2960:yt,2961:(n,e)=>n.clearStencil(e),2968:(n,e)=>n.stencilMaskSeparate(1028,e),36005:(n,e)=>n.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(n,e)=>n.viewport(...e),34383:yt,10754:yt,12288:yt,12289:yt,12290:yt,12291:yt,12292:yt,12293:yt,12294:yt,12295:yt,3333:dn,3317:dn,37440:dn,37441:dn,37443:dn,3330:dn,3332:dn,3331:dn,3314:dn,32878:dn,3316:dn,3315:dn,32877:dn,framebuffer:(n,e)=>{const t=e&&"handle"in e?e.handle:e;return n.bindFramebuffer(36160,t)},blend:(n,e)=>e?n.enable(3042):n.disable(3042),blendColor:(n,e)=>n.blendColor(...e),blendEquation:(n,e)=>{const t=typeof e=="number"?[e,e]:e;n.blendEquationSeparate(...t)},blendFunc:(n,e)=>{const t=e?.length===2?[...e,...e]:e;n.blendFuncSeparate(...t)},clearColor:(n,e)=>n.clearColor(...e),clearDepth:(n,e)=>n.clearDepth(e),clearStencil:(n,e)=>n.clearStencil(e),colorMask:(n,e)=>n.colorMask(...e),cull:(n,e)=>e?n.enable(2884):n.disable(2884),cullFace:(n,e)=>n.cullFace(e),depthTest:(n,e)=>e?n.enable(2929):n.disable(2929),depthFunc:(n,e)=>n.depthFunc(e),depthMask:(n,e)=>n.depthMask(e),depthRange:(n,e)=>n.depthRange(...e),dither:(n,e)=>e?n.enable(3024):n.disable(3024),derivativeHint:(n,e)=>{n.hint(35723,e)},frontFace:(n,e)=>n.frontFace(e),mipmapHint:(n,e)=>n.hint(33170,e),lineWidth:(n,e)=>n.lineWidth(e),polygonOffsetFill:(n,e)=>e?n.enable(32823):n.disable(32823),polygonOffset:(n,e)=>n.polygonOffset(...e),sampleCoverage:(n,e)=>n.sampleCoverage(e[0],e[1]||!1),scissorTest:(n,e)=>e?n.enable(3089):n.disable(3089),scissor:(n,e)=>n.scissor(...e),stencilTest:(n,e)=>e?n.enable(2960):n.disable(2960),stencilMask:(n,e)=>{e=Ah(e)?e:[e,e];const[t,r]=e;n.stencilMaskSeparate(1028,t),n.stencilMaskSeparate(1029,r)},stencilFunc:(n,e)=>{e=Ah(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,l,c]=e;n.stencilFuncSeparate(1028,t,r,i),n.stencilFuncSeparate(1029,s,l,c)},stencilOp:(n,e)=>{e=Ah(e)&&e.length===3?[...e,...e]:e;const[t,r,i,s,l,c]=e;n.stencilOpSeparate(1028,t,r,i),n.stencilOpSeparate(1029,s,l,c)},viewport:(n,e)=>n.viewport(...e)};function ft(n,e,t){return e[n]!==void 0?e[n]:t[n]}const kk={blendEquation:(n,e,t)=>n.blendEquationSeparate(ft(32777,e,t),ft(34877,e,t)),blendFunc:(n,e,t)=>n.blendFuncSeparate(ft(32969,e,t),ft(32968,e,t),ft(32971,e,t),ft(32970,e,t)),polygonOffset:(n,e,t)=>n.polygonOffset(ft(32824,e,t),ft(10752,e,t)),sampleCoverage:(n,e,t)=>n.sampleCoverage(ft(32938,e,t),ft(32939,e,t)),stencilFuncFront:(n,e,t)=>n.stencilFuncSeparate(1028,ft(2962,e,t),ft(2967,e,t),ft(2963,e,t)),stencilFuncBack:(n,e,t)=>n.stencilFuncSeparate(1029,ft(34816,e,t),ft(36003,e,t),ft(36004,e,t)),stencilOpFront:(n,e,t)=>n.stencilOpSeparate(1028,ft(2964,e,t),ft(2965,e,t),ft(2966,e,t)),stencilOpBack:(n,e,t)=>n.stencilOpSeparate(1029,ft(34817,e,t),ft(34818,e,t),ft(34819,e,t))},Wy={enable:(n,e)=>n({[e]:!0}),disable:(n,e)=>n({[e]:!1}),pixelStorei:(n,e,t)=>n({[e]:t}),hint:(n,e,t)=>n({[e]:t}),useProgram:(n,e)=>n({35725:e}),bindRenderbuffer:(n,e,t)=>n({36007:t}),bindTransformFeedback:(n,e,t)=>n({36389:t}),bindVertexArray:(n,e)=>n({34229:e}),bindFramebuffer:(n,e,t)=>{switch(e){case 36160:return n({36006:t,36010:t});case 36009:return n({36006:t});case 36008:return n({36010:t});default:return null}},bindBuffer:(n,e,t)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?n({[r]:t}):{valueChanged:!0}},blendColor:(n,e,t,r,i)=>n({32773:new Float32Array([e,t,r,i])}),blendEquation:(n,e)=>n({32777:e,34877:e}),blendEquationSeparate:(n,e,t)=>n({32777:e,34877:t}),blendFunc:(n,e,t)=>n({32969:e,32968:t,32971:e,32970:t}),blendFuncSeparate:(n,e,t,r,i)=>n({32969:e,32968:t,32971:r,32970:i}),clearColor:(n,e,t,r,i)=>n({3106:new Float32Array([e,t,r,i])}),clearDepth:(n,e)=>n({2931:e}),clearStencil:(n,e)=>n({2961:e}),colorMask:(n,e,t,r,i)=>n({3107:[e,t,r,i]}),cullFace:(n,e)=>n({2885:e}),depthFunc:(n,e)=>n({2932:e}),depthRange:(n,e,t)=>n({2928:new Float32Array([e,t])}),depthMask:(n,e)=>n({2930:e}),frontFace:(n,e)=>n({2886:e}),lineWidth:(n,e)=>n({2849:e}),polygonOffset:(n,e,t)=>n({32824:e,10752:t}),sampleCoverage:(n,e,t)=>n({32938:e,32939:t}),scissor:(n,e,t,r,i)=>n({3088:new Int32Array([e,t,r,i])}),stencilMask:(n,e)=>n({2968:e,36005:e}),stencilMaskSeparate:(n,e,t)=>n({[e===1028?2968:36005]:t}),stencilFunc:(n,e,t,r)=>n({2962:e,2967:t,2963:r,34816:e,36003:t,36004:r}),stencilFuncSeparate:(n,e,t,r,i)=>n({[e===1028?2962:34816]:t,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(n,e,t,r)=>n({2964:e,2965:t,2966:r,34817:e,34818:t,34819:r}),stencilOpSeparate:(n,e,t,r,i)=>n({[e===1028?2964:34817]:t,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(n,e,t,r,i)=>n({2978:[e,t,r,i]})},Qn=(n,e)=>n.isEnabled(e),Hy={3042:Qn,2884:Qn,2929:Qn,3024:Qn,32823:Qn,32926:Qn,32928:Qn,3089:Qn,2960:Qn,35977:Qn},Mk=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Fs(n,e){if(Nk(e))return;const t={};for(const i in e){const s=Number(i),l=Pk[i];l&&(typeof l=="string"?t[l]=!0:l(n,e[i],s))}const r=n.state&&n.state.cache;if(r)for(const i in t){const s=kk[i];s(n,e,r)}}function t3(n,e=ip){if(typeof e=="number"){const i=e,s=Hy[i];return s?s(n,i):n.getParameter(i)}const t=Array.isArray(e)?e:Object.keys(e),r={};for(const i of t){const s=Hy[i];r[i]=s?s(n,Number(i)):n.getParameter(Number(i))}return r}function Ok(n){Fs(n,ip)}function Nk(n){for(const e in n)return!1;return!0}function Dk(n,e){if(n===e)return!0;const t=Array.isArray(n)||ArrayBuffer.isView(n),r=Array.isArray(e)||ArrayBuffer.isView(e);if(t&&r&&n.length===e.length){for(let i=0;i<n.length;++i)if(n[i]!==e[i])return!1;return!0}return!1}class xi{constructor(e,t){w(this,"gl");w(this,"program",null);w(this,"stateStack",[]);w(this,"enable",!0);w(this,"cache",null);w(this,"log");w(this,"initialized",!1);this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Fs(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?t3(e):Object.assign({},ip),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,Lk(e);for(const r in Wy){const i=Wy[r];Fk(e,r,i)}Xy(e,"getParameter"),Xy(e,"isEnabled")}_updateCache(e){let t=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const l=e[s],c=this.cache[s];Dk(l,c)||(t=!0,r=c,i&&!(s in i)&&(i[s]=c),this.cache[s]=l)}return{valueChanged:t,oldValue:r}}}function Xy(n,e){const t=n[e].bind(n);n[e]=function(i){if(i===void 0||Mk.has(i))return t(i);const s=xi.get(n);return i in s.cache||(s.cache[i]=t(i)),s.enable?s.cache[i]:t(i)},Object.defineProperty(n[e],"name",{value:`${e}-from-cache`,configurable:!1})}function Fk(n,e,t){if(!n[e])return;const r=n[e].bind(n);n[e]=function(...s){const l=xi.get(n),{valueChanged:c,oldValue:f}=t(l._updateCache,...s);return c&&r(...s),f},Object.defineProperty(n[e],"name",{value:`${e}-to-cache`,configurable:!1})}function Lk(n){const e=n.useProgram.bind(n);n.useProgram=function(r){const i=xi.get(n);i.program!==r&&(e(r),i.program=r)}}function Bk(n,e,t){let r="";const i={preserveDrawingBuffer:!0,...t};let s=null;if(s||(s=n.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!t.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=n.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=n.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:l,onContextRestored:c}=e;return n.addEventListener("webglcontextlost",f=>l(f),!1),n.addEventListener("webglcontextrestored",f=>c(f),!1),s.luma||(s.luma={}),s}function Os(n,e,t){return t[e]===void 0&&(t[e]=n.getExtension(e)||null),t[e]}function Uk(n,e){const t=n.getParameter(7936),r=n.getParameter(7937);Os(n,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=n.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),l=n.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),c=s||t,f=l||r,h=n.getParameter(7938),p=n3(c,f),_=Vk(c,f),y=zk(c,f);return{type:"webgl",gpu:p,gpuType:y,gpuBackend:_,vendor:c,renderer:f,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function n3(n,e){return/NVIDIA/i.exec(n)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(n)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(n)||/Apple/i.exec(e)?"apple":/AMD/i.exec(n)||/AMD/i.exec(e)||/ATI/i.exec(n)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e)?"software":"unknown"}function Vk(n,e){return/Metal/i.exec(n)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(n)||/ANGLE/i.exec(e)?"opengl":"unknown"}function zk(n,e){if(/SwiftShader/i.exec(n)||/SwiftShader/i.exec(e))return"cpu";switch(n3(n,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function r3(n){switch(n){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(n))}const Po="WEBGL_compressed_texture_s3tc",ko="WEBGL_compressed_texture_s3tc_srgb",ms="EXT_texture_compression_rgtc",ys="EXT_texture_compression_bptc",$k="WEBGL_compressed_texture_etc",jk="WEBGL_compressed_texture_astc",Wk="WEBGL_compressed_texture_etc1",Hk="WEBGL_compressed_texture_pvrtc",Xk="WEBGL_compressed_texture_atc",Yy="EXT_texture_norm16",Ky="EXT_render_snorm",Yk="EXT_color_buffer_float",sp={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Ky],"norm16-renderable-webgl":[Yy],"snorm16-renderable-webgl":[Yy,Ky],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Po,ko,ms,ys],"texture-compression-bc5-webgl":[ms],"texture-compression-bc7-webgl":[ys],"texture-compression-etc2":[$k],"texture-compression-astc":[jk],"texture-compression-etc1-webgl":[Wk],"texture-compression-pvrtc-webgl":[Hk],"texture-compression-atc-webgl":[Xk]};function Kk(n){return n in sp}function qk(n,e,t){return(sp[e]||[]).every(i=>Os(n,i,t))}const op={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:Yk,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Po},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:ko},"bc1-rgba-unorm":{gl:33777,x:Po},"bc1-rgba-unorm-srgb":{gl:35916,x:ko},"bc2-rgba-unorm":{gl:33778,x:Po},"bc2-rgba-unorm-srgb":{gl:35918,x:ko},"bc3-rgba-unorm":{gl:33779,x:Po},"bc3-rgba-unorm-srgb":{gl:35919,x:ko},"bc4-r-unorm":{gl:36283,x:ms},"bc4-r-snorm":{gl:36284,x:ms},"bc5-rg-unorm":{gl:36285,x:ms},"bc5-rg-snorm":{gl:36286,x:ms},"bc6h-rgb-ufloat":{gl:36495,x:ys},"bc6h-rgb-float":{gl:36494,x:ys},"bc7-rgba-unorm":{gl:36492,x:ys},"bc7-rgba-unorm-srgb":{gl:36493,x:ys},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function Zk(n,e,t){let r=e.create;const i=op[e.format];return i?.gl===void 0&&(r=!1),i?.x&&(r=r&&!!Os(n,i.x,t)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function i3(n){const e=op[n],t=Gk(n),r=zd(n);return{internalFormat:t,format:e?.dataFormat||Jk(r.channels,r.integer,r.normalized,t),type:r.dataType?r3(r.dataType):e?.types?.[0]||5121,compressed:r.compressed||!1}}function Qk(n){switch(zd(n).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${n}`)}}function Jk(n,e,t,r){if(r===6408||r===6407)return r;switch(n){case"r":return e&&!t?36244:6403;case"rg":return e&&!t?33320:33319;case"rgb":return e&&!t?36248:6407;case"rgba":return e&&!t?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function Gk(n){const t=op[n]?.gl;if(t===void 0)throw new Error(`Unsupported texture format ${n}`);return t}const qy={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class eM extends ME{constructor(t,r,i){super([],i);w(this,"gl");w(this,"extensions");w(this,"testedFeatures",new Set);this.gl=t,this.extensions=r,Os(t,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const t=this.getFeatures();for(const r of t)this.has(r)&&(yield r);return[]}has(t){return this.disabledFeatures?.[t]?!1:(this.testedFeatures.has(t)||(this.testedFeatures.add(t),Kk(t)&&qk(this.gl,t,this.extensions)&&this.features.add(t),this.getWebGLFeature(t)&&this.features.add(t)),this.features.has(t))}initializeFeatures(){const t=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of t)this.has(r)}getFeatures(){return[...Object.keys(qy),...Object.keys(sp)]}getWebGLFeature(t){const r=qy[t];return typeof r=="string"?!!Os(this.gl,r,this.extensions):!!r}}class tM extends kE{constructor(t){super();w(this,"gl");w(this,"limits",{});this.gl=t}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(t){return this.limits[t]===void 0&&(this.limits[t]=this.gl.getParameter(t)),this.limits[t]||0}}class Fo extends Zl{constructor(t,r){super(t,r);w(this,"device");w(this,"gl");w(this,"handle");w(this,"colorAttachments",[]);w(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=t,this.gl=t.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(t.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const t=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=Qk(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${rM(r)}`)}this.gl.bindFramebuffer(36160,t)}_attachTextureView(t,r){const{gl:i}=this.device,{texture:s}=r,l=r.props.baseMipLevel,c=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,t,s.handle,l,c);break;case 34067:const f=nM(c);i.framebufferTexture2D(36160,t,f,s.handle,l);break;case 3553:i.framebufferTexture2D(36160,t,3553,s.handle,l);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function nM(n){return n<34069?n+34069:n}function rM(n){switch(n){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${n}`}}class iM extends Xh{constructor(t,r){super(r);w(this,"device");w(this,"format","rgba8unorm");w(this,"depthStencilFormat","depth24plus");w(this,"presentationSize");w(this,"_framebuffer",null);this.device=t,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Fo(this.device,{handle:null}),this._framebuffer}update(){const t=this.getPixelSize();(t[0]!==this.presentationSize[0]||t[1]!==this.presentationSize[1])&&(this.presentationSize=t,this.resize())}resize(t){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(t?.useDevicePixels);this.setDevicePixelRatio(r,t);return}}commit(){}}async function s3(n,e){const t=document.getElementsByTagName("head")[0];if(!t)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",n),new Promise((i,s)=>{r.onload=i,r.onerror=l=>s(new Error(`Unable to load script '${n}': ${l}`)),t.appendChild(r)})}const sM=1;let pn=null,Zy=!1;const ap={debugSpectorJS:oe.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function oM(n){if(!globalThis.SPECTOR)try{await s3(n.debugSpectorJSUrl||ap.debugSpectorJSUrl)}catch(e){oe.warn(String(e))}}function aM(n){if(n={...ap,...n},!n.debugSpectorJS)return null;if(!pn&&globalThis.SPECTOR&&!globalThis.luma?.spector){oe.probe(sM,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:e}=globalThis.SPECTOR;pn=new e,globalThis.luma&&(globalThis.luma.spector=pn)}if(!pn)return null;if(Zy||(Zy=!0,pn.spyCanvases(),pn?.onCaptureStarted.add(e=>oe.info("Spector capture started:",e)()),pn?.onCapture.add(e=>{oe.info("Spector capture complete:",e)(),pn?.getResultUI(),pn?.resultView.display(),pn?.resultView.addCapture(e)})),n.gl){const e=n.gl,t=e.device;pn?.startCapture(n.gl,500),e.device=t,new Promise(r=>setTimeout(r,2e3)).then(r=>{oe.info("Spector capture stopped after 2 seconds")(),pn?.stopCapture()})}return pn}const lM="https://unpkg.com/webgl-debug@2.0.1/index.js";function o3(n){return n.luma=n.luma||{},n.luma}async function cM(){Pi()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await s3(lM))}function uM(n,e={}){return e.debugWebGL||e.traceWebGL?hM(n,e):fM(n)}function fM(n){const e=o3(n);return e.realContext?e.realContext:n}function hM(n,e){if(!globalThis.WebGLDebugUtils)return oe.warn("webgl-debug not loaded")(),n;const t=o3(n);if(t.debugContext)return t.debugContext;globalThis.WebGLDebugUtils.init({..._s,...n});const r=globalThis.WebGLDebugUtils.makeDebugContext(n,dM.bind(null,e),pM.bind(null,e));for(const l in _s)!(l in r)&&typeof _s[l]=="number"&&(r[l]=_s[l]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(n)),Object.setPrototypeOf(i,r);const s=Object.create(i);return t.realContext=n,t.debugContext=s,s.debug=!0,s}function Qy(n,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let t=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,e);return t=`${t.slice(0,100)}${t.length>100?"...":""}`,`gl.${n}(${t})`}function dM(n,e,t,r){r=Array.from(r).map(c=>c===void 0?"undefined":c);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,r),l=`${i} in gl.${t}(${s})`;oe.error(l)();debugger}function pM(n,e,t){let r="";oe.level>=1&&(r=Qy(e,t),n.traceWebGL&&oe.log(1,r)());for(const i of t)if(i===void 0){r=r||Qy(e,t);debugger}}const Rh={};function gM(n="id"){Rh[n]=Rh[n]||1;const e=Rh[n]++;return`${n}-${e}`}class Lo extends st{constructor(t,r={}){super(t,r);w(this,"device");w(this,"gl");w(this,"handle");w(this,"glTarget");w(this,"glUsage");w(this,"glIndexType",5123);w(this,"byteLength");w(this,"bytesUsed");this.device=t,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),t.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=_M(this.props.usage),this.glUsage=mM(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(t,r=0,i=t.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,t),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(t,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(t){let r=t;t===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=t,this.byteLength=t,this._setDebugData(null,0,t),this.trackAllocatedMemory(t),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(t,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,t),this.gl.bindBuffer(36663,null),this._setDebugData(t,r,t.byteLength)}async readAsync(t=0,r){return this.readSyncWebGL(t,r)}readSyncWebGL(t=0,r){r=r??this.byteLength-t;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,t,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,t,r),i}}function _M(n){return n&st.INDEX?34963:n&st.VERTEX?34962:n&st.UNIFORM?35345:34962}function mM(n){return n&st.INDEX||n&st.VERTEX?35044:n&st.UNIFORM?35048:35044}function yM(n){const e=n.split(/\r?\n/),t=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[_,y]=i;t.push({message:y.trim(),type:Jy(_),lineNum:0,linePos:0});continue}const[s,l,c,...f]=i;let h=parseInt(c,10);isNaN(h)&&(h=0);let p=parseInt(l,10);isNaN(p)&&(p=0),t.push({message:f.join(":").trim(),type:Jy(s),lineNum:h,linePos:p})}return t}function Jy(n){const e=["warning","error","info"],t=n.toLowerCase();return e.includes(t)?t:"info"}class vM extends Kl{constructor(t,r){super(t,r);w(this,"device");w(this,"handle");switch(this.device=t,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const t=this.device.gl.getShaderInfoLog(this.handle);return t?yM(t):[]}getTranslatedSource(){return this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders?.getTranslatedShaderSource(this.handle)||null}async _compile(t){t=t.startsWith("#version ")?t:`#version 300 es
${t}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,t),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}oe.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),oe.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const t=async s=>await new Promise(l=>setTimeout(l,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await t(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function bM(n,e,t,r){if(SM(e))return r(n);const i=n;i.pushState();try{return wM(n,e),Fs(i.gl,t),r(n)}finally{i.popState()}}function wM(n,e){const t=n,{gl:r}=t;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Si("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&n.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&n.features.has("provoking-vertex-webgl")){const s=t.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,l=Si("provokingVertex",e.provokingVertex,{first:36429,last:36430});s?.provokingVertexWEBGL(l)}if((e.polygonMode||e.polygonOffsetLine)&&n.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=t.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,l=Si("polygonMode",e.polygonMode,{fill:6914,line:6913});s?.polygonModeWEBGL(1028,l),s?.polygonModeWEBGL(1029,l)}e.polygonOffsetLine&&r.enable(10754)}if(n.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(xM("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(md("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&oe.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=md("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=Ch("stencilPassOperation",e.stencilPassOperation),s=Ch("stencilFailOperation",e.stencilFailOperation),l=Ch("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,l,i),r.stencilOpSeparate(1029,s,l,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=Gy("blendColorOperation",e.blendColorOperation||"add"),s=Gy("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const l=Tl("blendColorSrcFactor",e.blendColorSrcFactor||"one"),c=Tl("blendColorDstFactor",e.blendColorDstFactor||"zero"),f=Tl("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),h=Tl("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(l,c,f,h)}}function md(n,e){return Si(n,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function Ch(n,e){return Si(n,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Gy(n,e){return Si(n,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Tl(n,e){return Si(n,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function TM(n,e){return`Illegal parameter ${e} for ${n}`}function Si(n,e,t){if(!(e in t))throw new Error(TM(n,e));return t[e]}function xM(n,e){return e}function SM(n){let e=!0;for(const t in n){e=!1;break}return e}function a3(n){const e={};return n.addressModeU&&(e[10242]=Ih(n.addressModeU)),n.addressModeV&&(e[10243]=Ih(n.addressModeV)),n.addressModeW&&(e[32882]=Ih(n.addressModeW)),n.magFilter&&(e[10240]=yd(n.magFilter)),(n.minFilter||n.mipmapFilter)&&(e[10241]=EM(n.minFilter||"linear",n.mipmapFilter)),n.lodMinClamp!==void 0&&(e[33082]=n.lodMinClamp),n.lodMaxClamp!==void 0&&(e[33083]=n.lodMaxClamp),n.type==="comparison-sampler"&&(e[34892]=34894),n.compare&&(e[34893]=md("compare",n.compare)),n.maxAnisotropy&&(e[34046]=n.maxAnisotropy),e}function Ih(n){switch(n){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function yd(n){switch(n){case"nearest":return 9728;case"linear":return 9729}}function EM(n,e="none"){if(!e)return yd(n);switch(e){case"none":return yd(n);case"nearest":return n==="nearest"?9984:9986;case"linear":return n==="nearest"?9985:9987}}class vd extends ql{constructor(t,r){super(t,r);w(this,"device");w(this,"handle");w(this,"parameters");this.device=t,this.parameters=a3(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(t){for(const[r,i]of Object.entries(t)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class vs extends Yl{constructor(t,r){super(t,{...ct.defaultProps,...r});w(this,"device");w(this,"gl");w(this,"handle");w(this,"texture");this.device=t,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const AM="Failed to deduce GL constant from typed array";function RM(n){switch(ArrayBuffer.isView(n)?n.constructor:n){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(AM)}}function CM(n,e){const{clamped:t=!0}=e||{};switch(n){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return t?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function l3(n){switch(n){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function IM(n){switch(n){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function fc(n,e,t){if(PM(e))return t(n);const{nocatch:r=!0}=e,i=xi.get(n);i.push(),Fs(n,e);let s;if(r)s=t(n),i.pop();else try{s=t(n)}finally{i.pop()}return s}function PM(n){for(const e in n)return!1;return!0}function kM(n,e,t){const{dimension:r,width:i,height:s,depth:l=0}=t,{glInternalFormat:c}=t,f=t.glTarget;switch(r){case"2d-array":case"3d":n.texStorage3D(f,e,c,i,s,l);break;default:n.texStorage2D(f,e,c,i,s)}}function e0(n,e,t,r){const{width:i,height:s}=r,{dimension:l,depth:c=0,mipLevel:f=0}=r,{x:h=0,y:p=0,z:_=0}=r,{glFormat:y,glType:b}=r,x=c3(r.glTarget,l,c),S=r.flipY?{37440:!0}:{};fc(n,S,()=>{switch(l){case"2d-array":case"3d":n.bindTexture(x,e),n.texSubImage3D(x,f,h,p,_,i,s,c,y,b,t),n.bindTexture(x,null);break;case"2d":case"cube":n.bindTexture(x,e),n.texSubImage2D(x,f,h,p,i,s,y,b,t),n.bindTexture(x,null);break;default:throw new Error(l)}})}function t0(n,e,t){const{dimension:r,width:i,height:s,depth:l=0,mipLevel:c=0,byteOffset:f=0}=t,{x:h=0,y:p=0,z:_=0}=t,{glFormat:y,glType:b,compressed:x}=t,S=c3(t.glTarget,r,l);switch(r){case"2d-array":case"3d":x?n.compressedTexSubImage3D(S,c,h,p,_,i,s,l,y,e,f):n.texSubImage3D(S,c,h,p,_,i,s,l,y,b,e,f);break;case"2d":case"cube":x?n.compressedTexSubImage2D(S,c,h,p,i,s,y,e,f):n.texSubImage2D(S,c,h,p,i,s,y,b,e,f);break;default:throw new Error(r)}}function MM(n){switch(n){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(n)}function c3(n,e,t){return e==="cube"?34069+t:n}function OM(n,e){const{sourceX:t=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:l,sourceHeight:c,sourceDepth:f,sourceFormat:h,sourceType:p}=e||{};const{framebuffer:_,deleteFramebuffer:y}=u3(n),{gl:b,handle:x}=_;l||(l=_.width),c||(c=_.height);const S=_.colorAttachments[i]?.texture;if(!S)throw new Error(`Invalid framebuffer attachment ${i}`);f=S?.depth||1,h||(h=S?.glFormat||6408),p||(p=S?.glType||5121),s=FM(s,p,h,l,c),p=p||RM(s);const C=b.bindFramebuffer(36160,x);return b.readBuffer(36064+i),b.readPixels(t,r,l,c,h,p,s),b.readBuffer(36064),b.bindFramebuffer(36160,C||null),y&&_.destroy(),s}function NM(n,e){const{target:t,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:l=0}=e||{};let{sourceWidth:c,sourceHeight:f,sourceType:h}=e||{};const{framebuffer:p,deleteFramebuffer:_}=u3(n);c=c||p.width,f=f||p.height;const y=p;h=h||5121;let b=t;if(!b){const S=l3(s),C=IM(h),P=l+c*f*S*C;b=y.device.createBuffer({byteLength:P})}const x=n.device.createCommandEncoder();return x.copyTextureToBuffer({sourceTexture:n,width:c,height:f,origin:[r,i],destinationBuffer:b,byteOffset:l}),x.destroy(),_&&p.destroy(),b}function u3(n){return n instanceof Zl?{framebuffer:n,deleteFramebuffer:!1}:{framebuffer:DM(n),deleteFramebuffer:!0}}function DM(n,e){const{device:t,width:r,height:i,id:s}=n;return t.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[n]})}function FM(n,e,t,r,i,s){if(n)return n;e||(e=5121);const l=CM(e,{clamped:!1}),c=l3(t);return new l(r*i*c)}class Bo extends ct{constructor(t,r){super(t,r);w(this,"device");w(this,"gl");w(this,"handle");w(this,"sampler");w(this,"view");w(this,"mipmaps");w(this,"compressed");w(this,"glTarget");w(this,"glFormat");w(this,"glType");w(this,"glInternalFormat");w(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=t,this.gl=this.device.gl,this.glTarget=MM(this.props.dimension);const s=i3(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(t){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:t.data});let{width:r,height:i}=t;if(!r||!i){const s=ct.getTextureDataSize(t.data);r=s?.width||1,i=s?.height||1}if(this.width=r,this.height=i,this.depth=t.depth,this.setSampler(t.sampler),this.view=new vs(this.device,{...this.props,texture:this}),this.bind(),kM(this.gl,this.mipLevels,this),t.data)switch(t.dimension){case"1d":this.setTexture1DData(t.data);break;case"2d":this.setTexture2DData(t.data);break;case"3d":this.setTexture3DData(t.data);break;case"cube":this.setTextureCubeData(t.data);break;case"2d-array":this.setTextureArrayData(t.data);break;case"cube-array":this.setTextureCubeArrayData(t.data);break;default:throw new Error(t.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(t){return new vs(this.device,{...t,texture:this})}setSampler(t={}){let r;t instanceof vd?(this.sampler=t,r=t.props):(this.sampler=new vd(this.device,t),r=t);const i=a3(r);this._setSamplerParameters(i)}generateMipmap(t){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(oe.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!t?.force)))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){oe.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(t){const r=ct.getExternalImageSize(t.image),i={...ct.defaultCopyExternalImageOptions,...r,...t},{image:s,depth:l,mipLevel:c,x:f,y:h,z:p,flipY:_}=i;let{width:y,height:b}=i;const{dimension:x,glTarget:S,glFormat:C,glInternalFormat:P,glType:z}=this;if(y=Math.min(y,this.width-f),b=Math.min(b,this.height-h),t.sourceX||t.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return e0(this.device.gl,this.handle,s,{dimension:x,mipLevel:c,x:f,y:h,z:p,width:y,height:b,depth:l,glFormat:C,glType:z,glTarget:S,flipY:_}),{width:i.width,height:i.height}}setTexture1DData(t){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(t,r=0){this.bind();const i=ct.normalizeTextureData(t,this);i.length>1&&this.props.mipmaps!==!1&&oe.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const l=i[s];this._setMipLevel(r,s,l)}this.unbind()}setTexture3DData(t){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(t)&&(this.bind(),t0(this.device.gl,t,this),this.unbind())}setTextureCubeData(t,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of ct.CubeFaces)this.setTextureCubeFaceData(t[i],i)}setTextureArrayData(t){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(t){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(t,r,i=0){Array.isArray(t)&&t.length>1&&this.props.mipmaps!==!1&&oe.warn(`${this.id} has mipmap and multiple LODs.`)();const s=ct.CubeFaces.indexOf(r);this.setTexture2DData(t,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(t){const{face:r,width:i,height:s,pixels:l,data:c,format:f=6408,type:h=5121}=t,{gl:p}=this,_=l||c;this.bind(),_ instanceof Promise?_.then(y=>this.setImageDataForFace(Object.assign({},t,{face:r,data:y,pixels:y}))):this.width||this.height?p.texImage2D(r,0,f,i,s,0,f,h,_):p.texImage2D(r,0,f,f,h,_)}_getImageDataMap(t){for(let r=0;r<ct.CubeFaces.length;++r){const i=ct.CubeFaces[r];t[i]&&(t[34069+r]=t[i],delete t[i])}return t}_setSamplerParameters(t){oe.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(t))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(t)){const s=Number(r),l=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,l);break;case 10241:this.gl.texParameteri(this.glTarget,s,l);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,l);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,l);break;default:this.gl.texParameteri(this.glTarget,s,l);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(t,r,i,s=this.glTarget){if(ct.isExternalImage(i)){e0(this.device.gl,this.handle,i,{...this,depth:t,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(ct.isTextureLevelData(i)){t0(this.device.gl,i.data,{...this,depth:t,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,this.handle),t}unbind(t){const{gl:r}=this;return t!==void 0&&(this.textureUnit=t,r.activeTexture(33984+t)),r.bindTexture(this.glTarget,null),t}}const LM=[1,2,4,8];class BM extends Yh{constructor(t,r){super(t,r);w(this,"device");w(this,"glParameters");this.device=t;let i;if(!r?.parameters?.viewport)if(r?.framebuffer){const{width:l,height:c}=r.framebuffer;i=[0,0,l,c]}else{const[l,c]=t.getCanvasContext().getDrawingBufferSize();i=[0,0,l,c]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer?.handle)if(this.props.framebuffer){const l=this.props.framebuffer.colorAttachments.map((c,f)=>36064+f);this.device.gl.drawBuffers(l)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}setParameters(t={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,t.viewport&&(t.viewport.length>=6?(r.viewport=t.viewport.slice(0,4),r.depthRange=[t.viewport[4],t.viewport[5]]):r.viewport=t.viewport),t.scissorRect&&(r.scissorTest=!0,r.scissor=t.scissorRect),t.blendConstant&&(r.blendColor=t.blendConstant),t.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),t[2967]=t.stencilReference),t.colorMask&&(r.colorMask=LM.map(i=>!!(i&t.colorMask))),this.glParameters=r,Fs(this.device.gl,r)}beginOcclusionQuery(t){this.props.occlusionQuerySet?.beginOcclusionQuery()}endOcclusionQuery(){this.props.occlusionQuerySet?.endOcclusionQuery()}clear(){const t={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,t.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,t.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,t.clearStencil=this.props.clearStencil),r!==0&&fc(this.device.gl,t,()=>{this.device.gl.clear(r)})}clearColorBuffer(t=0,r=[0,0,0,0]){fc(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,t,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,t,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,t,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function UM(n){return VM.includes(n)}const VM=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],f3={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function h3(n){const e=f3[n];if(!e)throw new Error("uniform");const[t,r,,i]=e;return{format:i,components:r,glType:t}}function zM(n){const e=f3[n];if(!e)throw new Error("attribute");const[,t,,r,i]=e;return{attributeType:r,vertexFormat:i,components:t}}function $M(n,e){const t={attributes:[],bindings:[]};t.attributes=jM(n,e);const r=XM(n,e);for(const c of r){const f=c.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));t.bindings.push({type:"uniform",name:c.name,group:0,location:c.location,visibility:(c.vertex?1:0)&(c.fragment?2:0),minBindingSize:c.byteLength,uniforms:f})}const i=HM(n,e);let s=0;for(const c of i)if(UM(c.type)){const{viewDimension:f,sampleType:h}=KM(c.type);t.bindings.push({type:"texture",name:c.name,group:0,location:s,viewDimension:f,sampleType:h}),c.textureUnit=s,s+=1}i.length&&(t.uniforms=i);const l=WM(n,e);return l?.length&&(t.varyings=l),t}function jM(n,e){const t=[],r=n.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=n.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:l,type:c}=s,f=n.getAttribLocation(e,l);if(f>=0){const{attributeType:h}=zM(c),p=/instance/i.test(l)?"instance":"vertex";t.push({name:l,location:f,stepMode:p,type:h})}}return t.sort((i,s)=>i.location-s.location),t}function WM(n,e){const t=[],r=n.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=n.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:l,type:c,size:f}=s,{glType:h,components:p}=h3(c),_={location:i,name:l,type:h,size:f*p};t.push(_)}return t.sort((i,s)=>i.location-s.location),t}function HM(n,e){const t=[],r=n.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=n.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:l,size:c,type:f}=s,{name:h,isArray:p}=qM(l);let _=n.getUniformLocation(e,h);const y={location:_,name:h,size:c,type:f,isArray:p};if(t.push(y),y.size>1)for(let b=0;b<y.size;b++){const x=`${h}[${b}]`;_=n.getUniformLocation(e,x);const S={...y,name:x,location:_};t.push(S)}}return t}function XM(n,e){const t=(s,l)=>n.getActiveUniformBlockParameter(e,s,l),r=[],i=n.getProgramParameter(e,35382);for(let s=0;s<i;s++){const l={name:n.getActiveUniformBlockName(e,s)||"",location:t(s,35391),byteLength:t(s,35392),vertex:t(s,35396),fragment:t(s,35398),uniformCount:t(s,35394),uniforms:[]},c=t(s,35395)||[],f=n.getActiveUniforms(e,c,35383),h=n.getActiveUniforms(e,c,35384),p=n.getActiveUniforms(e,c,35387),_=n.getActiveUniforms(e,c,35388);for(let y=0;y<l.uniformCount;++y){const b=n.getActiveUniform(e,c[y]);if(!b)throw new Error("activeInfo");l.uniforms.push({name:b.name,format:h3(f[y]).format,type:f[y],arrayLength:h[y],byteOffset:p[y],byteStride:_[y]})}r.push(l)}return r.sort((s,l)=>s.location-l.location),r}const YM={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function KM(n){const e=YM[n];if(!e)throw new Error("sampler");const[t,r]=e;return{viewDimension:t,sampleType:r}}function qM(n){if(n[n.length-1]!=="]")return{name:n,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(n);if(!t||t.length<2)throw new Error(`Failed to parse GLSL uniform name ${n}`);return{name:t[1],length:t[2]?1:0,isArray:!!t[2]}}function ZM(n,e,t,r){const i=n;let s=r;s===!0&&(s=1),s===!1&&(s=0);const l=typeof s=="number"?[s]:s;switch(t){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return n.uniform1i(e,r);case 5126:return n.uniform1fv(e,l);case 35664:return n.uniform2fv(e,l);case 35665:return n.uniform3fv(e,l);case 35666:return n.uniform4fv(e,l);case 5124:return n.uniform1iv(e,l);case 35667:return n.uniform2iv(e,l);case 35668:return n.uniform3iv(e,l);case 35669:return n.uniform4iv(e,l);case 35670:return n.uniform1iv(e,l);case 35671:return n.uniform2iv(e,l);case 35672:return n.uniform3iv(e,l);case 35673:return n.uniform4iv(e,l);case 5125:return i.uniform1uiv(e,l,1);case 36294:return i.uniform2uiv(e,l,2);case 36295:return i.uniform3uiv(e,l,3);case 36296:return i.uniform4uiv(e,l,4);case 35674:return n.uniformMatrix2fv(e,!1,l);case 35675:return n.uniformMatrix3fv(e,!1,l);case 35676:return n.uniformMatrix4fv(e,!1,l);case 35685:return i.uniformMatrix2x3fv(e,!1,l);case 35686:return i.uniformMatrix2x4fv(e,!1,l);case 35687:return i.uniformMatrix3x2fv(e,!1,l);case 35688:return i.uniformMatrix3x4fv(e,!1,l);case 35689:return i.uniformMatrix4x2fv(e,!1,l);case 35690:return i.uniformMatrix4x3fv(e,!1,l)}throw new Error("Illegal uniform")}function QM(n){return Hb(n)!==null||typeof n=="number"||typeof n=="boolean"}function JM(n){const e={bindings:{},uniforms:{}};return Object.keys(n).forEach(t=>{const r=n[t];QM(r)?e.uniforms[t]=r:e.bindings[t]=r}),e}function GM(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(n)}}function e4(n){switch(n){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(n)}}const n0=4;class t4 extends Es{constructor(t,r){super(t,r);w(this,"device");w(this,"handle");w(this,"vs");w(this,"fs");w(this,"introspectedLayout");w(this,"uniforms",{});w(this,"bindings",{});w(this,"varyings",null);w(this,"_uniformCount",0);w(this,"_uniformSetters",{});this.device=t,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),oe.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=$M(this.device.gl,this.handle),oe.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=n4(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(t,r){for(const[i,s]of Object.entries(t)){const l=this.shaderLayout.bindings.find(c=>c.name===i)||this.shaderLayout.bindings.find(c=>c.name===`${i}Uniforms`);if(!l){const c=this.shaderLayout.bindings.map(f=>`"${f.name}"`).join(", ");r?.disableWarnings||oe.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${c}`,s)();continue}switch(s||oe.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),l.type){case"uniform":if(!(s instanceof Lo)&&!(s.buffer instanceof Lo))throw new Error("buffer value");break;case"texture":if(!(s instanceof vs||s instanceof Bo||s instanceof Fo))throw new Error("texture value");break;case"sampler":oe.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(l.type)}this.bindings[i]=s}}draw(t){const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:l,vertexCount:c,instanceCount:f,isInstanced:h=!1,firstVertex:p=0,transformFeedback:_}=t,y=GM(s),b=!!l.indexBuffer,x=l.indexBuffer?.glIndexType;if(this.linkStatus!=="success")return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return oe.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),l.bindBeforeRender(r),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const S=r;return bM(this.device,i,S.glParameters,()=>{b&&h?this.device.gl.drawElementsInstanced(y,c||0,x,p,f||0):b?this.device.gl.drawElements(y,c||0,x,p):h?this.device.gl.drawArraysInstanced(y,p,c||0,f||0):this.device.gl.drawArrays(y,p,c||0),_&&_.end()}),l.unbindAfterRender(r),!0}setUniformsWebGL(t){const{bindings:r}=JM(t);Object.keys(r).forEach(i=>{oe.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,t)}async _linkShaders(){const{gl:t}=this.device;if(t.attachShader(this.handle,this.vs.handle),t.attachShader(this.handle,this.fs.handle),oe.time(n0,`linkProgram for ${this.id}`)(),t.linkProgram(this.handle),oe.timeEnd(n0,`linkProgram for ${this.id}`)(),oe.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}oe.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),oe.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(t){switch(t){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const r=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${t}: ${r}`)}}_getLinkStatus(){const{gl:t}=this.device;return t.getProgramParameter(this.handle,35714)?(t.validateProgram(this.handle),t.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const t=async s=>await new Promise(l=>setTimeout(l,s));if(!this.device.features.has("compilation-status-async-webgl")){await t(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await t(10)}}_areTexturesRenderable(){let t=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(oe.warn(`Binding ${r.name} not found in ${this.id}`)(),t=!1);return t}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:t}=this.device;t.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const l=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!l)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:c}=s,f=t.getUniformBlockIndex(this.handle,c);if(f===4294967295)throw new Error(`Invalid uniform block name ${c}`);t.uniformBlockBinding(this.handle,i,f),l instanceof Lo?t.bindBufferBase(35345,i,l.handle):t.bindBufferRange(35345,i,l.buffer.handle,l.offset||0,l.size||l.buffer.byteLength-l.offset),i+=1;break;case"texture":if(!(l instanceof vs||l instanceof Bo||l instanceof Fo))throw new Error("texture");let h;if(l instanceof vs)h=l.texture;else if(l instanceof Bo)h=l;else if(l instanceof Fo&&l.colorAttachments[0]instanceof vs)oe.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=l.colorAttachments[0].texture;else throw new Error("No texture");t.activeTexture(33984+r),t.bindTexture(h.glTarget,h.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:l}=t,c=this.uniforms[r]??l;c!==void 0&&ZM(this.device.gl,i,s,c)}}}function n4(n,e){const t={...n,attributes:n.attributes.map(r=>({...r}))};for(const r of e?.attributes||[]){const i=t.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):oe.warn(`shader layout attribute ${r.name} not present in shader`)}return t}class r4 extends qh{constructor(t){super(t,{});w(this,"device");w(this,"commands",[]);this.device=t}submitCommands(t=this.commands){for(const r of t)switch(r.name){case"copy-buffer-to-buffer":i4(this.device,r.options);break;case"copy-buffer-to-texture":s4(this.device,r.options);break;case"copy-texture-to-buffer":o4(this.device,r.options);break;case"copy-texture-to-texture":a4(this.device,r.options);break;default:throw new Error(r.name)}}}function i4(n,e){const t=e.sourceBuffer,r=e.destinationBuffer;n.gl.bindBuffer(36662,t.handle),n.gl.bindBuffer(36663,r.handle),n.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),n.gl.bindBuffer(36662,null),n.gl.bindBuffer(36663,null)}function s4(n,e){throw new Error("Not implemented")}function o4(n,e){const{sourceTexture:t,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:l=e.sourceTexture.height,depthOrArrayLayers:c=0,origin:f=[0,0],destinationBuffer:h,byteOffset:p=0,bytesPerRow:_,rowsPerImage:y}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||c!==0||_||y)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:x}=d3(t);let S;try{const C=h,P=s||b.width,z=l||b.height,k=i3(b.colorAttachments[0].texture.props.format),V=k.format,Z=k.type;n.gl.bindBuffer(35051,C.handle),S=n.gl.bindFramebuffer(36160,b.handle),n.gl.readPixels(f[0],f[1],P,z,V,Z,p)}finally{n.gl.bindBuffer(35051,null),S!==void 0&&n.gl.bindFramebuffer(36160,S),x&&b.destroy()}}function a4(n,e){const{sourceTexture:t,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:l}=e;let{width:c=e.destinationTexture.width,height:f=e.destinationTexture.height}=e;const{framebuffer:h,destroyFramebuffer:p}=d3(t),[_,y]=i,[b,x,S]=s,C=n.gl.bindFramebuffer(36160,h.handle);let P=null,z;if(l instanceof Bo)P=l,c=Number.isFinite(c)?c:P.width,f=Number.isFinite(f)?f:P.height,P.bind(0),z=P.glTarget;else throw new Error("invalid destination");switch(z){case 3553:case 34067:n.gl.copyTexSubImage2D(z,r,b,x,_,y,c,f);break;case 35866:case 32879:n.gl.copyTexSubImage3D(z,r,b,x,S,_,y,c,f);break}P&&P.unbind(),n.gl.bindFramebuffer(36160,C),p&&h.destroy()}function d3(n){if(n instanceof ct){const{width:e,height:t,id:r}=n;return{framebuffer:n.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:t,colorAttachments:[n]}),destroyFramebuffer:!0}}return{framebuffer:n,destroyFramebuffer:!1}}class l4 extends Kh{constructor(t,r){super(t,r);w(this,"device");w(this,"commandBuffer");this.device=t,this.commandBuffer=new r4(t)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(t){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:t})}copyBufferToTexture(t){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:t})}copyTextureToBuffer(t){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:t})}copyTextureToTexture(t){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:t})}pushDebugGroup(t){}popDebugGroup(){}insertDebugMarker(t){}resolveQuerySet(t,r,i){}}function c4(n){const{target:e,source:t,start:r=0,count:i=1}=n,s=t.length,l=i*s;let c=0;for(let f=r;c<s;c++)e[f++]=t[c];for(;c<l;)c<l-c?(e.copyWithin(r+c,r,r+c),c*=2):(e.copyWithin(r+c,r,r+l-c),c=l);return n.target}class lp extends Zh{constructor(t,r){super(t,r);w(this,"device");w(this,"handle");w(this,"buffer",null);w(this,"bufferValue",null);this.device=t,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(t){return bT()==="Chrome"}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(t){const r=t;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(t,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:l,stride:c,offset:f,normalized:h,integer:p,divisor:_}=this._getAccessor(t);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),p?this.device.gl.vertexAttribIPointer(t,s,l,c,f):this.device.gl.vertexAttribPointer(t,s,l,h,c,f),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(t),this.device.gl.vertexAttribDivisor(t,_||0),this.attributes[t]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(t,r){this._enable(t,!1),this.attributes[t]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let t=0;t<this.maxVertexAttributes;++t){const r=this.attributes[t];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(t,r)}}_getAccessor(t){const r=this.attributeInfos[t];if(!r)throw new Error(`Unknown attribute location ${t}`);const i=r3(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(t,r=!0){const s=lp.isConstantAttributeZeroSupported(this.device)||t!==0;(r||s)&&(t=Number(t),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(t):this.device.gl.disableVertexAttribArray(t),this.device.gl.bindVertexArray(null))}getConstantBuffer(t,r){const i=u4(r),s=i.byteLength*t,l=i.length*t;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let c=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),c=c||!f4(i,this.bufferValue),c){const f=aA(r.constructor,l);c4({target:f,source:i,start:0,count:l}),this.buffer.write(f),this.bufferValue=r}return this.buffer}}function u4(n){return Array.isArray(n)?new Float32Array(n):n}function f4(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}class h4 extends Qh{constructor(t,r){super(t,r);w(this,"device");w(this,"gl");w(this,"handle");w(this,"layout");w(this,"buffers",{});w(this,"unusedBuffers",{});w(this,"bindOnUse",!0);w(this,"_bound",!1);this.device=t,this.gl=t.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(t="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(e4(t))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(t){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in t)this.setBuffer(r,t[r])})}setBuffer(t,r){const i=this._getVaryingIndex(t),{buffer:s,byteLength:l,byteOffset:c}=this._getBufferRange(r);if(i<0){this.unusedBuffers[t]=s,oe.warn(`${this.id} unusedBuffers varying buffer ${t}`)();return}this.buffers[i]={buffer:s,byteLength:l,byteOffset:c},this.bindOnUse||this._bindBuffer(i,s,c,l)}getBuffer(t){if(r0(t))return this.buffers[t]||null;const r=this._getVaryingIndex(t);return r>=0?this.buffers[r]:null}bind(t=this.handle){if(typeof t!="function")return this.gl.bindTransformFeedback(36386,t),this;let r;return this._bound?r=t():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=t(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(t){if(t instanceof Lo)return{buffer:t,byteOffset:0,byteLength:t.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=t.buffer.byteLength}=t;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(t){if(r0(t))return Number(t);for(const r of this.layout.varyings)if(t===r.name)return r.location;return-1}_bindBuffers(){for(const t in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[t]);this._bindBuffer(Number(t),r,s,i)}}_unbindBuffers(){for(const t in this.buffers)this.gl.bindBufferBase(35982,Number(t),null)}_bindBuffer(t,r,i=0,s){const l=r&&r.handle;!l||s===void 0?this.gl.bindBufferBase(35982,t,l):this.gl.bindBufferRange(35982,t,l,i,s)}}function r0(n){return typeof n=="number"?Number.isInteger(n):/^\d+$/.test(n)}class d4 extends Jh{constructor(t,r){super(t,r);w(this,"device");w(this,"handle");w(this,"target",null);w(this,"_queryPending",!1);w(this,"_pollingPromise",null);if(this.device=t,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(t){return this._begin(t?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(t){this._queryPending||(this.target=t,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const t=this.device.gl.getQueryParameter(this.handle,34919);return t&&(this._queryPending=!1),t}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(t=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const l=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>t?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(l)};requestAnimationFrame(l)}),this._pollingPromise}}class bs extends Qr{constructor(t){super({...t,id:t.id||gM("webgl-device")});w(this,"type","webgl");w(this,"handle");w(this,"features");w(this,"limits");w(this,"info");w(this,"canvasContext");w(this,"lost");w(this,"_resolveContextLost");w(this,"gl");w(this,"debug",!1);w(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});w(this,"_extensions",{});w(this,"_polyfilled",!1);w(this,"spectorJS");w(this,"renderPass",null);w(this,"_constants");const r=Qr._getCanvasContextProps(t);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=r.canvas?.gl?.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new iM(this,r),this.lost=new Promise(_=>{this._resolveContextLost=_});const s={...t.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),t.powerPreference!==void 0&&(s.powerPreference=t.powerPreference);const c=this.props._handle||Bk(this.canvasContext.canvas,{onContextLost:_=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:_=>console.log("WebGL context restored")},s);if(!c)throw new Error("WebGL context creation failed");if(i=c.device,i){if(t._reuseDevices)return oe.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=c,this.gl=c,this.spectorJS=aM({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=Uk(this.gl,this._extensions),this.limits=new tM(this.gl),this.features=new eM(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new xi(this.gl,{log:(..._)=>oe.log(1,..._)()}).trackState(this.gl,{copyState:!1});const h=t.debugWebGL||t.debug,p=t.debugWebGL;h&&(this.gl=uM(this.gl,{debugWebGL:h,traceWebGL:p}),oe.warn("WebGL debug mode activated. Performance reduced.")(),t.debugWebGL&&(oe.level=Math.max(oe.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(t){throw new Error("WebGL only supports a single canvas")}createBuffer(t){const r=this._normalizeBufferProps(t);return new Lo(this,r)}createTexture(t){return new Bo(this,t)}createExternalTexture(t){throw new Error("createExternalTexture() not implemented")}createSampler(t){return new vd(this,t)}createShader(t){return new vM(this,t)}createFramebuffer(t){return new Fo(this,t)}createVertexArray(t){return new lp(this,t)}createTransformFeedback(t){return new h4(this,t)}createQuerySet(t){return new d4(this,t)}createRenderPipeline(t){return new t4(this,t)}beginRenderPass(t){return new BM(this,t)}createComputePipeline(t){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(t){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(t={}){return new l4(this,t)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(t,r){return OM(t,r)}readPixelsToBufferWebGL(t,r){return NM(t,r)}setParametersWebGL(t){Fs(this.gl,t)}getParametersWebGL(t){return t3(this.gl,t)}withParametersWebGL(t,r){return fc(this.gl,t,r)}resetWebGL(){oe.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),Ok(this.gl)}_getDeviceSpecificTextureFormatCapabilities(t){return Zk(this.gl,t,this._extensions)}loseDevice(){let t=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(t=!0,i.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){xi.get(this.gl).push()}popState(){xi.get(this.gl).pop()}setSpectorMetadata(t,r){t.__SPECTOR_Metadata=r}getGLKey(t,r){const i=Number(t);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r?.emptyIfUnknown?"":String(t)}getGLKeys(t){const r={emptyIfUnknown:!0};return Object.entries(t).reduce((i,[s,l])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${l}:${this.getGLKey(l,r)}`,i),{})}setConstantAttributeWebGL(t,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[t];switch(s&&m4(s,r)&&oe.info(1,`setConstantAttributeWebGL(${t}) could have been skipped, value unchanged`)(),this._constants[t]=r,r.constructor){case Float32Array:p4(this,t,r);break;case Int32Array:g4(this,t,r);break;case Uint32Array:_4(this,t,r);break;default:throw new Error("constant")}}getExtension(t){return Os(this.gl,t,this._extensions),this._extensions}}function p4(n,e,t){switch(t.length){case 1:n.gl.vertexAttrib1fv(e,t);break;case 2:n.gl.vertexAttrib2fv(e,t);break;case 3:n.gl.vertexAttrib3fv(e,t);break;case 4:n.gl.vertexAttrib4fv(e,t);break}}function g4(n,e,t){n.gl.vertexAttribI4iv(e,t)}function _4(n,e,t){n.gl.vertexAttribI4uiv(e,t)}function m4(n,e){if(!n||!e||n.length!==e.length||n.constructor!==e.constructor)return!1;for(let t=0;t<n.length;++t)if(n[t]!==e[t])return!1;return!0}const y4={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},v4=n=>({drawBuffersWEBGL(e){return n.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),b4=n=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return n.createVertexArray()},deleteVertexArrayOES(e){return n.deleteVertexArray(e)},isVertexArrayOES(e){return n.isVertexArray(e)},bindVertexArrayOES(e){return n.bindVertexArray(e)}}),w4=n=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return n.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return n.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return n.vertexAttribDivisor(...e)}});function T4(n=!0){const e=HTMLCanvasElement.prototype;if(!n&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(t,r){if(t==="webgl"||t==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&x4(i),i}return this.originalGetContext(t,r)}}function x4(n){n.getExtension("EXT_color_buffer_float");const e={...y4,WEBGL_disjoint_timer_query:n.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:v4(n),OES_vertex_array_object:b4(n),ANGLE_instanced_arrays:w4(n)},t=n.getExtension;n.getExtension=function(i){const s=t.call(n,i);return s||(i in e?e[i]:null)};const r=n.getSupportedExtensions;n.getSupportedExtensions=function(){return(r.apply(n)||[])?.concat(Object.keys(e))}}const xl=1;class S4 extends LE{constructor(){super();w(this,"type","webgl");Qr.defaultProps={...Qr.defaultProps,...ap},bs.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(t){T4(t)}async attach(t){if(t instanceof bs)return t;if(t?.device instanceof Qr)return t.device;if(!E4(t))throw new Error("Invalid WebGL2RenderingContext");return new bs({_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1}})}async create(t={}){oe.groupCollapsed(xl,"WebGLDevice created")();const r=[];(t.debugWebGL||t.debug)&&r.push(cM()),t.debugSpectorJS&&r.push(oM(t));const i=await Promise.allSettled(r);for(const c of i)c.status==="rejected"&&oe.error(`Failed to initialize debug libraries ${c.reason}`)();const s=new bs(t),l=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return oe.probe(xl,l)(),oe.table(xl,s.info)(),oe.groupEnd(xl)(),s}}function E4(n){return typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext?!0:!!(n&&Number.isFinite(n._version))}const i0=new S4;function Wr(){}const A4=({isDragging:n})=>n?"grabbing":"grab",p3={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Wr,onWebGLInitialized:Wr,onResize:Wr,onViewStateChange:Wr,onInteractionStateChange:Wr,onBeforeRender:Wr,onAfterRender:Wr,onLoad:Wr,onError:n=>Je.error(n.message,n.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:A4,getTooltip:null,debug:!1,drawPickingColors:!1};class cp{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Oc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=ld[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const l=this.layerManager.getLayers(),c=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:l,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:f}=c,h=f&&(f[i]||f.props[i]),p=this.props[i];let _=!1;h&&(_=h.call(f,c,r)),_||(p?.(c,r),this.widgetManager.onEvent(c,r))},this._onPointerDown=r=>{if(this.device?.type==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...p3,...e},e=this.props,e.viewState&&e.initialViewState&&Je.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&Je.error("WebGL1 context not supported.")(),t=i0.attach(e.gl)),t||(t=Hh.createDevice({type:"best-available",_reuseDevices:!0,adapters:[i0],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&Ho.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&Je.removed("onLayerHover","onHover")(),"onLayerClick"in e&&Je.removed("onLayerClick","onClick")(),e.initialViewState&&!$n(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),l=this.deckRenderer.needsRedraw(e);return t=t||r||i||s||l,t}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});t=e||t,t&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return this.viewManager!==null}getViews(){return jt(this.viewManager),this.viewManager.views}getViewports(e){return jt(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(const t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,r){jt(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return typeof t=="string"&&(t=document.getElementById(t),jt(t)),t||(t=document.createElement("canvas"),t.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;const{width:t,height:r}=e;if(t||t===0){const i=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=i}if(r||r===0){const i=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=i}}_updateCanvasSize(){const{canvas:e}=this;if(!e)return;const t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.viewManager?.setProps({width:t,height:r}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){const{gl:r,onError:i,useDevicePixels:s}=t;return new xP({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:l=>this._setDevice(l.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Jb({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:t,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=r,s=!1;for(const l of t)i=l,s=l.layer?.onHover(l,e.event)||s;s||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const t=new Wb;t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new GC(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Ey).map(i=>{const[s,l,c,f]=Ey[i],h=this.props.eventRecognizerOptions?.[i],p={...l,...h,event:i};return{recognizer:new s(p),recognizeWith:c,requestFailure:f}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const i in ld)this.eventManager.on(i,this._onEvent);this.viewManager=new GP({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new JP(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new gk({deck:this,device:this.device}),this.deckRenderer=new yk(this.device),this.deckPicker=new Sk(this.device),this.widgetManager=new Rk({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new Ik),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),Je.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();const r=Hh.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}cp.defaultProps=p3;cp.VERSION=$S;function R4(n){switch(n){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return Kv(n)}}const C4=Yv;function Sl(n,e,t){const r=t==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:n,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function yi(n){return n.stride||n.size*n.bytesPerElement}function I4(n,e){return n.type===e.type&&n.size===e.size&&yi(n)===yi(e)&&(n.offset||0)===(e.offset||0)}function bd(n,e){e.offset&&Je.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const t=yi(n),r=e.vertexOffset!==void 0?e.vertexOffset:n.vertexOffset||0,i=e.elementOffset||0,s=r*t+i*n.bytesPerElement+(n.offset||0);return{...e,offset:s,stride:t}}function P4(n,e){const t=bd(n,e);return{high:t,low:{...t,offset:t.offset+n.size*4}}}class k4{constructor(e,t,r){this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const i=t.logicalType||t.type,s=i==="float64";let{defaultValue:l}=t;l=Number.isFinite(l)?[l]:l||new Array(this.size).fill(0);let c;s?c="float32":!i&&t.isIndexed?c="uint32":c=i||"float32";let f=R4(i||c);this.doublePrecision=s,s&&t.fp64===!1&&(f=Float32Array),this.value=null,this.settings={...t,defaultType:f,defaultValue:l,logicalType:i,type:c,normalized:c.includes("norm"),size:this.size,bytesPerElement:f.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*yi(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Ho.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){const r={};if(this.state.constant){const i=this.value;if(t){const s=bd(this.getAccessor(),t),l=s.offset/i.BYTES_PER_ELEMENT,c=s.size||this.size;r[e]=i.subarray(l,l+c)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:yi(r),attributes:i};if(this.doublePrecision){const l=P4(r,t||{});i.push(Sl(e,{...r,...l.high},this.device.type),Sl(`${e}64Low`,{...r,...l.low},this.device.type))}else if(t){const l=bd(r,t);i.push(Sl(e,{...r,...l},this.device.type))}else i.push(Sl(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const t=Array.from(this.value);e=[t,t]}else{const{value:t,numInstances:r,size:i}=this,s=r*i;if(t&&s&&t.length>=s){const l=new Array(i).fill(1/0),c=new Array(i).fill(-1/0);for(let f=0;f<s;)for(let h=0;h<i;h++){const p=t[f++];p<l[h]&&(l[h]=p),p>c[h]&&(c[h]=p)}e=[l,c]}}return this.state.bounds=e,e}setData(e){const{state:t}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof st?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const l=C4(r.value);i.type=i.normalized?l.replace("int","norm"):l}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=yi(i)}if(t.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!t.constant||!this._areValuesEqual(s,this.value)))return!1;t.externalBuffer=null,t.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;t.externalBuffer=s,t.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;t.externalBuffer=null,t.constant=!1,this.value=s;let{buffer:l}=this;const c=yi(i),f=(i.vertexOffset||0)*c;if(this.doublePrecision&&s instanceof Float64Array&&(s=bh(s,i)),this.settings.isIndexed){const p=this.settings.defaultType;s.constructor!==p&&(s=new p(s))}const h=s.byteLength+f+c*2;(!l||l.byteLength<h)&&(l=this._createBuffer(h)),l.write(s,f)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?bh(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){const{state:r}=this,i=r.allocatedValue,s=Ho.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;const{byteOffset:l}=this;let{buffer:c}=this;return(!c||c.byteLength<s.byteLength+l)&&(c=this._createBuffer(s.byteLength+l),t&&i&&c.write(i instanceof Float64Array?bh(i,this):i,l)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:t}=e;if(!ArrayBuffer.isView(t))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${t.constructor.name}`);!(t instanceof r)&&this.settings.normalized&&!("normalized"in e)&&Je.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(t=>(t+128)/255*2-1);case"snorm16":return new Float32Array(e).map(t=>(t+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(t=>t/255);case"unorm16":return new Float32Array(e).map(t=>t/65535);default:return e}}_normalizeValue(e,t,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let l=s;for(;--l>=0;)t[r+l]=i[l];return t}switch(s){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let l=s;for(;--l>=0;)t[r+l]=Number.isFinite(e[l])?e[l]:i[l]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();const{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?st.INDEX:st.VERTEX)|st.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}const s0=[],o0=[];function g3(n,e=0,t=1/0){let r=s0;const i={index:-1,data:n,target:[]};return n?typeof n[Symbol.iterator]=="function"?r=n:n.length>0&&(o0.length=n.length,r=o0):r=s0,(e>0||Number.isFinite(t))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,t),i.index=e-1),{iterable:r,objectInfo:i}}function _3(n){return n&&n[Symbol.asyncIterator]}function M4(n,e){const{size:t,stride:r,offset:i,startIndices:s,nested:l}=e,c=n.BYTES_PER_ELEMENT,f=r?r/c:t,h=i?i/c:0,p=Math.floor((n.length-h)/f);return(_,{index:y,target:b})=>{if(!s){const P=y*f+h;for(let z=0;z<t;z++)b[z]=n[P+z];return b}const x=s[y],S=s[y+1]||p;let C;if(l){C=new Array(S-x);for(let P=x;P<S;P++){const z=P*f+h;b=new Array(t);for(let k=0;k<t;k++)b[k]=n[z+k];C[P-x]=b}}else if(f===t)C=n.subarray(x*t+h,S*t+h);else{C=new n.constructor((S-x)*t);let P=0;for(let z=x;z<S;z++){const k=z*f+h;for(let V=0;V<t;V++)C[P++]=n[k+V]}}return C}}const O4=[],Ll=[[0,1/0]];function N4(n,e){if(n===Ll||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return n;const t=[],r=n.length;let i=0;for(let s=0;s<r;s++){const l=n[s];l[1]<e[0]?(t.push(l),i=s+1):l[0]>e[1]?t.push(l):e=[Math.min(l[0],e[0]),Math.max(l[1],e[1])]}return t.splice(i,0,e),t}const D4={interpolation:{duration:0,easing:n=>n},spring:{stiffness:.05,damping:.5}};function m3(n,e){if(!n)return null;Number.isFinite(n)&&(n={type:"interpolation",duration:n});const t=n.type||"interpolation";return{...D4[t],...e,...n,type:t}}class y3 extends k4{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Ll}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t;(t=this.state).layoutChanged||(t.layoutChanged=!I4(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:t}=this.settings,r=this.settings.transition,i=Array.isArray(t)?e[t.find(s=>e[s])]:e[t];return m3(i,r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){const{startRow:r=0,endRow:i=1/0}=t;this.state.updateRanges=N4(this.state.updateRanges,[r,i])}else this.state.updateRanges=Ll}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=O4}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:t,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,t.updateRanges!==Ll),!0):!1}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:l,noAlloc:c}}=this;let f=!0;if(l){for(const[h,p]of s)l.call(i,this,{data:t,startRow:h,endRow:p,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,p]of s){const _=Number.isFinite(h)?this.getVertexOffset(h):0,y=Number.isFinite(p)?this.getVertexOffset(p):c||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:y})}this._checkAttributeArray()}else f=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),f}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const l=e;jt(ArrayBuffer.isView(l.value),`invalid ${i.accessor}`);const c=!!l.size&&l.size!==this.size;return r.binaryAccessor=M4(l.value,{size:l.size||this.size,stride:l.stride,offset:l.offset,startIndices:t,nested:c}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(const r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;const t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!t)return r;for(const s in t){const l=super._getBufferLayout(s,t[s]);r.attributes.push(...l.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:s,numInstances:l}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:c,state:f,value:h,size:p,startIndices:_}=e,{accessor:y,transform:b}=c;let x=f.binaryAccessor||(typeof y=="function"?y:s[y]);typeof x!="function"&&(x=()=>x),jt(typeof x=="function",`accessor "${y}" is not a function`);let S=e.getVertexOffset(r);const{iterable:C,objectInfo:P}=g3(t,r,i);for(const z of C){P.index++;let k=x(z,P);if(b&&(k=b.call(this,k)),_){const V=(P.index<_.length-1?_[P.index+1]:l)-_[P.index];if(k&&Array.isArray(k[0])){let Z=S;for(const Y of k)e._normalizeValue(Y,h,Z),Z+=p}else k&&k.length>p?h.set(k,S):(e._normalizeValue(k,P.target,0),YP({target:h,source:P.target,start:S,count:V}));S+=V*p}else e._normalizeValue(k,h,S),S+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Ph(n){const{source:e,target:t,start:r=0,size:i,getData:s}=n,l=n.end||t.length,c=e.length,f=l-r;if(c>f){t.set(e.subarray(0,f),r);return}if(t.set(e,r),!s)return;let h=c;for(;h<f;){const p=s(h,e);for(let _=0;_<i;_++)t[r+h]=p[_]||0,h++}}function F4({source:n,target:e,size:t,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Ph({source:n,target:e,size:t,getData:r}),e;let l=0,c=0;const f=r&&((p,_)=>r(p+c,_)),h=Math.min(i.length,s.length);for(let p=1;p<h;p++){const _=i[p]*t,y=s[p]*t;Ph({source:n.subarray(l,_),target:e,start:c,end:y,size:t,getData:f}),l=_,c=y}return c<e.length&&Ph({source:[],target:e,start:c,size:t,getData:f}),e}function L4(n){const{device:e,settings:t,value:r}=n,i=new y3(e,t);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:t.normalized}),i}function v3(n){switch(n){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${n}"`)}}function b3(n){switch(n){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function w3(n){n.push(n.shift())}function B4(n,e){const{doublePrecision:t,settings:r,value:i,size:s}=n,l=t&&i instanceof Float64Array?2:1;let c=0;const{shaderAttributes:f}=n.settings;if(f)for(const h of Object.values(f))c=Math.max(c,h.vertexOffset??0);return(r.noAlloc?i.length:(e+c)*s)*l}function T3({device:n,source:e,target:t}){return(!t||t.byteLength<e.byteLength)&&(t?.destroy(),t=n.createBuffer({byteLength:e.byteLength,usage:e.usage})),t}function x3({device:n,buffer:e,attribute:t,fromLength:r,toLength:i,fromStartIndices:s,getData:l=c=>c}){const c=t.doublePrecision&&t.value instanceof Float64Array?2:1,f=t.size*c,h=t.byteOffset,p=t.settings.bytesPerElement<4?h/t.settings.bytesPerElement*4:h,_=t.startIndices,y=s&&_,b=t.isConstant;if(!y&&e&&r>=i)return e;const x=t.value instanceof Float64Array?Float32Array:t.value.constructor,S=b?t.value:new x(t.getBuffer().readSyncWebGL(h,i*x.BYTES_PER_ELEMENT).buffer);if(t.settings.normalized&&!b){const k=l;l=(V,Z)=>t.normalizeConstant(k(V,Z))}const C=b?(k,V)=>l(S,V):(k,V)=>l(S.subarray(k+h,k+h+f),V),P=e?new Float32Array(e.readSyncWebGL(p,r*4).buffer):new Float32Array(0),z=new Float32Array(i);return F4({source:P,target:z,sourceStartIndices:s,targetStartIndices:_,size:f,getData:C}),(!e||e.byteLength<z.byteLength+p)&&(e?.destroy(),e=n.createBuffer({byteLength:z.byteLength+p,usage:35050})),e.write(z,p),e}class S3{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Lc(r),this.attribute=t,this.attributeInTransition=L4(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=B4(this.attribute,t),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class U4 extends S3{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=j4(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:l}=this;w3(s),s[0]=x3({device:this.device,buffer:s[0],attribute:l,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=T3({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:c}=this,f=c.model;let h=Math.floor(this.currentLength/l.size);E3(l)&&(h/=2),f.setVertexCount(h),l.isConstant?(f.setAttributes({aFrom:s[0]}),f.setConstantAttributes({aTo:l.value})):f.setAttributes({aFrom:s[0],aTo:l.getBuffer()}),c.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:t}=this.settings,{time:r}=this.transition;let i=r/e;t&&(i=t(i));const{model:s}=this.transform,l={time:i};s.shaderInputs.setProps({interpolation:l}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const V4=`uniform interpolationUniforms {
  float time;
} interpolation;
`,a0={name:"interpolation",vs:V4,uniformTypes:{time:"f32"}},z4=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,$4=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function E3(n){return n.doublePrecision&&n.value instanceof Float64Array}function j4(n,e){const t=e.size,r=v3(t),i=b3(t),s=e.getBufferLayout();return E3(e)?new Xo(n,{vs:$4,bufferLayout:[{name:"aFrom",byteStride:8*t,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*t}]},{name:"aTo",byteStride:8*t,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*t}]}],modules:[jR,a0],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:t},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new Xo(n,{vs:z4,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[a0],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class W4 extends S3{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=Z4(e),this.framebuffer=Q4(e,this.texture),this.transform=q4(e,t)}start(e,t){const r=this.currentLength,i=this.currentStartIndices;super.start(e,t);const{buffers:s,attribute:l}=this;for(let f=0;f<2;f++)s[f]=x3({device:this.device,buffer:s[f],attribute:l,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=T3({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:c}=this.transform;c.setVertexCount(Math.floor(this.currentLength/l.size)),l.isConstant?c.setConstantAttributes({aTo:l.value}):c.setAttributes({aTo:l.getBuffer()})}onUpdate(){const{buffers:e,transform:t,framebuffer:r,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});const l={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:l}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),w3(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const H4=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,X4={name:"spring",vs:H4,uniformTypes:{damping:"f32",stiffness:"f32"}},Y4=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,K4=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function q4(n,e){const t=v3(e.size),r=b3(e.size);return new Xo(n,{vs:Y4,fs:K4,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[X4],defines:{ATTRIBUTE_TYPE:t},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function Z4(n){return n.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function Q4(n,e){return n.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const J4={interpolation:U4,spring:W4};class G4{constructor(e,{id:t,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],l=s.getTransitionSetting(t);l&&this._updateAttribute(i,s,l)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(t))&&this._removeTransition(i)}}hasAttribute(e){const t=this.transitions[e];return t&&t.inProgress}getAttributes(){const e={};for(const t in this.transitions){const r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const t in this.transitions)this.transitions[t].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const l=J4[r.type];l?this.transitions[e]=new l({attribute:t,timeline:this.timeline,device:this.device}):(Je.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const l0="attributeManager.invalidate",eO="attributeManager.updateStart",tO="attributeManager.updateEnd",nO="attribute.updateStart",rO="attribute.allocate",iO="attribute.updateEnd";class sO{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Jo(uP),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new G4(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const t of e)this.attributes[t]!==void 0&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){const r=this._invalidateTrigger(e,t);qt(l0,this,e,r)}invalidateAll(e){for(const t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);qt(l0,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:s={},buffers:l={},context:c={}}){let f=!1;qt(eO,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const p=this.attributes[h],_=p.settings.accessor;p.startIndices=r,p.numInstances=t,s[h]&&Je.removed(`props.${h}`,`data.attributes.${h}`)(),p.setExternalBuffer(l[h])||p.setBinaryValue(typeof _=="string"?l[_]:void 0,e.startIndices)||typeof _=="string"&&!l[_]&&p.setConstantValue(s[_])||p.needsUpdate()&&(f=!0,this._updateAttribute({attribute:p,numInstances:t,data:e,props:s,context:c})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}f&&qt(tO,this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const t=e.map(r=>this.attributes[r]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in t){const l=t[s];l.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=l)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...t};this.attributes[r]=new y3(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(l=>{const c=r[l];c&&c.setNeedsUpdate(c.id,t)}),s}_updateAttribute(e){const{attribute:t,numInstances:r}=e;if(qt(nO,t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&qt(rO,t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,qt(iO,t,r))}}class oO extends Lc{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:s}}=this,l=s(e/i);this._value=ic(t,r,l)}}const c0=1e-5;function u0(n,e,t,r,i){const s=e-n,c=(t-e)*i,f=-s*r;return c+f+s+e}function aO(n,e,t,r,i){if(Array.isArray(t)){const s=[];for(let l=0;l<t.length;l++)s[l]=u0(n[l],e[l],t[l],r,i);return s}return u0(n,e,t,r,i)}function f0(n,e){if(Array.isArray(n)){let t=0;for(let r=0;r<n.length;r++){const i=n[r]-e[r];t+=i*i}return Math.sqrt(t)}return Math.abs(n-e)}class lO extends Lc{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:l=e}=this;let c=aO(s,l,t,r,i);const f=f0(c,t),h=f0(c,l);f<c0&&h<c0&&(c=t,this.end()),this._prevValue=l,this._currValue=c}}const cO={interpolation:oO,spring:lO};class uO{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){const{transitions:s}=this;if(s.has(e)){const f=s.get(e),{value:h=f.settings.fromValue}=f;t=h,this.remove(e)}if(i=m3(i),!i)return;const l=cO[i.type];if(!l){Je.error(`unsupported transition type '${i.type}'`)();return}const c=new l(this.timeline);c.start({...i,fromValue:t,toValue:r}),s.set(e,c)}remove(e){const{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){const e={};for(const[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function fO(n){const e=n[Ti];for(const t in e){const r=e[t],{validate:i}=r;if(i&&!i(n[t],r))throw new Error(`Invalid prop ${t}: ${n[t]}`)}}function hO(n,e){const t=A3({newProps:n,oldProps:e,propTypes:n[Ti],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=pO(n,e);let i=!1;return r||(i=gO(n,e)),{dataChanged:r,propsChanged:t,updateTriggersChanged:i,extensionsChanged:_O(n,e),transitionsChanged:dO(n,e)}}function dO(n,e){if(!n.transitions)return!1;const t={},r=n[Ti];let i=!1;for(const s in n.transitions){const l=r[s],c=l&&l.type;(c==="number"||c==="color"||c==="array")&&wd(n[s],e[s],l)&&(t[s]=!0,i=!0)}return i?t:!1}function A3({newProps:n,oldProps:e,ignoreProps:t={},propTypes:r={},triggerName:i="props"}){if(e===n)return!1;if(typeof n!="object"||n===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(n))if(!(s in t)){if(!(s in e))return`${i}.${s} added`;const l=wd(n[s],e[s],r[s]);if(l)return`${i}.${s} ${l}`}for(const s of Object.keys(e))if(!(s in t)){if(!(s in n))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(n,s)){const l=wd(n[s],e[s],r[s]);if(l)return`${i}.${s} ${l}`}}return!1}function wd(n,e,t){let r=t&&t.equal;return r&&!r(n,e,t)||!r&&(r=n&&e&&n.equals,r&&!r.call(n,e))?"changed deeply":!r&&e!==n?"changed shallowly":null}function pO(n,e){if(e===null)return"oldProps is null, initial diff";let t=!1;const{dataComparator:r,_dataDiff:i}=n;return r?r(n.data,e.data)||(t="Data comparator detected a change"):n.data!==e.data&&(t="A new data container was supplied"),t&&i&&(t=i(n.data,e.data)||t),t}function gO(n,e){if(e===null)return{all:!0};if("all"in n.updateTriggers&&h0(n,e,"all"))return{all:!0};const t={};let r=!1;for(const i in n.updateTriggers)i!=="all"&&h0(n,e,i)&&(t[i]=!0,r=!0);return r?t:!1}function _O(n,e){if(e===null)return!0;const t=e.extensions,{extensions:r}=n;if(r===t)return!1;if(!t||!r||r.length!==t.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(t[i]))return!0;return!1}function h0(n,e,t){let r=n.updateTriggers[t];r=r??{};let i=e.updateTriggers[t];return i=i??{},A3({oldProps:i,newProps:r,triggerName:t})}const mO="count(): argument not an object",yO="count(): argument not a container";function vO(n){if(!wO(n))throw new Error(mO);if(typeof n.count=="function")return n.count();if(Number.isFinite(n.size))return n.size;if(Number.isFinite(n.length))return n.length;if(bO(n))return Object.keys(n).length;throw new Error(yO)}function bO(n){return n!==null&&typeof n=="object"&&n.constructor===Object}function wO(n){return n!==null&&typeof n=="object"}function d0(n,e){if(!e)return n;const t={...n,...e};if("defines"in e&&(t.defines={...n.defines,...e.defines}),"modules"in e&&(t.modules=(n.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=t.modules.findIndex(i=>i.name==="project32");r>=0&&t.modules.splice(r,1)}if("inject"in e)if(!n.inject)t.inject=e.inject;else{const r={...n.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];t.inject=r}return t}const TO={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},Td={};function xO(n,e,t,r){if(t instanceof ct)return t;t.constructor&&t.constructor.name!=="Object"&&(t={data:t});let i=null;t.compressed&&(i={minFilter:"linear",mipmapFilter:t.data.length>1?"nearest":"linear"});const s=e.createTexture({...t,sampler:{...TO,...i,...r},mipmaps:!0});return Td[s.id]=n,s}function SO(n,e){!e||!(e instanceof ct)||Td[e.id]===n&&(e.delete(),delete Td[e.id])}const EO={boolean:{validate(n,e){return!0},equal(n,e,t){return!!n==!!e}},number:{validate(n,e){return Number.isFinite(n)&&(!("max"in e)||n<=e.max)&&(!("min"in e)||n>=e.min)}},color:{validate(n,e){return e.optional&&!n||xd(n)&&(n.length===3||n.length===4)},equal(n,e,t){return $n(n,e,1)}},accessor:{validate(n,e){const t=hc(n);return t==="function"||t===hc(e.value)},equal(n,e,t){return typeof e=="function"?!0:$n(n,e,1)}},array:{validate(n,e){return e.optional&&!n||xd(n)},equal(n,e,t){const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?$n(n,e,i):n===e}},object:{equal(n,e,t){if(t.ignore)return!0;const{compare:r}=t,i=Number.isInteger(r)?r:r?1:0;return r?$n(n,e,i):n===e}},function:{validate(n,e){return e.optional&&!n||typeof n=="function"},equal(n,e,t){return!t.compare&&t.ignore!==!1||n===e}},data:{transform:(n,e,t)=>{if(!n)return n;const{dataTransform:r}=t.props;return r?r(n):typeof n.shape=="string"&&n.shape.endsWith("-table")&&Array.isArray(n.data)?n.data:n}},image:{transform:(n,e,t)=>{const r=t.context;return!r||!r.device?null:xO(t.id,r.device,n,{...e.parameters,...t.props.textureParameters})},release:(n,e,t)=>{SO(t.id,n)}}};function AO(n){const e={},t={},r={};for(const[i,s]of Object.entries(n)){const l=s?.deprecatedFor;if(l)r[i]=Array.isArray(l)?l:[l];else{const c=RO(i,s);e[i]=c,t[i]=c.value}}return{propTypes:e,defaultProps:t,deprecatedProps:r}}function RO(n,e){switch(hc(e)){case"object":return Ao(n,e);case"array":return Ao(n,{type:"array",value:e,compare:!1});case"boolean":return Ao(n,{type:"boolean",value:e});case"number":return Ao(n,{type:"number",value:e});case"function":return Ao(n,{type:"function",value:e,compare:!0});default:return{name:n,type:"unknown",value:e}}}function Ao(n,e){return"type"in e?{name:n,...EO[e.type],...e}:"value"in e?{name:n,type:hc(e.value),...e}:{name:n,type:"object",value:e}}function xd(n){return Array.isArray(n)||ArrayBuffer.isView(n)}function hc(n){return xd(n)?"array":n===null?"null":typeof n}function CO(n,e){let t;for(let s=e.length-1;s>=0;s--){const l=e[s];"extensions"in l&&(t=l.extensions)}const r=Sd(n.constructor,t),i=Object.create(r);i[uc]=n,i[Ii]={},i[Zr]={};for(let s=0;s<e.length;++s){const l=e[s];for(const c in l)i[c]=l[c]}return Object.freeze(i),i}const IO="_mergedDefaultProps";function Sd(n,e){if(!(n instanceof Bc.constructor))return{};let t=IO;if(e)for(const i of e){const s=i.constructor;s&&(t+=`:${s.extensionName||s.name}`)}const r=R3(n,t);return r||(n[t]=PO(n,e||[]))}function PO(n,e){if(!n.prototype)return null;const r=Object.getPrototypeOf(n),i=Sd(r),s=R3(n,"defaultProps")||{},l=AO(s),c=Object.assign(Object.create(null),i,l.defaultProps),f=Object.assign(Object.create(null),i?.[Ti],l.propTypes),h=Object.assign(Object.create(null),i?.[Eh],l.deprecatedProps);for(const p of e){const _=Sd(p.constructor);_&&(Object.assign(c,_),Object.assign(f,_[Ti]),Object.assign(h,_[Eh]))}return kO(c,n),OO(c,f),MO(c,h),c[Ti]=f,c[Eh]=h,e.length===0&&!up(n,"_propTypes")&&(n._propTypes=f),c}function kO(n,e){const t=DO(e);Object.defineProperties(n,{id:{writable:!0,value:t}})}function MO(n,e){for(const t in e)Object.defineProperty(n,t,{enumerable:!1,set(r){const i=`${this.id}: ${t}`;for(const s of e[t])up(this,s)||(this[s]=r);Je.deprecated(i,e[t].join("/"))()}})}function OO(n,e){const t={},r={};for(const i in e){const s=e[i],{name:l,value:c}=s;s.async&&(t[l]=c,r[l]=NO(l))}n[xs]=t,n[Ii]={},Object.defineProperties(n,r)}function NO(n){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||_3(e)?this[Ii][n]=e:this[Zr][n]=e},get(){if(this[Zr]){if(n in this[Zr])return this[Zr][n]||this[xs][n];if(n in this[Ii]){const e=this[uc]&&this[uc].internalState;if(e&&e.hasAsyncProp(n))return e.getAsyncProp(n)||this[xs][n]}}return this[xs][n]}}}function up(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function R3(n,e){return up(n,e)&&n[e]}function DO(n){const e=n.componentName;return e||Je.warn(`${n.name}.componentName not specified`)(),e||n.name}let FO=0;class Bc{constructor(...e){this.props=CO(this,e),this.id=this.props.id,this.count=FO++}clone(e){const{props:t}=this,r={};for(const i in t[xs])i in t[Zr]?r[i]=t[Zr][i]:i in t[Ii]&&(r[i]=t[Ii][i]);return new this.constructor({...t,...r,...e})}}Bc.componentName="Component";Bc.defaultProps={};const LO=Object.freeze({});class BO{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||LO}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){const t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(const t in this.asyncProps)if(this.isAsyncPropLoading(t))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[uc]||this.component;const t=e[Zr]||{},r=e[Ii]||e,i=e[xs]||{};for(const s in t){const l=t[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,l),t[s]=this.getAsyncProp(s)}for(const s in r){const l=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,l)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if(typeof t=="string"&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(_3(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,t){const r=this.asyncProps[e];return t===r.resolvedValue||t===r.lastValue?!1:(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(t=this._postProcessValue(r,t),r.resolvedValue=t,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&t!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;t.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,t){if(e!=="data"){this._setPropValue(e,t);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],l=0;for await(const c of t){if(!this.component)return;const{dataTransform:f}=this.component.props;f?s=f(c,s):s=s.concat(c),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:l,endRow:s.length}]}),l=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Ti];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class UO extends BO{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){const r=this.layer,i=r?.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){const r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}const VO="layer.changeFlag",zO="layer.initialize",$O="layer.update",jO="layer.finalize",WO="layer.matched",p0=2**24-1,HO=Object.freeze([]),XO=Jo(({oldViewport:n,viewport:e})=>n.equals(e));let Bn=new Uint8ClampedArray(0);const YO={data:{type:"data",value:HO,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:n=>n&&n.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(n,{propName:e,layer:t,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:l}=t.context;i=i||t.getLoadOptions(),r=r||t.props.loaders,s&&(i={...i,fetch:{...i?.fetch,signal:s}});let c=l.contains(n);return!c&&!i&&(l.add({resourceId:n,data:Bh(n,r),persistent:!1}),c=!0),c?l.subscribe({resourceId:n,onChange:f=>t.internalState?.reloadAsyncProp(e,f),consumerId:t.id,requestId:e}):Bh(n,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ze.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:n})=>[0,-n*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Ls extends Bc{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ps.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){jt(this.internalState);const t=this.internalState.viewport||this.context.viewport,r=jb(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,l]=Ub(r,t.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,l]}unproject(e){return jt(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){jt(this.internalState);const r=this.internalState.viewport||this.context.viewport;return _P(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ze.DEFAULT||e===ze.LNGLAT||e===ze.CARTESIAN}onHover(e,t){return this.props.onHover&&this.props.onHover(e,t)||!1}onClick(e,t){return this.props.onClick&&this.props.onClick(e,t)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){jt(e instanceof Uint8Array);const[t,r,i]=e;return t+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:vO(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){e=d0(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const t of this.props.extensions)e=d0(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t)if(Array.isArray(r))for(const i of r)t.invalidateAll(i);else t.invalidateAll();if(t){const{props:i}=e,s=this.internalState.hasPickingBuffer,l=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(c=>c.getNeedsPickingBuffer.call(this,c));if(s!==l){this.internalState.hasPickingBuffer=l;const{pickingColors:c,instancePickingColors:f}=t.attributes,h=c||f;h&&(l&&h.constant&&(h.constant=!1,t.invalidate(h.id)),!h.value&&!l&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=new Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;const t=this.internalState.viewport;this.internalState.viewport=e,(!t||!XO({oldViewport:t,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const t=this.getAttributeManager();t&&(e==="all"?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(const r in e)e[r].layoutChanged()&&(t=!0);for(const r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const t=e.update(),r=Object.create(this.props);for(const i in t)Object.defineProperty(r,i,{value:t[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;const r=Math.floor(Bn.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>p0&&Je.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Bn=Ho.allocate(Bn,t,{size:4,copy:!0,maxCount:Math.max(t,p0)});const i=Math.floor(Bn.length/4),s=[0,0,0];for(let l=r;l<i;l++)this.encodePickingColor(l,s),Bn[l*4+0]=s[0],Bn[l*4+1]=s[1],Bn[l*4+2]=s[2],Bn[l*4+3]=0}e.value=Bn.subarray(0,t*4)}_setModelAttributes(e,t,r=!1){if(!Object.keys(t).length)return;if(r){const c=this.getAttributeManager();e.setBufferLayout(c.getBufferLayouts(e)),t=c.getAttributes()}const i=e.userData?.excludeAttributes||{},s={},l={};for(const c in t){if(i[c])continue;const f=t[c].getValue();for(const h in f){const p=f[h];p instanceof st?t[c].settings.isIndexed?e.setIndexBuffer(p):s[h]=p:p&&(l[h]=p)}}e.setAttributes(s),e.setConstantAttributes(l)}disablePickingIndex(e){const t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,l=s&&t.attributes&&t.attributes[s.id];if(l&&l.value){const c=l.value,f=this.encodePickingColor(e);for(let h=0;h<t.length;h++){const p=s.getVertexOffset(h);c[p]===f[0]&&c[p+1]===f[1]&&c[p+2]===f[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;const s=i.getVertexOffset(e),l=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(l-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Bn.buffer&&(r.value=Bn.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){jt(!this.internalState),jt(Number.isFinite(this.props.coordinateSystem)),qt(zO,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new UO({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(Je.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new uO(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const t of this.props.extensions)t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){qt(WO,this,this===e);const{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(qt($O,this,e),!e)return;const t=this.props,r=this.context,i=this.internalState,s=r.viewport,l=this._updateUniformTransition();i.propsInTransition=l,r.viewport=i.viewport||s,this.props=l;try{const c=this._getUpdateParams(),f=this.getModels();if(r.device)this.updateState(c);else try{this.updateState(c)}catch{}for(const p of this.props.extensions)p.updateState.call(this,c,p);this.setNeedsRedraw(),this._updateAttributes();const h=this.getModels()[0]!==f[0];this._postUpdate(c,h)}finally{r.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){qt(jO,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,l=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);const{getPolygonOffset:c}=this.props,f=c&&c(r)||[0,0];l.device instanceof bs&&l.device.setParametersWebGL({polygonOffset:f});for(const h of this.getModels())h.device.type==="webgpu"?h.setParameters({...h.parameters,...i}):h.setParameters(i);if(l.device instanceof bs)l.device.withParametersWebGL(i,()=>{const h={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:l};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)});else{const h={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:l};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:t}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const l=e[i],c=t[i];l&&Array.isArray(c)&&(t.dataChanged=Array.isArray(l)?c.concat(l):l,s=!0);default:t[i]||(t[i]=e[i],s=!0)}s&&qt(VO,this,i,e)}const r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){const r=hO(e,t);if(r.updateTriggersChanged)for(const i in r.updateTriggersChanged)r.updateTriggersChanged[i]&&this.invalidateAttribute(i);if(r.transitionsChanged)for(const i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(r)}validateProps(){fO(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new sO(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){const{props:r,oldProps:i}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:l,highlightedObjectIndex:c,highlightColor:f}=r;if(t||i.autoHighlight!==l||i.highlightedObjectIndex!==c||i.highlightColor!==f){const h={};Array.isArray(f)&&(h.highlightColor=f),(t||i.autoHighlight!==l||c!==i.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(c)&&c>=0?this.encodePickingColor(c):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=t||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(t=t||i,t)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Ls.defaultProps=YO;Ls.layerName="Layer";const KO=typeof window<"u"?ue.useLayoutEffect:ue.useEffect;function dc(n,e){for(;n;){if(n===e)return!0;n=Object.getPrototypeOf(n)}return!1}const qO={position:"absolute",zIndex:-1};function C3(n,e){if(typeof n=="function")return n(e);if(Array.isArray(n))return n.map(t=>C3(t,e));if(Uc(n)){if(ZO(n))return e.style=qO,ue.cloneElement(n,e);if(QO(n))return ue.cloneElement(n,e)}return n}function Uc(n){return n&&typeof n=="object"&&"type"in n||!1}function ZO(n){return n.props?.mapStyle}function QO(n){const e=n.type;return e&&e.deckGLViewProps}function Ed(n){if(typeof n=="function")return ue.createElement(Ms,{},n);if(Array.isArray(n))return n.map(Ed);if(Uc(n)){if(n.type===ue.Fragment)return Ed(n.props.children);if(dc(n.type,Ms))return n}return n}function JO({children:n,layers:e=[],views:t=null}){const r=[],i=[],s={};return ue.Children.forEach(Ed(n),l=>{if(Uc(l)){const c=l.type;if(dc(c,Ls)){const f=GO(c,l.props);i.push(f)}else r.push(l);if(dc(c,Ms)&&c!==Ms&&l.props.id){const f=new c(l.props);s[f.id]=f}}else l&&r.push(l)}),Object.keys(s).length>0&&(Array.isArray(t)?t.forEach(l=>{s[l.id]=l}):t&&(s[t.id]=t),t=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:t}}function GO(n,e){const t={},r=n.defaultProps||{};for(const i in e)r[i]!==e[i]&&(t[i]=e[i]);return new n(t)}const eN=ue.createContext();function tN({children:n,deck:e,ContextProvider:t=eN.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const l of n){let c=s,f=l;Uc(l)&&dc(l.type,Ms)&&(c=l.props.id||s,f=l.props.children);const h=r.getViewport(c),p=r.getViewState(c);if(h){p.padding=h.padding;const{x:_,y,width:b,height:x}=h;f=C3(f,{x:_,y,width:b,height:x,viewport:h,viewState:p}),i[c]||(i[c]={viewport:h,children:[]}),i[c].children.push(f)}}return Object.keys(i).map(l=>{const{viewport:c,children:f}=i[l],{x:h,y:p,width:_,height:y}=c,b={position:"absolute",left:h,top:p,width:_,height:y},x=`view-${l}`,S=ue.createElement("div",{key:x,id:x,style:b},...f),C={deck:e,viewport:c,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:z=>{z.viewId=l,e._onViewStateChange(z)},widgets:[]},P=`view-${l}-context`;return ue.createElement(t,{key:P,value:C},S)})}const nN={mixBlendMode:null};function rN({width:n,height:e,style:t}){const r={position:"absolute",zIndex:0,left:0,top:0,width:n,height:e},i={left:0,top:0};if(t)for(const s in t)s in nN?i[s]=t[s]:r[s]=t[s];return{containerStyle:r,canvasStyle:i}}function iN(n){return{get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}}function I3(n){n.redrawReason&&(n.deck._drawLayers(n.redrawReason),n.redrawReason=null)}function sN(n,e,t){const r=new e({...t,_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:i=>{n.redrawReason=i;const s=r.getViewports();n.lastRenderedViewports!==s?n.forceUpdate():I3(n)}});return r}function oN(n,e){const[t,r]=ue.useState(0),s=ue.useRef({control:null,version:t,forceUpdate:()=>r(Z=>Z+1)}).current,l=ue.useRef(null),c=ue.useRef(null),f=ue.useMemo(()=>JO(n),[n.layers,n.views,n.children]);let h=!0;const p=Z=>h&&n.viewState?(s.viewStateUpdateRequested=Z,null):(s.viewStateUpdateRequested=null,n.onViewStateChange?.(Z)),_=Z=>{h?s.interactionStateUpdateRequested=Z:(s.interactionStateUpdateRequested=null,n.onInteractionStateChange?.(Z))},y=ue.useMemo(()=>{const Z={widgets:[],...n,style:null,width:"100%",height:"100%",parent:l.current,canvas:c.current,layers:f.layers,views:f.views,onViewStateChange:p,onInteractionStateChange:_};return delete Z._customRender,s.deck&&s.deck.setProps(Z),Z},[n]);ue.useEffect(()=>{const Z=n.Deck||cp;return s.deck=sN(s,Z,{...y,parent:l.current,canvas:c.current}),()=>s.deck?.finalize()},[]),KO(()=>{I3(s);const{viewStateUpdateRequested:Z,interactionStateUpdateRequested:Y}=s;Z&&p(Z),Y&&_(Y)}),ue.useImperativeHandle(e,()=>iN(s),[]);const b=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:x,width:S="100%",height:C="100%",id:P,style:z}=n,{containerStyle:k,canvasStyle:V}=ue.useMemo(()=>rN({width:S,height:C,style:z}),[S,C,z]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===b||s.version!==t){s.lastRenderedViewports=b,s.version=t;const Z=tN({children:f.children,deck:s.deck,ContextProvider:x}),Y=ue.createElement("canvas",{key:"canvas",id:P||"deckgl-overlay",ref:c,style:V});s.control=ue.createElement("div",{id:`${P||"deckgl"}-wrapper`,ref:l,style:k},[Y,Z])}return h=!1,s.control}const aN=ue.forwardRef(oN),lN="modulepreload",cN=function(n){return"/pypsa-eur-map-viewer/"+n},g0={},uN=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let f=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=l?.nonce||l?.getAttribute("nonce");i=f(t.map(h=>{if(h=cN(h),h in g0)return;g0[h]=!0;const p=h.endsWith(".css"),_=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${_}`))return;const y=document.createElement("link");if(y.rel=p?"stylesheet":lN,p||(y.as="script"),y.crossOrigin="",y.href=h,c&&y.setAttribute("nonce",c),document.head.appendChild(y),p)return new Promise((b,x)=>{y.addEventListener("load",b),y.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function s(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return i.then(l=>{for(const c of l||[])c.status==="rejected"&&s(c.reason);return e().catch(s)})},fN=ue.createContext(null);function hN(n,e){const t=Array.isArray(n)?n[0]:n?n.x:0,r=Array.isArray(n)?n[1]:n?n.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return t===i&&r===s}function Gn(n,e){if(n===e)return!0;if(!n||!e)return!1;if(Array.isArray(n)){if(!Array.isArray(e)||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Gn(n[t],e[t]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof n=="object"&&typeof e=="object"){const t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(const i of t)if(!e.hasOwnProperty(i)||!Gn(n[i],e[i]))return!1;return!0}return!1}function _0(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function m0(n,e){const t=e.viewState||e,r={};if("longitude"in t&&"latitude"in t&&(t.longitude!==n.center.lng||t.latitude!==n.center.lat)){const i=n.center.constructor;r.center=new i(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==n.zoom&&(r.zoom=t.zoom),"bearing"in t&&t.bearing!==n.bearing&&(r.bearing=t.bearing),"pitch"in t&&t.pitch!==n.pitch&&(r.pitch=t.pitch),t.padding&&n.padding&&!Gn(t.padding,n.padding)&&(r.padding=t.padding),r}const dN=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function y0(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const e={};for(const r of n.layers)e[r.id]=r;const t=n.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const l of dN)l in s&&(i[l]=s[l])}return i||r});return{...n,layers:t}}const v0={version:8,sources:{},layers:[]},b0={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},w0={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},T0={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},pN=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],gN=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Ns{constructor(e,t,r){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=i=>{const s=this.props[T0[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onCameraEvent=i=>{if(this._internalUpdate)return;i.viewState=this._propsedCameraUpdate||_0(this._map.transform);const s=this.props[w0[i.type]];s&&s(i)},this._onCameraUpdate=i=>this._internalUpdate?i:(this._propsedCameraUpdate=_0(i),m0(i,this.props)),this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[b0[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._MapClass=e,this.props=t,this._initialize(r)}get map(){return this._map}setProps(e){const t=this.props;this.props=e;const r=this._updateSettings(e,t),i=this._updateSize(e),s=this._updateViewState(e);this._updateStyle(e,t),this._updateStyleComponents(e),this._updateHandlers(e,t),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,t){const r=Ns.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(t.className=s.className;s.childNodes.length>0;)t.appendChild(s.childNodes[0]);i._container=t;const l=i._resizeObserver;l&&(l.disconnect(),l.observe(t)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:c}=e;return c&&(c.bounds?i.fitBounds(c.bounds,{...c.fitBoundsOptions,duration:0}):r._updateViewState(c)),i.isStyleLoaded()?i.fire("load"):i.once("style.load",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:t}=this,{mapStyle:r=v0}=t,i={...t,...t.initialViewState,container:e,style:y0(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),t.gl){const c=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=c,t.gl)}const l=new this._MapClass(i);s.padding&&l.setPadding(s.padding),t.cursor&&(l.getCanvas().style.cursor=t.cursor),l.transformCameraUpdate=this._onCameraUpdate,l.on("style.load",()=>{this._styleComponents={light:l.getLight(),sky:l.getSky(),projection:l.getProjection?.(),terrain:l.getTerrain()},this._updateStyleComponents(this.props)}),l.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const c in b0)l.on(c,this._onPointerEvent);for(const c in w0)l.on(c,this._onCameraEvent);for(const c in T0)l.on(c,this._onEvent);this._map=l}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),Ns.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_updateSize(e){const{viewState:t}=e;if(t){const r=this._map;if(t.width!==r.transform.width||t.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e){const t=this._map,r=t.transform;if(!t.isMoving()){const s=m0(r,e);if(Object.keys(s).length>0)return this._internalUpdate=!0,t.jumpTo(s),this._internalUpdate=!1,!0}return!1}_updateSettings(e,t){const r=this._map;let i=!1;for(const s of pN)s in e&&!Gn(e[s],t[s])&&(i=!0,r[`set${s[0].toUpperCase()}${s.slice(1)}`]?.call(r,e[s]));return i}_updateStyle(e,t){if(e.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==t.mapStyle){const{mapStyle:r=v0,styleDiffing:i=!0}=e,s={diff:i};"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(y0(r),s)}}_updateStyleComponents({light:e,projection:t,sky:r,terrain:i}){const s=this._map,l=this._styleComponents;s.style._loaded&&(e&&!Gn(e,l.light)&&(l.light=e,s.setLight(e)),t&&!Gn(t,l.projection)&&t!==l.projection?.type&&(l.projection=typeof t=="string"?{type:t}:t,s.setProjection?.(l.projection)),r&&!Gn(r,l.sky)&&(l.sky=r,s.setSky(r)),i!==void 0&&!Gn(i,l.terrain)&&(!i||s.getSource(i.source))&&(l.terrain=i,s.setTerrain(i)))}_updateHandlers(e,t){const r=this._map;for(const i of gN){const s=e[i]??!0,l=t[i]??!0;Gn(s,l)||(s?r[i].enable(s):r[i].disable())}}_queryRenderedFeatures(e){const t=this._map,{interactiveLayerIds:r=[]}=this.props;try{return t.queryRenderedFeatures(e,{layers:r.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(e){const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const i=e.type,s=this._hoveredFeatures?.length>0,l=this._queryRenderedFeatures(e.point),c=l.length>0;!c&&s&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=l,c&&!s&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=i}else this._hoveredFeatures=null}}Ns.savedMaps=[];const _N=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function mN(n){if(!n)return null;const e=n.map,t={getMap:()=>e};for(const r of yN(e))!(r in t)&&!_N.includes(r)&&(t[r]=e[r].bind(e));return t}function yN(n){const e=new Set;let t=n;for(;t;){for(const r of Object.getOwnPropertyNames(t))r[0]!=="_"&&typeof n[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);t=Object.getPrototypeOf(t)}return Array.from(e)}const vN=typeof document<"u"?ue.useLayoutEffect:ue.useEffect;function bN(n,e){const{RTLTextPlugin:t,maxParallelImageRequests:r,workerCount:i,workerUrl:s}=e;if(t&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:l,lazy:c=!0}=typeof t=="string"?{pluginUrl:t}:t;n.setRTLTextPlugin(l,f=>{f&&console.error(f)},c)}r!==void 0&&n.setMaxParallelImageRequests(r),i!==void 0&&n.setWorkerCount(i),s!==void 0&&n.setWorkerUrl(s)}const Vc=ue.createContext(null);function wN(n,e){const t=ue.useContext(fN),[r,i]=ue.useState(null),s=ue.useRef(),{current:l}=ue.useRef({mapLib:null,map:null});ue.useEffect(()=>{const h=n.mapLib;let p=!0,_;return Promise.resolve(h||uN(()=>import("./maplibre-gl-CM-oVHyy.js").then(y=>y.m),[])).then(y=>{if(!p)return;if(!y)throw new Error("Invalid mapLib");const b="Map"in y?y:y.default;if(!b.Map)throw new Error("Invalid mapLib");bN(b,n),n.reuseMaps&&(_=Ns.reuse(n,s.current)),_||(_=new Ns(b.Map,n,s.current)),l.map=mN(_),l.mapLib=b,i(_),t?.onMapMount(l.map,n.id)}).catch(y=>{const{onError:b}=n;b?b({type:"error",target:null,originalEvent:null,error:y}):console.error(y)}),()=>{p=!1,_&&(t?.onMapUnmount(n.id),n.reuseMaps?_.recycle():_.destroy())}},[]),vN(()=>{r&&r.setProps(n)}),ue.useImperativeHandle(e,()=>l.map,[r]);const c=ue.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]),f={height:"100%"};return ue.createElement("div",{id:n.id,ref:s,style:c},r&&ue.createElement(Vc.Provider,{value:l},ue.createElement("div",{"mapboxgl-children":"",style:f},n.children)))}const TN=ue.forwardRef(wN);var P3=F0();const xN=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function yr(n,e){if(!n||!e)return;const t=n.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!xN.test(r)?t[r]=`${i}px`:t[r]=i}}function k3(n,e){if(n===e)return null;const t=x0(n),r=x0(e),i=[];for(const s of r)t.has(s)||i.push(s);for(const s of t)r.has(s)||i.push(s);return i.length===0?null:i}function x0(n){return new Set(n?n.trim().split(/\s+/):[])}ue.memo(ue.forwardRef((n,e)=>{const{map:t,mapLib:r}=ue.useContext(Vc),i=ue.useRef({props:n}),s=ue.useMemo(()=>{let P=!1;ue.Children.forEach(n.children,V=>{V&&(P=!0)});const z={...n,element:P?document.createElement("div"):void 0},k=new r.Marker(z);return k.setLngLat([n.longitude,n.latitude]),k.getElement().addEventListener("click",V=>{i.current.props.onClick?.({type:"click",target:k,originalEvent:V})}),k.on("dragstart",V=>{const Z=V;Z.lngLat=s.getLngLat(),i.current.props.onDragStart?.(Z)}),k.on("drag",V=>{const Z=V;Z.lngLat=s.getLngLat(),i.current.props.onDrag?.(Z)}),k.on("dragend",V=>{const Z=V;Z.lngLat=s.getLngLat(),i.current.props.onDragEnd?.(Z)}),k},[]);ue.useEffect(()=>(s.addTo(t.getMap()),()=>{s.remove()}),[]);const{longitude:l,latitude:c,offset:f,style:h,draggable:p=!1,popup:_=null,rotation:y=0,rotationAlignment:b="auto",pitchAlignment:x="auto"}=n;ue.useEffect(()=>{yr(s.getElement(),h)},[h]),ue.useImperativeHandle(e,()=>s,[]);const S=i.current.props;(s.getLngLat().lng!==l||s.getLngLat().lat!==c)&&s.setLngLat([l,c]),f&&!hN(s.getOffset(),f)&&s.setOffset(f),s.isDraggable()!==p&&s.setDraggable(p),s.getRotation()!==y&&s.setRotation(y),s.getRotationAlignment()!==b&&s.setRotationAlignment(b),s.getPitchAlignment()!==x&&s.setPitchAlignment(x),s.getPopup()!==_&&s.setPopup(_);const C=k3(S.className,n.className);if(C)for(const P of C)s.toggleClassName(P);return i.current.props=n,P3.createPortal(n.children,s.getElement())}));ue.memo(ue.forwardRef((n,e)=>{const{map:t,mapLib:r}=ue.useContext(Vc),i=ue.useMemo(()=>document.createElement("div"),[]),s=ue.useRef({props:n}),l=ue.useMemo(()=>{const c={...n},f=new r.Popup(c);return f.setLngLat([n.longitude,n.latitude]),f.once("open",h=>{s.current.props.onOpen?.(h)}),f},[]);if(ue.useEffect(()=>{const c=f=>{s.current.props.onClose?.(f)};return l.on("close",c),l.setDOMContent(i).addTo(t.getMap()),()=>{l.off("close",c),l.isOpen()&&l.remove()}},[]),ue.useEffect(()=>{yr(l.getElement(),n.style)},[n.style]),ue.useImperativeHandle(e,()=>l,[]),l.isOpen()){const c=s.current.props;(l.getLngLat().lng!==n.longitude||l.getLngLat().lat!==n.latitude)&&l.setLngLat([n.longitude,n.latitude]),n.offset&&!Gn(c.offset,n.offset)&&l.setOffset(n.offset),(c.anchor!==n.anchor||c.maxWidth!==n.maxWidth)&&(l.options.anchor=n.anchor,l.setMaxWidth(n.maxWidth));const f=k3(c.className,n.className);if(f)for(const h of f)l.toggleClassName(h);s.current.props=n}return P3.createPortal(n.children,i)}));function Ni(n,e,t,r){const i=ue.useContext(Vc),s=ue.useMemo(()=>n(i),[]);return ue.useEffect(()=>{const l=e,c=null,f=typeof e=="function"?e:null,{map:h}=i;return h.hasControl(s)||(h.addControl(s,l?.position),c&&c(i)),()=>{f&&f(i),h.hasControl(s)&&h.removeControl(s)}},[]),s}function SN(n){const e=Ni(({mapLib:t})=>new t.AttributionControl(n),{position:n.position});return ue.useEffect(()=>{yr(e._container,n.style)},[n.style]),null}ue.memo(SN);function EN(n){const e=Ni(({mapLib:t})=>new t.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return ue.useEffect(()=>{yr(e._controlContainer,n.style)},[n.style]),null}ue.memo(EN);function AN(n,e){const t=ue.useRef({props:n}),r=Ni(({mapLib:i})=>{const s=new i.GeolocateControl(n),l=s._setupUI;return s._setupUI=()=>{s._container.hasChildNodes()||l()},s.on("geolocate",c=>{t.current.props.onGeolocate?.(c)}),s.on("error",c=>{t.current.props.onError?.(c)}),s.on("outofmaxbounds",c=>{t.current.props.onOutOfMaxBounds?.(c)}),s.on("trackuserlocationstart",c=>{t.current.props.onTrackUserLocationStart?.(c)}),s.on("trackuserlocationend",c=>{t.current.props.onTrackUserLocationEnd?.(c)}),s},{position:n.position});return t.current.props=n,ue.useImperativeHandle(e,()=>r,[]),ue.useEffect(()=>{yr(r._container,n.style)},[n.style]),null}ue.memo(ue.forwardRef(AN));function RN(n){const e=Ni(({mapLib:t})=>new t.NavigationControl(n),{position:n.position});return ue.useEffect(()=>{yr(e._container,n.style)},[n.style]),null}ue.memo(RN);function CN(n){const e=Ni(({mapLib:s})=>new s.ScaleControl(n),{position:n.position}),t=ue.useRef(n),r=t.current;t.current=n;const{style:i}=n;return n.maxWidth!==void 0&&n.maxWidth!==r.maxWidth&&(e.options.maxWidth=n.maxWidth),n.unit!==void 0&&n.unit!==r.unit&&e.setUnit(n.unit),ue.useEffect(()=>{yr(e._container,i)},[i]),null}ue.memo(CN);function IN(n){const e=Ni(({mapLib:t})=>new t.TerrainControl(n),{position:n.position});return ue.useEffect(()=>{yr(e._container,n.style)},[n.style]),null}ue.memo(IN);function PN(n){const e=Ni(({mapLib:t})=>new t.LogoControl(n),{position:n.position});return ue.useEffect(()=>{yr(e._container,n.style)},[n.style]),null}ue.memo(PN);const kN=`struct LineUniforms {
  widthScale: f32,
  widthMinPixels: f32,
  widthMaxPixels: f32,
  useShortestPath: f32,
  widthUnits: i32,
};

@group(0) @binding(1)
var<uniform> line: LineUniforms;
`,S0=`uniform lineUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float useShortestPath;
  highp int widthUnits;
} line;
`,MN={name:"line",source:kN,vs:S0,fs:S0,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",useShortestPath:"f32",widthUnits:"i32"}},ON=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)
struct LayerUniforms {
  opacity: f32,
};
var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// ---------- Helper Structures & Functions ----------

// Placeholder filter functions.
fn deckgl_filter_size(offset: vec3<f32>, geometry: Geometry) -> vec3<f32> {
  return offset;
}
fn deckgl_filter_gl_position(p: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return p;
}
fn deckgl_filter_color(color: vec4<f32>, geometry: Geometry) -> vec4<f32> {
  return color;
}

// Compute an extrusion offset given a line direction (in clipspace),
// an offset direction (-1 or 1), and a width in pixels.
// Assumes a uniform "project" with a viewportSize field is available.
fn getExtrusionOffset(line_clipspace: vec2<f32>, offset_direction: f32, width: f32) -> vec2<f32> {
  // project.viewportSize should be provided as a uniform (not shown here)
  let dir_screenspace = normalize(line_clipspace * project.viewportSize);
  // Rotate by 90: (x,y) becomes (-y,x)
  let rotated = vec2<f32>(-dir_screenspace.y, dir_screenspace.x);
  return rotated * offset_direction * width / 2.0;
}

// Splits the line between two points at a given x coordinate.
// Interpolates the y and z components.
fn splitLine(a: vec3<f32>, b: vec3<f32>, x: f32) -> vec3<f32> {
  let t: f32 = (x - a.x) / (b.x - a.x);
  return vec3<f32>(x, a.yz + t * (b.yz - a.yz));
}

// ---------- Uniforms & Global Structures ----------

// Uniforms for line, layer, and project are assumed to be defined elsewhere.
// For example:
//
// @group(0) @binding(0)
// var<uniform> line: LineUniform;
//
// struct LayerUniform {
//   opacity: f32,
// };
// @group(0) @binding(1)
// var<uniform> layer: LayerUniform;
//
// struct ProjectUniform {
//   viewportSize: vec2<f32>,
// };
// @group(0) @binding(2)
// var<uniform> project: ProjectUniform;



// ---------- Vertex Output Structure ----------

struct Varyings {
  @builtin(position) gl_Position: vec4<f32>,
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>,
};

// ---------- Vertex Shader Entry Point ----------

@vertex
fn vertexMain(
  @location(0) positions: vec3<f32>,
  @location(1) instanceSourcePositions: vec3<f32>,
  @location(2) instanceTargetPositions: vec3<f32>,
  @location(3) instanceSourcePositions64Low: vec3<f32>,
  @location(4) instanceTargetPositions64Low: vec3<f32>,
  @location(5) instanceColors: vec4<f32>,
  @location(6) instancePickingColors: vec3<f32>,
  @location(7) instanceWidths: f32
) -> Varyings {
  var geometry: Geometry;
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  var source_world: vec3<f32> = instanceSourcePositions;
  var target_world: vec3<f32> = instanceTargetPositions;
  var source_world_64low: vec3<f32> = instanceSourcePositions64Low;
  var target_world_64low: vec3<f32> = instanceTargetPositions64Low;

  // Apply shortest-path adjustments if needed.
  if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
    source_world.x = (source_world.x + 180.0 % 360.0) - 180.0;
    target_world.x = (target_world.x + 180.0 % 360.0) - 180.0;
    let deltaLng: f32 = target_world.x - source_world.x;

    if (deltaLng * line.useShortestPath > 180.0) {
      source_world.x = source_world.x + 360.0 * line.useShortestPath;
      source_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      source_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (deltaLng * line.useShortestPath < -180.0) {
      target_world.x = target_world.x + 360.0 * line.useShortestPath;
      target_world = splitLine(source_world, target_world, 180.0 * line.useShortestPath);
      target_world_64low = vec3<f32>(0.0, 0.0, 0.0);
    } else if (line.useShortestPath < 0.0) {
      var abortOut: Varyings;
      abortOut.gl_Position = vec4<f32>(0.0);
      abortOut.vColor = vec4<f32>(0.0);
      abortOut.uv = vec2<f32>(0.0);
      return abortOut;
    }
  }

  // Project Pos and target positions to clip space.
  let sourceResult = project_position_to_clipspace_and_commonspace(source_world, source_world_64low, vec3<f32>(0.0));
  let targetResult = project_position_to_clipspace_and_commonspace(target_world, target_world_64low, vec3<f32>(0.0));
  let sourcePos: vec4<f32> = sourceResult.clipPosition;
  let targetPos: vec4<f32> = targetResult.clipPosition;
  let source_commonspace: vec4<f32> = sourceResult.commonPosition;
  let target_commonspace: vec4<f32> = targetResult.commonPosition;

  // Interpolate along the line segment.
  let segmentIndex: f32 = positions.x;
  let p: vec4<f32> = sourcePos + segmentIndex * (targetPos - sourcePos);
  geometry.position = source_commonspace + segmentIndex * (target_commonspace - source_commonspace);
  let uv: vec2<f32> = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  // Determine width in pixels.
  let widthPixels: f32 = clamp(
    project_unit_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
    line.widthMinPixels, line.widthMaxPixels
  );

  // Compute extrusion offset.
  let extrusion: vec2<f32> = getExtrusionOffset(targetPos.xy - sourcePos.xy, positions.y, widthPixels);
  let offset: vec3<f32> = vec3<f32>(extrusion, 0.0);

  // Apply deck.gl filter functions.
  let filteredOffset = deckgl_filter_size(offset, geometry);
  let filteredP = deckgl_filter_gl_position(p, geometry);

  let clipOffset: vec2<f32> = project_pixel_size_to_clipspace(filteredOffset.xy);
  let finalPosition: vec4<f32> = filteredP + vec4<f32>(clipOffset, 0.0, 0.0);

  // Compute color.
  var vColor: vec4<f32> = vec4<f32>(instanceColors.rgb, instanceColors.a * layer.opacity);
  // vColor = deckgl_filter_color(vColor, geometry);

  var output: Varyings;
  output.gl_Position = finalPosition;
  output.vColor = vColor;
  output.uv = uv;
  return output;
}

@fragment
fn fragmentMain(
  @location(0) vColor: vec4<f32>,
  @location(1) uv: vec2<f32>
) -> @location(0) vec4<f32> {
  // Create and initialize geometry with the provided uv.
  var geometry: Geometry;
  geometry.uv = uv;

  // Start with the input color.
  var fragColor: vec4<f32> = vColor;

  // Apply the deck.gl filter to the color.
  fragColor = deckgl_filter_color(fragColor, geometry);

  return fragColor;
}
`,NN=`#version 300 es
#define SHADER_NAME line-layer-vertex-shader
in vec3 positions;
in vec3 instanceSourcePositions;
in vec3 instanceTargetPositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in float instanceWidths;
out vec4 vColor;
out vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
vec3 splitLine(vec3 a, vec3 b, float x) {
float t = (x - a.x) / (b.x - a.x);
return vec3(x, mix(a.yz, b.yz, t));
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
vec3 source_world_64low = instanceSourcePositions64Low;
vec3 target_world_64low = instanceTargetPositions64Low;
if (line.useShortestPath > 0.5 || line.useShortestPath < -0.5) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng * line.useShortestPath > 180.) {
source_world.x += 360. * line.useShortestPath;
source_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
source_world_64low = vec3(0.0);
} else if (deltaLng * line.useShortestPath < -180.) {
target_world.x += 360. * line.useShortestPath;
target_world = splitLine(source_world, target_world, 180. * line.useShortestPath);
target_world_64low = vec3(0.0);
} else if (line.useShortestPath < 0.) {
gl_Position = vec4(0.);
return;
}
}
vec4 source_commonspace;
vec4 target_commonspace;
vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
float segmentIndex = positions.x;
vec4 p = mix(source, target, segmentIndex);
geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
uv = positions.xy;
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * line.widthScale, line.widthUnits),
line.widthMinPixels, line.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(p, geometry);
gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,DN=`#version 300 es
#define SHADER_NAME line-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,FN=[0,0,0,255],LN={getSourcePosition:{type:"accessor",value:n=>n.sourcePosition},getTargetPosition:{type:"accessor",value:n=>n.targetPosition},getColor:{type:"accessor",value:FN},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class pc extends Ls{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:NN,fs:DN,source:ON,modules:[Gd,np,MN]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{widthUnits:t,widthScale:r,widthMinPixels:i,widthMaxPixels:s,wrapLongitude:l}=this.props,c=this.state.model,f={widthUnits:Ri[t],widthScale:r,widthMinPixels:i,widthMaxPixels:s,useShortestPath:l?1:0};c.shaderInputs.setProps({line:f}),c.draw(this.context.renderPass),l&&(c.shaderInputs.setProps({line:{...f,useShortestPath:-1}}),c.draw(this.context.renderPass))}_getModel(){const e=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new Ci(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new wi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}pc.layerName="LineLayer";pc.defaultProps=LN;const E0=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,BN={name:"scatterplot",vs:E0,fs:E0,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},UN=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,VN=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,zN=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,A0=[0,0,0,255],$N={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:n=>n.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:A0},getLineColor:{type:"accessor",value:A0},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class fp extends Ls{getShaders(){return super.getShaders({vs:UN,fs:VN,source:zN,modules:[Gd,np,BN]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:t,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:l,filled:c,billboard:f,antialiasing:h,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b}=this.props,x={stroked:l,filled:c,billboard:f,antialiasing:h,radiusUnits:Ri[t],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:Ri[p],lineWidthScale:_,lineWidthMinPixels:y,lineWidthMaxPixels:b},S=this.state.model;S.shaderInputs.setProps({scatterplot:x}),S.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Ci(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new wi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}fp.defaultProps=$N;fp.layerName="ScatterplotLayer";const kh=Math.PI/180,El=new Float32Array(16),R0=new Float32Array(12);function C0(n,e,t){const r=e[0]*kh,i=e[1]*kh,s=e[2]*kh,l=Math.sin(s),c=Math.sin(r),f=Math.sin(i),h=Math.cos(s),p=Math.cos(r),_=Math.cos(i),y=t[0],b=t[1],x=t[2];n[0]=y*_*p,n[1]=y*f*p,n[2]=y*-c,n[3]=b*(-f*h+_*c*l),n[4]=b*(_*h+f*c*l),n[5]=b*p*l,n[6]=x*(f*l+_*c*h),n[7]=x*(-_*l+f*c*h),n[8]=x*p*h}function I0(n){return n[0]=n[0],n[1]=n[1],n[2]=n[2],n[3]=n[4],n[4]=n[5],n[5]=n[6],n[6]=n[8],n[7]=n[9],n[8]=n[10],n[9]=n[12],n[10]=n[13],n[11]=n[14],n.subarray(0,12)}const jN={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(n,{startRow:e,endRow:t}){const{data:r,getOrientation:i,getScale:s,getTranslation:l,getTransformMatrix:c}=this.props,f=Array.isArray(c),h=f&&c.length===16,p=Array.isArray(s),_=Array.isArray(i),y=Array.isArray(l),b=h||!f&&!!c(r[0]);b?n.constant=h:n.constant=_&&p&&y;const x=n.value;if(n.constant){let S;b?(El.set(c),S=I0(El)):(S=R0,C0(S,i,s),S.set(l,9)),n.value=new Float32Array(S)}else{let S=e*n.size;const{iterable:C,objectInfo:P}=g3(r,e,t);for(const z of C){P.index++;let k;if(b)El.set(h?c:c(z,P)),k=I0(El);else{k=R0;const V=_?i:i(z,P),Z=p?s:s(z,P);C0(k,V,Z),k.set(y?l:l(z,P),9)}x[S++]=k[0],x[S++]=k[1],x[S++]=k[2],x[S++]=k[3],x[S++]=k[4],x[S++]=k[5],x[S++]=k[6],x[S++]=k[7],x[S++]=k[8],x[S++]=k[9],x[S++]=k[10],x[S++]=k[11]}}}};function WN(n,e){return e===ze.CARTESIAN||e===ze.METER_OFFSETS||e===ze.DEFAULT&&!n.isGeospatial}const P0=`uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,HN={name:"simpleMesh",vs:P0,fs:P0,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},XN=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,YN=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function Mh(n){const e=n.positions||n.POSITION;Je.assert(e,'no "postions" or "POSITION" attribute in mesh');const t=e.value.length/e.size;let r=n.COLOR_0||n.colors;r||(r={size:3,value:new Float32Array(t*3).fill(1)});let i=n.NORMAL||n.normals;i||(i={size:3,value:new Float32Array(t*3).fill(0)});let s=n.TEXCOORD_0||n.texCoords;return s||(s={size:2,value:new Float32Array(t*2).fill(0)}),{positions:e,colors:r,normals:i,texCoords:s}}function k0(n){return n instanceof wi?(n.attributes=Mh(n.attributes),n):n.attributes?new wi({...n,topology:"triangle-list",attributes:Mh(n.attributes)}):new wi({topology:"triangle-list",attributes:Mh(n)})}const KN=[0,0,0,255],qN={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:n=>n.position},getColor:{type:"accessor",value:KN},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}};class gc extends Ls{getShaders(){return super.getShaders({vs:XN,fs:YN,modules:[Gd,Sb,np,HN]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;const{mesh:t}=this.props;if(!t)return null;if(e=t.header?.boundingBox,!e){const{attributes:r}=k0(t);r.POSITION=r.POSITION||r.positions,e=rS(r)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:jN}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);const{props:t,oldProps:r,changeFlags:i}=e;if(t.mesh!==r.mesh||i.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);const s=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(s.NORMAL||s.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&t.texture instanceof ct&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){const{model:t}=this.state;if(!t)return;const{viewport:r,renderPass:i}=this.context,{sizeScale:s,coordinateSystem:l,_instanced:c}=this.props,f={sizeScale:s,composeModelMatrix:!c||WN(r,l),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:f}),t.draw(i)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){const t=new Ci(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:k0(e),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:i}=this.state,s={sampler:r||i,hasTexture:!!r};return t.shaderInputs.setProps({simpleMesh:s}),t}setTexture(e){const{emptyTexture:t,model:r}=this.state;if(r){const i={sampler:e||t,hasTexture:!!e};r.shaderInputs.setProps({simpleMesh:i})}}}gc.defaultProps=qN;gc.layerName="SimpleMeshLayer";function ZN(n,e,t){if(!n)return[];const r=[],i=Oe.scale("viridis").domain([50,750]);return n.lines&&r.push(new pc({id:"ac-lines",data:n.lines.features.filter(s=>{const l=Number(s.properties.voltage_nom),c=!isNaN(l)&&l>=e[0]&&l<=e[1];return c||console.log("DEBUG line fuera de rango o voltage_nom invlido:",s.properties),c}),getSourcePosition:s=>new Float32Array(s.geometry.coordinates[0]),getTargetPosition:s=>new Float32Array(s.geometry.coordinates[s.geometry.coordinates.length-1]),getWidth:s=>Math.max(1,(s.properties.s_nom||1e3)/2e3),getColor:s=>i(Number(s.properties.voltage_nom)).rgb(),pickable:!0})),t&&n.links&&r.push(new pc({id:"hvdc",data:n.links.features,getSourcePosition:s=>new Float32Array(s.geometry.coordinates[0]),getTargetPosition:s=>new Float32Array(s.geometry.coordinates[s.geometry.coordinates.length-1]),getWidth:2.2,getColor:[0,255,255],pickable:!0})),n.buses&&r.push(new fp({id:"buses",data:n.buses.features,getPosition:s=>new Float32Array(s.geometry.coordinates),getRadius:1e3,getFillColor:[200,200,200],pickable:!0})),n.transformers&&r.push(new gc({id:"transformers",data:n.transformers.features,mesh:new zP,getPosition:s=>new Float32Array(s.geometry.coordinates[0]),getScale:s=>[1800,1800,3e3],getColor:s=>[255,128,0],getOrientation:()=>[0,0,90],pickable:!0})),n.converters&&r.push(new gc({id:"converters",data:n.converters.features,mesh:new $P,getPosition:s=>new Float32Array(s.geometry.coordinates[0]),getScale:s=>[4e3,4e3,4e3],getColor:s=>i(Number(s.properties.voltage)).rgb(),getOrientation:()=>[0,0,0],pickable:!0})),r}const M0=n=>{let e;const t=new Set,r=(h,p)=>{const _=typeof h=="function"?h(e):h;if(!Object.is(_,e)){const y=e;e=p??(typeof _!="object"||_===null)?_:Object.assign({},e,_),t.forEach(b=>b(e,y))}},i=()=>e,c={setState:r,getState:i,getInitialState:()=>f,subscribe:h=>(t.add(h),()=>t.delete(h))},f=e=n(r,i,c);return c},QN=n=>n?M0(n):M0,JN=n=>n;function GN(n,e=JN){const t=pm.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return pm.useDebugValue(t),t}const e6=n=>{const e=QN(n),t=r=>GN(e,r);return Object.assign(t,e),t},t6=n=>e6,O0={BASE_URL:"/pypsa-eur-map-viewer/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},Yo=new Map,Al=n=>{const e=Yo.get(n);return e?Object.fromEntries(Object.entries(e.stores).map(([t,r])=>[t,r.getState()])):{}},n6=(n,e,t)=>{if(n===void 0)return{type:"untracked",connection:e.connect(t)};const r=Yo.get(t.name);if(r)return{type:"tracked",store:n,...r};const i={connection:e.connect(t),stores:{}};return Yo.set(t.name,i),{type:"tracked",store:n,...i}},r6=(n,e)=>{if(e===void 0)return;const t=Yo.get(n);t&&(delete t.stores[e],Object.keys(t.stores).length===0&&Yo.delete(n))},i6=n=>{var e,t;if(!n)return;const r=n.split(`
`),i=r.findIndex(l=>l.includes("api.setState"));if(i<0)return;const s=((e=r[i+1])==null?void 0:e.trim())||"";return(t=/.+ (.+) .+/.exec(s))==null?void 0:t[1]},s6=(n,e={})=>(t,r,i)=>{const{enabled:s,anonymousActionType:l,store:c,...f}=e;let h;try{h=(s??(O0?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!h)return n(t,r,i);const{connection:p,..._}=n6(c,h,f);let y=!0;i.setState=(S,C,P)=>{const z=t(S,C);if(!y)return z;const k=P===void 0?{type:l||i6(new Error().stack)||"anonymous"}:typeof P=="string"?{type:P}:P;return c===void 0?(p?.send(k,r()),z):(p?.send({...k,type:`${c}/${k.type}`},{...Al(f.name),[c]:i.getState()}),z)},i.devtools={cleanup:()=>{p&&typeof p.unsubscribe=="function"&&p.unsubscribe(),r6(f.name,c)}};const b=(...S)=>{const C=y;y=!1,t(...S),y=C},x=n(i.setState,r,i);if(_.type==="untracked"?p?.init(x):(_.stores[_.store]=i,p?.init(Object.fromEntries(Object.entries(_.stores).map(([S,C])=>[S,S===_.store?x:C.getState()])))),i.dispatchFromDevtools&&typeof i.dispatch=="function"){let S=!1;const C=i.dispatch;i.dispatch=(...P)=>{(O0?"production":void 0)!=="production"&&P[0].type==="__setState"&&!S&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),S=!0),C(...P)}}return p.subscribe(S=>{var C;switch(S.type){case"ACTION":if(typeof S.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Oh(S.payload,P=>{if(P.type==="__setState"){if(c===void 0){b(P.state);return}Object.keys(P.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const z=P.state[c];if(z==null)return;JSON.stringify(i.getState())!==JSON.stringify(z)&&b(z);return}i.dispatchFromDevtools&&typeof i.dispatch=="function"&&i.dispatch(P)});case"DISPATCH":switch(S.payload.type){case"RESET":return b(x),c===void 0?p?.init(i.getState()):p?.init(Al(f.name));case"COMMIT":if(c===void 0){p?.init(i.getState());return}return p?.init(Al(f.name));case"ROLLBACK":return Oh(S.state,P=>{if(c===void 0){b(P),p?.init(i.getState());return}b(P[c]),p?.init(Al(f.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Oh(S.state,P=>{if(c===void 0){b(P);return}JSON.stringify(i.getState())!==JSON.stringify(P[c])&&b(P[c])});case"IMPORT_STATE":{const{nextLiftedState:P}=S.payload,z=(C=P.computedStates.slice(-1)[0])==null?void 0:C.state;if(!z)return;b(c===void 0?z:z[c]),p?.send(null,P);return}case"PAUSE_RECORDING":return y=!y}return}}),x},o6=s6,Oh=(n,e)=>{let t;try{t=JSON.parse(n)}catch(r){console.error("[zustand devtools middleware] Could not parse the received json",r)}t!==void 0&&e(t)},hp=t6()(o6(n=>({ready:!1,dataset:{},voltage:[50,750],showHVDC:!0,setDataset:e=>n({dataset:e,ready:!0}),setVoltage:e=>n({voltage:e}),setShowHVDC:e=>n({showHVDC:e}),setSelected:e=>n({selected:e})}),{name:"Network Store"})),a6=()=>{const{dataset:n,ready:e,voltage:t,showHVDC:r,selected:i,setSelected:s}=hp(),[l,c]=ue.useState({longitude:10,latitude:50,zoom:4,pitch:53,bearing:22,maxZoom:9,minZoom:3.5}),[f,h]=ue.useState([]);ue.useEffect(()=>{e&&h(ZN(n,t,r))},[n,t,r,e]);const p=({viewState:y})=>{console.log("ViewState changed:",y),c(y)},_=y=>{y&&y.object&&y.layer&&s(y.object)};return $t.jsx("div",{style:{height:"100%",width:"100%"},children:$t.jsx(aN,{initialViewState:l,controller:!0,layers:f,onViewStateChange:p,onClick:_,style:{width:"100%",height:"100%"},children:$t.jsx(TN,{mapStyle:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",reuseMaps:!0,renderWorldCopies:!1,interactive:!0,initialViewState:l})})})};var Bl={exports:{}};/* @license
Papa Parse
v5.5.3
https://github.com/mholt/PapaParse
License: MIT
*/var l6=Bl.exports,N0;function c6(){return N0||(N0=1,function(n,e){((t,r)=>{n.exports=r()})(l6,function t(){var r=typeof self<"u"?self:typeof window<"u"?window:r!==void 0?r:{},i,s=!r.document&&!!r.postMessage,l=r.IS_PAPA_WORKER||!1,c={},f=0,h={};function p(E){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(R){var N=Z(R);N.chunkSize=parseInt(N.chunkSize),R.step||R.chunk||(N.chunkSize=null),this._handle=new S(N),(this._handle.streamer=this)._config=N}.call(this,E),this.parseChunk=function(R,N){var j=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<j){let G=this._config.newline;G||(K=this._config.quoteChar||'"',G=this._handle.guessLineEndings(R,K)),R=[...R.split(G).slice(j)].join(G)}this.isFirstChunk&&L(this._config.beforeFirstChunk)&&(K=this._config.beforeFirstChunk(R))!==void 0&&(R=K),this.isFirstChunk=!1,this._halted=!1;var j=this._partialLine+R,K=(this._partialLine="",this._handle.parse(j,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(R=K.meta.cursor,j=(this._finished||(this._partialLine=j.substring(R-this._baseIndex),this._baseIndex=R),K&&K.data&&(this._rowCount+=K.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),l)r.postMessage({results:K,workerId:h.WORKER_ID,finished:j});else if(L(this._config.chunk)&&!N){if(this._config.chunk(K,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=K=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(K.data),this._completeResults.errors=this._completeResults.errors.concat(K.errors),this._completeResults.meta=K.meta),this._completed||!j||!L(this._config.complete)||K&&K.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),j||K&&K.meta.paused||this._nextChunk(),K}this._halted=!0},this._sendError=function(R){L(this._config.error)?this._config.error(R):l&&this._config.error&&r.postMessage({workerId:h.WORKER_ID,error:R,finished:!1})}}function _(E){var R;(E=E||{}).chunkSize||(E.chunkSize=h.RemoteChunkSize),p.call(this,E),this._nextChunk=s?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(N){this._input=N,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(R=new XMLHttpRequest,this._config.withCredentials&&(R.withCredentials=this._config.withCredentials),s||(R.onload=Y(this._chunkLoaded,this),R.onerror=Y(this._chunkError,this)),R.open(this._config.downloadRequestBody?"POST":"GET",this._input,!s),this._config.downloadRequestHeaders){var N,j=this._config.downloadRequestHeaders;for(N in j)R.setRequestHeader(N,j[N])}var K;this._config.chunkSize&&(K=this._start+this._config.chunkSize-1,R.setRequestHeader("Range","bytes="+this._start+"-"+K));try{R.send(this._config.downloadRequestBody)}catch(G){this._chunkError(G.message)}s&&R.status===0&&this._chunkError()}},this._chunkLoaded=function(){R.readyState===4&&(R.status<200||400<=R.status?this._chunkError():(this._start+=this._config.chunkSize||R.responseText.length,this._finished=!this._config.chunkSize||this._start>=(N=>(N=N.getResponseHeader("Content-Range"))!==null?parseInt(N.substring(N.lastIndexOf("/")+1)):-1)(R),this.parseChunk(R.responseText)))},this._chunkError=function(N){N=R.statusText||N,this._sendError(new Error(N))}}function y(E){(E=E||{}).chunkSize||(E.chunkSize=h.LocalChunkSize),p.call(this,E);var R,N,j=typeof FileReader<"u";this.stream=function(K){this._input=K,N=K.slice||K.webkitSlice||K.mozSlice,j?((R=new FileReader).onload=Y(this._chunkLoaded,this),R.onerror=Y(this._chunkError,this)):R=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var K=this._input,G=(this._config.chunkSize&&(G=Math.min(this._start+this._config.chunkSize,this._input.size),K=N.call(K,this._start,G)),R.readAsText(K,this._config.encoding));j||this._chunkLoaded({target:{result:G}})},this._chunkLoaded=function(K){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(K.target.result)},this._chunkError=function(){this._sendError(R.error)}}function b(E){var R;p.call(this,E=E||{}),this.stream=function(N){return R=N,this._nextChunk()},this._nextChunk=function(){var N,j;if(!this._finished)return N=this._config.chunkSize,R=N?(j=R.substring(0,N),R.substring(N)):(j=R,""),this._finished=!R,this.parseChunk(j)}}function x(E){p.call(this,E=E||{});var R=[],N=!0,j=!1;this.pause=function(){p.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){p.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(K){this._input=K,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){j&&R.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),R.length?this.parseChunk(R.shift()):N=!0},this._streamData=Y(function(K){try{R.push(typeof K=="string"?K:K.toString(this._config.encoding)),N&&(N=!1,this._checkIsFinished(),this.parseChunk(R.shift()))}catch(G){this._streamError(G)}},this),this._streamError=Y(function(K){this._streamCleanUp(),this._sendError(K)},this),this._streamEnd=Y(function(){this._streamCleanUp(),j=!0,this._streamData("")},this),this._streamCleanUp=Y(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function S(E){var R,N,j,K,G=Math.pow(2,53),fe=-G,Ce=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,De=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,de=this,ne=0,ie=0,ce=!1,M=!1,Q=[],re={data:[],errors:[],meta:{}};function be(_e){return E.skipEmptyLines==="greedy"?_e.join("").trim()==="":_e.length===1&&_e[0].length===0}function Te(){if(re&&j&&(Ne("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+h.DefaultDelimiter+"'"),j=!1),E.skipEmptyLines&&(re.data=re.data.filter(function(Re){return!be(Re)})),Ee()){let Re=function(et,rt){L(E.transformHeader)&&(et=E.transformHeader(et,rt)),Q.push(et)};if(re)if(Array.isArray(re.data[0])){for(var _e=0;Ee()&&_e<re.data.length;_e++)re.data[_e].forEach(Re);re.data.splice(0,1)}else re.data.forEach(Re)}function we(Re,et){for(var rt=E.header?{}:[],We=0;We<Re.length;We++){var Ye=We,Fe=Re[We],Fe=((Ht,Pe)=>(Qe=>(E.dynamicTypingFunction&&E.dynamicTyping[Qe]===void 0&&(E.dynamicTyping[Qe]=E.dynamicTypingFunction(Qe)),(E.dynamicTyping[Qe]||E.dynamicTyping)===!0))(Ht)?Pe==="true"||Pe==="TRUE"||Pe!=="false"&&Pe!=="FALSE"&&((Qe=>{if(Ce.test(Qe)&&(Qe=parseFloat(Qe),fe<Qe&&Qe<G))return 1})(Pe)?parseFloat(Pe):De.test(Pe)?new Date(Pe):Pe===""?null:Pe):Pe)(Ye=E.header?We>=Q.length?"__parsed_extra":Q[We]:Ye,Fe=E.transform?E.transform(Fe,Ye):Fe);Ye==="__parsed_extra"?(rt[Ye]=rt[Ye]||[],rt[Ye].push(Fe)):rt[Ye]=Fe}return E.header&&(We>Q.length?Ne("FieldMismatch","TooManyFields","Too many fields: expected "+Q.length+" fields but parsed "+We,ie+et):We<Q.length&&Ne("FieldMismatch","TooFewFields","Too few fields: expected "+Q.length+" fields but parsed "+We,ie+et)),rt}var Ve;re&&(E.header||E.dynamicTyping||E.transform)&&(Ve=1,!re.data.length||Array.isArray(re.data[0])?(re.data=re.data.map(we),Ve=re.data.length):re.data=we(re.data,0),E.header&&re.meta&&(re.meta.fields=Q),ie+=Ve)}function Ee(){return E.header&&Q.length===0}function Ne(_e,we,Ve,Re){_e={type:_e,code:we,message:Ve},Re!==void 0&&(_e.row=Re),re.errors.push(_e)}L(E.step)&&(K=E.step,E.step=function(_e){re=_e,Ee()?Te():(Te(),re.data.length!==0&&(ne+=_e.data.length,E.preview&&ne>E.preview?N.abort():(re.data=re.data[0],K(re,de))))}),this.parse=function(_e,we,Ve){var Re=E.quoteChar||'"',Re=(E.newline||(E.newline=this.guessLineEndings(_e,Re)),j=!1,E.delimiter?L(E.delimiter)&&(E.delimiter=E.delimiter(_e),re.meta.delimiter=E.delimiter):((Re=((et,rt,We,Ye,Fe)=>{var Ht,Pe,Qe,Zt;Fe=Fe||[",","	","|",";",h.RECORD_SEP,h.UNIT_SEP];for(var an=0;an<Fe.length;an++){for(var Qt,vr=Fe[an],wt=0,ln=0,dt=0,At=(Qe=void 0,new P({comments:Ye,delimiter:vr,newline:rt,preview:10}).parse(et)),Jt=0;Jt<At.data.length;Jt++)We&&be(At.data[Jt])?dt++:(Qt=At.data[Jt].length,ln+=Qt,Qe===void 0?Qe=Qt:0<Qt&&(wt+=Math.abs(Qt-Qe),Qe=Qt));0<At.data.length&&(ln/=At.data.length-dt),(Pe===void 0||wt<=Pe)&&(Zt===void 0||Zt<ln)&&1.99<ln&&(Pe=wt,Ht=vr,Zt=ln)}return{successful:!!(E.delimiter=Ht),bestDelimiter:Ht}})(_e,E.newline,E.skipEmptyLines,E.comments,E.delimitersToGuess)).successful?E.delimiter=Re.bestDelimiter:(j=!0,E.delimiter=h.DefaultDelimiter),re.meta.delimiter=E.delimiter),Z(E));return E.preview&&E.header&&Re.preview++,R=_e,N=new P(Re),re=N.parse(R,we,Ve),Te(),ce?{meta:{paused:!0}}:re||{meta:{paused:!1}}},this.paused=function(){return ce},this.pause=function(){ce=!0,N.abort(),R=L(E.chunk)?"":R.substring(N.getCharIndex())},this.resume=function(){de.streamer._halted?(ce=!1,de.streamer.parseChunk(R,!0)):setTimeout(de.resume,3)},this.aborted=function(){return M},this.abort=function(){M=!0,N.abort(),re.meta.aborted=!0,L(E.complete)&&E.complete(re),R=""},this.guessLineEndings=function(et,Re){et=et.substring(0,1048576);var Re=new RegExp(C(Re)+"([^]*?)"+C(Re),"gm"),Ve=(et=et.replace(Re,"")).split("\r"),Re=et.split(`
`),et=1<Re.length&&Re[0].length<Ve[0].length;if(Ve.length===1||et)return`
`;for(var rt=0,We=0;We<Ve.length;We++)Ve[We][0]===`
`&&rt++;return rt>=Ve.length/2?`\r
`:"\r"}}function C(E){return E.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function P(E){var R=(E=E||{}).delimiter,N=E.newline,j=E.comments,K=E.step,G=E.preview,fe=E.fastMode,Ce=null,De=!1,de=E.quoteChar==null?'"':E.quoteChar,ne=de;if(E.escapeChar!==void 0&&(ne=E.escapeChar),(typeof R!="string"||-1<h.BAD_DELIMITERS.indexOf(R))&&(R=","),j===R)throw new Error("Comment character same as delimiter");j===!0?j="#":(typeof j!="string"||-1<h.BAD_DELIMITERS.indexOf(j))&&(j=!1),N!==`
`&&N!=="\r"&&N!==`\r
`&&(N=`
`);var ie=0,ce=!1;this.parse=function(M,Q,re){if(typeof M!="string")throw new Error("Input must be a string");var be=M.length,Te=R.length,Ee=N.length,Ne=j.length,_e=L(K),we=[],Ve=[],Re=[],et=ie=0;if(!M)return wt();if(fe||fe!==!1&&M.indexOf(de)===-1){for(var rt=M.split(N),We=0;We<rt.length;We++){if(Re=rt[We],ie+=Re.length,We!==rt.length-1)ie+=N.length;else if(re)return wt();if(!j||Re.substring(0,Ne)!==j){if(_e){if(we=[],Zt(Re.split(R)),ln(),ce)return wt()}else Zt(Re.split(R));if(G&&G<=We)return we=we.slice(0,G),wt(!0)}}return wt()}for(var Ye=M.indexOf(R,ie),Fe=M.indexOf(N,ie),Ht=new RegExp(C(ne)+C(de),"g"),Pe=M.indexOf(de,ie);;)if(M[ie]===de)for(Pe=ie,ie++;;){if((Pe=M.indexOf(de,Pe+1))===-1)return re||Ve.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:we.length,index:ie}),Qt();if(Pe===be-1)return Qt(M.substring(ie,Pe).replace(Ht,de));if(de===ne&&M[Pe+1]===ne)Pe++;else if(de===ne||Pe===0||M[Pe-1]!==ne){Ye!==-1&&Ye<Pe+1&&(Ye=M.indexOf(R,Pe+1));var Qe=an((Fe=Fe!==-1&&Fe<Pe+1?M.indexOf(N,Pe+1):Fe)===-1?Ye:Math.min(Ye,Fe));if(M.substr(Pe+1+Qe,Te)===R){Re.push(M.substring(ie,Pe).replace(Ht,de)),M[ie=Pe+1+Qe+Te]!==de&&(Pe=M.indexOf(de,ie)),Ye=M.indexOf(R,ie),Fe=M.indexOf(N,ie);break}if(Qe=an(Fe),M.substring(Pe+1+Qe,Pe+1+Qe+Ee)===N){if(Re.push(M.substring(ie,Pe).replace(Ht,de)),vr(Pe+1+Qe+Ee),Ye=M.indexOf(R,ie),Pe=M.indexOf(de,ie),_e&&(ln(),ce))return wt();if(G&&we.length>=G)return wt(!0);break}Ve.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:we.length,index:ie}),Pe++}}else if(j&&Re.length===0&&M.substring(ie,ie+Ne)===j){if(Fe===-1)return wt();ie=Fe+Ee,Fe=M.indexOf(N,ie),Ye=M.indexOf(R,ie)}else if(Ye!==-1&&(Ye<Fe||Fe===-1))Re.push(M.substring(ie,Ye)),ie=Ye+Te,Ye=M.indexOf(R,ie);else{if(Fe===-1)break;if(Re.push(M.substring(ie,Fe)),vr(Fe+Ee),_e&&(ln(),ce))return wt();if(G&&we.length>=G)return wt(!0)}return Qt();function Zt(dt){we.push(dt),et=ie}function an(dt){var At=0;return At=dt!==-1&&(dt=M.substring(Pe+1,dt))&&dt.trim()===""?dt.length:At}function Qt(dt){return re||(dt===void 0&&(dt=M.substring(ie)),Re.push(dt),ie=be,Zt(Re),_e&&ln()),wt()}function vr(dt){ie=dt,Zt(Re),Re=[],Fe=M.indexOf(N,ie)}function wt(dt){if(E.header&&!Q&&we.length&&!De){var At=we[0],Jt=Object.create(null),Di=new Set(At);let br=!1;for(let mn=0;mn<At.length;mn++){let yn=At[mn];if(Jt[yn=L(E.transformHeader)?E.transformHeader(yn,mn):yn]){let wr,Bs=Jt[yn];for(;wr=yn+"_"+Bs,Bs++,Di.has(wr););Di.add(wr),At[mn]=wr,Jt[yn]++,br=!0,(Ce=Ce===null?{}:Ce)[wr]=yn}else Jt[yn]=1,At[mn]=yn;Di.add(yn)}br&&console.warn("Duplicate headers found and renamed."),De=!0}return{data:we,errors:Ve,meta:{delimiter:R,linebreak:N,aborted:ce,truncated:!!dt,cursor:et+(Q||0),renamedHeaders:Ce}}}function ln(){K(wt()),we=[],Ve=[]}},this.abort=function(){ce=!0},this.getCharIndex=function(){return ie}}function z(E){var R=E.data,N=c[R.workerId],j=!1;if(R.error)N.userError(R.error,R.file);else if(R.results&&R.results.data){var K={abort:function(){j=!0,k(R.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:V,resume:V};if(L(N.userStep)){for(var G=0;G<R.results.data.length&&(N.userStep({data:R.results.data[G],errors:R.results.errors,meta:R.results.meta},K),!j);G++);delete R.results}else L(N.userChunk)&&(N.userChunk(R.results,K,R.file),delete R.results)}R.finished&&!j&&k(R.workerId,R.results)}function k(E,R){var N=c[E];L(N.userComplete)&&N.userComplete(R),N.terminate(),delete c[E]}function V(){throw new Error("Not implemented.")}function Z(E){if(typeof E!="object"||E===null)return E;var R,N=Array.isArray(E)?[]:{};for(R in E)N[R]=Z(E[R]);return N}function Y(E,R){return function(){E.apply(R,arguments)}}function L(E){return typeof E=="function"}return h.parse=function(E,R){var N=(R=R||{}).dynamicTyping||!1;if(L(N)&&(R.dynamicTypingFunction=N,N={}),R.dynamicTyping=N,R.transform=!!L(R.transform)&&R.transform,!R.worker||!h.WORKERS_SUPPORTED)return N=null,h.NODE_STREAM_INPUT,typeof E=="string"?(E=(j=>j.charCodeAt(0)!==65279?j:j.slice(1))(E),N=new(R.download?_:b)(R)):E.readable===!0&&L(E.read)&&L(E.on)?N=new x(R):(r.File&&E instanceof File||E instanceof Object)&&(N=new y(R)),N.stream(E);(N=(()=>{var j;return!!h.WORKERS_SUPPORTED&&(j=(()=>{var K=r.URL||r.webkitURL||null,G=t.toString();return h.BLOB_URL||(h.BLOB_URL=K.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",G,")();"],{type:"text/javascript"})))})(),(j=new r.Worker(j)).onmessage=z,j.id=f++,c[j.id]=j)})()).userStep=R.step,N.userChunk=R.chunk,N.userComplete=R.complete,N.userError=R.error,R.step=L(R.step),R.chunk=L(R.chunk),R.complete=L(R.complete),R.error=L(R.error),delete R.worker,N.postMessage({input:E,config:R,workerId:N.id})},h.unparse=function(E,R){var N=!1,j=!0,K=",",G=`\r
`,fe='"',Ce=fe+fe,De=!1,de=null,ne=!1,ie=((()=>{if(typeof R=="object"){if(typeof R.delimiter!="string"||h.BAD_DELIMITERS.filter(function(Q){return R.delimiter.indexOf(Q)!==-1}).length||(K=R.delimiter),typeof R.quotes!="boolean"&&typeof R.quotes!="function"&&!Array.isArray(R.quotes)||(N=R.quotes),typeof R.skipEmptyLines!="boolean"&&typeof R.skipEmptyLines!="string"||(De=R.skipEmptyLines),typeof R.newline=="string"&&(G=R.newline),typeof R.quoteChar=="string"&&(fe=R.quoteChar),typeof R.header=="boolean"&&(j=R.header),Array.isArray(R.columns)){if(R.columns.length===0)throw new Error("Option columns is empty");de=R.columns}R.escapeChar!==void 0&&(Ce=R.escapeChar+fe),R.escapeFormulae instanceof RegExp?ne=R.escapeFormulae:typeof R.escapeFormulae=="boolean"&&R.escapeFormulae&&(ne=/^[=+\-@\t\r].*$/)}})(),new RegExp(C(fe),"g"));if(typeof E=="string"&&(E=JSON.parse(E)),Array.isArray(E)){if(!E.length||Array.isArray(E[0]))return ce(null,E,De);if(typeof E[0]=="object")return ce(de||Object.keys(E[0]),E,De)}else if(typeof E=="object")return typeof E.data=="string"&&(E.data=JSON.parse(E.data)),Array.isArray(E.data)&&(E.fields||(E.fields=E.meta&&E.meta.fields||de),E.fields||(E.fields=Array.isArray(E.data[0])?E.fields:typeof E.data[0]=="object"?Object.keys(E.data[0]):[]),Array.isArray(E.data[0])||typeof E.data[0]=="object"||(E.data=[E.data])),ce(E.fields||[],E.data||[],De);throw new Error("Unable to serialize unrecognized input");function ce(Q,re,be){var Te="",Ee=(typeof Q=="string"&&(Q=JSON.parse(Q)),typeof re=="string"&&(re=JSON.parse(re)),Array.isArray(Q)&&0<Q.length),Ne=!Array.isArray(re[0]);if(Ee&&j){for(var _e=0;_e<Q.length;_e++)0<_e&&(Te+=K),Te+=M(Q[_e],_e);0<re.length&&(Te+=G)}for(var we=0;we<re.length;we++){var Ve=(Ee?Q:re[we]).length,Re=!1,et=Ee?Object.keys(re[we]).length===0:re[we].length===0;if(be&&!Ee&&(Re=be==="greedy"?re[we].join("").trim()==="":re[we].length===1&&re[we][0].length===0),be==="greedy"&&Ee){for(var rt=[],We=0;We<Ve;We++){var Ye=Ne?Q[We]:We;rt.push(re[we][Ye])}Re=rt.join("").trim()===""}if(!Re){for(var Fe=0;Fe<Ve;Fe++){0<Fe&&!et&&(Te+=K);var Ht=Ee&&Ne?Q[Fe]:Fe;Te+=M(re[we][Ht],Fe)}we<re.length-1&&(!be||0<Ve&&!et)&&(Te+=G)}}return Te}function M(Q,re){var be,Te;return Q==null?"":Q.constructor===Date?JSON.stringify(Q).slice(1,25):(Te=!1,ne&&typeof Q=="string"&&ne.test(Q)&&(Q="'"+Q,Te=!0),be=Q.toString().replace(ie,Ce),(Te=Te||N===!0||typeof N=="function"&&N(Q,re)||Array.isArray(N)&&N[re]||((Ee,Ne)=>{for(var _e=0;_e<Ne.length;_e++)if(-1<Ee.indexOf(Ne[_e]))return!0;return!1})(be,h.BAD_DELIMITERS)||-1<be.indexOf(K)||be.charAt(0)===" "||be.charAt(be.length-1)===" ")?fe+be+fe:be)}},h.RECORD_SEP="",h.UNIT_SEP="",h.BYTE_ORDER_MARK="\uFEFF",h.BAD_DELIMITERS=["\r",`
`,'"',h.BYTE_ORDER_MARK],h.WORKERS_SUPPORTED=!s&&!!r.Worker,h.NODE_STREAM_INPUT=1,h.LocalChunkSize=10485760,h.RemoteChunkSize=5242880,h.DefaultDelimiter=",",h.Parser=P,h.ParserHandle=S,h.NetworkStreamer=_,h.FileStreamer=y,h.StringStreamer=b,h.ReadableStreamStreamer=x,r.jQuery&&((i=r.jQuery).fn.parse=function(E){var R=E.config||{},N=[];return this.each(function(G){if(!(i(this).prop("tagName").toUpperCase()==="INPUT"&&i(this).attr("type").toLowerCase()==="file"&&r.FileReader)||!this.files||this.files.length===0)return!0;for(var fe=0;fe<this.files.length;fe++)N.push({file:this.files[fe],inputElem:this,instanceConfig:i.extend({},R)})}),j(),this;function j(){if(N.length===0)L(E.complete)&&E.complete();else{var G,fe,Ce,De,de=N[0];if(L(E.before)){var ne=E.before(de.file,de.inputElem);if(typeof ne=="object"){if(ne.action==="abort")return G="AbortError",fe=de.file,Ce=de.inputElem,De=ne.reason,void(L(E.error)&&E.error({name:G},fe,Ce,De));if(ne.action==="skip")return void K();typeof ne.config=="object"&&(de.instanceConfig=i.extend(de.instanceConfig,ne.config))}else if(ne==="skip")return void K()}var ie=de.instanceConfig.complete;de.instanceConfig.complete=function(ce){L(ie)&&ie(ce,de.file,de.inputElem),K()},h.parse(de.file,de.instanceConfig)}}function K(){N.splice(0,1),j()}}),l&&(r.onmessage=function(E){E=E.data,h.WORKER_ID===void 0&&E&&(h.WORKER_ID=E.workerId),typeof E.input=="string"?r.postMessage({workerId:h.WORKER_ID,results:h.parse(E.input,E.config),finished:!0}):(r.File&&E.input instanceof File||E.input instanceof Object)&&(E=h.parse(E.input,E.config))&&r.postMessage({workerId:h.WORKER_ID,results:E,finished:!0})}),(_.prototype=Object.create(p.prototype)).constructor=_,(y.prototype=Object.create(p.prototype)).constructor=y,(b.prototype=Object.create(b.prototype)).constructor=b,(x.prototype=Object.create(p.prototype)).constructor=x,h})}(Bl)),Bl.exports}var u6=c6();const f6=Ad(u6),h6="/pypsa-eur-map-viewer/data/",D0={buses:"buses.csv",lines:"lines.csv",links:"links.csv",converters:"converters.csv",transformers:"transformers.csv"};function Rl(n){if(!n)return[];n=n.trim().replace(/^'+|'+$/g,"");const e=n.match(/\(([\s\S]*)\)/);if(!e)return console.log("DEBUG parseWKT: no match para parntesis en",n),[];const t=e[1];return n.startsWith("POINT")?t.split(" ").map(Number):n.startsWith("LINESTRING")?t.split(",").map(r=>r.trim().split(" ").map(Number)):[]}function d6(){const n=hp(e=>e.setDataset);ue.useEffect(()=>{(async()=>{const e={};for(const r in D0){const s=await(await fetch(h6+D0[r])).text();e[r]=f6.parse(s,{header:!0,dynamicTyping:!0}).data}const t={};t.buses={type:"FeatureCollection",features:e.buses.filter(r=>r.x&&r.y).map(r=>({type:"Feature",geometry:{type:"Point",coordinates:[r.x,r.y]},properties:{bus_id:r.bus_id,voltage:Number(r.voltage),dc:r.dc==="t",symbol:r.symbol,under_construction:r.under_construction==="t",tags:r.tags,x:Number(r.x),y:Number(r.y),country:r.country,geometry:r.geometry}}))},t.lines={type:"FeatureCollection",features:e.lines.map((r,i)=>{let s=(r.geometry||"").trim();return{type:"Feature",geometry:{type:"LineString",coordinates:Rl(s)},properties:{id:r.line_id,voltage_nom:Number(r.voltage),length:r.length,s_nom:r.s_nom,description:r.type||"",...r}}})},t.links={type:"FeatureCollection",features:e.links.map(r=>({type:"Feature",geometry:{type:"LineString",coordinates:Rl(r.geometry||"")},properties:{id:r.name,p_nom:r.p_nom,efficiency:r.efficiency}}))},t.transformers={type:"FeatureCollection",features:e.transformers.map(r=>({type:"Feature",geometry:{type:"LineString",coordinates:Rl(r.geometry||"")},properties:{transformer_id:r.transformer_id,bus0:r.bus0,bus1:r.bus1,voltage_bus0:Number(r.voltage_bus0),voltage_bus1:Number(r.voltage_bus1),s_nom:Number(r.s_nom)}}))},t.converters={type:"FeatureCollection",features:e.converters.map(r=>({type:"Feature",geometry:{type:"LineString",coordinates:Rl(r.geometry||"")},properties:{converter_id:r.converter_id,bus0:r.bus0,bus1:r.bus1,voltage:Number(r.voltage),p_nom:Number(r.p_nom)}}))},n(t)})()},[n])}const p6=()=>{d6();const n=hp(e=>e.ready);return $t.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[$t.jsxs("div",{style:{flex:1,position:"relative"},children:[$t.jsx(a6,{}),!n&&$t.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.5)",zIndex:100},children:$t.jsx("div",{className:"custom-spinner",style:{fontSize:32},children:"Cargando..."})})]}),$t.jsx(yT,{})]})};Lw.createRoot(document.getElementById("root")).render($t.jsx(p6,{}));export{Ad as g};
